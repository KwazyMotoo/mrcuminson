this.createjs=this.createjs||{},function(){var e=createjs.SoundJS=createjs.SoundJS||{};e.version="1.0.0",e.buildDate="Thu, 14 Sep 2017 19:47:47 GMT"}(),this.createjs=this.createjs||{},createjs.extend=function(e,t){"use strict";function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n},this.createjs=this.createjs||{},createjs.promote=function(e,t){"use strict";var n=e.prototype,i=Object.getPrototypeOf&&Object.getPrototypeOf(n)||n.__proto__;if(i)for(var r in n[(t+="_")+"constructor"]=i.constructor,i)n.hasOwnProperty(r)&&"function"==typeof i[r]&&(n[t+r]=i[r]);return e},this.createjs=this.createjs||{},createjs.deprecate=function(e,t){"use strict";return function(){var n="Deprecated property or method '"+t+"'. See docs for info.";return console&&(console.warn?console.warn(n):console.log(n)),e&&e.apply(this,arguments)}},this.createjs=this.createjs||{},createjs.indexOf=function(e,t){"use strict";for(var n=0,i=e.length;i>n;n++)if(t===e[n])return n;return-1},this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,Array.prototype.slice.call(arguments,0).concat(n))}}}(),this.createjs=this.createjs||{},function(){"use strict";function e(){throw"BrowserDetect cannot be instantiated"}var t=e.agent=window.navigator.userAgent;e.isWindowPhone=t.indexOf("IEMobile")>-1||t.indexOf("Windows Phone")>-1,e.isFirefox=t.indexOf("Firefox")>-1,e.isOpera=null!=window.opera,e.isChrome=t.indexOf("Chrome")>-1,e.isIOS=(t.indexOf("iPod")>-1||t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1)&&!e.isWindowPhone,e.isAndroid=t.indexOf("Android")>-1&&!e.isWindowPhone,e.isBlackberry=t.indexOf("Blackberry")>-1,createjs.BrowserDetect=e}(),this.createjs=this.createjs||{},function(){"use strict";function e(){this._listeners=null,this._captureListeners=null}var t=e.prototype;e.initialize=function(e){e.addEventListener=t.addEventListener,e.on=t.on,e.removeEventListener=e.off=t.removeEventListener,e.removeAllEventListeners=t.removeAllEventListeners,e.hasEventListener=t.hasEventListener,e.dispatchEvent=t.dispatchEvent,e._dispatchEvent=t._dispatchEvent,e.willTrigger=t.willTrigger},t.addEventListener=function(e,t,n){var i,r=(i=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{})[e];return r&&this.removeEventListener(e,t,n),(r=i[e])?r.push(t):i[e]=[t],t},t.on=function(e,t,n,i,r,o){return t.handleEvent&&(n=n||t,t=t.handleEvent),n=n||this,this.addEventListener(e,function(e){t.call(n,e,r),i&&e.remove()},o)},t.removeEventListener=function(e,t,n){var i=n?this._captureListeners:this._listeners;if(i){var r=i[e];if(r)for(var o=0,a=r.length;a>o;o++)if(r[o]==t){1==a?delete i[e]:r.splice(o,1);break}}},t.off=t.removeEventListener,t.removeAllEventListeners=function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},t.dispatchEvent=function(e,t,n){if("string"==typeof e){var i=this._listeners;if(!(t||i&&i[e]))return!0;e=new createjs.Event(e,t,n)}else e.target&&e.clone&&(e=e.clone());try{e.target=this}catch(e){}if(e.bubbles&&this.parent){for(var r=this,o=[r];r.parent;)o.push(r=r.parent);var a,s=o.length;for(a=s-1;a>=0&&!e.propagationStopped;a--)o[a]._dispatchEvent(e,1+(0==a));for(a=1;s>a&&!e.propagationStopped;a++)o[a]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return!e.defaultPrevented},t.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},t.willTrigger=function(e){for(var t=this;t;){if(t.hasEventListener(e))return!0;t=t.parent}return!1},t.toString=function(){return"[EventDispatcher]"},t._dispatchEvent=function(e,t){var n,i,r=2>=t?this._captureListeners:this._listeners;if(e&&r&&(i=r[e.type])&&(n=i.length)){try{e.currentTarget=this}catch(e){}try{e.eventPhase=0|t}catch(e){}e.removed=!1,i=i.slice();for(var o=0;n>o&&!e.immediatePropagationStopped;o++){var a=i[o];a.handleEvent?a.handleEvent(e):a(e),e.removed&&(this.off(e.type,a,1==t),e.removed=!1)}}2===t&&this._dispatchEvent(e,2.1)},createjs.EventDispatcher=e}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t,n){this.type=e,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!t,this.cancelable=!!n,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var t=e.prototype;t.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},t.stopPropagation=function(){this.propagationStopped=!0},t.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.remove=function(){this.removed=!0},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},t.set=function(e){for(var t in e)this[t]=e[t];return this},t.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=e}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t,n){this.Event_constructor("error"),this.title=e,this.message=t,this.data=n}createjs.extend(e,createjs.Event).clone=function(){return new createjs.ErrorEvent(this.title,this.message,this.data)},createjs.ErrorEvent=createjs.promote(e,"Event")}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t){this.Event_constructor("progress"),this.loaded=e,this.total=null==t?1:t,this.progress=0==t?0:this.loaded/this.total}createjs.extend(e,createjs.Event).clone=function(){return new createjs.ProgressEvent(this.loaded,this.total)},createjs.ProgressEvent=createjs.promote(e,"Event")}(window),this.createjs=this.createjs||{},function(){"use strict";function e(){this.src=null,this.type=null,this.id=null,this.maintainOrder=!1,this.callback=null,this.data=null,this.method=createjs.Methods.GET,this.values=null,this.headers=null,this.withCredentials=!1,this.mimeType=null,this.crossOrigin=null,this.loadTimeout=n.LOAD_TIMEOUT_DEFAULT}var t=e.prototype={},n=e;n.LOAD_TIMEOUT_DEFAULT=8e3,n.create=function(t){if("string"==typeof t){var i=new e;return i.src=t,i}if(t instanceof n)return t;if(t instanceof Object&&t.src)return null==t.loadTimeout&&(t.loadTimeout=n.LOAD_TIMEOUT_DEFAULT),t;throw new Error("Type not recognized.")},t.set=function(e){for(var t in e)this[t]=e[t];return this},createjs.LoadItem=n}(),this.createjs=this.createjs||{},function(){var e={POST:"POST",GET:"GET"};createjs.Methods=e}(),this.createjs=this.createjs||{},function(){var e={BINARY:"binary",CSS:"css",FONT:"font",FONTCSS:"fontcss",IMAGE:"image",JAVASCRIPT:"javascript",JSON:"json",JSONP:"jsonp",MANIFEST:"manifest",SOUND:"sound",VIDEO:"video",SPRITESHEET:"spritesheet",SVG:"svg",TEXT:"text",XML:"xml"};createjs.Types=e}(),function(){var e={a:function(){return e.el("a")},svg:function(){return e.el("svg")},object:function(){return e.el("object")},image:function(){return e.el("image")},img:function(){return e.el("img")},style:function(){return e.el("style")},link:function(){return e.el("link")},script:function(){return e.el("script")},audio:function(){return e.el("audio")},video:function(){return e.el("video")},text:function(e){return document.createTextNode(e)},el:function(e){return document.createElement(e)}};createjs.Elements=e}(),function(){var e={container:null,appendToHead:function(t){e.getHead().appendChild(t)},appendToBody:function(t){if(null==e.container){e.container=document.createElement("div"),e.container.id="preloadjs-container";var n=e.container.style;n.visibility="hidden",n.position="absolute",n.width=e.container.style.height="10px",n.overflow="hidden",n.transform=n.msTransform=n.webkitTransform=n.oTransform="translate(-10px, -10px)",e.getBody().appendChild(e.container)}e.container.appendChild(t)},getHead:function(){return document.head||document.getElementsByTagName("head")[0]},getBody:function(){return document.body||document.getElementsByTagName("body")[0]},removeChild:function(e){e.parent&&e.parent.removeChild(e)},isImageTag:function(e){return e instanceof HTMLImageElement},isAudioTag:function(e){return!!window.HTMLAudioElement&&e instanceof HTMLAudioElement},isVideoTag:function(e){return!!window.HTMLVideoElement&&e instanceof HTMLVideoElement}};createjs.DomUtils=e}(),function(){var e={isBinary:function(e){switch(e){case createjs.Types.IMAGE:case createjs.Types.BINARY:return!0;default:return!1}},isText:function(e){switch(e){case createjs.Types.TEXT:case createjs.Types.JSON:case createjs.Types.MANIFEST:case createjs.Types.XML:case createjs.Types.CSS:case createjs.Types.SVG:case createjs.Types.JAVASCRIPT:case createjs.Types.SPRITESHEET:return!0;default:return!1}},getTypeByExtension:function(e){if(null==e)return createjs.Types.TEXT;switch(e.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.Types.IMAGE;case"ogg":case"mp3":case"webm":return createjs.Types.SOUND;case"mp4":case"webm":case"ts":return createjs.Types.VIDEO;case"json":return createjs.Types.JSON;case"xml":return createjs.Types.XML;case"css":return createjs.Types.CSS;case"js":return createjs.Types.JAVASCRIPT;case"svg":return createjs.Types.SVG;default:return createjs.Types.TEXT}}};createjs.RequestUtils=e}(),function(){var e={ABSOLUTE_PATT:/^(?:\w+:)?\/{2}/i,RELATIVE_PATT:/^[.\/]*?\//i,EXTENSION_PATT:/\/?[^\/]+\.(\w{1,5})$/i,parseURI:function(t){var n={absolute:!1,relative:!1,protocol:null,hostname:null,port:null,pathname:null,search:null,hash:null,host:null};if(null==t)return n;var i=createjs.Elements.a();for(var r in i.href=t,n)r in i&&(n[r]=i[r]);var o,a=t.indexOf("?");return a>-1&&(t=t.substr(0,a)),e.ABSOLUTE_PATT.test(t)?n.absolute=!0:e.RELATIVE_PATT.test(t)&&(n.relative=!0),(o=t.match(e.EXTENSION_PATT))&&(n.extension=o[1].toLowerCase()),n},formatQueryString:function(e,t){if(null==e)throw new Error("You must specify data.");var n=[];for(var i in e)n.push(i+"="+escape(e[i]));return t&&(n=n.concat(t)),n.join("&")},buildURI:function(e,t){if(null==t)return e;var n=[],i=e.indexOf("?");if(-1!=i){var r=e.slice(i+1);n=n.concat(r.split("&"))}return-1!=i?e.slice(0,i)+"?"+this.formatQueryString(t,n):e+"?"+this.formatQueryString(t,n)},isCrossDomain:function(e){var t=createjs.Elements.a();t.href=e.src;var n=createjs.Elements.a();return n.href=location.href,""!=t.hostname&&(t.port!=n.port||t.protocol!=n.protocol||t.hostname!=n.hostname)},isLocal:function(e){var t=createjs.Elements.a();return t.href=e.src,""==t.hostname&&"file:"==t.protocol}};createjs.URLUtils=e}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t,n){this.EventDispatcher_constructor(),this.loaded=!1,this.canceled=!1,this.progress=0,this.type=n,this.resultFormatter=null,this._item=e?createjs.LoadItem.create(e):null,this._preferXHR=t,this._result=null,this._rawResult=null,this._loadedItems=null,this._tagSrcAttribute=null,this._tag=null}var t=createjs.extend(e,createjs.EventDispatcher),n=e;try{Object.defineProperties(n,{POST:{get:createjs.deprecate(function(){return createjs.Methods.POST},"AbstractLoader.POST")},GET:{get:createjs.deprecate(function(){return createjs.Methods.GET},"AbstractLoader.GET")},BINARY:{get:createjs.deprecate(function(){return createjs.Types.BINARY},"AbstractLoader.BINARY")},CSS:{get:createjs.deprecate(function(){return createjs.Types.CSS},"AbstractLoader.CSS")},FONT:{get:createjs.deprecate(function(){return createjs.Types.FONT},"AbstractLoader.FONT")},FONTCSS:{get:createjs.deprecate(function(){return createjs.Types.FONTCSS},"AbstractLoader.FONTCSS")},IMAGE:{get:createjs.deprecate(function(){return createjs.Types.IMAGE},"AbstractLoader.IMAGE")},JAVASCRIPT:{get:createjs.deprecate(function(){return createjs.Types.JAVASCRIPT},"AbstractLoader.JAVASCRIPT")},JSON:{get:createjs.deprecate(function(){return createjs.Types.JSON},"AbstractLoader.JSON")},JSONP:{get:createjs.deprecate(function(){return createjs.Types.JSONP},"AbstractLoader.JSONP")},MANIFEST:{get:createjs.deprecate(function(){return createjs.Types.MANIFEST},"AbstractLoader.MANIFEST")},SOUND:{get:createjs.deprecate(function(){return createjs.Types.SOUND},"AbstractLoader.SOUND")},VIDEO:{get:createjs.deprecate(function(){return createjs.Types.VIDEO},"AbstractLoader.VIDEO")},SPRITESHEET:{get:createjs.deprecate(function(){return createjs.Types.SPRITESHEET},"AbstractLoader.SPRITESHEET")},SVG:{get:createjs.deprecate(function(){return createjs.Types.SVG},"AbstractLoader.SVG")},TEXT:{get:createjs.deprecate(function(){return createjs.Types.TEXT},"AbstractLoader.TEXT")},XML:{get:createjs.deprecate(function(){return createjs.Types.XML},"AbstractLoader.XML")}})}catch(e){}t.getItem=function(){return this._item},t.getResult=function(e){return e?this._rawResult:this._result},t.getTag=function(){return this._tag},t.setTag=function(e){this._tag=e},t.load=function(){this._createRequest(),this._request.on("complete",this,this),this._request.on("progress",this,this),this._request.on("loadStart",this,this),this._request.on("abort",this,this),this._request.on("timeout",this,this),this._request.on("error",this,this);var e=new createjs.Event("initialize");e.loader=this._request,this.dispatchEvent(e),this._request.load()},t.cancel=function(){this.canceled=!0,this.destroy()},t.destroy=function(){this._request&&(this._request.removeAllEventListeners(),this._request.destroy()),this._request=null,this._item=null,this._rawResult=null,this._result=null,this._loadItems=null,this.removeAllEventListeners()},t.getLoadedItems=function(){return this._loadedItems},t._createRequest=function(){this._request=this._preferXHR?new createjs.XHRRequest(this._item):new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},t._createTag=function(){return null},t._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},t._sendProgress=function(e){if(!this._isCanceled()){var t=null;"number"==typeof e?(this.progress=e,t=new createjs.ProgressEvent(this.progress)):(t=e,this.progress=e.loaded/e.total,t.progress=this.progress,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),this.hasEventListener("progress")&&this.dispatchEvent(t)}},t._sendComplete=function(){if(!this._isCanceled()){this.loaded=!0;var e=new createjs.Event("complete");e.rawResult=this._rawResult,null!=this._result&&(e.result=this._result),this.dispatchEvent(e)}},t._sendError=function(e){!this._isCanceled()&&this.hasEventListener("error")&&(null==e&&(e=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY")),this.dispatchEvent(e))},t._isCanceled=function(){return!(null!=window.createjs&&!this.canceled)},t.resultFormatter=null,t.handleEvent=function(e){switch(e.type){case"complete":this._rawResult=e.target._response;var t=this.resultFormatter&&this.resultFormatter(this);t instanceof Function?t.call(this,createjs.proxy(this._resultFormatSuccess,this),createjs.proxy(this._resultFormatFailed,this)):(this._result=t||this._rawResult,this._sendComplete());break;case"progress":this._sendProgress(e);break;case"error":this._sendError(e);break;case"loadstart":this._sendLoadStart();break;case"abort":case"timeout":this._isCanceled()||this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_"+e.type.toUpperCase()+"_ERROR"))}},t._resultFormatSuccess=function(e){this._result=e,this._sendComplete()},t._resultFormatFailed=function(e){this._sendError(e)},t.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=createjs.promote(e,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t,n){this.AbstractLoader_constructor(e,t,n),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src",this.on("initialize",this._updateXHR,this)}var t=createjs.extend(e,createjs.AbstractLoader);t.load=function(){this._tag||(this._tag=this._createTag(this._item.src)),this._tag.preload="auto",this._tag.load(),this.AbstractLoader_load()},t._createTag=function(){},t._createRequest=function(){this._request=this._preferXHR?new createjs.XHRRequest(this._item):new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},t._updateXHR=function(e){e.loader.setResponseType&&e.loader.setResponseType("blob")},t._formatResult=function(e){if(this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.onstalled=null,this._preferXHR){var t=window.URL||window.webkitURL,n=e.getResult(!0);e.getTag().src=t.createObjectURL(n)}return e.getTag()},createjs.AbstractMediaLoader=createjs.promote(e,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(e){this._item=e},t=createjs.extend(e,createjs.EventDispatcher);t.load=function(){},t.destroy=function(){},t.cancel=function(){},createjs.AbstractRequest=createjs.promote(e,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t,n){this.AbstractRequest_constructor(e),this._tag=t,this._tagSrcAttribute=n,this._loadedHandler=createjs.proxy(this._handleTagComplete,this),this._addedToDOM=!1}var t=createjs.extend(e,createjs.AbstractRequest);t.load=function(){this._tag.onload=createjs.proxy(this._handleTagComplete,this),this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this),this._tag.onerror=createjs.proxy(this._handleError,this);var e=new createjs.Event("initialize");e.loader=this._tag,this.dispatchEvent(e),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout),this._tag[this._tagSrcAttribute]=this._item.src,null==this._tag.parentNode&&(createjs.DomUtils.appendToBody(this._tag),this._addedToDOM=!0)},t.destroy=function(){this._clean(),this._tag=null,this.AbstractRequest_destroy()},t._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var e=this._tag;("loaded"==e.readyState||"complete"==e.readyState)&&this._handleTagComplete()},t._handleError=function(){this._clean(),this.dispatchEvent("error")},t._handleTagComplete=function(){this._rawResult=this._tag,this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult,this._clean(),this.dispatchEvent("complete")},t._handleTimeout=function(){this._clean(),this.dispatchEvent(new createjs.Event("timeout"))},t._clean=function(){this._tag.onload=null,this._tag.onreadystatechange=null,this._tag.onerror=null,this._addedToDOM&&null!=this._tag.parentNode&&this._tag.parentNode.removeChild(this._tag),clearTimeout(this._loadTimeout)},t._handleStalled=function(){},createjs.TagRequest=createjs.promote(e,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t,n){this.AbstractRequest_constructor(e),this._tag=t,this._tagSrcAttribute=n,this._loadedHandler=createjs.proxy(this._handleTagComplete,this)}var t=createjs.extend(e,createjs.TagRequest);t.load=function(){var e=createjs.proxy(this._handleStalled,this);this._stalledCallback=e;var t=createjs.proxy(this._handleProgress,this);this._handleProgress=t,this._tag.addEventListener("stalled",e),this._tag.addEventListener("progress",t),this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,!1),this.TagRequest_load()},t._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var e=this._tag;("loaded"==e.readyState||"complete"==e.readyState)&&this._handleTagComplete()},t._handleStalled=function(){},t._handleProgress=function(e){if(e&&!(e.loaded>0&&0==e.total)){var t=new createjs.ProgressEvent(e.loaded,e.total);this.dispatchEvent(t)}},t._clean=function(){this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.removeEventListener("stalled",this._stalledCallback),this._tag.removeEventListener("progress",this._progressCallback),this.TagRequest__clean()},createjs.MediaTagRequest=createjs.promote(e,"TagRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function e(e){this.AbstractRequest_constructor(e),this._request=null,this._loadTimeout=null,this._xhrLevel=1,this._response=null,this._rawResponse=null,this._canceled=!1,this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this),this._handleProgressProxy=createjs.proxy(this._handleProgress,this),this._handleAbortProxy=createjs.proxy(this._handleAbort,this),this._handleErrorProxy=createjs.proxy(this._handleError,this),this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this),this._handleLoadProxy=createjs.proxy(this._handleLoad,this),this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this),this._createXHR(e)}var t=createjs.extend(e,createjs.AbstractRequest);e.ACTIVEX_VERSIONS=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],t.getResult=function(e){return e&&this._rawResponse?this._rawResponse:this._response},t.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},t.load=function(){if(null!=this._request){null!=this._request.addEventListener?(this._request.addEventListener("loadstart",this._handleLoadStartProxy,!1),this._request.addEventListener("progress",this._handleProgressProxy,!1),this._request.addEventListener("abort",this._handleAbortProxy,!1),this._request.addEventListener("error",this._handleErrorProxy,!1),this._request.addEventListener("timeout",this._handleTimeoutProxy,!1),this._request.addEventListener("load",this._handleLoadProxy,!1),this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,!1)):(this._request.onloadstart=this._handleLoadStartProxy,this._request.onprogress=this._handleProgressProxy,this._request.onabort=this._handleAbortProxy,this._request.onerror=this._handleErrorProxy,this._request.ontimeout=this._handleTimeoutProxy,this._request.onload=this._handleLoadProxy,this._request.onreadystatechange=this._handleReadyStateChangeProxy),1==this._xhrLevel&&(this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout));try{this._item.values?this._request.send(createjs.URLUtils.formatQueryString(this._item.values)):this._request.send()}catch(e){this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,e))}}else this._handleError()},t.setResponseType=function(e){"blob"===e&&(e=window.URL?"blob":"arraybuffer",this._responseType=e),this._request.responseType=e},t.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},t.getResponseHeader=function(e){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(e):null},t._handleProgress=function(e){if(e&&!(e.loaded>0&&0==e.total)){var t=new createjs.ProgressEvent(e.loaded,e.total);this.dispatchEvent(t)}},t._handleLoadStart=function(){clearTimeout(this._loadTimeout),this.dispatchEvent("loadstart")},t._handleAbort=function(e){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,e))},t._handleError=function(e){this._clean(),this.dispatchEvent(new createjs.ErrorEvent(e.message))},t._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},t._handleLoad=function(){if(!this.loaded){this.loaded=!0;var e=this._checkError();if(e)return void this._handleError(e);if(this._response=this._getResponse(),"arraybuffer"===this._responseType)try{this._response=new Blob([this._response])}catch(e){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"===e.name&&window.BlobBuilder){var t=new BlobBuilder;t.append(this._response),this._response=t.getBlob()}}this._clean(),this.dispatchEvent(new createjs.Event("complete"))}},t._handleTimeout=function(e){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,e))},t._checkError=function(){var e=parseInt(this._request.status);return e>=400&&599>=e?new Error(e):0==e&&/^https?:/.test(location.protocol)?new Error(0):null},t._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(e){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(e){}return null},t._createXHR=function(e){var t=createjs.URLUtils.isCrossDomain(e),n={},i=null;if(window.XMLHttpRequest)i=new XMLHttpRequest,t&&void 0===i.withCredentials&&window.XDomainRequest&&(i=new XDomainRequest);else{for(var r=0,o=s.ACTIVEX_VERSIONS.length;o>r;r++){var a=s.ACTIVEX_VERSIONS[r];try{i=new ActiveXObject(a);break}catch(e){}}if(null==i)return!1}null==e.mimeType&&createjs.RequestUtils.isText(e.type)&&(e.mimeType="text/plain; charset=utf-8"),e.mimeType&&i.overrideMimeType&&i.overrideMimeType(e.mimeType),this._xhrLevel="string"==typeof i.responseType?2:1;var l;if(l=e.method==createjs.Methods.GET?createjs.URLUtils.buildURI(e.src,e.values):e.src,i.open(e.method||createjs.Methods.GET,l,!0),t&&i instanceof XMLHttpRequest&&1==this._xhrLevel&&(n.Origin=location.origin),e.values&&e.method==createjs.Methods.POST&&(n["Content-Type"]="application/x-www-form-urlencoded"),t||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),e.headers)for(var c in e.headers)n[c]=e.headers[c];for(c in n)i.setRequestHeader(c,n[c]);return i instanceof XMLHttpRequest&&void 0!==e.withCredentials&&(i.withCredentials=e.withCredentials),this._request=i,!0},t._clean=function(){clearTimeout(this._loadTimeout),null!=this._request.removeEventListener?(this._request.removeEventListener("loadstart",this._handleLoadStartProxy),this._request.removeEventListener("progress",this._handleProgressProxy),this._request.removeEventListener("abort",this._handleAbortProxy),this._request.removeEventListener("error",this._handleErrorProxy),this._request.removeEventListener("timeout",this._handleTimeoutProxy),this._request.removeEventListener("load",this._handleLoadProxy),this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy)):(this._request.onloadstart=null,this._request.onprogress=null,this._request.onabort=null,this._request.onerror=null,this._request.ontimeout=null,this._request.onload=null,this._request.onreadystatechange=null)},t.toString=function(){return"[PreloadJS XHRRequest]"},createjs.XHRRequest=createjs.promote(e,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t){this.AbstractMediaLoader_constructor(e,t,createjs.Types.SOUND),createjs.DomUtils.isAudioTag(e)?this._tag=e:createjs.DomUtils.isAudioTag(e.src)?this._tag=e:createjs.DomUtils.isAudioTag(e.tag)&&(this._tag=createjs.DomUtils.isAudioTag(e)?e:e.src),null!=this._tag&&(this._preferXHR=!1)}var t=createjs.extend(e,createjs.AbstractMediaLoader);e.canLoadItem=function(e){return e.type==createjs.Types.SOUND},t._createTag=function(e){var t=createjs.Elements.audio();return t.autoplay=!1,t.preload="none",t.src=e,t},createjs.SoundLoader=createjs.promote(e,"AbstractMediaLoader")}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(){this.interrupt=null,this.delay=null,this.offset=null,this.loop=null,this.volume=null,this.pan=null,this.startTime=null,this.duration=null},t=e.prototype={},n=e;n.create=function(e){if("string"==typeof e)return console&&(console.warn||console.log)("Deprecated behaviour. Sound.play takes a configuration object instead of individual arguments. See docs for info."),(new createjs.PlayPropsConfig).set({interrupt:e});if(null==e||e instanceof n||e instanceof Object)return(new createjs.PlayPropsConfig).set(e);if(null==e)throw new Error("PlayProps configuration not recognized.")},t.set=function(e){if(null!=e)for(var t in e)this[t]=e[t];return this},t.toString=function(){return"[PlayPropsConfig]"},createjs.PlayPropsConfig=n}(),this.createjs=this.createjs||{},function(){"use strict";function e(){throw"Sound cannot be instantiated"}function t(e,t){this.init(e,t)}var n=e;n.INTERRUPT_ANY="any",n.INTERRUPT_EARLY="early",n.INTERRUPT_LATE="late",n.INTERRUPT_NONE="none",n.PLAY_INITED="playInited",n.PLAY_SUCCEEDED="playSucceeded",n.PLAY_INTERRUPTED="playInterrupted",n.PLAY_FINISHED="playFinished",n.PLAY_FAILED="playFailed",n.SUPPORTED_EXTENSIONS=["mp3","ogg","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"],n.EXTENSION_MAP={m4a:"mp4"},n.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([\/.]*?(?:[^?]+)?\/)?((?:[^\/?]+)\.(\w+))(?:\?(\S+)?)?$/,n.defaultInterruptBehavior=n.INTERRUPT_NONE,n.alternateExtensions=[],n.activePlugin=null,n._masterVolume=1,n._getMasterVolume=function(){return this._masterVolume},n.getVolume=createjs.deprecate(n._getMasterVolume,"Sound.getVolume"),n._setMasterVolume=function(e){if(null!=Number(e)&&(e=Math.max(0,Math.min(1,e)),n._masterVolume=e,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(e)))for(var t=this._instances,i=0,r=t.length;r>i;i++)t[i].setMasterVolume(e)},n.setVolume=createjs.deprecate(n._setMasterVolume,"Sound.setVolume"),n._masterMute=!1,n._getMute=function(){return this._masterMute},n.getMute=createjs.deprecate(n._getMute,"Sound.getMute"),n._setMute=function(e){if(null!=e&&(this._masterMute=e,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(e)))for(var t=this._instances,n=0,i=t.length;i>n;n++)t[n].setMasterMute(e)},n.setMute=createjs.deprecate(n._setMute,"Sound.setMute"),n._getCapabilities=function(){return null==n.activePlugin?null:n.activePlugin._capabilities},n.getCapabilities=createjs.deprecate(n._getCapabilities,"Sound.getCapabilities"),Object.defineProperties(n,{volume:{get:n._getMasterVolume,set:n._setMasterVolume},muted:{get:n._getMute,set:n._setMute},capabilities:{get:n._getCapabilities}}),n._pluginsRegistered=!1,n._lastID=0,n._instances=[],n._idHash={},n._preloadHash={},n._defaultPlayPropsHash={},n.addEventListener=null,n.removeEventListener=null,n.removeAllEventListeners=null,n.dispatchEvent=null,n.hasEventListener=null,n._listeners=null,createjs.EventDispatcher.initialize(n),n.getPreloadHandlers=function(){return{callback:createjs.proxy(n.initLoad,n),types:["sound"],extensions:n.SUPPORTED_EXTENSIONS}},n._handleLoadComplete=function(e){var t=e.target.getItem().src;if(n._preloadHash[t])for(var i=0,r=n._preloadHash[t].length;r>i;i++){var o=n._preloadHash[t][i];if(n._preloadHash[t][i]=!0,n.hasEventListener("fileload"))(e=new createjs.Event("fileload")).src=o.src,e.id=o.id,e.data=o.data,e.sprite=o.sprite,n.dispatchEvent(e)}},n._handleLoadError=function(e){var t=e.target.getItem().src;if(n._preloadHash[t])for(var i=0,r=n._preloadHash[t].length;r>i;i++){var o=n._preloadHash[t][i];if(n._preloadHash[t][i]=!1,n.hasEventListener("fileerror"))(e=new createjs.Event("fileerror")).src=o.src,e.id=o.id,e.data=o.data,e.sprite=o.sprite,n.dispatchEvent(e)}},n._registerPlugin=function(e){return!!e.isSupported()&&(n.activePlugin=new e,!0)},n.registerPlugins=function(e){n._pluginsRegistered=!0;for(var t=0,i=e.length;i>t;t++)if(n._registerPlugin(e[t]))return!0;return!1},n.initializeDefaultPlugins=function(){return null!=n.activePlugin||!n._pluginsRegistered&&!!n.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])},n.isReady=function(){return null!=n.activePlugin},n.initLoad=function(e){return"video"==e.type||n._registerSound(e)},n._registerSound=function(e){if(!n.initializeDefaultPlugins())return!1;var i;if(e.src instanceof Object?(i=n._parseSrc(e.src)).src=e.path+i.src:i=n._parsePath(e.src),null==i)return!1;e.src=i.src,e.type="sound";var r=e.data,o=null;if(null!=r&&(isNaN(r.channels)?isNaN(r)||(o=parseInt(r)):o=parseInt(r.channels),r.audioSprite))for(var a,s=r.audioSprite.length;s--;)a=r.audioSprite[s],n._idHash[a.id]={src:e.src,startTime:parseInt(a.startTime),duration:parseInt(a.duration)},a.defaultPlayProps&&(n._defaultPlayPropsHash[a.id]=createjs.PlayPropsConfig.create(a.defaultPlayProps));null!=e.id&&(n._idHash[e.id]={src:e.src});var l=n.activePlugin.register(e);return t.create(e.src,o),null!=r&&isNaN(r)?e.data.channels=o||t.maxPerChannel():e.data=o||t.maxPerChannel(),l.type&&(e.type=l.type),e.defaultPlayProps&&(n._defaultPlayPropsHash[e.src]=createjs.PlayPropsConfig.create(e.defaultPlayProps)),l},n.registerSound=function(e,t,i,r,o){var a={src:e,id:t,data:i,defaultPlayProps:o};e instanceof Object&&e.src&&(r=t,a=e),(a=createjs.LoadItem.create(a)).path=r,null==r||a.src instanceof Object||(a.src=r+a.src);var s=n._registerSound(a);if(!s)return!1;if(n._preloadHash[a.src]||(n._preloadHash[a.src]=[]),n._preloadHash[a.src].push(a),1==n._preloadHash[a.src].length)s.on("complete",this._handleLoadComplete,this),s.on("error",this._handleLoadError,this),n.activePlugin.preload(s);else if(1==n._preloadHash[a.src][0])return!0;return a},n.registerSounds=function(e,t){var n=[];e.path&&(t?t+=e.path:t=e.path,e=e.manifest);for(var i=0,r=e.length;r>i;i++)n[i]=createjs.Sound.registerSound(e[i].src,e[i].id,e[i].data,t,e[i].defaultPlayProps);return n},n.removeSound=function(e,i){if(null==n.activePlugin)return!1;var r;if(e instanceof Object&&e.src&&(e=e.src),e instanceof Object?r=n._parseSrc(e):(e=n._getSrcById(e).src,r=n._parsePath(e)),null==r)return!1;for(var o in e=r.src,null!=i&&(e=i+e),n._idHash)n._idHash[o].src==e&&delete n._idHash[o];return t.removeSrc(e),delete n._preloadHash[e],n.activePlugin.removeSound(e),!0},n.removeSounds=function(e,t){var n=[];e.path&&(t?t+=e.path:t=e.path,e=e.manifest);for(var i=0,r=e.length;r>i;i++)n[i]=createjs.Sound.removeSound(e[i].src,t);return n},n.removeAllSounds=function(){n._idHash={},n._preloadHash={},t.removeAll(),n.activePlugin&&n.activePlugin.removeAllSounds()},n.loadComplete=function(e){if(!n.isReady())return!1;var t=n._parsePath(e);return e=t?n._getSrcById(t.src).src:n._getSrcById(e).src,void 0!=n._preloadHash[e]&&1==n._preloadHash[e][0]},n._parsePath=function(e){"string"!=typeof e&&(e=e.toString());var t=e.match(n.FILE_PATTERN);if(null==t)return!1;for(var i=t[4],r=t[5],o=n.capabilities,a=0;!o[r];)if(r=n.alternateExtensions[a++],a>n.alternateExtensions.length)return null;return{name:i,src:e=e.replace("."+t[5],"."+r),extension:r}},n._parseSrc=function(e){var t={name:void 0,src:void 0,extension:void 0},i=n.capabilities;for(var r in e)if(e.hasOwnProperty(r)&&i[r]){t.src=e[r],t.extension=r;break}if(!t.src)return!1;var o=t.src.lastIndexOf("/");return t.name=-1!=o?t.src.slice(o+1):t.src,t},n.play=function(e,t){var i=createjs.PlayPropsConfig.create(t),r=n.createInstance(e,i.startTime,i.duration);return n._playInstance(r,i)||r._playFailed(),r},n.createInstance=function(e,i,r){if(!n.initializeDefaultPlugins())return new createjs.DefaultSoundInstance(e,i,r);var o=n._defaultPlayPropsHash[e];e=n._getSrcById(e);var a=n._parsePath(e.src),s=null;return null!=a&&null!=a.src?(t.create(a.src),null==i&&(i=e.startTime),s=n.activePlugin.create(a.src,i,r||e.duration),(o=o||n._defaultPlayPropsHash[a.src])&&s.applyPlayProps(o)):s=new createjs.DefaultSoundInstance(e,i,r),s.uniqueId=n._lastID++,s},n.stop=function(){for(var e=this._instances,t=e.length;t--;)e[t].stop()},n.setDefaultPlayProps=function(e,t){e=n._getSrcById(e),n._defaultPlayPropsHash[n._parsePath(e.src).src]=createjs.PlayPropsConfig.create(t)},n.getDefaultPlayProps=function(e){return e=n._getSrcById(e),n._defaultPlayPropsHash[n._parsePath(e.src).src]},n._playInstance=function(e,t){var i=n._defaultPlayPropsHash[e.src]||{};if(null==t.interrupt&&(t.interrupt=i.interrupt||n.defaultInterruptBehavior),null==t.delay&&(t.delay=i.delay||0),null==t.offset&&(t.offset=e.position),null==t.loop&&(t.loop=e.loop),null==t.volume&&(t.volume=e.volume),null==t.pan&&(t.pan=e.pan),0==t.delay){if(!n._beginPlaying(e,t))return!1}else{var r=setTimeout(function(){n._beginPlaying(e,t)},t.delay);e.delayTimeoutId=r}return this._instances.push(e),!0},n._beginPlaying=function(e,n){if(!t.add(e,n.interrupt))return!1;if(!e._beginPlaying(n)){var i=createjs.indexOf(this._instances,e);return i>-1&&this._instances.splice(i,1),!1}return!0},n._getSrcById=function(e){return n._idHash[e]||{src:e}},n._playFinished=function(e){t.remove(e);var n=createjs.indexOf(this._instances,e);n>-1&&this._instances.splice(n,1)},createjs.Sound=e,t.channels={},t.create=function(e,n){return null==t.get(e)&&(t.channels[e]=new t(e,n),!0)},t.removeSrc=function(e){var n=t.get(e);return null!=n&&(n._removeAll(),delete t.channels[e],!0)},t.removeAll=function(){for(var e in t.channels)t.channels[e]._removeAll();t.channels={}},t.add=function(e,n){var i=t.get(e.src);return null!=i&&i._add(e,n)},t.remove=function(e){var n=t.get(e.src);return null!=n&&(n._remove(e),!0)},t.maxPerChannel=function(){return i.maxDefault},t.get=function(e){return t.channels[e]};var i=t.prototype;i.constructor=t,i.src=null,i.max=null,i.maxDefault=100,i.length=0,i.init=function(e,t){this.src=e,this.max=t||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},i._get=function(e){return this._instances[e]},i._add=function(e,t){return!!this._getSlot(t,e)&&(this._instances.push(e),this.length++,!0)},i._remove=function(e){var t=createjs.indexOf(this._instances,e);return-1!=t&&(this._instances.splice(t,1),this.length--,!0)},i._removeAll=function(){for(var e=this.length-1;e>=0;e--)this._instances[e].stop()},i._getSlot=function(t){var n,i;if(t!=e.INTERRUPT_NONE&&null==(i=this._get(0)))return!0;for(var r=0,o=this.max;o>r;r++){if(null==(n=this._get(r)))return!0;if(n.playState==e.PLAY_FINISHED||n.playState==e.PLAY_INTERRUPTED||n.playState==e.PLAY_FAILED){i=n;break}t!=e.INTERRUPT_NONE&&(t==e.INTERRUPT_EARLY&&n.position<i.position||t==e.INTERRUPT_LATE&&n.position>i.position)&&(i=n)}return null!=i&&(i._interrupt(),this._remove(i),!0)},i.toString=function(){return"[Sound SoundChannel]"}}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(e,t,n,i){this.EventDispatcher_constructor(),this.src=e,this.uniqueId=-1,this.playState=null,this.delayTimeoutId=null,this._volume=1,Object.defineProperty(this,"volume",{get:this._getVolume,set:this._setVolume}),this._pan=0,Object.defineProperty(this,"pan",{get:this._getPan,set:this._setPan}),this._startTime=Math.max(0,t||0),Object.defineProperty(this,"startTime",{get:this._getStartTime,set:this._setStartTime}),this._duration=Math.max(0,n||0),Object.defineProperty(this,"duration",{get:this._getDuration,set:this._setDuration}),this._playbackResource=null,Object.defineProperty(this,"playbackResource",{get:this._getPlaybackResource,set:this._setPlaybackResource}),!1!==i&&!0!==i&&this._setPlaybackResource(i),this._position=0,Object.defineProperty(this,"position",{get:this._getPosition,set:this._setPosition}),this._loop=0,Object.defineProperty(this,"loop",{get:this._getLoop,set:this._setLoop}),this._muted=!1,Object.defineProperty(this,"muted",{get:this._getMuted,set:this._setMuted}),this._paused=!1,Object.defineProperty(this,"paused",{get:this._getPaused,set:this._setPaused})},t=createjs.extend(e,createjs.EventDispatcher);t.play=function(e){var t=createjs.PlayPropsConfig.create(e);return this.playState==createjs.Sound.PLAY_SUCCEEDED?(this.applyPlayProps(t),void(this._paused&&this._setPaused(!1))):(this._cleanUp(),createjs.Sound._playInstance(this,t),this)},t.stop=function(){return this._position=0,this._paused=!1,this._handleStop(),this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this},t.destroy=function(){this._cleanUp(),this.src=null,this.playbackResource=null,this.removeAllEventListeners()},t.applyPlayProps=function(e){return null!=e.offset&&this._setPosition(e.offset),null!=e.loop&&this._setLoop(e.loop),null!=e.volume&&this._setVolume(e.volume),null!=e.pan&&this._setPan(e.pan),null!=e.startTime&&(this._setStartTime(e.startTime),this._setDuration(e.duration)),this},t.toString=function(){return"[AbstractSoundInstance]"},t._getPaused=function(){return this._paused},t._setPaused=function(e){return!0!==e&&!1!==e||this._paused==e||1==e&&this.playState!=createjs.Sound.PLAY_SUCCEEDED?void 0:(this._paused=e,e?this._pause():this._resume(),clearTimeout(this.delayTimeoutId),this)},t._setVolume=function(e){return e==this._volume?this:(this._volume=Math.max(0,Math.min(1,e)),this._muted||this._updateVolume(),this)},t._getVolume=function(){return this._volume},t._setMuted=function(e){return!0===e||!1===e?(this._muted=e,this._updateVolume(),this):void 0},t._getMuted=function(){return this._muted},t._setPan=function(e){return e==this._pan?this:(this._pan=Math.max(-1,Math.min(1,e)),this._updatePan(),this)},t._getPan=function(){return this._pan},t._getPosition=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||(this._position=this._calculateCurrentPosition()),this._position},t._setPosition=function(e){return this._position=Math.max(0,e),this.playState==createjs.Sound.PLAY_SUCCEEDED&&this._updatePosition(),this},t._getStartTime=function(){return this._startTime},t._setStartTime=function(e){return e==this._startTime?this:(this._startTime=Math.max(0,e||0),this._updateStartTime(),this)},t._getDuration=function(){return this._duration},t._setDuration=function(e){return e==this._duration?this:(this._duration=Math.max(0,e||0),this._updateDuration(),this)},t._setPlaybackResource=function(e){return this._playbackResource=e,0==this._duration&&this._playbackResource&&this._setDurationFromSource(),this},t._getPlaybackResource=function(){return this._playbackResource},t._getLoop=function(){return this._loop},t._setLoop=function(e){null!=this._playbackResource&&(0!=this._loop&&0==e?this._removeLooping(e):0==this._loop&&0!=e&&this._addLooping(e)),this._loop=e},t._sendEvent=function(e){var t=new createjs.Event(e);this.dispatchEvent(t)},t._cleanUp=function(){clearTimeout(this.delayTimeoutId),this._handleCleanUp(),this._paused=!1,createjs.Sound._playFinished(this)},t._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._sendEvent("interrupted")},t._beginPlaying=function(e){return this._setPosition(e.offset),this._setLoop(e.loop),this._setVolume(e.volume),this._setPan(e.pan),null!=e.startTime&&(this._setStartTime(e.startTime),this._setDuration(e.duration)),null!=this._playbackResource&&this._position<this._duration?(this._paused=!1,this._handleSoundReady(),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._sendEvent("succeeded"),!0):(this._playFailed(),!1)},t._playFailed=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed")},t._handleSoundComplete=function(){return this._position=0,0!=this._loop?(this._loop--,this._handleLoop(),void this._sendEvent("loop")):(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,void this._sendEvent("complete"))},t._handleSoundReady=function(){},t._updateVolume=function(){},t._updatePan=function(){},t._updateStartTime=function(){},t._updateDuration=function(){},t._setDurationFromSource=function(){},t._calculateCurrentPosition=function(){},t._updatePosition=function(){},t._removeLooping=function(){},t._addLooping=function(){},t._pause=function(){},t._resume=function(){},t._handleStop=function(){},t._handleCleanUp=function(){},t._handleLoop=function(){},createjs.AbstractSoundInstance=createjs.promote(e,"EventDispatcher"),createjs.DefaultSoundInstance=createjs.AbstractSoundInstance}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(){this._capabilities=null,this._loaders={},this._audioSources={},this._soundInstances={},this._volume=1,this._loaderClass,this._soundInstanceClass},t=e.prototype;e._capabilities=null,e.isSupported=function(){return!0},t.register=function(e){var t=this._loaders[e.src];return t&&!t.canceled?this._loaders[e.src]:(this._audioSources[e.src]=!0,this._soundInstances[e.src]=[],(t=new this._loaderClass(e)).on("complete",this._handlePreloadComplete,this),this._loaders[e.src]=t,t)},t.preload=function(e){e.on("error",this._handlePreloadError,this),e.load()},t.isPreloadStarted=function(e){return null!=this._audioSources[e]},t.isPreloadComplete=function(e){return!(null==this._audioSources[e]||1==this._audioSources[e])},t.removeSound=function(e){if(this._soundInstances[e]){for(var t=this._soundInstances[e].length;t--;){this._soundInstances[e][t].destroy()}delete this._soundInstances[e],delete this._audioSources[e],this._loaders[e]&&this._loaders[e].destroy(),delete this._loaders[e]}},t.removeAllSounds=function(){for(var e in this._audioSources)this.removeSound(e)},t.create=function(e,t,n){this.isPreloadStarted(e)||this.preload(this.register(e));var i=new this._soundInstanceClass(e,t,n,this._audioSources[e]);return this._soundInstances[e]&&this._soundInstances[e].push(i),i.setMasterVolume&&i.setMasterVolume(createjs.Sound.volume),i.setMasterMute&&i.setMasterMute(createjs.Sound.muted),i},t.setVolume=function(e){return this._volume=e,this._updateVolume(),!0},t.getVolume=function(){return this._volume},t.setMute=function(){return this._updateVolume(),!0},t.toString=function(){return"[AbstractPlugin]"},t._handlePreloadComplete=function(e){var t=e.target.getItem().src;this._audioSources[t]=e.result;for(var n=0,i=this._soundInstances[t].length;i>n;n++){this._soundInstances[t][n].setPlaybackResource(this._audioSources[t]),this._soundInstances[t]=null}},t._handlePreloadError=function(){},t._updateVolume=function(){},createjs.AbstractPlugin=e}(),this.createjs=this.createjs||{},function(){"use strict";function e(e){this.AbstractLoader_constructor(e,!0,createjs.Types.SOUND)}var t=createjs.extend(e,createjs.AbstractLoader);e.context=null,t.toString=function(){return"[WebAudioLoader]"},t._createRequest=function(){this._request=new createjs.XHRRequest(this._item,!1),this._request.setResponseType("arraybuffer")},t._sendComplete=function(){e.context.decodeAudioData(this._rawResult,createjs.proxy(this._handleAudioDecoded,this),createjs.proxy(this._sendError,this))},t._handleAudioDecoded=function(e){this._result=e,this.AbstractLoader__sendComplete()},createjs.WebAudioLoader=createjs.promote(e,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t,i,r){this.AbstractSoundInstance_constructor(e,t,i,r),this.gainNode=n.context.createGain(),this.panNode=n.context.createPanner(),this.panNode.panningModel=n._panningModel,this.panNode.connect(this.gainNode),this._updatePan(),this.sourceNode=null,this._soundCompleteTimeout=null,this._sourceNodeNext=null,this._playbackStartTime=0,this._endedHandler=createjs.proxy(this._handleSoundComplete,this)}var t=createjs.extend(e,createjs.AbstractSoundInstance),n=e;n.context=null,n._scratchBuffer=null,n.destinationNode=null,n._panningModel="equalpower",t.destroy=function(){this.AbstractSoundInstance_destroy(),this.panNode.disconnect(0),this.panNode=null,this.gainNode.disconnect(0),this.gainNode=null},t.toString=function(){return"[WebAudioSoundInstance]"},t._updatePan=function(){this.panNode.setPosition(this._pan,0,-.5)},t._removeLooping=function(){this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)},t._addLooping=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},t._setDurationFromSource=function(){this._duration=1e3*this.playbackResource.duration},t._handleCleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout),this._playbackStartTime=0},t._cleanUpAudioNode=function(e){if(e){if(e.stop(0),e.disconnect(0),createjs.BrowserDetect.isIOS)try{e.buffer=n._scratchBuffer}catch(e){}e=null}return e},t._handleSoundReady=function(){this.gainNode.connect(n.destinationNode);var e=.001*this._duration,t=Math.min(.001*Math.max(0,this._position),e);this.sourceNode=this._createAndPlayAudioNode(n.context.currentTime-e,t),this._playbackStartTime=this.sourceNode.startTime-t,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(e-t)),0!=this._loop&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},t._createAndPlayAudioNode=function(e,t){var i=n.context.createBufferSource();i.buffer=this.playbackResource,i.connect(this.panNode);var r=.001*this._duration;return i.startTime=e+r,i.start(i.startTime,t+.001*this._startTime,r-t),i},t._pause=function(){this._position=1e3*(n.context.currentTime-this._playbackStartTime),this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout)},t._resume=function(){this._handleSoundReady()},t._updateVolume=function(){var e=this._muted?0:this._volume;e!=this.gainNode.gain.value&&(this.gainNode.gain.value=e)},t._calculateCurrentPosition=function(){return 1e3*(n.context.currentTime-this._playbackStartTime)},t._updatePosition=function(){this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout),this._paused||this._handleSoundReady()},t._handleLoop=function(){this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._playbackStartTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)},t._updateDuration=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._pause(),this._resume())},createjs.WebAudioSoundInstance=createjs.promote(e,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){"use strict";function e(){this.AbstractPlugin_constructor(),this._panningModel=n._panningModel,this.context=n.context,this.dynamicsCompressorNode=this.context.createDynamicsCompressor(),this.dynamicsCompressorNode.connect(this.context.destination),this.gainNode=this.context.createGain(),this.gainNode.connect(this.dynamicsCompressorNode),createjs.WebAudioSoundInstance.destinationNode=this.gainNode,this._capabilities=n._capabilities,this._loaderClass=createjs.WebAudioLoader,this._soundInstanceClass=createjs.WebAudioSoundInstance,this._addPropsToClasses()}var t=createjs.extend(e,createjs.AbstractPlugin),n=e;n._capabilities=null,n._panningModel="equalpower",n.context=null,n._scratchBuffer=null,n._unlocked=!1,n.DEFAULT_SAMPLE_RATE=44100,n.isSupported=function(){var e=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;return!("file:"==location.protocol&&!e&&!this._isFileXHRSupported())&&(n._generateCapabilities(),null!=n.context)},n.playEmptySound=function(){if(null!=n.context){var e=n.context.createBufferSource();e.buffer=n._scratchBuffer,e.connect(n.context.destination),e.start(0,0,0)}},n._isFileXHRSupported=function(){var e=!0,t=new XMLHttpRequest;try{t.open("GET","WebAudioPluginTest.fail",!1)}catch(t){return e=!1}t.onerror=function(){e=!1},t.onload=function(){e=404==this.status||200==this.status||0==this.status&&""!=this.response};try{t.send()}catch(t){e=!1}return e},n._generateCapabilities=function(){if(null==n._capabilities){var e=document.createElement("audio");if(null==e.canPlayType)return null;if(null==n.context&&(n.context=n._createAudioContext(),null==n.context))return null;null==n._scratchBuffer&&(n._scratchBuffer=n.context.createBuffer(1,1,22050)),n._compatibilitySetUp(),"ontouchstart"in window&&"running"!=n.context.state&&(n._unlock(),document.addEventListener("mousedown",n._unlock,!0),document.addEventListener("touchstart",n._unlock,!0),document.addEventListener("touchend",n._unlock,!0)),n._capabilities={panning:!0,volume:!0,tracks:-1};for(var t=createjs.Sound.SUPPORTED_EXTENSIONS,i=createjs.Sound.EXTENSION_MAP,r=0,o=t.length;o>r;r++){var a=t[r],s=i[a]||a;n._capabilities[a]="no"!=e.canPlayType("audio/"+a)&&""!=e.canPlayType("audio/"+a)||"no"!=e.canPlayType("audio/"+s)&&""!=e.canPlayType("audio/"+s)}n.context.destination.numberOfChannels<2&&(n._capabilities.panning=!1)}},n._createAudioContext=function(){var e=window.AudioContext||window.webkitAudioContext;if(null==e)return null;var t=new e;if(/(iPhone|iPad)/i.test(navigator.userAgent)&&t.sampleRate!==n.DEFAULT_SAMPLE_RATE){var i=t.createBuffer(1,1,n.DEFAULT_SAMPLE_RATE),r=t.createBufferSource();r.buffer=i,r.connect(t.destination),r.start(0),r.disconnect(),t.close(),t=new e}return t},n._compatibilitySetUp=function(){if(n._panningModel="equalpower",!n.context.createGain){n.context.createGain=n.context.createGainNode;var e=n.context.createBufferSource();e.__proto__.start=e.__proto__.noteGrainOn,e.__proto__.stop=e.__proto__.noteOff,n._panningModel=0}},n._unlock=function(){n._unlocked||(n.playEmptySound(),"running"==n.context.state&&(document.removeEventListener("mousedown",n._unlock,!0),document.removeEventListener("touchend",n._unlock,!0),document.removeEventListener("touchstart",n._unlock,!0),n._unlocked=!0))},t.toString=function(){return"[WebAudioPlugin]"},t._addPropsToClasses=function(){var e=this._soundInstanceClass;e.context=this.context,e._scratchBuffer=n._scratchBuffer,e.destinationNode=this.gainNode,e._panningModel=this._panningModel,this._loaderClass.context=this.context},t._updateVolume=function(){var e=createjs.Sound._masterMute?0:this._volume;e!=this.gainNode.gain.value&&(this.gainNode.gain.value=e)},createjs.WebAudioPlugin=createjs.promote(e,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){"use strict";function e(){throw"HTMLAudioTagPool cannot be instantiated"}function t(){this._tags=[]}var n=e;n._tags={},n._tagPool=new t,n._tagUsed={},n.get=function(e){var t=n._tags[e];return null==t?(t=n._tags[e]=n._tagPool.get()).src=e:n._tagUsed[e]?(t=n._tagPool.get()).src=e:n._tagUsed[e]=!0,t},n.set=function(e,t){t==n._tags[e]?n._tagUsed[e]=!1:n._tagPool.set(t)},n.remove=function(e){var t=n._tags[e];return null!=t&&(n._tagPool.set(t),delete n._tags[e],delete n._tagUsed[e],!0)},n.getDuration=function(e){var t=n._tags[e];return null!=t&&t.duration?1e3*t.duration:0},createjs.HTMLAudioTagPool=e;var i=t.prototype;i.constructor=t,i.get=function(){var e;return null==(e=0==this._tags.length?this._createTag():this._tags.pop()).parentNode&&document.body.appendChild(e),e},i.set=function(e){-1==createjs.indexOf(this._tags,e)&&(this._tags.src=null,this._tags.push(e))},i.toString=function(){return"[TagPool]"},i._createTag=function(){var e=document.createElement("audio");return e.autoplay=!1,e.preload="none",e}}(),this.createjs=this.createjs||{},function(){"use strict";function e(e,t,n,i){this.AbstractSoundInstance_constructor(e,t,n,i),this._audioSpriteStopTime=null,this._delayTimeoutId=null,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleTagReady,this),this._stalledHandler=createjs.proxy(this._playFailed,this),this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this),this._loopHandler=createjs.proxy(this._handleSoundComplete,this),n?this._audioSpriteStopTime=.001*(t+n):this._duration=createjs.HTMLAudioTagPool.getDuration(this.src)}var t=createjs.extend(e,createjs.AbstractSoundInstance);t.setMasterVolume=function(){this._updateVolume()},t.setMasterMute=function(){this._updateVolume()},t.toString=function(){return"[HTMLAudioSoundInstance]"},t._removeLooping=function(){null!=this._playbackResource&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},t._addLooping=function(){null==this._playbackResource||this._audioSpriteStopTime||(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)},t._handleCleanUp=function(){var e=this._playbackResource;if(null!=e){e.pause(),e.loop=!1,e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1);try{e.currentTime=this._startTime}catch(e){}createjs.HTMLAudioTagPool.set(this.src,e),this._playbackResource=null}},t._beginPlaying=function(e){return this._playbackResource=createjs.HTMLAudioTagPool.get(this.src),this.AbstractSoundInstance__beginPlaying(e)},t._handleSoundReady=function(){if(4!==this._playbackResource.readyState){var e=this._playbackResource;return e.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),e.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),e.preload="auto",void e.load()}this._updateVolume(),this._playbackResource.currentTime=.001*(this._startTime+this._position),this._audioSpriteStopTime?this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1):(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),0!=this._loop&&(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)),this._playbackResource.play()},t._handleTagReady=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),this._handleSoundReady()},t._pause=function(){this._playbackResource.pause()},t._resume=function(){this._playbackResource.play()},t._updateVolume=function(){if(null!=this._playbackResource){var e=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;e!=this._playbackResource.volume&&(this._playbackResource.volume=e)}},t._calculateCurrentPosition=function(){return 1e3*this._playbackResource.currentTime-this._startTime},t._updatePosition=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1);try{this._playbackResource.currentTime=.001*(this._position+this._startTime)}catch(e){this._handleSetPositionSeek(null)}},t._handleSetPositionSeek=function(){null!=this._playbackResource&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},t._handleAudioSpriteLoop=function(){this._playbackResource.currentTime<=this._audioSpriteStopTime||(this._playbackResource.pause(),0==this._loop?this._handleSoundComplete(null):(this._position=0,this._loop--,this._playbackResource.currentTime=.001*this._startTime,this._paused||this._playbackResource.play(),this._sendEvent("loop")))},t._handleLoop=function(){0==this._loop&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},t._updateStartTime=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},t._updateDuration=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},t._setDurationFromSource=function(){this._duration=createjs.HTMLAudioTagPool.getDuration(this.src),this._playbackResource=null},createjs.HTMLAudioSoundInstance=createjs.promote(e,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){"use strict";function e(){this.AbstractPlugin_constructor(),this._capabilities=n._capabilities,this._loaderClass=createjs.SoundLoader,this._soundInstanceClass=createjs.HTMLAudioSoundInstance}var t=createjs.extend(e,createjs.AbstractPlugin),n=e;n.MAX_INSTANCES=30,n._AUDIO_READY="canplaythrough",n._AUDIO_ENDED="ended",n._AUDIO_SEEKED="seeked",n._AUDIO_STALLED="stalled",n._TIME_UPDATE="timeupdate",n._capabilities=null,n.isSupported=function(){return n._generateCapabilities(),null!=n._capabilities},n._generateCapabilities=function(){if(null==n._capabilities){var e=document.createElement("audio");if(null==e.canPlayType)return null;n._capabilities={panning:!1,volume:!0,tracks:-1};for(var t=createjs.Sound.SUPPORTED_EXTENSIONS,i=createjs.Sound.EXTENSION_MAP,r=0,o=t.length;o>r;r++){var a=t[r],s=i[a]||a;n._capabilities[a]="no"!=e.canPlayType("audio/"+a)&&""!=e.canPlayType("audio/"+a)||"no"!=e.canPlayType("audio/"+s)&&""!=e.canPlayType("audio/"+s)}}},t.register=function(e){var t=createjs.HTMLAudioTagPool.get(e.src),n=this.AbstractPlugin_register(e);return n.setTag(t),n},t.removeSound=function(e){this.AbstractPlugin_removeSound(e),createjs.HTMLAudioTagPool.remove(e)},t.create=function(e,t,n){var i=this.AbstractPlugin_create(e,t,n);return i.playbackResource=null,i},t.toString=function(){return"[HTMLAudioPlugin]"},t.setVolume=t.getVolume=t.setMute=null,createjs.HTMLAudioPlugin=createjs.promote(e,"AbstractPlugin")}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.h5ads=e.h5ads||{})}(this,function(e){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,n)};var n,i,r=(function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,i,r,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new function(e,t,n){this.fn=e,this.context=t,this.once=n||!1}(i,r||e,o),s=n?n+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],a]:e._events[s].push(a):(e._events[s]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},a.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},a.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var l,c,h=this._events[s],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,i),!0;case 4:return h.fn.call(h.context,t,i,r),!0;case 5:return h.fn.call(h.context,t,i,r,o),!0;case 6:return h.fn.call(h.context,t,i,r,o,a),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];h.fn.apply(h.context,l)}else{var d,p=h.length;for(c=0;c<p;c++)switch(h[c].once&&this.removeListener(e,h[c].fn,void 0,!0),u){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,t);break;case 3:h[c].fn.call(h[c].context,t,i);break;case 4:h[c].fn.call(h[c].context,t,i,r);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];h[c].fn.apply(h[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,i,r){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||o(this,a);else{for(var l=0,c=[],h=s.length;l<h;l++)(s[l].fn!==t||r&&!s[l].once||i&&s[l].context!==i)&&c.push(s[l]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}(n={exports:{}},n.exports),n.exports);!function(e){e[e.AdMob=0]="AdMob",e[e.MoPub=1]="MoPub",e[e.Chartboost=2]="Chartboost",e[e.Heyzap=3]="Heyzap"}(i||(i={}));var o,a,s,l=function(){function t(e,t){if(this.adsEnabled=!1,this.bannerShowable=!1,this.interstitialShowable=!1,this.insentiveShowable=!1,Cocoon&&Cocoon.Ad){switch(this.adsEnabled=!0,e){default:case i.AdMob:this.cocoonProvider=Cocoon.Ad.AdMob;break;case i.Chartboost:this.cocoonProvider=Cocoon.Ad.Chartboost;break;case i.Heyzap:this.cocoonProvider=Cocoon.Ad.Heyzap;break;case i.MoPub:this.cocoonProvider=Cocoon.Ad.MoPub}this.cocoonProvider.configure(t)}}return t.prototype.setManager=function(t){this.adManager=t,this.adManager.emit(e.AdEvents.AD_PROVIDER_LOADED)},t.prototype.showAd=function(t){if(this.adsEnabled){if(t===e.AdType.banner){if(!this.bannerShowable||null===this.banner)return;this.adManager.emit(e.AdEvents.BANNER_SHOWN,this.banner.width,this.banner.height),this.adManager.bannerActive=!0,this.banner.show()}if(t===e.AdType.interstitial){if(!this.interstitialShowable||null===this.interstitial)return void this.adManager.emit(e.AdEvents.CONTENT_RESUMED,e.AdType.interstitial);this.interstitial.show()}if(t===e.AdType.rewarded){if(!this.insentiveShowable||null===this.insentive)return void this.adManager.emit(e.AdEvents.CONTENT_RESUMED,e.AdType.rewarded);this.insentive.show()}}else t!==e.AdType.banner&&this.adManager.emit(e.AdEvents.CONTENT_RESUMED)},t.prototype.adAvailable=function(e){return!0},t.prototype.preloadAd=function(t,n,i){var r=this;this.adsEnabled&&(this.destroyAd(t),t===e.AdType.banner&&(this.banner=this.cocoonProvider.createBanner(n),i&&this.banner.setLayout(i),this.banner.on("load",function(){r.bannerShowable=!0}),this.banner.on("fail",function(){r.bannerShowable=!1,r.banner=null}),this.banner.on("click",function(){r.adManager.emit(e.AdEvents.AD_CLICKED,e.AdType.banner)}),this.banner.on("show",function(){}),this.banner.on("dismiss",function(){}),this.banner.load()),t===e.AdType.interstitial&&(this.interstitial=this.cocoonProvider.createInterstitial(n),this.interstitial.on("load",function(){r.interstitialShowable=!0}),this.interstitial.on("fail",function(){r.interstitialShowable=!1,r.interstitial=null}),this.interstitial.on("click",function(){r.adManager.emit(e.AdEvents.AD_CLICKED,e.AdType.interstitial)}),this.interstitial.on("show",function(){r.adManager.emit(e.AdEvents.CONTENT_PAUSED,e.AdType.interstitial)}),this.interstitial.on("dismiss",function(){r.adManager.emit(e.AdEvents.CONTENT_RESUMED,e.AdType.interstitial),r.interstitialShowable=!1,r.interstitial=null}),this.interstitial.load()),t===e.AdType.rewarded&&(this.insentive=this.cocoonProvider.createRewardedVideo(n),this.insentive.on("load",function(){r.insentiveShowable=!0}),this.insentive.on("fail",function(){r.insentiveShowable=!1,r.insentive=null}),this.insentive.on("click",function(){r.adManager.emit(e.AdEvents.AD_CLICKED,e.AdType.rewarded)}),this.insentive.on("show",function(){r.adManager.emit(e.AdEvents.CONTENT_PAUSED,e.AdType.rewarded)}),this.insentive.on("dismiss",function(){r.adManager.emit(e.AdEvents.CONTENT_RESUMED,e.AdType.rewarded),r.insentiveShowable=!1,r.insentive=null}),this.insentive.on("reward",function(){r.adManager.emit(e.AdEvents.AD_REWARDED,e.AdType.rewarded),r.insentiveShowable=!1,r.insentive=null}),this.insentive.load()))},t.prototype.destroyAd=function(t){if(this.adsEnabled){if(t===e.AdType.banner&&null!==this.banner){try{this.cocoonProvider.releaseBanner(this.banner)}catch(e){}this.banner=null,this.bannerShowable=!1}t===e.AdType.interstitial&&null!==this.interstitial&&(this.cocoonProvider.releaseInterstitial(this.interstitial),this.interstitial=null,this.interstitialShowable=!1)}},t.prototype.hideAd=function(t){this.adsEnabled&&(t===e.AdType.interstitial&&null!==this.interstitial&&this.interstitial.hide(),t===e.AdType.banner&&null!==this.banner&&(this.adManager.bannerActive&&(this.adManager.bannerActive=!1,this.adManager.emit(e.AdEvents.BANNER_HIDDEN,this.banner.width,this.banner.height)),this.banner.hide()),t===e.AdType.rewarded&&null!==this.insentive&&this.insentive.hide())},t}(),c=function(){function t(e,t,n){void 0===n&&(n=!1),this.adsEnabled=!1,void 0===cordova.plugins||void 0!==cordova.plugins&&void 0===cordova.plugins.gdApi?console.log("gdApi not available!"):(n&&cordova.plugins.gdApi.enableTestAds(),this.setAdListeners(),cordova.plugins.gdApi.init([e,t],function(e){console.log("API init success!",e)},function(e){console.log("API init error!",e)}))}return t.prototype.setAdListeners=function(){var t=this;cordova.plugins.gdApi.setAdListener(function(n){switch(console.log("banner reply, data.event",n.event,n),n.event){case"BANNER_STARTED":t.adManager.emit(e.AdEvents.CONTENT_PAUSED);break;case"API_IS_READY":t.adsEnabled=!0;break;case"API_ALREADY_INITIALIZED":break;case"BANNER_CLOSED":case"API_NOT_READY":case"BANNER_FAILED":t.adManager.emit(e.AdEvents.CONTENT_RESUMED)}},function(e){console.log("Set listener error:",e),t.adsEnabled=!1})},t.prototype.setManager=function(t){this.adManager=t,this.adManager.emit(e.AdEvents.AD_PROVIDER_LOADED)},t.prototype.showAd=function(t){var n=this;this.adsEnabled?(console.log("show banner called"),cordova.plugins.gdApi.showBanner(function(e){console.log("Show banner worked",e)},function(t){console.log("Could not show banner:",t),n.adManager.emit(e.AdEvents.CONTENT_RESUMED)})):(console.log("Ads not enabled, resuming"),this.adManager.emit(e.AdEvents.CONTENT_RESUMED))},t.prototype.adAvailable=function(e){return!0},t.prototype.preloadAd=function(e){},t.prototype.destroyAd=function(e){},t.prototype.hideAd=function(e){},t}(),h=function(){function t(){var t=this;if(this.adsEnabled=!1,this.rewardedLoaded=!1,"undefined"!=typeof gamedockSDK){gamedockSDK.on("PrivacyPolicyStatus",function(n){t.adManager.emit(e.AdEvents.AD_PROVIDER_LOADED)}),gamedockSDK.initialise(!1,{shouldBlock:!0,requiredAge:12},!0,"PRODUCTION",[]),gamedockSDK.on("AdAvailable",function(e){switch(e.type){case"interstitial":t.interstitalAvailable();break;case"rewardVideo":t.rewardedChanged(!0);break;case"banner":throw new Error("Not yet implemented.")}}),gamedockSDK.on("AdNotAvailable",function(e){switch(e.type){case"interstitial":case"rewardVideo":t.resumeGameplay();break;case"banner":throw new Error("Not yet implemented.")}}),gamedockSDK.on("AdFinished",function(e){switch(e.type){case"interstitial":t.resumeGameplay();break;case"rewardVideo":t.rewardVideoFinished(e.reason);break;case"banner":throw new Error("Not yet implemented.")}})}}return t.prototype.setManager=function(e){this.adManager=e},t.prototype.showAd=function(t){if(void 0===t&&(t=e.AdType.interstitial),"undefined"!=typeof gamedockSDK)switch(t){case e.AdType.interstitial:this.adManager.emit(e.AdEvents.CONTENT_PAUSED),gamedockSDK.requestInterstitial();break;case e.AdType.rewarded:if(!this.adAvailable(e.AdType.rewarded)){this.resumeGameplay();break}this.adManager.emit(e.AdEvents.CONTENT_PAUSED),this.rewardedChanged(!1),gamedockSDK.playRewardVideo();break;default:this.resumeGameplay()}},t.prototype.interstitalAvailable=function(){"undefined"!=typeof gamedockSDK&&gamedockSDK.playInterstitial()},t.prototype.rewardVideoFinished=function(t){switch(t){case"dismiss":this.resumeGameplay();break;case"close":this.adManager.emit(e.AdEvents.AD_REWARDED)}},t.prototype.resumeGameplay=function(){this.adManager.emit(e.AdEvents.CONTENT_RESUMED)},t.prototype.preloadAd=function(t){if(void 0===t&&(t=e.AdType.interstitial),"undefined"!=typeof gamedockSDK)switch(t){case e.AdType.rewarded:if(this.rewardedLoaded)return;gamedockSDK.requestRewardVideo()}},t.prototype.destroyAd=function(){},t.prototype.hideAd=function(){},t.prototype.adAvailable=function(t){switch(t){case e.AdType.rewarded:return this.rewardedLoaded}return!1},t.prototype.rewardedChanged=function(e){this.rewardedLoaded=e},t}(),u=function(){function t(e){var t=this;this.adsEnabled=!1,this.adsEnabled=!0,HeyzapAds.start(e).then(function(){},function(e){t.adsEnabled=!1})}return t.prototype.setManager=function(t){this.adManager=t,this.adManager.emit(e.AdEvents.AD_PROVIDER_LOADED)},t.prototype.showAd=function(t,n){var i=this;switch(this.adsEnabled||this.adManager.emit(e.AdEvents.CONTENT_RESUMED),t){case e.AdType.interstitial:HeyzapAds.InterstitialAd.addEventListener(HeyzapAds.InterstitialAd.Events.HIDE,function(){i.adManager.emit(e.AdEvents.CONTENT_RESUMED,HeyzapAds.InterstitialAd.Events.HIDE)}),HeyzapAds.InterstitialAd.addEventListener(HeyzapAds.InterstitialAd.Events.SHOW_FAILED,function(){i.adManager.emit(e.AdEvents.CONTENT_RESUMED,HeyzapAds.InterstitialAd.Events.SHOW_FAILED)}),HeyzapAds.InterstitialAd.addEventListener(HeyzapAds.InterstitialAd.Events.CLICKED,function(){i.adManager.emit(e.AdEvents.AD_CLICKED,HeyzapAds.InterstitialAd.Events.CLICKED)}),HeyzapAds.InterstitialAd.show().then(function(){i.adManager.emit(e.AdEvents.CONTENT_PAUSED)},function(t){i.adManager.emit(e.AdEvents.CONTENT_RESUMED)});break;case e.AdType.interstitial:HeyzapAds.VideoAd.addEventListener(HeyzapAds.VideoAd.Events.HIDE,function(){i.adManager.emit(e.AdEvents.CONTENT_RESUMED,HeyzapAds.VideoAd.Events.HIDE)}),HeyzapAds.VideoAd.addEventListener(HeyzapAds.VideoAd.Events.SHOW_FAILED,function(){i.adManager.emit(e.AdEvents.CONTENT_RESUMED,HeyzapAds.VideoAd.Events.SHOW_FAILED)}),HeyzapAds.VideoAd.addEventListener(HeyzapAds.VideoAd.Events.CLICKED,function(){i.adManager.emit(e.AdEvents.AD_CLICKED,HeyzapAds.VideoAd.Events.CLICKED)}),HeyzapAds.VideoAd.show().then(function(){i.adManager.emit(e.AdEvents.CONTENT_PAUSED)},function(t){i.adManager.emit(e.AdEvents.CONTENT_RESUMED)});break;case e.AdType.rewarded:HeyzapAds.IncentivizedAd.addEventListener(HeyzapAds.IncentivizedAd.Events.HIDE,function(){i.adManager.emit(e.AdEvents.CONTENT_RESUMED,HeyzapAds.IncentivizedAd.Events.HIDE)}),HeyzapAds.IncentivizedAd.addEventListener(HeyzapAds.IncentivizedAd.Events.SHOW_FAILED,function(){i.adManager.emit(e.AdEvents.CONTENT_RESUMED,HeyzapAds.IncentivizedAd.Events.SHOW_FAILED)}),HeyzapAds.IncentivizedAd.addEventListener(HeyzapAds.IncentivizedAd.Events.CLICKED,function(){i.adManager.emit(e.AdEvents.AD_CLICKED,HeyzapAds.IncentivizedAd.Events.CLICKED)}),HeyzapAds.IncentivizedAd.show().then(function(){i.adManager.emit(e.AdEvents.CONTENT_PAUSED)},function(t){i.adManager.emit(e.AdEvents.CONTENT_RESUMED)});break;case e.AdType.banner:if(void 0===n)return;HeyzapAds.BannerAd.show(n).then(function(){},function(e){})}},t.prototype.adAvailable=function(e){return!0},t.prototype.preloadAd=function(t){this.adsEnabled&&t===e.AdType.rewarded&&HeyzapAds.IncentivizedAd.fetch().then(function(){},function(e){})},t.prototype.destroyAd=function(t){this.adsEnabled&&t===e.AdType.banner&&HeyzapAds.BannerAd.destroy().then(function(){},function(e){})},t.prototype.hideAd=function(t){this.adsEnabled&&t===e.AdType.banner&&HeyzapAds.BannerAd.hide().then(function(){},function(e){})},t}(),d=function(){function t(e){var t=this;if(this.adsEnabled=!1,this.interstitialLoaded=!1,this.rewardedLoaded=!1,"undefined"!=typeof IronSourceAds){IronSourceAds.init({appKey:e});var n=function(){return t.resumeGameplay()};window.addEventListener("interstitialClosed",n),window.addEventListener("interstitialShowFailed",n),window.addEventListener("interstitialLoaded",function(){return t.interstitialChanged(!0)}),window.addEventListener("rewardedVideoClosed",n),window.addEventListener("rewardedVideoFailed",n),IronSourceAds.hasRewardedVideo({onSuccess:this.rewardedChanged.bind(this)}),window.addEventListener("rewardedVideoAvailabilityChanged",function(e){return t.rewardedChanged(e.available)})}}return t.prototype.setManager=function(t){this.adManager=t,this.adManager.emit(e.AdEvents.AD_PROVIDER_LOADED)},t.prototype.showAd=function(t){switch(void 0===t&&(t=e.AdType.interstitial),t){case e.AdType.interstitial:if(!this.interstitialLoaded){this.resumeGameplay();break}this.interstitialChanged(!1),this.adManager.emit(e.AdEvents.CONTENT_PAUSED),IronSourceAds.showInterstitial();break;case e.AdType.rewarded:if(!this.rewardedLoaded){this.resumeGameplay();break}this.adManager.emit(e.AdEvents.CONTENT_PAUSED),IronSourceAds.showRewardedVideo();break;default:this.resumeGameplay()}},t.prototype.resumeGameplay=function(){this.adManager.emit(e.AdEvents.CONTENT_RESUMED)},t.prototype.preloadAd=function(t){void 0===t&&(t=e.AdType.interstitial),t===e.AdType.interstitial&&IronSourceAds.loadInterstitial()},t.prototype.destroyAd=function(){},t.prototype.hideAd=function(){},t.prototype.adAvailable=function(t){switch(t){case e.AdType.interstitial:return this.interstitialLoaded;case e.AdType.rewarded:return this.rewardedLoaded}return!1},t.prototype.interstitialChanged=function(e){this.interstitialLoaded=e},t.prototype.rewardedChanged=function(e){this.rewardedLoaded=e},t}();!function(e){e.interstitial="interstitial",e.rewarded="rewarded",e.display="display"}(o||(o={})),(a=e.GameDistributionBannerSize||(e.GameDistributionBannerSize={}))[a.LargeRectangle=0]="LargeRectangle",a[a.MediumRectangle=1]="MediumRectangle",a[a.Billboard=2]="Billboard",a[a.Leaderboard=3]="Leaderboard",a[a.Skyscraper=4]="Skyscraper",a[a.WideSkyscraper=5]="WideSkyscraper",(s=e.GameDistributionAlignment||(e.GameDistributionAlignment={}))[s.TopLeft=0]="TopLeft",s[s.TopCenter=1]="TopCenter",s[s.TopRight=2]="TopRight",s[s.CenterLeft=3]="CenterLeft",s[s.Center=4]="Center",s[s.CenterRight=5]="CenterRight",s[s.BottomLeft=6]="BottomLeft",s[s.BottomCenter=7]="BottomCenter",s[s.BottomRight=8]="BottomRight";var p,f=function(){function t(){this.scaleFactor=1,this.offsetX=0,this.offsetY=0,this.element=document.createElement("div"),this.element.style.position="absolute",this.element.style.top="0px",this.element.style.left="0px",this.element.id="banner-"+Date.now()+(1e7*Math.random()|0),document.body.appendChild(this.element)}return t.prototype.loadBanner=function(){return"undefined"==typeof gdsdk?Promise.reject("GD Sdk not available, probably due to adblocker"):gdsdk.showAd(o.display,{containerId:this.element.id})},t.prototype.destroy=function(){document.body.removeChild(this.element),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),delete this.element,delete this.parent,delete this.alignment},t.prototype.alignIn=function(e,t){var n=this;this.parent?console.warn("Banner already aligned, ignoring..."):(this.parent=e,this.alignment=t,this.resizeListener=function(){return n.resize()},window.addEventListener("resize",this.resizeListener),this.resize())},t.prototype.setOffset=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.offsetX=e,this.offsetY=t,this.resize()},t.prototype.resize=function(){if(this.parent){var t=this.parent.getBoundingClientRect();switch(this.alignment){case e.GameDistributionAlignment.TopLeft:this.position(t.left,t.top);break;case e.GameDistributionAlignment.TopCenter:this.position(t.left+t.width/2-this.width*this.scaleFactor/2,t.top);break;case e.GameDistributionAlignment.TopRight:this.position(t.left+t.width-this.width*this.scaleFactor,t.top);break;case e.GameDistributionAlignment.CenterLeft:this.position(t.left,t.top+t.height/2-this.height*this.scaleFactor/2);break;case e.GameDistributionAlignment.Center:this.position(t.left+t.width/2-this.width*this.scaleFactor/2,t.top+t.height/2-this.height*this.scaleFactor/2);break;case e.GameDistributionAlignment.CenterRight:this.position(t.left+t.width-this.width*this.scaleFactor,t.top+t.height/2-this.height*this.scaleFactor/2);break;case e.GameDistributionAlignment.BottomLeft:this.position(t.left,t.top+t.height-this.height*this.scaleFactor);break;case e.GameDistributionAlignment.BottomCenter:this.position(t.left+t.width/2-this.width*this.scaleFactor/2,t.top+t.height-this.height*this.scaleFactor);break;case e.GameDistributionAlignment.BottomRight:this.position(t.left+t.width-this.width*this.scaleFactor,t.top+t.height-this.height*this.scaleFactor)}}},t.prototype.setSize=function(t){var n,i;switch(t){default:case e.GameDistributionBannerSize.LargeRectangle:n=336,i=280;break;case e.GameDistributionBannerSize.MediumRectangle:n=300,i=250;break;case e.GameDistributionBannerSize.Billboard:n=970,i=250;break;case e.GameDistributionBannerSize.Leaderboard:n=728,i=90;break;case e.GameDistributionBannerSize.Skyscraper:n=120,i=600;break;case e.GameDistributionBannerSize.WideSkyscraper:n=160,i=600}this.width=n,this.height=i,this.element.style.width=n+"px",this.element.style.height=i+"px"},t.prototype.position=function(e,t){this.element.style.left=e+this.offsetX+"px",this.element.style.top=t+this.offsetY+"px"},t.prototype.scale=function(e){this.element.style.transformOrigin="left top",this.scaleFactor=e,this.element.style.transform="scale("+e+")"},t}(),E=function(){function t(t){var n,i,r,o,a,s=this;this.adsEnabled=!1,this.hasRewarded=!1,this.adShowing=!1,this.areAdsEnabled(),window.GD_OPTIONS={gameId:t,advertisementSettings:{autoplay:!1},onEvent:function(t){switch(t.name){case"SDK_GAME_PAUSE":s.adManager.emit(e.AdEvents.CONTENT_PAUSED);break;case"SDK_READY":s.sdkLoaded()}}},n=document,i="script",r="gamedistribution-jssdk",a=n.getElementsByTagName(i)[0],n.getElementById(r)||((o=n.createElement(i)).id=r,o.src="//lablockedgames.com/gd_1_5_2_h5fix.js",a.parentNode&&a.parentNode.insertBefore(o,a))}return t.prototype.setManager=function(t){this.adManager=t,this.adManager.emit(e.AdEvents.AD_PROVIDER_LOADED)},t.prototype.sdkLoaded=function(){var e=this;this.areAdsEnabled().then(function(t){t&&(e.adsEnabled=!0)})},t.prototype.showAd=function(t){var n=this;if(this.adsEnabled){if("undefined"==typeof gdsdk||gdsdk&&void 0===gdsdk.showAd)return this.adsEnabled=!1,void this.adManager.emit(e.AdEvents.CONTENT_RESUMED);gdsdk.showAd(t===e.AdType.rewarded?o.rewarded:o.interstitial).then(function(){t===e.AdType.rewarded&&(n.adManager.emit(e.AdEvents.AD_REWARDED),n.hasRewarded=!1),n.adManager.emit(e.AdEvents.CONTENT_RESUMED)}).catch(function(){t===e.AdType.rewarded&&n.hasRewarded&&(n.hasRewarded=!1),n.adManager.emit(e.AdEvents.CONTENT_RESUMED)})}else this.adManager.emit(e.AdEvents.CONTENT_RESUMED)},t.prototype.createBanner=function(e){if(this.adsEnabled){var t=new f;return t.setSize(e),t}},t.prototype.loadBanner=function(e){if(this.adsEnabled){var t=new f;return t.setSize(e),t.loadBanner(),t}},t.prototype.preloadAd=function(t){var n=this;!this.hasRewarded&&this.adsEnabled&&t===e.AdType.rewarded&&(console.log("preloading ad"),gdsdk.preloadAd(o.rewarded).then(function(){n.hasRewarded=!0,n.adManager.emit(e.AdEvents.AD_LOADED,t)}))},t.prototype.adAvailable=function(t){return t!==e.AdType.rewarded||this.hasRewarded},t.prototype.destroyAd=function(){},t.prototype.hideAd=function(){},t.prototype.areAdsEnabled=function(){var e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox",e.style.position="absolute",e.style.fontSize="10px",document.body.appendChild(e);return new Promise(function(t){window.setTimeout(function(){var n;t((n=!0,0===e.offsetHeight&&(n=!1),e.parentNode&&e.parentNode.removeChild(e),n))},100)})},t}();!function(e){e[e.start=0]="start",e[e.firstQuartile=1]="firstQuartile",e[e.midPoint=2]="midPoint",e[e.thirdQuartile=3]="thirdQuartile",e[e.complete=4]="complete"}(p||(p={}));var m,g,v=function(){function t(e,t){this.googleEnabled=!1,this.adsEnabled=!0,this.adTagUrl="",this.adRequested=!1,this.areAdsEnabled(),"undefined"!=typeof google&&(this.googleEnabled=!0,this.gameContent="string"==typeof e.parentElement?document.getElementById(e.parentElement):e.parentElement,this.gameContent.style.position="absolute",this.gameContent.style.width="100%",this.adContent=this.gameContent.parentNode.appendChild(document.createElement("div")),this.adContent.id="phaser-ad-container",this.adContent.style.position="absolute",this.adContent.style.zIndex="9999",this.adContent.style.display="none",this.adContent.style.top="0",this.adContent.style.left="0",this.adContent.style.width="100%",this.adContent.style.height="100%",this.adContent.style.overflow="hidden",this.adTagUrl=t,this.adDisplay=new google.ima.AdDisplayContainer(this.adContent),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale("nl"),this.adLoader=new google.ima.AdsLoader(this.adDisplay),this.adLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdManagerLoader,!1,this),this.adLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError,!1,this))}return t.prototype.setManager=function(t){this.adManager=t,this.adManager.emit(e.AdEvents.AD_PROVIDER_LOADED)},t.prototype.showAd=function(t,n){if(console.log("Ad Requested"),!this.adRequested)if(this.adsEnabled||this.adManager.emit(e.AdEvents.AD_DISABLED,!0),this.googleEnabled){this.adDisplay.initialize();var i=new google.ima.AdsRequest;i.adTagUrl=this.adTagUrl+this.parseCustomParams(n);var r=window.innerWidth,o=window.innerHeight;document.body.clientHeight<window.innerHeight&&(o=document.body.clientHeight,r=document.body.clientWidth),i.linearAdSlotWidth=r,i.linearAdSlotHeight=o,i.nonLinearAdSlotWidth=r,i.nonLinearAdSlotHeight=o,i.forceNonLinearFullSlot=!0;try{this.adRequested=!0,this.adLoader.requestAds(i)}catch(e){console.log(e),this.onContentResumeRequested()}}else this.onContentResumeRequested()},t.prototype.adAvailable=function(e){return!0},t.prototype.preloadAd=function(){},t.prototype.destroyAd=function(){},t.prototype.hideAd=function(){},t.prototype.onAdManagerLoader=function(e){var t=this;console.log("AdsManager loaded");var n=new google.ima.AdsRenderingSettings;n.restoreCustomPlaybackStateOnAdBreakComplete=!0;var i=e.getAdsManager(this.gameContent,n);this.adsManager=i,console.log(i.isCustomClickTrackingUsed()),i.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested,!1,this),i.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested,!1,this),i.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError,!1,this),[google.ima.AdEvent.Type.ALL_ADS_COMPLETED,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.THIRD_QUARTILE].forEach(function(e){i.addEventListener(e,t.onAdEvent,!1,t)});try{this.adContent.style.display="block";var r=window.innerWidth,o=window.innerHeight;this.adsManager.init(r,o,google.ima.ViewMode.NORMAL),this.adsManager.start(),this.resizeListener=function(){null!==t.adsManager&&(console.log("Resizing ad size"),t.adsManager.resize(window.innerWidth,window.innerHeight,google.ima.ViewMode.NORMAL))},window.addEventListener("resize",this.resizeListener)}catch(e){console.log("Adsmanager error:",e),this.onAdError(e)}},t.prototype.onAdEvent=function(t){switch(console.log("onAdEvent",t),t.type){case google.ima.AdEvent.Type.CLICK:this.adManager.emit(e.AdEvents.AD_CLICKED);break;case google.ima.AdEvent.Type.LOADED:this.adRequested=!1;var n=t.getAd();console.log("is ad linear?",n.isLinear()),n.isLinear()||this.onContentResumeRequested();break;case google.ima.AdEvent.Type.STARTED:this.adManager.emit(e.AdEvents.AD_PROGRESSION,p.start);break;case google.ima.AdEvent.Type.FIRST_QUARTILE:this.adManager.emit(e.AdEvents.AD_PROGRESSION,p.firstQuartile);break;case google.ima.AdEvent.Type.MIDPOINT:this.adManager.emit(e.AdEvents.AD_PROGRESSION,p.midPoint);break;case google.ima.AdEvent.Type.THIRD_QUARTILE:this.adManager.emit(e.AdEvents.AD_PROGRESSION,p.thirdQuartile);break;case google.ima.AdEvent.Type.COMPLETE:this.adManager.emit(e.AdEvents.AD_PROGRESSION,p.complete);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.onContentResumeRequested()}},t.prototype.onAdError=function(e){console.log("gneric ad error",e),null!==this.adsManager&&(this.adsManager.destroy(),null!==this.resizeListener&&window.removeEventListener("resize",this.resizeListener)),this.adRequested&&(this.adRequested=!1),this.onContentResumeRequested()},t.prototype.onContentPauseRequested=function(){console.log("onContentPauseRequested",arguments),this.adManager.emit(e.AdEvents.CONTENT_PAUSED)},t.prototype.onContentResumeRequested=function(){console.log("onContentResumeRequested",arguments),"undefined"!=typeof google?(this.adContent.style.display="none",this.adManager.emit(e.AdEvents.CONTENT_RESUMED)):this.adManager.emit(e.AdEvents.CONTENT_RESUMED)},t.prototype.parseCustomParams=function(e){if(void 0!==e){var t="";for(var n in e){if(e.hasOwnProperty(n))t.length>0&&(t+="&"),t+=n+"="+(Array.isArray(e[n])?e[n].join(","):e[n])}return"&cust_params="+encodeURIComponent(t)}return""},t.prototype.areAdsEnabled=function(){var e=this,t=document.createElement("div");t.innerHTML="&nbsp;",t.className="adsbox",t.style.position="absolute",t.style.fontSize="10px",document.body.appendChild(t);window.setTimeout(function(){var n;e.adsEnabled=(n=!0,0===t.offsetHeight&&(n=!1),t.parentNode&&t.parentNode.removeChild(t),n)},100)},t}();(m=e.AdEvents||(e.AdEvents={})).CONTENT_PAUSED="onContentPaused",m.CONTENT_RESUMED="onContentResumed",m.AD_PROGRESSION="onAdProgression",m.AD_DISABLED="onAdsDisabled",m.AD_CLICKED="onAdClicked",m.AD_REWARDED="onAdRewardGranted",m.BANNER_SHOWN="onBannerShown",m.BANNER_HIDDEN="onBannerHidden",m.AD_LOADED="onAdLoaded",m.AD_PROVIDER_LOADED="onAdProviderLoaded",(g=e.AdType||(e.AdType={}))[g.interstitial=0]="interstitial",g[g.rewarded=1]="rewarded",g[g.banner=2]="banner";var y=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.bannerActive=!1,t.provider=null,t}return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}(n,e),n.prototype.setAdProvider=function(e){this.provider=e,this.provider.setManager(this)},n.prototype.showAd=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(null===this.provider)throw new Error("Can not request an ad without an provider, please attach an ad provider!");t.unshift(e),this.provider.showAd.apply(this.provider,t)},n.prototype.createBanner=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.provider.loadBanner.apply(this.provider,e)},n.prototype.loadBanner=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.provider.loadBanner.apply(this.provider,e)},n.prototype.preloadAd=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(null===this.provider)throw new Error("Can not preload an ad without an provider, please attach an ad provider!");t.unshift(e),this.provider.preloadAd.apply(this.provider,t)},n.prototype.destroyAd=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(null===this.provider)throw new Error("Can not destroy an ad without an provider, please attach an ad provider!");t.unshift(e),this.provider.destroyAd.apply(this.provider,t)},n.prototype.hideAd=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(null===this.provider)throw new Error("Can not hide an ad without an provider, please attach an ad provider!");t.unshift(e),this.provider.hideAd.apply(this.provider,t)},n.prototype.adsEnabled=function(){if(null===this.provider)throw new Error("Can not hide an ad without an provider, please attach an ad provider!");return this.provider.adsEnabled},n.prototype.adAvailable=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(null===this.provider)throw new Error("Can not hide an ad without an provider, please attach an ad provider!");return t.unshift(e),this.provider.adAvailable.apply(this.provider,t)},n}(r),T=new y;e.H5AdWrapper=y,e.adWrapper=T,e.CocoonAds=l,e.CordovaGamedistribution=c,e.CordovaGamedock=h,e.CordovaHeyzap=u,e.CordovaIronSource=d,e.GameDistribution=E,e.GameDistributionBanner=f,e.Ima3=v,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.h5branding=e.h5branding||{})}(this,function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function i(e,t){return e(t={exports:{}},t.exports),t.exports}var r,o;i(function(e,n){e.exports=function(){function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,r=void 0,o=void 0,a=function(e,t){p[i]=e,p[i+1]=t,2===(i+=2)&&(o?o(f):y())},s="undefined"!=typeof window?window:void 0,l=s||{},c=l.MutationObserver||l.WebKitMutationObserver,h="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(f,1)}}var p=new Array(1e3);function f(){for(var e=0;e<i;e+=2){var t=p[e],n=p[e+1];t(n),p[e]=void 0,p[e+1]=void 0}i=0}var E,m,g,v,y=void 0;function T(e,t){var n=this,i=new this.constructor(b);void 0===i[R]&&D(i);var r=n._state;if(r){var o=arguments[r-1];a(function(){return P(r,i,o,n._result)})}else C(n,i,e,t);return i}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(b);return S(t,e),t}h?y=function(){return process.nextTick(f)}:c?(m=0,g=new c(f),v=document.createTextNode(""),g.observe(v,{characterData:!0}),y=function(){v.data=m=++m%2}):u?((E=new MessageChannel).port1.onmessage=f,y=function(){return E.port2.postMessage(0)}):y=void 0===s?function(){try{var e=Function("return this")().require("vertx");return void 0!==(r=e.runOnLoop||e.runOnContext)?function(){r(f)}:d()}catch(e){return d()}}():d();var R=Math.random().toString(36).substring(2);function b(){}var x=void 0,w=1,M=2;function L(t,n,i){n.constructor===t.constructor&&i===T&&n.constructor.resolve===_?function(e,t){t._state===w?I(e,t._result):t._state===M?A(e,t._result):C(t,void 0,function(t){return S(e,t)},function(t){return A(e,t)})}(t,n):void 0===i?I(t,n):e(i)?function(e,t,n){a(function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,function(n){i||(i=!0,t!==n?S(e,n):I(e,n))},function(t){i||(i=!0,A(e,t))},e._label);!i&&r&&(i=!0,A(e,r))},e)}(t,n,i):I(t,n)}function S(e,t){if(e===t)A(e,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(i=t),null===i||"object"!==r&&"function"!==r)I(e,t);else{var n=void 0;try{n=t.then}catch(t){return void A(e,t)}L(e,t,n)}var i,r}function H(e){e._onerror&&e._onerror(e._result),O(e)}function I(e,t){e._state===x&&(e._result=t,e._state=w,0!==e._subscribers.length&&a(O,e))}function A(e,t){e._state===x&&(e._state=M,e._result=t,a(H,e))}function C(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+w]=n,r[o+M]=i,0===o&&e._state&&a(O,e)}function O(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,a=0;a<t.length;a+=3)i=t[a],r=t[a+n],i?P(n,i,r,o):r(o);e._subscribers.length=0}}function P(t,n,i,r){var o=e(i),a=void 0,s=void 0,l=!0;if(o){try{a=i(r)}catch(e){l=!1,s=e}if(n===a)return void A(n,new TypeError("A promises callback cannot return that same promise."))}else a=r;n._state!==x||(o&&l?S(n,a):!1===l?A(n,s):t===w?I(n,a):t===M&&A(n,a))}var G=0;function D(e){e[R]=G++,e._state=void 0,e._result=void 0,e._subscribers=[]}var k=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(b),this.promise[R]||D(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&I(this.promise,this._result))):A(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===x&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===_){var r=void 0,o=void 0,a=!1;try{r=e.then}catch(e){a=!0,o=e}if(r===T&&e._state!==x)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===B){var s=new n(b);a?A(s,o):L(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===x&&(this._remaining--,e===M?A(i,n):this._result[t]=n),0===this._remaining&&I(i,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,function(e){return n._settledAt(w,t,e)},function(e){return n._settledAt(M,t,e)})},e}(),B=function(){function t(e){this[R]=G++,this._result=this._state=void 0,this._subscribers=[],b!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){S(e,t)},function(t){A(e,t)})}catch(t){A(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this.constructor;return e(t)?this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):this.then(t,t)},t}();return B.prototype.then=T,B.all=function(e){return new k(this,e).promise},B.race=function(e){var t=this;return n(e)?new t(function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},B.resolve=_,B.reject=function(e){var t=new this(b);return A(t,e),t},B._setScheduler=function(e){o=e},B._setAsap=function(e){a=e},B._asap=a,B.polyfill=function(){var e=void 0;if(void 0!==t)e=t;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var i=null;try{i=Object.prototype.toString.call(n.resolve())}catch(e){}if("[object Promise]"===i&&!n.cast)return}e.Promise=B},B.Promise=B,B}()}).polyfill();(r=e.BrandingDomain||(e.BrandingDomain={}))[r.Neutral=0]="Neutral",r[r.Yepi=1]="Yepi",r[r.Spele=2]="Spele",r[r.Funnygames=3]="Funnygames",r[r.Kizi=4]="Kizi",r[r.PlayCell=5]="PlayCell",r[r.GameCell=6]="GameCell",r[r.Bild=7]="Bild",r[r.AGame=8]="AGame",r[r.Admeen=9]="Admeen",r[r.PlayTime=10]="PlayTime";var a,s=function(){function e(){}return e.has=function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var n=e.lastIndexOf(".",t-1);if(n<=0||n>=t-1)return!1;var i=o[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(n+1,t)+" ")>=0},e.is=function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var n=o[e.slice(t+1)];return!!n&&n.indexOf(" "+e.slice(0,t)+" ")>=0},e.get=function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var n=e.lastIndexOf(".",t-1);if(n<=0||n>=t-1)return null;var i=o[e.slice(t+1)];return i?i.indexOf(" "+e.slice(n+1,t)+" ")<0?null:e.slice(n+1):null},e}(),l=function(){function e(){}return e.setList=function(e){o=e||{}},e.getDomain=function(e){if(!o)return null;var t=e.match(/\./g);if(t&&t.length<2)return e;var n=this.getTld(e);if(!n)return null;var i=e.length-n.length-1;return i=e.lastIndexOf(".",i-1)+1,e.substring(i)||""},e.getTld=function(e){if(!o)return"";var t=e.lastIndexOf("."),n=e.substring(t+1);return o[n.toLowerCase()]&&s.get(e)||n},e.KEY="Domains",e}(),c=function(){function e(){this.cache={}}return Object.defineProperty(e,"instance",{get:function(){return void 0===e.classInstance&&(e.classInstance=new e),e.classInstance},enumerable:!1,configurable:!0}),e.prototype.load=function(e,t,n){var i=this;return this.contains(e)?Promise.reject("Already in cache."):(this.cache[e]={url:t,data:null},this.requestXhr(t,n).then(function(t){return i.loadComplete(e,t)}).catch(function(t){return i.remove(e),Promise.reject(t)}))},e.prototype.loadComplete=function(e,t){if(!this.contains(e))return Promise.reject("Item was removed from cache before loading was complete.");try{var n=JSON.parse(t);return this.cache[e].data=n,Promise.resolve(n)}catch(e){return Promise.reject("There was an error parsing JSON file.")}},e.prototype.remove=function(e){this.contains(e)&&delete this.cache[e]},e.prototype.get=function(e){return this.contains(e)?this.cache[e].data:null},e.prototype.contains=function(e){return this.cache.hasOwnProperty(e)},e.prototype.isLoading=function(e){return this.contains(e)&&null===this.cache[e].data},e.prototype.isLoaded=function(e){return this.contains(e)&&null!==this.cache[e].data},e.prototype.loadScript=function(e,t,n){return void 0===t&&(t=!0),new Promise(function(t,i){var r=document.createElement("script");r.src=e,r.async=!1,r.onload=function(){"function"==typeof n&&n(),t()},document.head.appendChild(r)})},e.prototype.requestXhr=function(e,t){var n;return void 0===t&&(t="application/json"),window.XMLHttpRequest?(n=new XMLHttpRequest,new Promise(function(i,r){n.onreadystatechange=function(){4===n.readyState&&(200===n.status?(i(n.responseText),n.onreadystatechange=null):n.status>0&&(r("There was a problem with the request: status "+n.status),n.onreadystatechange=null))};try{n.open("GET",e,!0),n.setRequestHeader("Content-Type",t),n.send()}catch(e){r("Error: Unable to send request, CORS not allowed.")}})):Promise.reject("Unable to send request, XMLHttpRequest not supported.")},e}();function h(e,t,n){var i=document.createElement("script");i.setAttribute("src",e+"?v="+t),"function"==typeof n&&(i.onload=n),document.body.appendChild(i)}(a=e.UtmTargets||(e.UtmTargets={}))[a.splashscreen=0]="splashscreen",a[a.logo=1]="logo",a[a.facebook=2]="facebook",a[a.twitter=3]="twitter",a[a.playstore=4]="playstore",a[a.appstore=5]="appstore",a[a.more_games=6]="more_games",a[a.download_game=7]="download_game",a[a.walkthrough=8]="walkthrough",a[a.disclaimer=9]="disclaimer",a[a.highscores=10]="highscores";var u,d,p=function(){function e(){}return e.loadPortalScript=function(e){e&&e.hasOwnProperty("minijuegos")&&-1!==e.minijuegos.indexOf(E.getSourceSite())&&(void 0!==window.mpConfig?window.mpConfig.partner="orange-games":window.mpConfig={partner:"orange-games"},h("https://ext.minijuegosgratis.com/external-host/main.js",Date.now()/1e3)),e&&e.hasOwnProperty("kongregate")&&-1!==e.kongregate.indexOf(E.getSourceSite())&&h("https://cdn1.kongregate.com/javascripts/kongregate_api.js",Date.now()/1e3,function(){"undefined"!=typeof kongregateAPI&&kongregateAPI.loadAPI(function(){window.kongregate=kongregateAPI.getAPI()})}),e&&e.hasOwnProperty("newgrounds")&&-1!==e.newgrounds.indexOf(E.getSourceSite())&&h("https://cdn.fbrq.io/@azerion/splash/assets/scripts/newgroundsio.min.js",Date.now()/1e3)},e}(),f=function(){function t(){}return t.preload=function(e){var n=Promise.all([c.instance.load(l.KEY,E.ASSET_LOCATION+"json/domains.json?v="+e,"text/plain"),c.instance.load(t.SITELOCK_PORTALS,E.ASSET_LOCATION+"json/sitelock.json?v="+e,"text/plain")]);return Promise.all([c.instance.load(t.INTERNAL_PORTALS_KEY,E.ASSET_LOCATION+"json/internal.json?v="+e,"text/plain"),c.instance.load(t.CONTRACTED_PORTALS_KEY,E.ASSET_LOCATION+"json/contracted.json?v="+e,"text/plain"),c.instance.load(t.SPECIAL_PORTALS_KEY,E.ASSET_LOCATION+"json/special.json?v="+e,"text/plain"),c.instance.load(t.GAME_ICONS_KEY,E.ASSET_LOCATION+"json/games.json?v="+e,"text/plain")]),n.then(function(e){var n=e[0],i=e[1];l.setList(n),p.loadPortalScript(i),t.setSiteLock(i)}).catch(function(){console.warn("Unable to parse json")})},t.setSiteLock=function(e){t.siteLocks=e},Object.defineProperty(t,"brandingLogoUrl",{get:function(){var n;switch(E.isOnDevice()||t.isAirfi()?E.ASSET_LOCATION="assets/":"fbrq.io"===E.getSourceSite(!0)&&(E.ASSET_LOCATION="https://"+window.location.host+"/@azerion/splash/assets/"),E.getBrandingDomain()){case e.BrandingDomain.Spele:n="spele";break;case e.BrandingDomain.PlayCell:n="playcell";break;case e.BrandingDomain.GameCell:n="gamecell";break;case e.BrandingDomain.Yepi:n="yepi";break;case e.BrandingDomain.Admeen:n="admeen";break;case e.BrandingDomain.Bild:n="bild";break;case e.BrandingDomain.Kizi:n="kizi";break;case e.BrandingDomain.Funnygames:n="funnygames";break;case e.BrandingDomain.PlayTime:n="playtime";break;default:case e.BrandingDomain.AGame:n="agame"}return E.ASSET_LOCATION+"images/branding_logo_"+n+"_small.png"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"brandingBackgroundColor",{get:function(){var t;switch(E.getBrandingDomain()){case e.BrandingDomain.Spele:t="#4a72ad";break;case e.BrandingDomain.PlayCell:t="#52a1e1";break;case e.BrandingDomain.GameCell:t="#c600b2";break;case e.BrandingDomain.Yepi:t="#0573a7";break;case e.BrandingDomain.AGame:t="#0C486C";break;case e.BrandingDomain.Admeen:t="#4267B2";break;case e.BrandingDomain.Bild:t="#de0000";break;default:case e.BrandingDomain.Kizi:t="#012f50";break;case e.BrandingDomain.Funnygames:t="#33b0ff";break;case e.BrandingDomain.PlayTime:t="#023a63"}return t},enumerable:!1,configurable:!0}),t.openCampaignLink=function(n,i){if(!E.isOnDevice()&&!t.isSpecial()&&t.outGoingLinksAllowed()){var r,o,a=E.getSourceSite(),s=E.isOnDevice()?"https://":"//";switch(E.getBrandingDomain()){case e.BrandingDomain.Spele:r=s+"www.spele.nl";break;case e.BrandingDomain.Yepi:r=s+"www.yepi.com";break;case e.BrandingDomain.Admeen:return r="https://media.admeen.com/branding/link.php",void((o=window.open(r,"_blank"))&&o.focus&&o.focus());case e.BrandingDomain.PlayCell:r=s+"www.playcell.com";break;case e.BrandingDomain.GameCell:r=s+"www.gamecell.com";break;case e.BrandingDomain.Kizi:r=s+"www.kizi.com";break;case e.BrandingDomain.Bild:return void((o=window.open(s+"www.bildspielt.de","_blank"))&&o.focus&&o.focus());case e.BrandingDomain.Funnygames:r=s+"www.funnygames.nu";break;case e.BrandingDomain.PlayTime:r=s+"playtime.nl";break;default:case e.BrandingDomain.AGame:r=s+"www.agame.com"}var l="string"==typeof i?i:e.UtmTargets[i];(o=window.open(r+"/?utm_source="+a+"&utm_medium=html5&utm_term="+n+"&utm_content="+l+"&utm_campaign=Gamedistribution","_blank"))&&o.focus&&o.focus()}},t.isInternal=function(){return t.hostMatchesList(c.instance.get(t.INTERNAL_PORTALS_KEY))},t.isContracted=function(){return t.hostMatchesList(c.instance.get(t.CONTRACTED_PORTALS_KEY))},t.isSpecial=function(){return t.hostMatchesList(c.instance.get(t.SPECIAL_PORTALS_KEY))},t.isAdmeen=function(){if(!t.siteLocks||!t.siteLocks.hasOwnProperty("admeen"))return!1;var e=t.siteLocks.admeen;return t.hostMatchesList(e)},t.isKongregate=function(){if(!t.siteLocks||!t.siteLocks.hasOwnProperty("kongregate"))return!1;var e=t.siteLocks.kongregate;return t.hostMatchesList(e)},t.isNewgrounds=function(){if(!t.siteLocks||!t.siteLocks.hasOwnProperty("newgrounds"))return!1;var e=t.siteLocks.newgrounds;return t.hostMatchesList(e)},t.isBild=function(){return"bild.fbrq.io"===window.location.host||-1!==window.location.host.indexOf("contentfleet.com")},t.isPlaytime=function(){return-1!==window.location.host.indexOf("playtime.nl")},t.isBip=function(){return-1!==window.location.search.indexOf("bipgaming")||"bip.fbrq.io"===window.location.host},t.isPlaycellApp=function(){return-1!==window.location.search.indexOf("playcellApp")},t.isAGame=function(){return-1!==window.location.search.indexOf("agame")},t.isAirfi=function(){return!!window.hasOwnProperty("airfi")&&window.airfi},t.outGoingLinksAllowed=function(){return!(t.isAirfi()||t.isSpecial()||t.isContracted())&&(!window.hasOwnProperty("fbrqLA")||window.fbrqLA)},t.hostMatchesList=function(e){e=e||[];for(var t=E.getSourceSite(),n=0;n<e.length;n++)if(t===e[n])return!0;return!1},t.LOGO_KEY="branding_logo",t.INTERNAL_PORTALS_KEY="branding_portals",t.CONTRACTED_PORTALS_KEY="branding_contracted",t.SPECIAL_PORTALS_KEY="branding_special",t.SITELOCK_PORTALS="sitelock_portals",t.GAME_ICONS_KEY="more_games",t.DOMAIN_OVERWRITE=null,t.analyticsEnabled=!0,t}(),E=function(){function t(){}return t.getSourceSite=function(e){void 0===e&&(e=!1);var n=document.referrer||window.location.host;if(e&&(n=window.location.host),-1!==n.indexOf("embed.gamedistribution.com")&&-1!==window.location.search.indexOf("gd_sdk_referrer_url")&&(n=t.getUrlParameter("gd_sdk_referrer_url")||n),n=decodeURIComponent(n),f.isBild())return"bildspielt.de";if(f.isBip())return"bipgaming.com";n=(n=n.indexOf("://")>-1?n.split("/")[2]:n.split("/")[0]).split(":")[0];var i=l.getDomain(n);return null!==i?i:(3===n.split(".").length&&(n=n.substr(n.indexOf(".")+1)),n)},t.getBrandingDomain=function(){if(window.hasOwnProperty("fbrqBD")&&window.fbrqBD in e.BrandingDomain)return window.fbrqBD;if(f.DOMAIN_OVERWRITE)return f.DOMAIN_OVERWRITE;var n=t.getSourceSite();if(f.isAdmeen())return e.BrandingDomain.Admeen;if(f.isPlaycellApp()||f.isBip())return e.BrandingDomain.PlayCell;switch(n){case"spele.nl":return e.BrandingDomain.Spele;case"yepi.com":return e.BrandingDomain.Yepi;case"oyunskor.com":case"barbioyunu.com.tr":case"bebekoyunu.com.tr":case"oyunkolu.com":case"oyungemisi.com":case"oyunlar1.com":case"oyunkuzusu.com":case"kraloyun.com":case"rekoroyun.com":case"oyundedem.com":case"oyunoyna.com":case"pastaoyunu.com.tr":case"playcell.com":return e.BrandingDomain.PlayCell;case"gamecell.com":return e.BrandingDomain.GameCell;case"playxl.com":return e.BrandingDomain.Admeen;case"kizi.com":return e.BrandingDomain.Kizi;case"bildspielt.de":return e.BrandingDomain.Bild;case"funnygames.nl":return e.BrandingDomain.Funnygames;case"playtime.nl":return e.BrandingDomain.PlayTime;default:case"agame.com":return e.BrandingDomain.AGame}},t.getReferrer=function(e){return-1!==e.indexOf("?ref=")?e.substr(e.indexOf("?ref=")+5):e},t.inIframe=function(){try{return window.self!==window.top}catch(e){return!0}},t.inGDGameZone=function(){return-1!==document.referrer.indexOf("html5.gamedistribution.com")},t.getDomain=function(e){var t=document.createElement("a");return t.href=e,t.origin},t.isOnDevice=function(){return void 0!==window.cordova&&!/(gamedistribution\.com)/.test(window.location.hostname)},t.isTc=function(){return/(teamcity\.azerdev\.com)/.test(window.location.host)},t.getRandomRange=function(e,t){return Math.random()*(t-e)+e|0},t.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},t.intTimeToString=function(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=e%60;return(t<10?"0"+t:t.toString())+":"+(n<10?"0"+n:n.toString())+":"+(i<10?"0"+i:i.toString())},t.ASSET_LOCATION=window.hasOwnProperty("fbrqSA")&&!0===window.fbrqSA?"assets/":"https://cdn.fbrq.io/@azerion/splash/assets/",t}(),m=function(){function e(){}return e.preload=function(){return f.analyticsEnabled?new Promise(function(e,t){var n,i,r,o,a,s,l,c=E.isOnDevice()?"https://":"//";n=window,i=document,r="script",o=c+"www.google-analytics.com/analytics.js",a="ga",n.GoogleAnalyticsObject=a,n.ga=n.ga?n.ga:function(){(n.ga.q=n.ga.q||[]).push(arguments)},n.ga.l=Date.now(),s=i.createElement(r),l=i.getElementsByTagName(r)[0],s.async=1,s.src=o,l.parentNode.insertBefore(s,l),e()}):Promise.resolve()},e.prototype.setup=function(e,t,n,i,r){if(void 0===i&&(i="auto"),void 0===r&&(r=100),!f.analyticsEnabled)return null;if(ga("create",e,i,{sampleRate:r}),E.isOnDevice()&&ga("set","checkProtocolTask",null),void 0!==t&&ga("set","appName",t),void 0!==t&&ga("set","appVersion",n),ga("send","pageview"),"auto"!==i){var o={name:"fbrq",sampleRate:1};for(var a in i)i.hasOwnProperty(a)&&(o[a]=i[a]);ga("create","UA-60359297-50",o)}else ga("create","UA-60359297-50",i,"fbrq",{sampleRate:1});if(f.isAGame()){var s=E.getReferrer(decodeURIComponent(document.referrer));ga("fbrq.set","referrer",s),ga("set","referrer",s)}return E.isOnDevice()&&ga("fbrq.set","checkProtocolTask",null),ga("fbrq.set","appName","All"),ga("fbrq.send","pageview"),ga},e.prototype.sendScreenView=function(e){f.analyticsEnabled&&["send","fbrq.send"].forEach(function(t){ga(t,"screenview",{screenName:e})})},e.prototype.sendGenericEvent=function(e,t,n){f.analyticsEnabled&&["send","fbrq.send"].forEach(function(i){ga(i,"event",e,t,n)})},e}(),g=g||function(e,t){var n={},i=n.lib={},r=function(){},o=i.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=n.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new a.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new a.init(n,t)}},h=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,o=this.blockSize,s=r/(4*o);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,r=e.min(4*t,r),t){for(var l=0;l<t;l+=o)this._doProcessBlock(i,l);l=i.splice(0,t),n.sigBytes-=r}return new a.init(l,r)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}});var d=n.algo={};return n}(Math);!function(e){for(var t=g,n=(r=t.lib).WordArray,i=r.Hasher,r=t.algo,o=[],a=[],s=function(e){return 4294967296*(e-(0|e))|0},l=2,c=0;64>c;){var h;e:{h=l;for(var u=e.sqrt(h),d=2;d<=u;d++)if(!(h%d)){h=!1;break e}h=!0}h&&(8>c&&(o[c]=s(e.pow(l,.5))),a[c]=s(e.pow(l,1/3)),c++),l++}var p=[];r=r.SHA256=i.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],s=n[3],l=n[4],c=n[5],h=n[6],u=n[7],d=0;64>d;d++){if(16>d)p[d]=0|e[t+d];else{var f=p[d-15],E=p[d-2];p[d]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+p[d-7]+((E<<15|E>>>17)^(E<<13|E>>>19)^E>>>10)+p[d-16]}f=u+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&c^~l&h)+a[d]+p[d],E=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&o^r&o),u=h,h=c,c=l,l=s+f|0,s=o,o=r,r=i,i=f+E|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+l|0,n[5]=n[5]+c|0,n[6]=n[6]+h|0,n[7]=n[7]+u|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(r),t.HmacSHA256=i._createHmacHelper(r)}(Math),d=(u=g).enc.Utf8,u.algo.HMAC=u.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=d.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),o=this._iKey=t.clone(),a=r.words,s=o.words,l=0;l<n;l++)a[l]^=1549556828,s[l]^=909522486;r.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),function(){var e=g,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var o=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,a=0;4>a&&r+.75*a<n;a++)e.push(i.charAt(o>>>6*(3-a)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,i=this._map;(r=i.charAt(64))&&(-1!=(r=e.indexOf(r))&&(n=r));for(var r=[],o=0,a=0;a<n;a++)if(a%4){var s=i.indexOf(e.charAt(a-1))<<a%4*2,l=i.indexOf(e.charAt(a))>>>6-a%4*2;r[o>>>2]|=(s|l)<<24-o%4*8,o++}return t.create(r,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical"}(e.EGAErrorSeverity||(e.EGAErrorSeverity={})),function(e){e[e.Undefined=0]="Undefined",e[e.Male=1]="Male",e[e.Female=2]="Female"}(e.EGAGender||(e.EGAGender={})),function(e){e[e.Undefined=0]="Undefined",e[e.Start=1]="Start",e[e.Complete=2]="Complete",e[e.Fail=3]="Fail"}(e.EGAProgressionStatus||(e.EGAProgressionStatus={})),function(e){e[e.Undefined=0]="Undefined",e[e.Source=1]="Source",e[e.Sink=2]="Sink"}(e.EGAResourceFlowType||(e.EGAResourceFlowType={})),function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Rejected=1]="Rejected"}(e.EGASdkErrorType||(e.EGASdkErrorType={})),function(e){e[e.NoResponse=0]="NoResponse",e[e.BadResponse=1]="BadResponse",e[e.RequestTimeout=2]="RequestTimeout",e[e.JsonEncodeFailed=3]="JsonEncodeFailed",e[e.JsonDecodeFailed=4]="JsonDecodeFailed",e[e.InternalServerError=5]="InternalServerError",e[e.BadRequest=6]="BadRequest",e[e.Unauthorized=7]="Unauthorized",e[e.UnknownResponseCode=8]="UnknownResponseCode",e[e.Ok=9]="Ok"}(e.EGAHTTPApiResponse||(e.EGAHTTPApiResponse={}))}(e.http||(e.http={}))}(v||(v={}));var v;v.EGAErrorSeverity,v.EGAGender,v.EGAProgressionStatus,v.EGAResourceFlowType;!function(e){!function(e){var t;!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Debug=3]="Debug"}(t||(t={}));var n=function(){function e(){e.debugEnabled=!1}return e.setInfoLog=function(t){e.instance.infoLogEnabled=t},e.setVerboseLog=function(t){e.instance.infoLogVerboseEnabled=t},e.i=function(n){if(e.instance.infoLogEnabled){var i="Info/"+e.Tag+": "+n;e.instance.sendNotificationMessage(i,t.Info)}},e.w=function(n){var i="Warning/"+e.Tag+": "+n;e.instance.sendNotificationMessage(i,t.Warning)},e.e=function(n){var i="Error/"+e.Tag+": "+n;e.instance.sendNotificationMessage(i,t.Error)},e.ii=function(n){if(e.instance.infoLogVerboseEnabled){var i="Verbose/"+e.Tag+": "+n;e.instance.sendNotificationMessage(i,t.Info)}},e.d=function(n){if(e.debugEnabled){var i="Debug/"+e.Tag+": "+n;e.instance.sendNotificationMessage(i,t.Debug)}},e.prototype.sendNotificationMessage=function(e,n){switch(n){case t.Error:console.error(e);break;case t.Warning:console.warn(e);break;case t.Debug:"function"==typeof console.debug?console.debug(e):console.log(e);break;case t.Info:console.log(e)}},e.instance=new e,e.Tag="GameAnalytics",e}();e.GALogger=n}(e.logging||(e.logging={}))}(v||(v={})),function(e){!function(t){var n=e.logging.GALogger,i=function(){function e(){}return e.getHmac=function(e,t){var n=g.HmacSHA256(t,e);return g.enc.Base64.stringify(n)},e.stringMatch=function(e,t){return!(!e||!t)&&t.test(e)},e.joinStringArray=function(e,t){for(var n="",i=0,r=e.length;i<r;i++)i>0&&(n+=t),n+=e[i];return n},e.stringArrayContainsString=function(e,t){if(0===e.length)return!1;for(var n in e)if(e[n]===t)return!0;return!1},e.encode64=function(t){t=encodeURI(t);var n,i,r,o,a,s="",l=0,c=0,h=0;do{r=(n=t.charCodeAt(h++))>>2,o=(3&n)<<4|(i=t.charCodeAt(h++))>>4,a=(15&i)<<2|(l=t.charCodeAt(h++))>>6,c=63&l,isNaN(i)?a=c=64:isNaN(l)&&(c=64),s=s+e.keyStr.charAt(r)+e.keyStr.charAt(o)+e.keyStr.charAt(a)+e.keyStr.charAt(c),n=i=l=0,r=o=a=c=0}while(h<t.length);return s},e.decode64=function(t){var i,r,o,a,s="",l=0,c=0,h=0;/[^A-Za-z0-9\+\/\=]/g.exec(t)&&n.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{i=e.keyStr.indexOf(t.charAt(h++))<<2|(o=e.keyStr.indexOf(t.charAt(h++)))>>4,r=(15&o)<<4|(a=e.keyStr.indexOf(t.charAt(h++)))>>2,l=(3&a)<<6|(c=e.keyStr.indexOf(t.charAt(h++))),s+=String.fromCharCode(i),64!=a&&(s+=String.fromCharCode(r)),64!=c&&(s+=String.fromCharCode(l)),i=r=l=0,o=a=c=0}while(h<t.length);return decodeURI(s)},e.timeIntervalSince1970=function(){var e=new Date;return Math.round(e.getTime()/1e3)},e.createGuid=function(){return(e.s4()+e.s4()+"-"+e.s4()+"-4"+e.s4().substr(0,3)+"-"+e.s4()+"-"+e.s4()+e.s4()+e.s4()).toLowerCase()},e.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e}();t.GAUtilities=i}(e.utilities||(e.utilities={}))}(v||(v={})),function(e){!function(t){var n=e.logging.GALogger,i=e.http.EGASdkErrorType,r=e.utilities.GAUtilities,o=function(){function t(){}return t.validateBusinessEvent=function(e,i,r,o,a){return t.validateCurrency(e)?i<0?(n.w("Validation fail - business event - amount. Cannot be less than 0. Failed amount: "+i),!1):t.validateShortString(r,!0)?t.validateEventPartLength(o,!1)?t.validateEventPartCharacters(o)?t.validateEventPartLength(a,!1)?!!t.validateEventPartCharacters(a)||(n.w("Validation fail - business event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+a),!1):(n.w("Validation fail - business event - itemId. Cannot be (null), empty or above 64 characters. String: "+a),!1):(n.w("Validation fail - business event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+o),!1):(n.w("Validation fail - business event - itemType: Cannot be (null), empty or above 64 characters. String: "+o),!1):(n.w("Validation fail - business event - cartType. Cannot be above 32 length. String: "+r),!1):(n.w("Validation fail - business event - currency: Cannot be (null) and need to be A-Z, 3 characters and in the standard at openexchangerates.org. Failed currency: "+e),!1)},t.validateResourceEvent=function(i,o,a,s,l,c,h){return i==e.EGAResourceFlowType.Undefined?(n.w("Validation fail - resource event - flowType: Invalid flow type."),!1):o?r.stringArrayContainsString(c,o)?a>0?s?t.validateEventPartLength(s,!1)?t.validateEventPartCharacters(s)?r.stringArrayContainsString(h,s)?t.validateEventPartLength(l,!1)?!!t.validateEventPartCharacters(l)||(n.w("Validation fail - resource event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+l),!1):(n.w("Validation fail - resource event - itemId: Cannot be (null), empty or above 64 characters. String: "+l),!1):(n.w("Validation fail - resource event - itemType: Not found in list of pre-defined available resource itemTypes. String: "+s),!1):(n.w("Validation fail - resource event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+s),!1):(n.w("Validation fail - resource event - itemType: Cannot be (null), empty or above 64 characters. String: "+s),!1):(n.w("Validation fail - resource event - itemType: Cannot be (null)"),!1):(n.w("Validation fail - resource event - amount: Float amount cannot be 0 or negative. Value: "+a),!1):(n.w("Validation fail - resource event - currency: Not found in list of pre-defined available resource currencies. String: "+o),!1):(n.w("Validation fail - resource event - currency: Cannot be (null)"),!1)},t.validateProgressionEvent=function(i,r,o,a){if(i==e.EGAProgressionStatus.Undefined)return n.w("Validation fail - progression event: Invalid progression status."),!1;if(a&&!o&&r)return n.w("Validation fail - progression event: 03 found but 01+02 are invalid. Progression must be set as either 01, 01+02 or 01+02+03."),!1;if(o&&!r)return n.w("Validation fail - progression event: 02 found but not 01. Progression must be set as either 01, 01+02 or 01+02+03"),!1;if(!r)return n.w("Validation fail - progression event: progression01 not valid. Progressions must be set as either 01, 01+02 or 01+02+03"),!1;if(!t.validateEventPartLength(r,!1))return n.w("Validation fail - progression event - progression01: Cannot be (null), empty or above 64 characters. String: "+r),!1;if(!t.validateEventPartCharacters(r))return n.w("Validation fail - progression event - progression01: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+r),!1;if(o){if(!t.validateEventPartLength(o,!0))return n.w("Validation fail - progression event - progression02: Cannot be empty or above 64 characters. String: "+o),!1;if(!t.validateEventPartCharacters(o))return n.w("Validation fail - progression event - progression02: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+o),!1}if(a){if(!t.validateEventPartLength(a,!0))return n.w("Validation fail - progression event - progression03: Cannot be empty or above 64 characters. String: "+a),!1;if(!t.validateEventPartCharacters(a))return n.w("Validation fail - progression event - progression03: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+a),!1}return!0},t.validateDesignEvent=function(e,i){return t.validateEventIdLength(e)?!!t.validateEventIdCharacters(e)||(n.w("Validation fail - design event - eventId: Non valid characters. Only allowed A-z, 0-9, -_., ()!?. String: "+e),!1):(n.w("Validation fail - design event - eventId: Cannot be (null) or empty. Only 5 event parts allowed seperated by :. Each part need to be 32 characters or less. String: "+e),!1)},t.validateErrorEvent=function(i,r){return i==e.EGAErrorSeverity.Undefined?(n.w("Validation fail - error event - severity: Severity was unsupported value."),!1):!!t.validateLongString(r,!0)||(n.w("Validation fail - error event - message: Message cannot be above 8192 characters."),!1)},t.validateSdkErrorEvent=function(e,r,o){return!!t.validateKeys(e,r)&&(o!==i.Undefined||(n.w("Validation fail - sdk error event - type: Type was unsupported value."),!1))},t.validateKeys=function(e,t){return!(!r.stringMatch(e,/^[A-z0-9]{32}$/)||!r.stringMatch(t,/^[A-z0-9]{40}$/))},t.validateCurrency=function(e){return!!e&&!!r.stringMatch(e,/^[A-Z]{3}$/)},t.validateEventPartLength=function(e,t){return!(!t||e)||!!e&&!(e.length>64)},t.validateEventPartCharacters=function(e){return!!r.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},t.validateEventIdLength=function(e){return!!e&&!!r.stringMatch(e,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},t.validateEventIdCharacters=function(e){return!!e&&!!r.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},t.validateAndCleanInitRequestResponse=function(e){if(null==e)return n.w("validateInitRequestResponse failed - no response dictionary."),null;var t={};try{t.enabled=e.enabled}catch(e){return n.w("validateInitRequestResponse failed - invalid type in 'enabled' field."),null}try{var i=e.server_ts;if(!(i>0))return n.w("validateInitRequestResponse failed - invalid value in 'server_ts' field."),null;t.server_ts=i}catch(t){return n.w("validateInitRequestResponse failed - invalid type in 'server_ts' field. type="+typeof e.server_ts+", value="+e.server_ts+", "+t),null}try{var r=e.configurations;t.configurations=r}catch(t){return n.w("validateInitRequestResponse failed - invalid type in 'configurations' field. type="+typeof e.configurations+", value="+e.configurations+", "+t),null}return t},t.validateBuild=function(e){return!!t.validateShortString(e,!1)},t.validateSdkWrapperVersion=function(e){return!!r.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},t.validateEngineVersion=function(e){return!(!e||!r.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},t.validateUserId=function(e){return!!t.validateString(e,!1)||(n.w("Validation fail - user id: id cannot be (null), empty or above 64 characters."),!1)},t.validateShortString=function(e,t){return!(!t||e)||!(!e||e.length>32)},t.validateString=function(e,t){return!(!t||e)||!(!e||e.length>64)},t.validateLongString=function(e,t){return!(!t||e)||!(!e||e.length>8192)},t.validateConnectionType=function(e){return r.stringMatch(e,/^(wwan|wifi|lan|offline)$/)},t.validateCustomDimensions=function(e){return t.validateArrayOfStrings(20,32,!1,"custom dimensions",e)},t.validateResourceCurrencies=function(e){if(!t.validateArrayOfStrings(20,64,!1,"resource currencies",e))return!1;for(var i=0;i<e.length;++i)if(!r.stringMatch(e[i],/^[A-Za-z]+$/))return n.w("resource currencies validation failed: a resource currency can only be A-Z, a-z. String was: "+e[i]),!1;return!0},t.validateResourceItemTypes=function(e){if(!t.validateArrayOfStrings(20,32,!1,"resource item types",e))return!1;for(var i=0;i<e.length;++i)if(!t.validateEventPartCharacters(e[i]))return n.w("resource item types validation failed: a resource item type cannot contain other characters than A-z, 0-9, -_., ()!?. String was: "+e[i]),!1;return!0},t.validateDimension01=function(e,t){return!e||!!r.stringArrayContainsString(t,e)},t.validateDimension02=function(e,t){return!e||!!r.stringArrayContainsString(t,e)},t.validateDimension03=function(e,t){return!e||!!r.stringArrayContainsString(t,e)},t.validateArrayOfStrings=function(e,t,i,r,o){var a=r;if(a||(a="Array"),!o)return n.w(a+" validation failed: array cannot be null. "),!1;if(0==i&&0==o.length)return n.w(a+" validation failed: array cannot be empty. "),!1;if(e>0&&o.length>e)return n.w(a+" validation failed: array cannot exceed "+e+" values. It has "+o.length+" values."),!1;for(var s=0;s<o.length;++s){var l=o[s]?o[s].length:0;if(0===l)return n.w(a+" validation failed: contained an empty string. Array="+JSON.stringify(o)),!1;if(t>0&&l>t)return n.w(a+" validation failed: a string exceeded max allowed length (which is: "+t+"). String was: "+o[s]),!1}return!0},t.validateFacebookId=function(e){return!!t.validateString(e,!1)||(n.w("Validation fail - facebook id: id cannot be (null), empty or above 64 characters."),!1)},t.validateGender=function(t){if(isNaN(Number(e.EGAGender[t]))){if(t==e.EGAGender.Undefined||t!=e.EGAGender.Male&&t!=e.EGAGender.Female)return n.w("Validation fail - gender: Has to be 'male' or 'female'. Was: "+t),!1}else if(t==e.EGAGender[e.EGAGender.Undefined]||t!=e.EGAGender[e.EGAGender.Male]&&t!=e.EGAGender[e.EGAGender.Female])return n.w("Validation fail - gender: Has to be 'male' or 'female'. Was: "+t),!1;return!0},t.validateBirthyear=function(e){return!(e<0||e>9999)||(n.w("Validation fail - birthYear: Cannot be (null) or invalid range."),!1)},t.validateClientTs=function(e){return!(e<-4294967294||e>4294967294)},t}();t.GAValidator=o}(e.validators||(e.validators={}))}(v||(v={})),function(e){!function(e){var t=function(){return function(e,t,n){this.name=e,this.value=t,this.version=n}}();e.NameValueVersion=t;var n=function(){return function(e,t){this.name=e,this.version=t}}();e.NameVersion=n;var i=function(){function e(){}return e.touch=function(){},e.getRelevantSdkVersion=function(){return e.sdkGameEngineVersion?e.sdkGameEngineVersion:e.sdkWrapperVersion},e.getConnectionType=function(){return e.connectionType},e.updateConnectionType=function(){navigator.onLine?"ios"===e.buildPlatform||"android"===e.buildPlatform?e.connectionType="wwan":e.connectionType="lan":e.connectionType="offline"},e.getOSVersionString=function(){return e.buildPlatform+" "+e.osVersionPair.version},e.runtimePlatformToString=function(){return e.osVersionPair.name},e.getBrowserVersionString=function(){var t,n=navigator.userAgent,i=n.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident|fbav(?=\/))\/?\s*(\d+)/i)||[];if(0==i.length&&"ios"===e.buildPlatform)return"webkit_"+e.osVersion;if(/trident/i.test(i[1]))return"IE "+((t=/\brv[ :]+(\d+)/g.exec(n)||[])[1]||"");if("Chrome"===i[1]&&null!=(t=n.match(/\b(OPR|Edge|UBrowser)\/(\d+)/)))return t.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();if(i[1]&&"fbav"===i[1].toLowerCase()&&(i[1]="facebook",i[2]))return"facebook "+i[2];var r=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(t=n.match(/version\/(\d+)/i))&&r.splice(1,1,t[1]),r.join(" ").toLowerCase()},e.getDeviceModel=function(){return"unknown"},e.getDeviceManufacturer=function(){return"unknown"},e.matchItem=function(e,t){var i,r,o,a,s=new n("unknown","0.0.0"),l=0,c=0;for(l=0;l<t.length;l+=1)if(new RegExp(t[l].value,"i").test(e)){if(i=new RegExp(t[l].version+"[- /:;]([\\d._]+)","i"),a="",(r=e.match(i))&&r[1]&&(o=r[1]),o){var h=o.split(/[._]+/);for(c=0;c<Math.min(h.length,3);c+=1)a+=h[c]+(c<Math.min(h.length,3)-1?".":"")}else a="0.0.0";return s.name=t[l].name,s.version=a,s}return s},e.sdkWrapperVersion="javascript 3.1.2",e.osVersionPair=e.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor].join(" "),[new t("windows_phone","Windows Phone","OS"),new t("windows","Win","NT"),new t("ios","iPhone","OS"),new t("ios","iPad","OS"),new t("ios","iPod","OS"),new t("android","Android","Android"),new t("blackBerry","BlackBerry","/"),new t("mac_osx","Mac","OS X"),new t("tizen","Tizen","Tizen"),new t("linux","Linux","rv")]),e.buildPlatform=e.runtimePlatformToString(),e.deviceModel=e.getDeviceModel(),e.deviceManufacturer=e.getDeviceManufacturer(),e.osVersion=e.getOSVersionString(),e.browserVersion=e.getBrowserVersionString(),e.maxSafeInteger=Math.pow(2,53)-1,e}();e.GADevice=i}(e.device||(e.device={}))}(v||(v={})),function(e){!function(e){var t=function(){function e(t){this.deadline=t,this.ignore=!1,this.async=!1,this.running=!1,this.id=++e.idCounter}return e.idCounter=0,e}();e.TimedBlock=t}(e.threading||(e.threading={}))}(v||(v={})),function(e){!function(e){var t=function(){function e(e){this.comparer=e,this._subQueues={},this._sortedKeys=[]}return e.prototype.enqueue=function(e,t){-1===this._sortedKeys.indexOf(e)&&this.addQueueOfPriority(e),this._subQueues[e].push(t)},e.prototype.addQueueOfPriority=function(e){var t=this;this._sortedKeys.push(e),this._sortedKeys.sort(function(e,n){return t.comparer.compare(e,n)}),this._subQueues[e]=[]},e.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},e.prototype.hasItems=function(){return this._sortedKeys.length>0},e.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},e.prototype.dequeueFromHighPriorityQueue=function(){var e=this._sortedKeys[0],t=this._subQueues[e].shift();return 0===this._subQueues[e].length&&(this._sortedKeys.shift(),delete this._subQueues[e]),t},e}();e.PriorityQueue=t}(e.threading||(e.threading={}))}(v||(v={})),function(e){!function(t){var n,i,r=e.logging.GALogger;!function(e){e[e.Equal=0]="Equal",e[e.LessOrEqual=1]="LessOrEqual",e[e.NotEqual=2]="NotEqual"}(n=t.EGAStoreArgsOperator||(t.EGAStoreArgsOperator={})),function(e){e[e.Events=0]="Events",e[e.Sessions=1]="Sessions",e[e.Progression=2]="Progression"}(i=t.EGAStore||(t.EGAStore={}));var o=function(){function e(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"==typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),e.storageAvailable=!0):e.storageAvailable=!1}catch(e){}}return e.isStorageAvailable=function(){return e.storageAvailable},e.isStoreTooLargeForEvents=function(){return e.instance.eventsStore.length+e.instance.sessionsStore.length>e.MaxNumberOfEntries},e.select=function(t,i,r,o){void 0===i&&(i=[]),void 0===r&&(r=!1),void 0===o&&(o=0);var a=e.getStore(t);if(!a)return null;for(var s=[],l=0;l<a.length;++l){for(var c=a[l],h=!0,u=0;u<i.length;++u){var d=i[u];if(c[d[0]])switch(d[1]){case n.Equal:h=c[d[0]]==d[2];break;case n.LessOrEqual:h=c[d[0]]<=d[2];break;case n.NotEqual:h=c[d[0]]!=d[2];break;default:h=!1}else h=!1;if(!h)break}h&&s.push(c)}return r&&s.sort(function(e,t){return e.client_ts-t.client_ts}),o>0&&s.length>o&&(s=s.slice(0,o+1)),s},e.update=function(t,i,r){void 0===r&&(r=[]);var o=e.getStore(t);if(!o)return!1;for(var a=0;a<o.length;++a){for(var s=o[a],l=!0,c=0;c<r.length;++c){var h=r[c];if(s[h[0]])switch(h[1]){case n.Equal:l=s[h[0]]==h[2];break;case n.LessOrEqual:l=s[h[0]]<=h[2];break;case n.NotEqual:l=s[h[0]]!=h[2];break;default:l=!1}else l=!1;if(!l)break}if(l)for(c=0;c<i.length;++c){var u=i[c];s[u[0]]=u[1]}}return!0},e.delete=function(t,i){var r=e.getStore(t);if(r)for(var o=0;o<r.length;++o){for(var a=r[o],s=!0,l=0;l<i.length;++l){var c=i[l];if(a[c[0]])switch(c[1]){case n.Equal:s=a[c[0]]==c[2];break;case n.LessOrEqual:s=a[c[0]]<=c[2];break;case n.NotEqual:s=a[c[0]]!=c[2];break;default:s=!1}else s=!1;if(!s)break}s&&(r.splice(o,1),--o)}},e.insert=function(t,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);var o=e.getStore(t);if(o)if(i){if(!r)return;for(var a=!1,s=0;s<o.length;++s){var l=o[s];if(l[r]==n[r]){for(var c in n)l[c]=n[c];a=!0;break}}a||o.push(n)}else o.push(n)},e.save=function(){e.isStorageAvailable()?(localStorage.setItem(e.KeyPrefix+e.EventsStoreKey,JSON.stringify(e.instance.eventsStore)),localStorage.setItem(e.KeyPrefix+e.SessionsStoreKey,JSON.stringify(e.instance.sessionsStore)),localStorage.setItem(e.KeyPrefix+e.ProgressionStoreKey,JSON.stringify(e.instance.progressionStore)),localStorage.setItem(e.KeyPrefix+e.ItemsStoreKey,JSON.stringify(e.instance.storeItems))):r.w("Storage is not available, cannot save.")},e.load=function(){if(e.isStorageAvailable()){try{e.instance.eventsStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.EventsStoreKey)),e.instance.eventsStore||(e.instance.eventsStore=[])}catch(t){r.w("Load failed for 'events' store. Using empty store."),e.instance.eventsStore=[]}try{e.instance.sessionsStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.SessionsStoreKey)),e.instance.sessionsStore||(e.instance.sessionsStore=[])}catch(t){r.w("Load failed for 'sessions' store. Using empty store."),e.instance.sessionsStore=[]}try{e.instance.progressionStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.ProgressionStoreKey)),e.instance.progressionStore||(e.instance.progressionStore=[])}catch(t){r.w("Load failed for 'progression' store. Using empty store."),e.instance.progressionStore=[]}try{e.instance.storeItems=JSON.parse(localStorage.getItem(e.KeyPrefix+e.ItemsStoreKey)),e.instance.storeItems||(e.instance.storeItems={})}catch(t){r.w("Load failed for 'items' store. Using empty store."),e.instance.progressionStore=[]}}else r.w("Storage is not available, cannot load.")},e.setItem=function(t,n){var i=e.KeyPrefix+t;n?e.instance.storeItems[i]=n:i in e.instance.storeItems&&delete e.instance.storeItems[i]},e.getItem=function(t){var n=e.KeyPrefix+t;return n in e.instance.storeItems?e.instance.storeItems[n]:null},e.getStore=function(t){switch(t){case i.Events:return e.instance.eventsStore;case i.Sessions:return e.instance.sessionsStore;case i.Progression:return e.instance.progressionStore;default:return r.w("GAStore.getStore(): Cannot find store: "+t),null}},e.instance=new e,e.MaxNumberOfEntries=2e3,e.KeyPrefix="GA::",e.EventsStoreKey="ga_event",e.SessionsStoreKey="ga_session",e.ProgressionStoreKey="ga_progression",e.ItemsStoreKey="ga_items",e}();t.GAStore=o}(e.store||(e.store={}))}(v||(v={})),function(e){!function(t){var n=e.validators.GAValidator,i=e.utilities.GAUtilities,r=e.logging.GALogger,o=e.store.GAStore,a=e.device.GADevice,s=e.store.EGAStore,l=e.store.EGAStoreArgsOperator,c=function(){function t(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.commandCenterListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={},this._isEventSubmissionEnabled=!0}return t.setUserId=function(e){t.instance.userId=e,t.cacheIdentifier()},t.getIdentifier=function(){return t.instance.identifier},t.isInitialized=function(){return t.instance.initialized},t.setInitialized=function(e){t.instance.initialized=e},t.getSessionStart=function(){return t.instance.sessionStart},t.getSessionNum=function(){return t.instance.sessionNum},t.getTransactionNum=function(){return t.instance.transactionNum},t.getSessionId=function(){return t.instance.sessionId},t.getCurrentCustomDimension01=function(){return t.instance.currentCustomDimension01},t.getCurrentCustomDimension02=function(){return t.instance.currentCustomDimension02},t.getCurrentCustomDimension03=function(){return t.instance.currentCustomDimension03},t.getGameKey=function(){return t.instance.gameKey},t.getGameSecret=function(){return t.instance.gameSecret},t.getAvailableCustomDimensions01=function(){return t.instance.availableCustomDimensions01},t.setAvailableCustomDimensions01=function(e){n.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions01=e,t.validateAndFixCurrentDimensions(),r.i("Set available custom01 dimension values: ("+i.joinStringArray(e,", ")+")"))},t.getAvailableCustomDimensions02=function(){return t.instance.availableCustomDimensions02},t.setAvailableCustomDimensions02=function(e){n.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions02=e,t.validateAndFixCurrentDimensions(),r.i("Set available custom02 dimension values: ("+i.joinStringArray(e,", ")+")"))},t.getAvailableCustomDimensions03=function(){return t.instance.availableCustomDimensions03},t.setAvailableCustomDimensions03=function(e){n.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions03=e,t.validateAndFixCurrentDimensions(),r.i("Set available custom03 dimension values: ("+i.joinStringArray(e,", ")+")"))},t.getAvailableResourceCurrencies=function(){return t.instance.availableResourceCurrencies},t.setAvailableResourceCurrencies=function(e){n.validateResourceCurrencies(e)&&(t.instance.availableResourceCurrencies=e,r.i("Set available resource currencies: ("+i.joinStringArray(e,", ")+")"))},t.getAvailableResourceItemTypes=function(){return t.instance.availableResourceItemTypes},t.setAvailableResourceItemTypes=function(e){n.validateResourceItemTypes(e)&&(t.instance.availableResourceItemTypes=e,r.i("Set available resource item types: ("+i.joinStringArray(e,", ")+")"))},t.getBuild=function(){return t.instance.build},t.setBuild=function(e){t.instance.build=e,r.i("Set build version: "+e)},t.getUseManualSessionHandling=function(){return t.instance.useManualSessionHandling},t.isEventSubmissionEnabled=function(){return t.instance._isEventSubmissionEnabled},t.prototype.setDefaultId=function(e){this.defaultUserId=e||"",t.cacheIdentifier()},t.getDefaultId=function(){return t.instance.defaultUserId},t.getSdkConfig=function(){var e=0;for(var n in t.instance.sdkConfig)0===e&&(i=n),++e;if(i&&e>0)return t.instance.sdkConfig;var i;e=0;for(var n in t.instance.sdkConfigCached)0===e&&(i=n),++e;return i&&e>0?t.instance.sdkConfigCached:t.instance.sdkConfigDefault},t.isEnabled=function(){var e=t.getSdkConfig();return(!e.enabled||"false"!=e.enabled)&&!!t.instance.initAuthorized},t.setCustomDimension01=function(e){t.instance.currentCustomDimension01=e,o.setItem(t.Dimension01Key,e),r.i("Set custom01 dimension value: "+e)},t.setCustomDimension02=function(e){t.instance.currentCustomDimension02=e,o.setItem(t.Dimension02Key,e),r.i("Set custom02 dimension value: "+e)},t.setCustomDimension03=function(e){t.instance.currentCustomDimension03=e,o.setItem(t.Dimension03Key,e),r.i("Set custom03 dimension value: "+e)},t.setFacebookId=function(e){t.instance.facebookId=e,o.setItem(t.FacebookIdKey,e),r.i("Set facebook id: "+e)},t.setGender=function(n){t.instance.gender=isNaN(Number(e.EGAGender[n]))?e.EGAGender[n].toString().toLowerCase():e.EGAGender[e.EGAGender[n]].toString().toLowerCase(),o.setItem(t.GenderKey,t.instance.gender),r.i("Set gender: "+t.instance.gender)},t.setBirthYear=function(e){t.instance.birthYear=e,o.setItem(t.BirthYearKey,e.toString()),r.i("Set birth year: "+e)},t.incrementSessionNum=function(){var e=t.getSessionNum()+1;t.instance.sessionNum=e},t.incrementTransactionNum=function(){var e=t.getTransactionNum()+1;t.instance.transactionNum=e},t.incrementProgressionTries=function(e){var n=t.getProgressionTries(e)+1;t.instance.progressionTries[e]=n;var i={};i.progression=e,i.tries=n,o.insert(s.Progression,i,!0,"progression")},t.getProgressionTries=function(e){return e in t.instance.progressionTries?t.instance.progressionTries[e]:0},t.clearProgressionTries=function(e){e in t.instance.progressionTries&&delete t.instance.progressionTries[e];var n=[];n.push(["progression",l.Equal,e]),o.delete(s.Progression,n)},t.setKeys=function(e,n){t.instance.gameKey=e,t.instance.gameSecret=n},t.setManualSessionHandling=function(e){t.instance.useManualSessionHandling=e,r.i("Use manual session handling: "+e)},t.setEnabledEventSubmission=function(e){t.instance._isEventSubmissionEnabled=e},t.getEventAnnotations=function(){var e={v:2};e.user_id=t.instance.identifier,e.client_ts=t.getClientTsAdjusted(),e.sdk_version=a.getRelevantSdkVersion(),e.os_version=a.osVersion,e.manufacturer=a.deviceManufacturer,e.device=a.deviceModel,e.browser_version=a.browserVersion,e.platform=a.buildPlatform,e.session_id=t.instance.sessionId,e[t.SessionNumKey]=t.instance.sessionNum;var i=a.getConnectionType();return n.validateConnectionType(i)&&(e.connection_type=i),a.gameEngineVersion&&(e.engine_version=a.gameEngineVersion),t.instance.build&&(e.build=t.instance.build),t.instance.facebookId&&(e[t.FacebookIdKey]=t.instance.facebookId),t.instance.gender&&(e[t.GenderKey]=t.instance.gender),0!=t.instance.birthYear&&(e[t.BirthYearKey]=t.instance.birthYear),e},t.getSdkErrorEventAnnotations=function(){var e={v:2};e.category=t.CategorySdkError,e.sdk_version=a.getRelevantSdkVersion(),e.os_version=a.osVersion,e.manufacturer=a.deviceManufacturer,e.device=a.deviceModel,e.platform=a.buildPlatform;var i=a.getConnectionType();return n.validateConnectionType(i)&&(e.connection_type=i),a.gameEngineVersion&&(e.engine_version=a.gameEngineVersion),e},t.getInitAnnotations=function(){var e={};return e.user_id=t.getIdentifier(),e.sdk_version=a.getRelevantSdkVersion(),e.os_version=a.osVersion,e.platform=a.buildPlatform,e},t.getClientTsAdjusted=function(){var e=i.timeIntervalSince1970(),r=e+t.instance.clientServerTimeOffset;return n.validateClientTs(r)?r:e},t.sessionIsStarted=function(){return 0!=t.instance.sessionStart},t.cacheIdentifier=function(){t.instance.userId?t.instance.identifier=t.instance.userId:t.instance.defaultUserId&&(t.instance.identifier=t.instance.defaultUserId)},t.ensurePersistedStates=function(){o.isStorageAvailable()&&o.load();var e=t.instance;e.setDefaultId(null!=o.getItem(t.DefaultUserIdKey)?o.getItem(t.DefaultUserIdKey):i.createGuid()),e.sessionNum=null!=o.getItem(t.SessionNumKey)?Number(o.getItem(t.SessionNumKey)):0,e.transactionNum=null!=o.getItem(t.TransactionNumKey)?Number(o.getItem(t.TransactionNumKey)):0,e.facebookId?o.setItem(t.FacebookIdKey,e.facebookId):(e.facebookId=null!=o.getItem(t.FacebookIdKey)?o.getItem(t.FacebookIdKey):"",e.facebookId),e.gender?o.setItem(t.GenderKey,e.gender):(e.gender=null!=o.getItem(t.GenderKey)?o.getItem(t.GenderKey):"",e.gender),e.birthYear&&0!=e.birthYear?o.setItem(t.BirthYearKey,e.birthYear.toString()):(e.birthYear=null!=o.getItem(t.BirthYearKey)?Number(o.getItem(t.BirthYearKey)):0,e.birthYear),e.currentCustomDimension01?o.setItem(t.Dimension01Key,e.currentCustomDimension01):(e.currentCustomDimension01=null!=o.getItem(t.Dimension01Key)?o.getItem(t.Dimension01Key):"",e.currentCustomDimension01),e.currentCustomDimension02?o.setItem(t.Dimension02Key,e.currentCustomDimension02):(e.currentCustomDimension02=null!=o.getItem(t.Dimension02Key)?o.getItem(t.Dimension02Key):"",e.currentCustomDimension02),e.currentCustomDimension03?o.setItem(t.Dimension03Key,e.currentCustomDimension03):(e.currentCustomDimension03=null!=o.getItem(t.Dimension03Key)?o.getItem(t.Dimension03Key):"",e.currentCustomDimension03);var n=null!=o.getItem(t.SdkConfigCachedKey)?o.getItem(t.SdkConfigCachedKey):"";if(n){var r=JSON.parse(i.decode64(n));r&&(e.sdkConfigCached=r)}var a=o.select(s.Progression);if(a)for(var l=0;l<a.length;++l){var c=a[l];c&&(e.progressionTries[c.progression]=c.tries)}},t.calculateServerTimeOffset=function(e){return e-i.timeIntervalSince1970()},t.validateAndCleanCustomFields=function(e){var n={};if(e){var o=0;for(var a in e){var s=e[a];if(a&&s)if(o<t.MAX_CUSTOM_FIELDS_COUNT){var l=new RegExp("^[a-zA-Z0-9_]{1,"+t.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(i.stringMatch(a,l)){var c=typeof s;if("string"===c||s instanceof String){var h=s;h.length<=t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&h.length>0?(n[a]=h,++o):r.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because its value is an empty string or exceeds the max number of characters ("+t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH+")")}else if("number"===c||s instanceof Number){var u=s;n[a]=u,++o}else r.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because its value is not a string or number")}else r.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because its key contains illegal character, is empty or exceeds the max number of characters ("+t.MAX_CUSTOM_FIELDS_KEY_LENGTH+")")}else r.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because it exceeds the max number of custom fields ("+t.MAX_CUSTOM_FIELDS_COUNT+")");else r.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because its key or value is null")}}return n},t.validateAndFixCurrentDimensions=function(){n.validateDimension01(t.getCurrentCustomDimension01(),t.getAvailableCustomDimensions01())||t.setCustomDimension01(""),n.validateDimension02(t.getCurrentCustomDimension02(),t.getAvailableCustomDimensions02())||t.setCustomDimension02(""),n.validateDimension03(t.getCurrentCustomDimension03(),t.getAvailableCustomDimensions03())||t.setCustomDimension03("")},t.getConfigurationStringValue=function(e,n){return t.instance.configurations[e]?t.instance.configurations[e].toString():n},t.isCommandCenterReady=function(){return t.instance.commandCenterIsReady},t.addCommandCenterListener=function(e){t.instance.commandCenterListeners.indexOf(e)<0&&t.instance.commandCenterListeners.push(e)},t.removeCommandCenterListener=function(e){var n=t.instance.commandCenterListeners.indexOf(e);n>-1&&t.instance.commandCenterListeners.splice(n,1)},t.getConfigurationsContentAsString=function(){return JSON.stringify(t.instance.configurations)},t.populateConfigurations=function(e){var n=e.configurations;if(n)for(var i=0;i<n.length;++i){var r=n[i];if(r){var o=r.key,a=r.value,s=r.start?r.start:Number.MIN_VALUE,l=r.end?r.end:Number.MAX_VALUE,c=t.getClientTsAdjusted();o&&a&&c>s&&c<l&&(t.instance.configurations[o]=a)}}t.instance.commandCenterIsReady=!0;var h=t.instance.commandCenterListeners;for(i=0;i<h.length;++i)h[i]&&h[i].onCommandCenterUpdated()},t.CategorySdkError="sdk_error",t.MAX_CUSTOM_FIELDS_COUNT=50,t.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,t.instance=new t,t.DefaultUserIdKey="default_user_id",t.SessionNumKey="session_num",t.TransactionNumKey="transaction_num",t.FacebookIdKey="facebook_id",t.GenderKey="gender",t.BirthYearKey="birth_year",t.Dimension01Key="dimension01",t.Dimension02Key="dimension02",t.Dimension03Key="dimension03",t.SdkConfigCachedKey="sdk_config_cached",t}();t.GAState=c}(e.state||(e.state={}))}(v||(v={})),function(e){!function(t){var n=e.utilities.GAUtilities,i=e.logging.GALogger,r=function(){function e(){}return e.execute=function(t,r,o,a){if(e.countMap[r]||(e.countMap[r]=0),!(e.countMap[r]>=e.MaxCount)){var s=n.getHmac(a,o),l=new XMLHttpRequest;l.onreadystatechange=function(){if(4===l.readyState){if(!l.responseText)return;if(200!=l.status)return void i.w("sdk error failed. response code not 200. status code: "+l.status+", description: "+l.statusText+", body: "+l.responseText);e.countMap[r]=e.countMap[r]+1}},l.open("POST",t,!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Authorization",s);try{l.send(o)}catch(e){console.error(e)}}},e.MaxCount=10,e.countMap={},e}();t.SdkErrorTask=r}(e.tasks||(e.tasks={}))}(v||(v={})),function(e){!function(t){var n=e.state.GAState,i=e.logging.GALogger,r=e.utilities.GAUtilities,o=e.validators.GAValidator,a=e.tasks.SdkErrorTask,s=function(){function e(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return e.prototype.requestInit=function(i){var r=n.getGameKey(),o=(this.baseUrl,this.initializeUrlPath);o="https://rubick.gameanalytics.com/v2/command_center?game_key="+r+"&interval_seconds=1000000";var a=n.getInitAnnotations(),s=JSON.stringify(a);if(s){var l=this.createPayloadData(s,this.useGzip),c=[];c.push(s),e.sendRequest(o,l,c,this.useGzip,e.initRequestCallback,i)}else i(t.EGAHTTPApiResponse.JsonEncodeFailed,null)},e.prototype.sendEventsInArray=function(i,r,o){if(0!=i.length){var a=n.getGameKey(),s=this.baseUrl+"/"+a+"/"+this.eventsUrlPath,l=JSON.stringify(i);if(l){var c=this.createPayloadData(l,this.useGzip),h=[];h.push(l),h.push(r),h.push(i.length.toString()),e.sendRequest(s,c,h,this.useGzip,e.sendEventInArrayRequestCallback,o)}else o(t.EGAHTTPApiResponse.JsonEncodeFailed,null,r,i.length)}},e.prototype.sendSdkErrorEvent=function(t){if(n.isEventSubmissionEnabled()){var r=n.getGameKey(),s=n.getGameSecret();if(o.validateSdkErrorEvent(r,s,t)){var l,c=this.baseUrl+"/"+r+"/"+this.eventsUrlPath,h=n.getSdkErrorEventAnnotations(),u=e.sdkErrorTypeToString(t);h.type=u;var d=[];d.push(h),(l=JSON.stringify(d))?a.execute(c,t,l,s):i.w("sendSdkErrorEvent: JSON encoding failed.")}}},e.sendEventInArrayRequestCallback=function(n,i,r,o){void 0===o&&(o=null);o[0],o[1];var a,s,l=o[2],c=parseInt(o[3]);a=n.responseText,s=n.status;var h=e.instance.processRequestResponse(s,n.statusText,a,"Events");if(h==t.EGAHTTPApiResponse.Ok||h==t.EGAHTTPApiResponse.BadRequest){var u=a?JSON.parse(a):{};null!=u?(t.EGAHTTPApiResponse.BadRequest,r(h,u,l,c)):r(t.EGAHTTPApiResponse.JsonDecodeFailed,null,l,c)}else r(h,null,l,c)},e.sendRequest=function(e,t,i,o,a,s){var l=new XMLHttpRequest,c=n.getGameSecret(),h=r.getHmac(c,t),u=[];for(var d in u.push(h),i)u.push(i[d]);if(l.onreadystatechange=function(){4===l.readyState&&a(l,e,s,u)},l.open("POST",e,!0),l.setRequestHeader("Content-Type","text/plain"),l.setRequestHeader("Authorization",h),o)throw new Error("gzip not supported");try{l.send(t)}catch(e){console.error(e.stack)}},e.initRequestCallback=function(n,i,r,a){void 0===a&&(a=null);var s,l;a[0],a[1];s=n.responseText,l=n.status;var c=s?JSON.parse(s):{},h=e.instance.processRequestResponse(l,n.statusText,s,"Init");if(h==t.EGAHTTPApiResponse.Ok||h==t.EGAHTTPApiResponse.BadRequest)if(null!=c)if(h!==t.EGAHTTPApiResponse.BadRequest){var u=o.validateAndCleanInitRequestResponse(c);u?r(t.EGAHTTPApiResponse.Ok,u,"",0):r(t.EGAHTTPApiResponse.BadResponse,null,"",0)}else r(h,null,"",0);else r(t.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0);else r(h,null,"",0)},e.prototype.createPayloadData=function(e,t){if(t)throw new Error("gzip not supported");return e},e.prototype.processRequestResponse=function(e,n,i,r){return i?200===e?t.EGAHTTPApiResponse.Ok:0===e||401===e?t.EGAHTTPApiResponse.Unauthorized:400===e?t.EGAHTTPApiResponse.BadRequest:500===e?t.EGAHTTPApiResponse.InternalServerError:t.EGAHTTPApiResponse.UnknownResponseCode:t.EGAHTTPApiResponse.NoResponse},e.sdkErrorTypeToString=function(e){switch(e){case t.EGASdkErrorType.Rejected:return"rejected";default:return""}},e.instance=new e,e}();t.GAHTTPApi=s}(e.http||(e.http={}))}(v||(v={})),function(e){var t,n,i,r,o,a,s,l,c,h,u,d;t=e.events||(e.events={}),n=e.store.GAStore,i=e.store.EGAStore,r=e.store.EGAStoreArgsOperator,o=e.state.GAState,a=e.logging.GALogger,s=e.utilities.GAUtilities,l=e.http.EGAHTTPApiResponse,c=e.http.GAHTTPApi,h=e.validators.GAValidator,u=e.http.EGASdkErrorType,d=function(){function t(){}return t.addSessionStartEvent=function(){if(o.isEventSubmissionEnabled()){var e={};e.category=t.CategorySessionStart,o.incrementSessionNum(),n.setItem(o.SessionNumKey,o.getSessionNum().toString()),t.addDimensionsToEvent(e),t.addEventToStore(e),a.i("Add SESSION START event"),t.processEvents(t.CategorySessionStart,!1)}},t.addSessionEndEvent=function(){if(o.isEventSubmissionEnabled()){var e=o.getSessionStart(),n=o.getClientTsAdjusted()-e;n<0&&(a.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),n=0);var i={};i.category=t.CategorySessionEnd,i.length=n,t.addDimensionsToEvent(i),t.addEventToStore(i),a.i("Add SESSION END event."),t.processEvents("",!1)}},t.addBusinessEvent=function(e,i,r,s,l,d){if(void 0===l&&(l=null),o.isEventSubmissionEnabled())if(h.validateBusinessEvent(e,i,l,r,s)){var p={};o.incrementTransactionNum(),n.setItem(o.TransactionNumKey,o.getTransactionNum().toString()),p.event_id=r+":"+s,p.category=t.CategoryBusiness,p.currency=e,p.amount=i,p[o.TransactionNumKey]=o.getTransactionNum(),l&&(p.cart_type=l),t.addDimensionsToEvent(p),t.addFieldsToEvent(p,o.validateAndCleanCustomFields(d)),a.i("Add BUSINESS event: {currency:"+e+", amount:"+i+", itemType:"+r+", itemId:"+s+", cartType:"+l+"}"),t.addEventToStore(p)}else c.instance.sendSdkErrorEvent(u.Rejected)},t.addResourceEvent=function(n,i,r,s,l,d){if(o.isEventSubmissionEnabled())if(h.validateResourceEvent(n,i,r,s,l,o.getAvailableResourceCurrencies(),o.getAvailableResourceItemTypes())){n===e.EGAResourceFlowType.Sink&&(r*=-1);var p={},f=t.resourceFlowTypeToString(n);p.event_id=f+":"+i+":"+s+":"+l,p.category=t.CategoryResource,p.amount=r,t.addDimensionsToEvent(p),t.addFieldsToEvent(p,o.validateAndCleanCustomFields(d)),a.i("Add RESOURCE event: {currency:"+i+", amount:"+r+", itemType:"+s+", itemId:"+l+"}"),t.addEventToStore(p)}else c.instance.sendSdkErrorEvent(u.Rejected)},t.addProgressionEvent=function(n,i,r,s,l,d,p){if(o.isEventSubmissionEnabled()){var f=t.progressionStatusToString(n);if(h.validateProgressionEvent(n,i,r,s)){var E,m={};E=r?s?i+":"+r+":"+s:i+":"+r:i,m.category=t.CategoryProgression,m.event_id=f+":"+E;var g=0;d&&n!=e.EGAProgressionStatus.Start&&(m.score=l),n===e.EGAProgressionStatus.Fail&&o.incrementProgressionTries(E),n===e.EGAProgressionStatus.Complete&&(o.incrementProgressionTries(E),g=o.getProgressionTries(E),m.attempt_num=g,o.clearProgressionTries(E)),t.addDimensionsToEvent(m),t.addFieldsToEvent(m,o.validateAndCleanCustomFields(p)),a.i("Add PROGRESSION event: {status:"+f+", progression01:"+i+", progression02:"+r+", progression03:"+s+", score:"+l+", attempt:"+g+"}"),t.addEventToStore(m)}else c.instance.sendSdkErrorEvent(u.Rejected)}},t.addDesignEvent=function(e,n,i,r){if(o.isEventSubmissionEnabled())if(h.validateDesignEvent(e,n)){var s={};s.category=t.CategoryDesign,s.event_id=e,i&&(s.value=n),t.addDimensionsToEvent(s),t.addFieldsToEvent(s,o.validateAndCleanCustomFields(r)),a.i("Add DESIGN event: {eventId:"+e+", value:"+n+"}"),t.addEventToStore(s)}else c.instance.sendSdkErrorEvent(u.Rejected)},t.addErrorEvent=function(e,n,i){if(o.isEventSubmissionEnabled()){var r=t.errorSeverityToString(e);if(h.validateErrorEvent(e,n)){var s={};s.category=t.CategoryError,s.severity=r,s.message=n,t.addDimensionsToEvent(s),t.addFieldsToEvent(s,o.validateAndCleanCustomFields(i)),a.i("Add ERROR event: {severity:"+r+", message:"+n+"}"),t.addEventToStore(s)}else c.instance.sendSdkErrorEvent(u.Rejected)}},t.processEvents=function(e,l){if(o.isEventSubmissionEnabled())try{var h=s.createGuid();l&&(t.cleanupEvents(),t.fixMissingSessionEndEvents());var u=[];u.push(["status",r.Equal,"new"]);var d=[];d.push(["status",r.Equal,"new"]),e&&(u.push(["category",r.Equal,e]),d.push(["category",r.Equal,e]));var p=[];p.push(["status",h]);var f=n.select(i.Events,u);if(!f||0==f.length)return a.i("Event queue: No events to send"),void t.updateSessionStore();if(f.length>t.MaxEventCount){if(!(f=n.select(i.Events,u,!0,t.MaxEventCount)))return;var E=f[f.length-1].client_ts;if(u.push(["client_ts",r.LessOrEqual,E]),!(f=n.select(i.Events,u)))return;d.push(["client_ts",r.LessOrEqual,E])}if(a.i("Event queue: Sending "+f.length+" events."),!n.update(i.Events,p,d))return;for(var m=[],g=0;g<f.length;++g){var v=f[g],y=JSON.parse(s.decode64(v.event));0!=y.length&&m.push(y)}c.instance.sendEventsInArray(m,h,t.processEventsCallback)}catch(e){a.e("Error during ProcessEvents(): "+e.stack)}},t.processEventsCallback=function(e,t,o,s){var c=[];if(c.push(["status",r.Equal,o]),e===l.Ok)n.delete(i.Events,c),a.i("Event queue: "+s+" events sent.");else if(e===l.NoResponse){var h=[];h.push(["status","new"]),a.w("Event queue: Failed to send events to collector - Retrying next time"),n.update(i.Events,h,c)}else{if(t){var u,d=0;for(var p in t)0==d&&(u=t[p]),++d;e===l.BadRequest&&u.constructor===Array?a.w("Event queue: "+s+" events sent. "+d+" events failed GA server validation."):a.w("Event queue: Failed to send events.")}else a.w("Event queue: Failed to send events.");n.delete(i.Events,c)}},t.cleanupEvents=function(){n.update(i.Events,[["status","new"]])},t.fixMissingSessionEndEvents=function(){if(o.isEventSubmissionEnabled()){var e=[];e.push(["session_id",r.NotEqual,o.getSessionId()]);var l=n.select(i.Sessions,e);if(l&&0!=l.length){a.i(l.length+" session(s) located with missing session_end event.");for(var c=0;c<l.length;++c){var h=JSON.parse(s.decode64(l[c].event)),u=h.client_ts-l[c].timestamp;u=Math.max(0,u),h.category=t.CategorySessionEnd,h.length=u,t.addEventToStore(h)}}}},t.addEventToStore=function(e){if(o.isEventSubmissionEnabled())if(o.isInitialized())try{if(n.isStoreTooLargeForEvents()&&!s.stringMatch(e.category,/^(user|session_end|business)$/))return void a.w("Database too large. Event has been blocked.");var l=o.getEventAnnotations(),c=s.encode64(JSON.stringify(l));for(var h in e)l[h]=e[h];var u=JSON.stringify(l);a.ii("Event added to queue: "+u);var d={status:"new"};d.category=l.category,d.session_id=l.session_id,d.client_ts=l.client_ts,d.event=s.encode64(JSON.stringify(l)),n.insert(i.Events,d),e.category==t.CategorySessionEnd?n.delete(i.Sessions,[["session_id",r.Equal,l.session_id]]):((d={}).session_id=l.session_id,d.timestamp=o.getSessionStart(),d.event=c,n.insert(i.Sessions,d,!0,"session_id")),n.isStorageAvailable()&&n.save()}catch(h){a.e("addEventToStore: error"),a.e(h.stack)}else a.w("Could not add event: SDK is not initialized")},t.updateSessionStore=function(){if(o.sessionIsStarted()){var e={};e.session_id=o.instance.sessionId,e.timestamp=o.getSessionStart(),e.event=s.encode64(JSON.stringify(o.getEventAnnotations())),n.insert(i.Sessions,e,!0,"session_id"),n.isStorageAvailable()&&n.save()}},t.addDimensionsToEvent=function(e){e&&(o.getCurrentCustomDimension01()&&(e.custom_01=o.getCurrentCustomDimension01()),o.getCurrentCustomDimension02()&&(e.custom_02=o.getCurrentCustomDimension02()),o.getCurrentCustomDimension03()&&(e.custom_03=o.getCurrentCustomDimension03()))},t.addFieldsToEvent=function(e,t){e&&t&&Object.keys(t).length>0&&(e.custom_fields=t)},t.resourceFlowTypeToString=function(t){return t==e.EGAResourceFlowType.Source||t==e.EGAResourceFlowType[e.EGAResourceFlowType.Source]?"Source":t==e.EGAResourceFlowType.Sink||t==e.EGAResourceFlowType[e.EGAResourceFlowType.Sink]?"Sink":""},t.progressionStatusToString=function(t){return t==e.EGAProgressionStatus.Start||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Start]?"Start":t==e.EGAProgressionStatus.Complete||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Complete]?"Complete":t==e.EGAProgressionStatus.Fail||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Fail]?"Fail":""},t.errorSeverityToString=function(t){return t==e.EGAErrorSeverity.Debug||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Debug]?"debug":t==e.EGAErrorSeverity.Info||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Info]?"info":t==e.EGAErrorSeverity.Warning||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Warning]?"warning":t==e.EGAErrorSeverity.Error||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Error]?"error":t==e.EGAErrorSeverity.Critical||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Critical]?"critical":""},t.instance=new t,t.CategorySessionStart="user",t.CategorySessionEnd="session_end",t.CategoryDesign="design",t.CategoryBusiness="business",t.CategoryProgression="progression",t.CategoryResource="resource",t.CategoryError="error",t.MaxEventCount=500,t}(),t.GAEvents=d}(v||(v={})),function(e){!function(t){var n=e.logging.GALogger,i=e.state.GAState,r=e.events.GAEvents,o=function(){function e(){this.blocks=new t.PriorityQueue({compare:function(e,t){return e-t}}),this.id2TimedBlockMap={},e.startThread()}return e.createTimedBlock=function(e){void 0===e&&(e=0);var n=new Date;return n.setSeconds(n.getSeconds()+e),new t.TimedBlock(n)},e.performTaskOnGAThread=function(n,i){void 0===i&&(i=0);var r=new Date;r.setSeconds(r.getSeconds()+i);var o=new t.TimedBlock(r);o.block=n,e.instance.id2TimedBlockMap[o.id]=o,e.instance.addTimedBlock(o)},e.performTimedBlockOnGAThread=function(t){e.instance.id2TimedBlockMap[t.id]=t,e.instance.addTimedBlock(t)},e.scheduleTimer=function(n,i){var r=new Date;r.setSeconds(r.getSeconds()+n);var o=new t.TimedBlock(r);return o.block=i,e.instance.id2TimedBlockMap[o.id]=o,e.instance.addTimedBlock(o),o.id},e.getTimedBlockById=function(t){return t in e.instance.id2TimedBlockMap?e.instance.id2TimedBlockMap[t]:null},e.ensureEventQueueIsRunning=function(){e.instance.keepRunning=!0,e.instance.isRunning||(e.instance.isRunning=!0,e.scheduleTimer(e.ProcessEventsIntervalInSeconds,e.processEventQueue))},e.endSessionAndStopQueue=function(){i.isInitialized()&&(n.i("Ending session."),e.stopEventQueue(),i.isEnabled()&&i.sessionIsStarted()&&(r.addSessionEndEvent(),i.instance.sessionStart=0))},e.stopEventQueue=function(){e.instance.keepRunning=!1},e.ignoreTimer=function(t){t in e.instance.id2TimedBlockMap&&(e.instance.id2TimedBlockMap[t].ignore=!0)},e.setEventProcessInterval=function(t){t>0&&(e.ProcessEventsIntervalInSeconds=t)},e.prototype.addTimedBlock=function(e){this.blocks.enqueue(e.deadline.getTime(),e)},e.run=function(){clearTimeout(e.runTimeoutId);try{for(var t;t=e.getNextBlock();)if(!t.ignore)if(t.async){if(!t.running){t.running=!0,t.block();break}}else t.block();return void(e.runTimeoutId=setTimeout(e.run,e.ThreadWaitTimeInMs))}catch(e){n.e("Error on GA thread"),n.e(e.stack)}},e.startThread=function(){e.runTimeoutId=setTimeout(e.run,0)},e.getNextBlock=function(){var t=new Date;return e.instance.blocks.hasItems()&&e.instance.blocks.peek().deadline.getTime()<=t.getTime()?e.instance.blocks.peek().async&&e.instance.blocks.peek().running?e.instance.blocks.peek():e.instance.blocks.dequeue():null},e.processEventQueue=function(){r.processEvents("",!0),e.instance.keepRunning?e.scheduleTimer(e.ProcessEventsIntervalInSeconds,e.processEventQueue):e.instance.isRunning=!1},e.instance=new e,e.ThreadWaitTimeInMs=1e3,e.ProcessEventsIntervalInSeconds=8,e}();t.GAThreading=o}(e.threading||(e.threading={}))}(v||(v={})),function(e){var t=e.threading.GAThreading,n=e.logging.GALogger,i=e.store.GAStore,r=e.state.GAState,o=e.http.GAHTTPApi,a=e.device.GADevice,s=e.validators.GAValidator,l=e.http.EGAHTTPApiResponse,c=e.utilities.GAUtilities,h=e.events.GAEvents,u=function(){function u(){}return u.init=function(){if(a.touch(),u.methodMap.configureAvailableCustomDimensions01=u.configureAvailableCustomDimensions01,u.methodMap.configureAvailableCustomDimensions02=u.configureAvailableCustomDimensions02,u.methodMap.configureAvailableCustomDimensions03=u.configureAvailableCustomDimensions03,u.methodMap.configureAvailableResourceCurrencies=u.configureAvailableResourceCurrencies,u.methodMap.configureAvailableResourceItemTypes=u.configureAvailableResourceItemTypes,u.methodMap.configureBuild=u.configureBuild,u.methodMap.configureSdkGameEngineVersion=u.configureSdkGameEngineVersion,u.methodMap.configureGameEngineVersion=u.configureGameEngineVersion,u.methodMap.configureUserId=u.configureUserId,u.methodMap.initialize=u.initialize,u.methodMap.addBusinessEvent=u.addBusinessEvent,u.methodMap.addResourceEvent=u.addResourceEvent,u.methodMap.addProgressionEvent=u.addProgressionEvent,u.methodMap.addDesignEvent=u.addDesignEvent,u.methodMap.addErrorEvent=u.addErrorEvent,u.methodMap.addErrorEvent=u.addErrorEvent,u.methodMap.setEnabledInfoLog=u.setEnabledInfoLog,u.methodMap.setEnabledVerboseLog=u.setEnabledVerboseLog,u.methodMap.setEnabledManualSessionHandling=u.setEnabledManualSessionHandling,u.methodMap.setEnabledEventSubmission=u.setEnabledEventSubmission,u.methodMap.setCustomDimension01=u.setCustomDimension01,u.methodMap.setCustomDimension02=u.setCustomDimension02,u.methodMap.setCustomDimension03=u.setCustomDimension03,u.methodMap.setFacebookId=u.setFacebookId,u.methodMap.setGender=u.setGender,u.methodMap.setBirthYear=u.setBirthYear,u.methodMap.setEventProcessInterval=u.setEventProcessInterval,u.methodMap.startSession=u.startSession,u.methodMap.endSession=u.endSession,u.methodMap.onStop=u.onStop,u.methodMap.onResume=u.onResume,u.methodMap.addCommandCenterListener=u.addCommandCenterListener,u.methodMap.removeCommandCenterListener=u.removeCommandCenterListener,u.methodMap.getCommandCenterValueAsString=u.getCommandCenterValueAsString,u.methodMap.isCommandCenterReady=u.isCommandCenterReady,u.methodMap.getConfigurationsContentAsString=u.getConfigurationsContentAsString,"undefined"!=typeof window&&void 0!==window.GameAnalytics&&void 0!==window.GameAnalytics.q){var e=window.GameAnalytics.q;for(var t in e)u.gaCommand.apply(null,e[t])}},u.gaCommand=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length>0&&t[0]in e.GameAnalytics.methodMap&&(t.length>1?e.GameAnalytics.methodMap[t[0]].apply(null,Array.prototype.slice.call(t,1)):e.GameAnalytics.methodMap[t[0]]())},u.configureAvailableCustomDimensions01=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?n.w("Available custom dimensions must be set before SDK is initialized"):r.setAvailableCustomDimensions01(e)})},u.configureAvailableCustomDimensions02=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?n.w("Available custom dimensions must be set before SDK is initialized"):r.setAvailableCustomDimensions02(e)})},u.configureAvailableCustomDimensions03=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?n.w("Available custom dimensions must be set before SDK is initialized"):r.setAvailableCustomDimensions03(e)})},u.configureAvailableResourceCurrencies=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?n.w("Available resource currencies must be set before SDK is initialized"):r.setAvailableResourceCurrencies(e)})},u.configureAvailableResourceItemTypes=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?n.w("Available resource item types must be set before SDK is initialized"):r.setAvailableResourceItemTypes(e)})},u.configureBuild=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?n.w("Build version must be set before SDK is initialized."):s.validateBuild(e)?r.setBuild(e):n.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+e)})},u.configureSdkGameEngineVersion=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)||(s.validateSdkWrapperVersion(e)?a.sdkGameEngineVersion=e:n.i("Validation fail - configure sdk version: Sdk version not supported. String: "+e))})},u.configureGameEngineVersion=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)||(s.validateEngineVersion(e)?a.gameEngineVersion=e:n.i("Validation fail - configure game engine version: Game engine version not supported. String: "+e))})},u.configureUserId=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?n.w("A custom user id must be set before SDK is initialized."):s.validateUserId(e)?r.setUserId(e):n.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+e)})},u.initialize=function(e,i){void 0===e&&(e=""),void 0===i&&(i=""),a.updateConnectionType();var o=t.createTimedBlock();o.async=!0,u.initTimedBlockId=o.id,o.block=function(){u.isSdkReady(!0,!1)?n.w("SDK already initialized. Can only be called once."):s.validateKeys(e,i)?(r.setKeys(e,i),u.internalInitialize()):n.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+e+", secretKey: "+i)},t.performTimedBlockOnGAThread(o)},u.addBusinessEvent=function(e,n,i,r,o){void 0===e&&(e=""),void 0===n&&(n=0),void 0===i&&(i=""),void 0===r&&(r=""),void 0===o&&(o=""),a.updateConnectionType(),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!0,"Could not add business event")&&h.addBusinessEvent(e,n,i,r,o,{})})},u.addResourceEvent=function(n,i,r,o,s){void 0===n&&(n=e.EGAResourceFlowType.Undefined),void 0===i&&(i=""),void 0===r&&(r=0),void 0===o&&(o=""),void 0===s&&(s=""),a.updateConnectionType(),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!0,"Could not add resource event")&&h.addResourceEvent(n,i,r,o,s,{})})},u.addProgressionEvent=function(n,i,r,o,s){void 0===n&&(n=e.EGAProgressionStatus.Undefined),void 0===i&&(i=""),void 0===r&&(r=""),void 0===o&&(o=""),a.updateConnectionType(),t.performTaskOnGAThread(function(){if(u.isSdkReady(!0,!0,"Could not add progression event")){var e="number"==typeof s;h.addProgressionEvent(n,i,r,o,e?s:0,e,{})}})},u.addDesignEvent=function(e,n){a.updateConnectionType(),t.performTaskOnGAThread(function(){if(u.isSdkReady(!0,!0,"Could not add design event")){var t="number"==typeof n;h.addDesignEvent(e,t?n:0,t,{})}})},u.addErrorEvent=function(n,i){void 0===n&&(n=e.EGAErrorSeverity.Undefined),void 0===i&&(i=""),a.updateConnectionType(),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!0,"Could not add error event")&&h.addErrorEvent(n,i,{})})},u.setEnabledInfoLog=function(e){void 0===e&&(e=!1),t.performTaskOnGAThread(function(){e?(n.setInfoLog(e),n.i("Info logging enabled")):(n.i("Info logging disabled"),n.setInfoLog(e))})},u.setEnabledVerboseLog=function(e){void 0===e&&(e=!1),t.performTaskOnGAThread(function(){e?(n.setVerboseLog(e),n.i("Verbose logging enabled")):(n.i("Verbose logging disabled"),n.setVerboseLog(e))})},u.setEnabledManualSessionHandling=function(e){void 0===e&&(e=!1),t.performTaskOnGAThread(function(){r.setManualSessionHandling(e)})},u.setEnabledEventSubmission=function(e){void 0===e&&(e=!1),t.performTaskOnGAThread(function(){e?(r.setEnabledEventSubmission(e),n.i("Event submission enabled")):(n.i("Event submission disabled"),r.setEnabledEventSubmission(e))})},u.setCustomDimension01=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){s.validateDimension01(e,r.getAvailableCustomDimensions01())?r.setCustomDimension01(e):n.w("Could not set custom01 dimension value to '"+e+"'. Value not found in available custom01 dimension values")})},u.setCustomDimension02=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){s.validateDimension02(e,r.getAvailableCustomDimensions02())?r.setCustomDimension02(e):n.w("Could not set custom02 dimension value to '"+e+"'. Value not found in available custom02 dimension values")})},u.setCustomDimension03=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){s.validateDimension03(e,r.getAvailableCustomDimensions03())?r.setCustomDimension03(e):n.w("Could not set custom03 dimension value to '"+e+"'. Value not found in available custom03 dimension values")})},u.setFacebookId=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){s.validateFacebookId(e)&&r.setFacebookId(e)})},u.setGender=function(n){void 0===n&&(n=e.EGAGender.Undefined),t.performTaskOnGAThread(function(){s.validateGender(n)&&r.setGender(n)})},u.setBirthYear=function(e){void 0===e&&(e=0),t.performTaskOnGAThread(function(){s.validateBirthyear(e)&&r.setBirthYear(e)})},u.setEventProcessInterval=function(e){t.performTaskOnGAThread(function(){t.setEventProcessInterval(e)})},u.startSession=function(){if(r.isInitialized()){var e=t.createTimedBlock();e.async=!0,u.initTimedBlockId=e.id,e.block=function(){r.isEnabled()&&r.sessionIsStarted()&&t.endSessionAndStopQueue(),u.resumeSessionAndStartQueue()},t.performTimedBlockOnGAThread(e)}},u.endSession=function(){u.onStop()},u.onStop=function(){t.performTaskOnGAThread(function(){try{t.endSessionAndStopQueue()}catch(e){}})},u.onResume=function(){var e=t.createTimedBlock();e.async=!0,u.initTimedBlockId=e.id,e.block=function(){u.resumeSessionAndStartQueue()},t.performTimedBlockOnGAThread(e)},u.getCommandCenterValueAsString=function(e,t){return void 0===t&&(t=null),r.getConfigurationStringValue(e,t)},u.isCommandCenterReady=function(){return r.isCommandCenterReady()},u.addCommandCenterListener=function(e){r.addCommandCenterListener(e)},u.removeCommandCenterListener=function(e){r.removeCommandCenterListener(e)},u.getConfigurationsContentAsString=function(){return r.getConfigurationsContentAsString()},u.internalInitialize=function(){r.ensurePersistedStates(),i.setItem(r.DefaultUserIdKey,r.getDefaultId()),r.setInitialized(!0),u.newSession(),r.isEnabled()&&t.ensureEventQueueIsRunning()},u.newSession=function(){n.i("Starting a new session."),r.validateAndFixCurrentDimensions(),o.instance.requestInit(u.startNewSessionCallback)},u.startNewSessionCallback=function(e,o){if(e===l.Ok&&o){var a=0;if(o.server_ts){var s=o.server_ts;a=r.calculateServerTimeOffset(s)}o.time_offset=a,i.setItem(r.SdkConfigCachedKey,c.encode64(JSON.stringify(o))),r.instance.sdkConfigCached=o,r.instance.sdkConfig=o,r.instance.initAuthorized=!0}else e==l.Unauthorized?(n.w("Initialize SDK failed - Unauthorized"),r.instance.initAuthorized=!1):(e===l.NoResponse||e===l.RequestTimeout?n.i("Init call (session start) failed - no response. Could be offline or timeout."):e===l.BadResponse||e===l.JsonEncodeFailed||e===l.JsonDecodeFailed?n.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):e!==l.BadRequest&&e!==l.UnknownResponseCode||n.i("Init call (session start) failed - bad request or unknown response."),null==r.instance.sdkConfig?null!=r.instance.sdkConfigCached?(n.i("Init call (session start) failed - using cached init values."),r.instance.sdkConfig=r.instance.sdkConfigCached):(n.i("Init call (session start) failed - using default init values."),r.instance.sdkConfig=r.instance.sdkConfigDefault):n.i("Init call (session start) failed - using cached init values."),r.instance.initAuthorized=!0);if(r.instance.clientServerTimeOffset=r.getSdkConfig().time_offset?r.getSdkConfig().time_offset:0,r.populateConfigurations(r.getSdkConfig()),!r.isEnabled())return n.w("Could not start session: SDK is disabled."),void t.stopEventQueue();t.ensureEventQueueIsRunning();var d=c.createGuid();r.instance.sessionId=d,r.instance.sessionStart=r.getClientTsAdjusted(),h.addSessionStartEvent();var p=t.getTimedBlockById(u.initTimedBlockId);null!=p&&(p.running=!1),u.initTimedBlockId=-1},u.resumeSessionAndStartQueue=function(){r.isInitialized()&&(n.i("Resuming session."),r.sessionIsStarted()||u.newSession())},u.isSdkReady=function(e,t,i){return void 0===t&&(t=!0),void 0===i&&(i=""),i&&(i+=": "),e&&!r.isInitialized()?(t&&n.w(i+"SDK is not initialized"),!1):e&&!r.isEnabled()?(t&&n.w(i+"SDK is disabled"),!1):!(e&&!r.sessionIsStarted())||(t&&n.w(i+"Session has not started yet"),!1)},u.initTimedBlockId=-1,u.methodMap={},u}();e.GameAnalytics=u}(v||(v={})),v.GameAnalytics.init();v.GameAnalytics.gaCommand;var y=v,T=function(){function e(){}return e.prototype.setup=function(e,t,n){f.analyticsEnabled&&(y.GameAnalytics.initialize(e,t),y.GameAnalytics.configureBuild(n),y.GameAnalytics.startSession(),window.addEventListener("beforeunload",function(){y.GameAnalytics.endSession()}))},e.prototype.addProgressionEvent=function(e,t,n,i,r){f.analyticsEnabled&&y.GameAnalytics.addProgressionEvent(e,t,n,i,r)},e.prototype.addDesignEvent=function(e,t){f.analyticsEnabled&&y.GameAnalytics.addDesignEvent(e,t)},e}();function _(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})}function R(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var b=i(function(e,t){e.exports=function e(t,i,r){function o(s,l){if(!i[s]){if(!t[s]){var c=n;if(!l&&c)return c(s,!0);if(a)return a(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n||e)},u,u.exports,e,t,i,r)}return i[s].exports}for(var a=n,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){(function(){var e,i=this||Function("return this")(),r=function(){var e,r,o,a,s,l,c="linear",h=1e3/60,u=Date.now?Date.now:function(){return+new Date},d="undefined"!=typeof SHIFTY_DEBUG_NOW?SHIFTY_DEBUG_NOW:u;function p(){}function f(e,t){var n;for(n in e)Object.hasOwnProperty.call(e,n)&&t(n)}function E(e,t){return f(t,function(n){e[n]=t[n]}),e}function m(e,t){f(t,function(n){void 0===e[n]&&(e[n]=t[n])})}function g(t,n,i,r,o,a,s){var l,c,h,u=t<a?0:(t-a)/o;for(l in n)n.hasOwnProperty(l)&&(c=s[l],h="function"==typeof c?c:e[c],n[l]=v(i[l],r[l],h,u));return n}function v(e,t,n,i){return e+(t-e)*n(i)}function y(e,t){var n=R.prototype.filter,i=e._filterArgs;f(n,function(r){void 0!==n[r][t]&&n[r][t].apply(e,i)})}function T(e,t,n,i,r,c,u,p,f,E,m){o=t+n+i,a=Math.min(m||d(),o),s=a>=o,l=i-(o-a),e.isPlaying()&&(s?(f(u,e._attachment,l),e.stop(!0)):(e._scheduleId=E(e._timeoutHandler,h),y(e,"beforeTween"),a<t+n?g(1,r,c,u,1,1,p):g(a,r,c,u,i,t+n,p),y(e,"afterTween"),f(r,e._attachment,l)))}function _(e,t){var n={},i=typeof t;return f(e,"string"===i||"function"===i?function(e){n[e]=t}:function(e){n[e]||(n[e]=t[e]||c)}),n}function R(e,t){this._currentState=e||{},this._configured=!1,this._scheduleFunction=r,void 0!==t&&this.setConfig(t)}return r="undefined"!=typeof window&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.mozCancelRequestAnimationFrame&&window.mozRequestAnimationFrame)||setTimeout,R.prototype.tween=function(e){return this._isTweening?this:(void 0===e&&this._configured||this.setConfig(e),this._timestamp=d(),this._start(this.get(),this._attachment),this.resume())},R.prototype.setConfig=function(e){e=e||{},this._configured=!0,this._attachment=e.attachment,this._pausedAtTime=null,this._scheduleId=null,this._delay=e.delay||0,this._start=e.start||p,this._step=e.step||p,this._finish=e.finish||p,this._duration=e.duration||500,this._currentState=E({},e.from||this.get()),this._originalState=this.get(),this._targetState=E({},e.to||this.get());var t=this;this._timeoutHandler=function(){T(t,t._timestamp,t._delay,t._duration,t._currentState,t._originalState,t._targetState,t._easing,t._step,t._scheduleFunction)};var n=this._currentState,i=this._targetState;return m(i,n),this._easing=_(n,e.easing||c),this._filterArgs=[n,this._originalState,i,this._easing],y(this,"tweenCreated"),this},R.prototype.get=function(){return E({},this._currentState)},R.prototype.set=function(e){this._currentState=e},R.prototype.pause=function(){return this._pausedAtTime=d(),this._isPaused=!0,this},R.prototype.resume=function(){return this._isPaused&&(this._timestamp+=d()-this._pausedAtTime),this._isPaused=!1,this._isTweening=!0,this._timeoutHandler(),this},R.prototype.seek=function(e){e=Math.max(e,0);var t=d();return this._timestamp+e===0?this:(this._timestamp=t-e,this.isPlaying()||(this._isTweening=!0,this._isPaused=!1,T(this,this._timestamp,this._delay,this._duration,this._currentState,this._originalState,this._targetState,this._easing,this._step,this._scheduleFunction,t),this.pause()),this)},R.prototype.stop=function(e){return this._isTweening=!1,this._isPaused=!1,this._timeoutHandler=p,(i.cancelAnimationFrame||i.webkitCancelAnimationFrame||i.oCancelAnimationFrame||i.msCancelAnimationFrame||i.mozCancelRequestAnimationFrame||i.clearTimeout)(this._scheduleId),e&&(y(this,"beforeTween"),g(1,this._currentState,this._originalState,this._targetState,1,0,this._easing),y(this,"afterTween"),y(this,"afterTweenEnd"),this._finish.call(this,this._currentState,this._attachment)),this},R.prototype.isPlaying=function(){return this._isTweening&&!this._isPaused},R.prototype.setScheduleFunction=function(e){this._scheduleFunction=e},R.prototype.dispose=function(){var e;for(e in this)this.hasOwnProperty(e)&&delete this[e]},R.prototype.filter={},R.prototype.formula={linear:function(e){return e}},e=R.prototype.formula,E(R,{now:d,each:f,tweenProps:g,tweenProp:v,applyFilter:y,shallowCopy:E,defaults:m,composeEasingObject:_}),"function"==typeof SHIFTY_DEBUG_NOW&&(i.timeoutHandler=T),"object"==typeof n?t.exports=R:void 0===i.Tweenable&&(i.Tweenable=R),R}();r.shallowCopy(r.prototype.formula,{easeInQuad:function(e){return Math.pow(e,2)},easeOutQuad:function(e){return-(Math.pow(e-1,2)-1)},easeInOutQuad:function(e){return(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2)},easeInCubic:function(e){return Math.pow(e,3)},easeOutCubic:function(e){return Math.pow(e-1,3)+1},easeInOutCubic:function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)},easeInQuart:function(e){return Math.pow(e,4)},easeOutQuart:function(e){return-(Math.pow(e-1,4)-1)},easeInOutQuart:function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeInQuint:function(e){return Math.pow(e,5)},easeOutQuint:function(e){return Math.pow(e-1,5)+1},easeInOutQuint:function(e){return(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2)},easeInSine:function(e){return 1-Math.cos(e*(Math.PI/2))},easeOutSine:function(e){return Math.sin(e*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e)-1)},easeInExpo:function(e){return 0===e?0:Math.pow(2,10*(e-1))},easeOutExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},easeInOutExpo:function(e){return 0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e))},easeInCirc:function(e){return-(Math.sqrt(1-e*e)-1)},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},easeOutBounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack:function(e){var t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},elastic:function(e){return-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1},swingFromTo:function(e){var t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},swingFrom:function(e){var t=1.70158;return e*e*((t+1)*e-t)},swingTo:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},bounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bouncePast:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?2-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},easeFromTo:function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeFrom:function(e){return Math.pow(e,4)},easeTo:function(e){return Math.pow(e,.25)}}),function(){function e(e,t,n,i,r,o){var a=0,s=0,l=0,c=0,h=0,u=0;function d(e){return((a*e+s)*e+l)*e}function p(e){return e>=0?e:0-e}return a=1-(l=3*t)-(s=3*(i-t)-l),c=1-(u=3*n)-(h=3*(r-n)-u),function(e,t){return n=function(e,t){var n,i,r,o,c,h,u;for(r=e,h=0;h<8;h++){if(p(o=d(r)-e)<t)return r;if(p(c=(3*a*(u=r)+2*s)*u+l)<1e-6)break;r-=o/c}if(i=1,(r=e)<(n=0))return n;if(r>i)return i;for(;n<i;){if(p((o=d(r))-e)<t)return r;e>o?n=r:i=r,r=.5*(i-n)+n}return r}(e,t),((c*n+h)*n+u)*n;var n}(e,function(e){return 1/(200*e)}(o))}r.setBezierFunction=function(t,n,i,o,a){var s=function(t,n,i,r){return function(o){return e(o,t,n,i,r,1)}}(n,i,o,a);return s.displayName=t,s.x1=n,s.y1=i,s.x2=o,s.y2=a,r.prototype.formula[t]=s},r.unsetBezierFunction=function(e){delete r.prototype.formula[e]}}(),(e=new r)._filterArgs=[],r.interpolate=function(t,n,i,o,a){var s=r.shallowCopy({},t),l=a||0,c=r.composeEasingObject(t,o||"linear");e.set({});var h=e._filterArgs;h.length=0,h[0]=s,h[1]=t,h[2]=n,h[3]=c,r.applyFilter(e,"tweenCreated"),r.applyFilter(e,"beforeTween");var u=function(e,t,n,i,o,a){return r.tweenProps(i,t,e,n,1,a,o)}(t,s,n,i,c,l);return r.applyFilter(e,"afterTween"),u},function(e){var t=/(\d|\-|\.)/,n=/([^\-0-9\.]+)/g,i=/[0-9.\-]+/g,r=new RegExp("rgb\\("+i.source+/,\s*/.source+i.source+/,\s*/.source+i.source+"\\)","g"),o=/^.*\(/,a=/#([0-9]|[a-f]){3,6}/gi,s="VAL";function l(t){e.each(t,function(e){var n=t[e];"string"==typeof n&&n.match(a)&&(t[e]=d(a,n,c))})}function c(e){var t,n=(3===(t=(t=e).replace(/#/,"")).length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]),h[0]=u(t.substr(0,2)),h[1]=u(t.substr(2,2)),h[2]=u(t.substr(4,2)),h);return"rgb("+n[0]+","+n[1]+","+n[2]+")"}var h=[];function u(e){return parseInt(e,16)}function d(e,t,n){var i=t.match(e),r=t.replace(e,s);if(i)for(var o,a=i.length,l=0;l<a;l++)o=i.shift(),r=r.replace(s,n(o));return r}function p(e){for(var t=e.match(i),n=t.length,r=e.match(o)[0],a=0;a<n;a++)r+=parseInt(t[a],10)+",";return r=r.slice(0,-1)+")"}function f(i){var r={};return e.each(i,function(e){var o,a,l=i[e];if("string"==typeof l){var c=v(l);r[e]={formatString:(o=l,a=o.match(n),a?(1===a.length||o.charAt(0).match(t))&&a.unshift(""):a=["",""],a.join(s)),chunkNames:function(e,t){var n,i=[],r=e.length;for(n=0;n<r;n++)i.push("_"+t+"_"+n);return i}(c,e)}}}),r}function E(t,n){e.each(n,function(e){for(var i=t[e],r=v(i),o=r.length,a=0;a<o;a++)t[n[e].chunkNames[a]]=+r[a];delete t[e]})}function m(t,n){e.each(n,function(e){var i=t[e],o=function(e,t){for(var n,i={},r=t.length,o=0;o<r;o++)n=t[o],i[n]=e[n],delete e[n];return i}(t,n[e].chunkNames),a=function(e,t){g.length=0;for(var n=t.length,i=0;i<n;i++)g.push(e[t[i]]);return g}(o,n[e].chunkNames);i=function(e,t){for(var n=e,i=t.length,r=0;r<i;r++)n=n.replace(s,+t[r].toFixed(4));return n}(n[e].formatString,a),t[e]=d(r,i,p)})}var g=[];function v(e){return e.match(i)}e.prototype.filter.token={tweenCreated:function(e,t,n,i){l(e),l(t),l(n),this._tokenData=f(e)},beforeTween:function(t,n,i,r){!function(t,n){e.each(n,function(e){var i,r=n[e],o=r.chunkNames,a=o.length,s=t[e];if("string"==typeof s){var l=s.split(" "),c=l[l.length-1];for(i=0;i<a;i++)t[o[i]]=l[i]||c}else for(i=0;i<a;i++)t[o[i]]=s;delete t[e]})}(r,this._tokenData),E(t,this._tokenData),E(n,this._tokenData),E(i,this._tokenData)},afterTween:function(t,n,i,r){m(t,this._tokenData),m(n,this._tokenData),m(i,this._tokenData),function(t,n){e.each(n,function(e){var i=n[e],r=i.chunkNames,o=r.length,a=t[r[0]],s=typeof a;if("string"===s){for(var l="",c=0;c<o;c++)l+=" "+t[r[c]],delete t[r[c]];t[e]=l.substr(1)}else t[e]=a})}(r,this._tokenData)}}}(r)}).call(null)},{}],2:[function(e,t,n){var i=e("./shape"),r=e("./utils"),o=function(e,t){this._pathTemplate="M 50,50 m 0,-{radius} a {radius},{radius} 0 1 1 0,{2radius} a {radius},{radius} 0 1 1 0,-{2radius}",this.containerAspectRatio=1,i.apply(this,arguments)};(o.prototype=new i).constructor=o,o.prototype._pathString=function(e){var t=e.strokeWidth;e.trailWidth&&e.trailWidth>e.strokeWidth&&(t=e.trailWidth);var n=50-t/2;return r.render(this._pathTemplate,{radius:n,"2radius":2*n})},o.prototype._trailString=function(e){return this._pathString(e)},t.exports=o},{"./shape":7,"./utils":9}],3:[function(e,t,n){var i=e("./shape"),r=e("./utils"),o=function(e,t){this._pathTemplate="M 0,{center} L 100,{center}",i.apply(this,arguments)};(o.prototype=new i).constructor=o,o.prototype._initializeSvg=function(e,t){e.setAttribute("viewBox","0 0 100 "+t.strokeWidth),e.setAttribute("preserveAspectRatio","none")},o.prototype._pathString=function(e){return r.render(this._pathTemplate,{center:e.strokeWidth/2})},o.prototype._trailString=function(e){return this._pathString(e)},t.exports=o},{"./shape":7,"./utils":9}],4:[function(e,t,n){t.exports={Line:e("./line"),Circle:e("./circle"),SemiCircle:e("./semicircle"),Square:e("./square"),Path:e("./path"),Shape:e("./shape"),utils:e("./utils")}},{"./circle":2,"./line":3,"./path":5,"./semicircle":6,"./shape":7,"./square":8,"./utils":9}],5:[function(e,t,n){var i=e("shifty"),r=e("./utils"),o={easeIn:"easeInCubic",easeOut:"easeOutCubic",easeInOut:"easeInOutCubic"},a=function e(t,n){if(!(this instanceof e))throw new Error("Constructor was called without new keyword");var i;n=r.extend({duration:800,easing:"linear",from:{},to:{},step:function(){}},n),i=r.isString(t)?document.querySelector(t):t,this.path=i,this._opts=n,this._tweenable=null;var o=this.path.getTotalLength();this.path.style.strokeDasharray=o+" "+o,this.set(0)};a.prototype.value=function(){var e=this._getComputedDashOffset(),t=this.path.getTotalLength(),n=1-e/t;return parseFloat(n.toFixed(6),10)},a.prototype.set=function(e){this.stop(),this.path.style.strokeDashoffset=this._progressToOffset(e);var t=this._opts.step;if(r.isFunction(t)){var n=this._easing(this._opts.easing),i=this._calculateTo(e,n),o=this._opts.shape||this;t(i,o,this._opts.attachment)}},a.prototype.stop=function(){this._stopTween(),this.path.style.strokeDashoffset=this._getComputedDashOffset()},a.prototype.animate=function(e,t,n){t=t||{},r.isFunction(t)&&(n=t,t={});var o=r.extend({},t),a=r.extend({},this._opts);t=r.extend(a,t);var s=this._easing(t.easing),l=this._resolveFromAndTo(e,s,o);this.stop(),this.path.getBoundingClientRect();var c=this._getComputedDashOffset(),h=this._progressToOffset(e),u=this;this._tweenable=new i,this._tweenable.tween({from:r.extend({offset:c},l.from),to:r.extend({offset:h},l.to),duration:t.duration,easing:s,step:function(e){u.path.style.strokeDashoffset=e.offset;var n=t.shape||u;t.step(e,n,t.attachment)},finish:function(e){r.isFunction(n)&&n()}})},a.prototype._getComputedDashOffset=function(){var e=window.getComputedStyle(this.path,null);return parseFloat(e.getPropertyValue("stroke-dashoffset"),10)},a.prototype._progressToOffset=function(e){var t=this.path.getTotalLength();return t-e*t},a.prototype._resolveFromAndTo=function(e,t,n){return n.from&&n.to?{from:n.from,to:n.to}:{from:this._calculateFrom(t),to:this._calculateTo(e,t)}},a.prototype._calculateFrom=function(e){return i.interpolate(this._opts.from,this._opts.to,this.value(),e)},a.prototype._calculateTo=function(e,t){return i.interpolate(this._opts.from,this._opts.to,e,t)},a.prototype._stopTween=function(){null!==this._tweenable&&(this._tweenable.stop(),this._tweenable=null)},a.prototype._easing=function(e){return o.hasOwnProperty(e)?o[e]:e},t.exports=a},{"./utils":9,shifty:1}],6:[function(e,t,n){var i=e("./shape"),r=e("./circle"),o=e("./utils"),a=function(e,t){this._pathTemplate="M 50,50 m -{radius},0 a {radius},{radius} 0 1 1 {2radius},0",this.containerAspectRatio=2,i.apply(this,arguments)};(a.prototype=new i).constructor=a,a.prototype._initializeSvg=function(e,t){e.setAttribute("viewBox","0 0 100 50")},a.prototype._initializeTextContainer=function(e,t,n){e.text.style&&(n.style.top="auto",n.style.bottom="0",e.text.alignToBottom?o.setStyle(n,"transform","translate(-50%, 0)"):o.setStyle(n,"transform","translate(-50%, 50%)"))},a.prototype._pathString=r.prototype._pathString,a.prototype._trailString=r.prototype._trailString,t.exports=a},{"./circle":2,"./shape":7,"./utils":9}],7:[function(e,t,n){var i=e("./path"),r=e("./utils"),o=function e(t,n){if(!(this instanceof e))throw new Error("Constructor was called without new keyword");if(0!==arguments.length){this._opts=r.extend({color:"#555",strokeWidth:1,trailColor:null,trailWidth:null,fill:null,text:{style:{color:null,position:"absolute",left:"50%",top:"50%",padding:0,margin:0,transform:{prefix:!0,value:"translate(-50%, -50%)"}},autoStyleContainer:!0,alignToBottom:!0,value:null,className:"progressbar-text"},svgStyle:{display:"block",width:"100%"},warnings:!1},n,!0),r.isObject(n)&&void 0!==n.svgStyle&&(this._opts.svgStyle=n.svgStyle),r.isObject(n)&&r.isObject(n.text)&&void 0!==n.text.style&&(this._opts.text.style=n.text.style);var o,a=this._createSvgView(this._opts);if(!(o=r.isString(t)?document.querySelector(t):t))throw new Error("Container does not exist: "+t);this._container=o,this._container.appendChild(a.svg),this._opts.warnings&&this._warnContainerAspectRatio(this._container),this._opts.svgStyle&&r.setStyles(a.svg,this._opts.svgStyle),this.svg=a.svg,this.path=a.path,this.trail=a.trail,this.text=null;var s=r.extend({attachment:void 0,shape:this},this._opts);this._progressPath=new i(a.path,s),r.isObject(this._opts.text)&&null!==this._opts.text.value&&this.setText(this._opts.text.value)}};o.prototype.animate=function(e,t,n){if(null===this._progressPath)throw new Error("Object is destroyed");this._progressPath.animate(e,t,n)},o.prototype.stop=function(){if(null===this._progressPath)throw new Error("Object is destroyed");void 0!==this._progressPath&&this._progressPath.stop()},o.prototype.destroy=function(){if(null===this._progressPath)throw new Error("Object is destroyed");this.stop(),this.svg.parentNode.removeChild(this.svg),this.svg=null,this.path=null,this.trail=null,this._progressPath=null,null!==this.text&&(this.text.parentNode.removeChild(this.text),this.text=null)},o.prototype.set=function(e){if(null===this._progressPath)throw new Error("Object is destroyed");this._progressPath.set(e)},o.prototype.value=function(){if(null===this._progressPath)throw new Error("Object is destroyed");return void 0===this._progressPath?0:this._progressPath.value()},o.prototype.setText=function(e){if(null===this._progressPath)throw new Error("Object is destroyed");null===this.text&&(this.text=this._createTextContainer(this._opts,this._container),this._container.appendChild(this.text)),r.isObject(e)?(r.removeChildren(this.text),this.text.appendChild(e)):this.text.innerHTML=e},o.prototype._createSvgView=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");this._initializeSvg(t,e);var n=null;(e.trailColor||e.trailWidth)&&(n=this._createTrail(e),t.appendChild(n));var i=this._createPath(e);return t.appendChild(i),{svg:t,path:i,trail:n}},o.prototype._initializeSvg=function(e,t){e.setAttribute("viewBox","0 0 100 100")},o.prototype._createPath=function(e){var t=this._pathString(e);return this._createPathElement(t,e)},o.prototype._createTrail=function(e){var t=this._trailString(e),n=r.extend({},e);return n.trailColor||(n.trailColor="#eee"),n.trailWidth||(n.trailWidth=n.strokeWidth),n.color=n.trailColor,n.strokeWidth=n.trailWidth,n.fill=null,this._createPathElement(t,n)},o.prototype._createPathElement=function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n.setAttribute("stroke",t.color),n.setAttribute("stroke-width",t.strokeWidth),t.fill?n.setAttribute("fill",t.fill):n.setAttribute("fill-opacity","0"),n},o.prototype._createTextContainer=function(e,t){var n=document.createElement("div");n.className=e.text.className;var i=e.text.style;return i&&(e.text.autoStyleContainer&&(t.style.position="relative"),r.setStyles(n,i),i.color||(n.style.color=e.color)),this._initializeTextContainer(e,t,n),n},o.prototype._initializeTextContainer=function(e,t,n){},o.prototype._pathString=function(e){throw new Error("Override this function for each progress bar")},o.prototype._trailString=function(e){throw new Error("Override this function for each progress bar")},o.prototype._warnContainerAspectRatio=function(e){if(this.containerAspectRatio){var t=window.getComputedStyle(e,null),n=parseFloat(t.getPropertyValue("width"),10),i=parseFloat(t.getPropertyValue("height"),10);r.floatEquals(this.containerAspectRatio,n/i)||(console.warn("Incorrect aspect ratio of container","#"+e.id,"detected:",t.getPropertyValue("width")+"(width)","/",t.getPropertyValue("height")+"(height)","=",n/i),console.warn("Aspect ratio of should be",this.containerAspectRatio))}},t.exports=o},{"./path":5,"./utils":9}],8:[function(e,t,n){var i=e("./shape"),r=e("./utils"),o=function(e,t){this._pathTemplate="M 0,{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{strokeWidth}",this._trailTemplate="M {startMargin},{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{halfOfStrokeWidth}",i.apply(this,arguments)};(o.prototype=new i).constructor=o,o.prototype._pathString=function(e){var t=100-e.strokeWidth/2;return r.render(this._pathTemplate,{width:t,strokeWidth:e.strokeWidth,halfOfStrokeWidth:e.strokeWidth/2})},o.prototype._trailString=function(e){var t=100-e.strokeWidth/2;return r.render(this._trailTemplate,{width:t,strokeWidth:e.strokeWidth,halfOfStrokeWidth:e.strokeWidth/2,startMargin:e.strokeWidth/2-e.trailWidth/2})},t.exports=o},{"./shape":7,"./utils":9}],9:[function(e,t,n){var i="Webkit Moz O ms".split(" "),r=.001;function o(e,t,n){for(var r=e.style,o=0;o<i.length;++o){var s=i[o];r[s+a(t)]=n}r[t]=n}function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}function s(e){if(function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e))return!1;var t=typeof e;return"object"===t&&!!e}function l(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t(i,n)}}t.exports={extend:function e(t,n,i){for(var r in t=t||{},n=n||{},i=i||!1,n)if(n.hasOwnProperty(r)){var o=t[r],a=n[r];i&&s(o)&&s(a)?t[r]=e(o,a,i):t[r]=a}return t},render:function(e,t){var n=e;for(var i in t)if(t.hasOwnProperty(i)){var r=t[i],o="\\{"+i+"\\}",a=new RegExp(o,"g");n=n.replace(a,r)}return n},setStyle:o,setStyles:function(e,t){l(t,function(t,n){null!==t&&void 0!==t&&(s(t)&&!0===t.prefix?o(e,n,t.value):e.style[n]=t)})},capitalize:a,isString:function(e){return"string"==typeof e||e instanceof String},isFunction:function(e){return"function"==typeof e},isObject:s,forEachObject:l,floatEquals:function(e,t){return Math.abs(e-t)<r},removeChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}}},{}]},{},[4])(4)});var x=function(){function t(e){this.circleLoader=null,this.loaded=!1,this.showPlayButton="undefined"==typeof playBtn||playBtn,this.progress=0,this.options={gameId:"12346",gameTitle:"Place Holder",gameName:"place-holder",libs:[],version:"dev",barColor:"white"},this.options.gameId=e.gameId,this.options.gameTitle=e.gameTitle,this.options.version=e.version,this.options.barColor=e.barColor?e.barColor:this.options.barColor,this.options.libs=e.libs}return t.getInstance=function(e){if(!t.instance){if(!e)throw new Error("Can not create new SplashLoader instance without options!");t.instance=new t(e)}return t.instance},t.prototype.create=function(){return _(this,void 0,void 0,function(){var e,t,n,i,r,o;return R(this,function(a){switch(a.label){case 0:return e="\n        #h5branding-center {\n            position: absolute;\n            top: 45%;\n            left: 50%;\n            transform: translate(-50%, -20%);\n            text-align: center;\n            width: 100%;\n        }\n        #h5branding-wrapper {\n            position: relative;\n            z-index: 665;\n            width: 150px;\n            height: 150px;\n            display:inline-block;\n            margin: 35px 40px 96px 40px;\n        }\n\n        #h5branding-wrapper > #h5branding-bar, #h5branding-wrapper > img {\n            box-shadow: inset 10px 10px 20px 5px rgba(0, 0, 0, 0.5);\n            border-radius: 50%;\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n        }\n\n        #h5branding-ad {\n            position: relative;\n            z-index: 667;\n            border-radius: 5px;\n            border: 3px solid white;\n            background: rgba(256, 256, 256, 0.2);\n            width: 336px;\n            height: 280px;\n            display: none;\n            margin: 0px 10px 0px 10px;\n        }\n\n        #h5branding-wrapper > img {\n            /* Needs appropriate vendor prefixes */\n            box-sizing: border-box;\n\n            /* This needs to be equal to strokeWidth */\n            padding: 4%;\n        }\n\n        #h5branding-wrapper > img {\n            border-radius: 50%;\n            box-shadow: inset 0 5px 5px rgba(0, 0, 0, 0.5), 5px 5px 7px rgba(0, 0, 0, 0.3);\n        }\n\n        #h5branding-container {\n            box-sizing: border-box;\n            position: absolute;\n            z-index: 664;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: #000;\n            overflow: hidden;\n        }\n        \n        #h5branding-background {\n            position: absolute;\n            top: -25%;\n            left: -25%;\n            width: 150%;\n            height: 150%;\n            background-blend-mode: multiply;\n            background-size: cover;\n            filter: blur(40px) brightness(1.5);\n        }\n        \n        @media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {\n             /* IE10+ CSS styles go here */\n             #h5branding-background {\n                background-image: none !important;\n             }\n        }\n\n        #h5branding-logo {\n            position: absolute;\n            margin: 0 auto;\n            left: 0;\n            right: 0;\n            text-align: center;\n            top: 10%;\n        }\n\n        #h5branding-logo > img {\n            height: 150px;\n        }\n\n        #h5branding-title {\n            position: absolute;\n            width: 100%;\n            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.5) 50%, transparent);\n            color: #fff;\n            text-shadow: 0 0 1px rgba(0, 0, 0, 0.7);\n            bottom:10%;\n            padding: 15px 0;\n            text-align: center;\n            font-size: 18px;\n            font-family: Helvetica, Arial, sans-serif;\n            font-weight: bold;\n            line-height: 100%;\n        }\n        \n        #h5branding-button {\n            /* border: 0; */\n            padding: 10px 22px;\n            border-radius: 5px;\n            border: 3px solid white;\n            background: linear-gradient(0deg, #dddddd, #ffffff);\n            color: #222;\n            text-transform: uppercase;\n            text-shadow: 0 0 1px #fff;\n            font-family: Helvetica, Arial, sans-serif;\n            font-weight: bold;\n            font-size: 18px;\n            cursor: pointer;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n            display: none;\n            width: 150px;\n            position: absolute;\n            top: 170px;\n            margin: 0 auto;\n            left: 0;\n            right: 0;\n        }\n        \n        @media (orientation: portrait) and (max-width: 1080px) {\n            #h5branding-logo > img {\n                height: initial;\n                width:100%;\n            }\n        }\n        \n        @media (orientation: landscape) and (max-height: 640px) {\n            #h5branding-title {\n                display: none;\n            }\n            \n            #h5branding-logo > img {\n                height: 100px;\n            }\n        }\n        \n        @media (orientation: landscape) and (max-height: 460px) {\n            #h5branding-title {\n                display: none;\n            }\n            \n            #h5branding-wrapper {\n                width: 110px;\n                height: 110px;\n                margin: 0;\n            }\n            \n            #h5branding-logo {\n                top: 0;\n                transform: scale(0.7, 0.7);\n            }\n       \n            #h5branding-button {\n                top: initial;\n                width: 110px;\n                font-size: 14px;\n                position: absolute;\n                top: 140px;\n                left: 0;\n                right: 0;\n            }\n            \n            #h5branding-ad {\n               display: none !important;\n            }\n        }\n        \n        @media (orientation: portrait) and (max-width: 250px) {\n            #h5branding-logo {\n                top: 2%;\n            }\n        }\n        \n        @media (orientation: landscape) and (max-width: 330px) {\n             #h5branding-button {\n                top: 120px;\n            }\n            \n            #h5branding-logo > img {\n                height: 70px;\n            }\n        }\n        \n        @media (max-width: 600px) and (max-height: 850px) {\n            #h5branding-ad {\n               display: none !important;\n            }\n        }\n        \n        @media (max-width: 600px) and (max-height: 1100px) {\n            #h5branding-center {\n                top: 40%;\n            }\n\n            #h5branding-title {\n               bottom: 5%\n            }\n        }\n        \n        @media (max-width: 600px) and (max-height: 900px) {\n            #h5branding-title {\n               display: none\n            }\n        }\n        \n        @media (orientation: landscape) and (min-width: 800px) {\n            #h5branding-wrapper {\n                margin-left: 120px;\n                margin-right: 120px;\n            }\n        }\n\n        ",s=this.getGameLogoUrl(this.options.gameId),l=this.options.gameTitle,t='\n        <div id="h5branding-background"></div>\n        <div id="h5branding-logo"></div>\n        <div id="h5branding-center">\n            <div id="h5branding-ad"></div>\n            <div id="h5branding-wrapper">\n                <img src="'+s+'" />\n                <div id="h5branding-bar"></div>\n                <button id="h5branding-button" onclick="h5branding.SplashLoader.getInstance().onPlayButtonClick();">Play</button>\n            </div>\n        </div>\n        <div id="h5branding-title">'+l+"</div>\n    ",n=document.head||document.getElementsByTagName("head")[0],(i=document.createElement("style")).type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),n.appendChild(i),(r=document.createElement("div")).innerHTML=t,r.id="h5branding-container",(o=document.body||document.getElementsByTagName("body")[0]).insertBefore(r,o.firstChild),this.circleLoader=new b.Circle("#h5branding-bar",{strokeWidth:3,color:this.options.barColor}),[4,Promise.all([this.loadBranding(),this.loadLibs(),m.preload()])];case 1:return a.sent(),this.loaded=!0,[2]}var s,l})})},t.prototype.loadBranding=function(){return _(this,void 0,void 0,function(){var t,n,i;return R(this,function(r){switch(r.label){case 0:return[4,f.preload(Date.now().toString())];case 1:return r.sent(),(t=document.getElementById("h5branding-background"))&&(t.style.backgroundImage="url("+this.getGameLogoUrl(this.options.gameId)+")",t.style.backgroundColor=f.brandingBackgroundColor),(n=document.getElementById("h5branding-logo"))&&E.getBrandingDomain()!==e.BrandingDomain.Neutral&&((i=document.createElement("img")).src=f.brandingLogoUrl.replace("_small",""),n.appendChild(i)),[2]}})})},t.prototype.loadLibs=function(){var e=this,t=this.options.libs.map(function(n,i){return c.instance.loadScript(n,!0,function(){e.setScriptloadProgress(t.length,i+1)})});return Promise.all(t)},Object.defineProperty(t.prototype,"bannerAllowed",{get:function(){var e=document.body.clientWidth,t=document.body.clientHeight;return this.progress<100&&!(e>t&&t<=460)&&!(e<600&&t<850)},enumerable:!1,configurable:!0}),t.prototype.showBanner=function(){if(!this.bannerAllowed)return null;var e=document.getElementById("h5branding-ad");return e?(e.style.display="inline-flex",e):null},t.prototype.setScriptloadProgress=function(e,t){var n=.3*t/e;this.circleLoader.animate(n,null,function(){})},t.prototype.setLoadProgress=function(e){var t=this;if(this.loaded)if(e=30+.7*e,this.progress=e,100===e){var n=document.querySelector("#h5branding-button");this.circleLoader.animate(1,null,function(){!E.inGDGameZone()&&n&&!0===t.showPlayButton?n.style.display="block":(E.inGDGameZone()||!1===t.showPlayButton)&&t.onPlayButtonClick()})}else this.circleLoader.animate(e/100,null,function(){})},t.prototype.setButtonCallback=function(e){this.buttonCallback=e},t.prototype.onPlayButtonClick=function(){this.buttonCallback&&this.buttonCallback()},t.prototype.destroy=function(){var e=document.querySelector("#h5branding-container");null!==e&&null!==e.parentNode&&e.parentNode.removeChild(e)},t.prototype.getGameLogoUrl=function(e){var t=e+"-512x512.jpeg";return window.hasOwnProperty("fbrqSA")&&!0===window.fbrqSA?"assets/"+t:"https://img.gamedistribution.com/"+t},t}(),w=y.EGAProgressionStatus,M=new m,L=new T;e.EGAProgressionStatus=w,e.google=M,e.gameanalytics=L,e.Utils=E,e.Domain=l,e.Branding=f,e.SplashLoader=x,Object.defineProperty(e,"__esModule",{value:!0})});var RaygunHelper={};!function(e){var t=function(){function e(){var e,t,n,i,r,o,a,s=this;this.apiKey="oDTLKocShe1VREPSvMQ15Q",this.recurringError=[],e=window,t=document,n="script",i="rg4js",e.RaygunObject=i,e[i]=e[i]||function(){(e[i].o=e[i].o||[]).push(arguments)},r=t.createElement(n),o=t.getElementsByTagName(n)[0],r.async=1,r.src="//cdn.raygun.io/raygun4js/raygun.min.js",o.parentNode.insertBefore(r,o),a=e.onerror,e.onerror=function(t,n,r,o,s){a&&a(t,n,r,o,s),s||(s=new Error(t)),e[i].q=e[i].q||[],e[i].q.push({e:s})},rg4js("apiKey",this.apiKey),rg4js("enableCrashReporting",!0),rg4js("setVersion",version),rg4js("options",{ignore3rdPartyErrors:!0}),rg4js("onBeforeSend",function(e){return s.filterError(e)}),rg4js("enablePulse",!1)}return e.getInstance=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.filterError=function(e){if(void 0!==e&&e.Details&&e.Details.Error&&e.Details.Error.Message){if(-1!==this.recurringError.indexOf(e.Details.Error.Message))return!1;this.recurringError.push(e.Details.Error.Message)}return e},e.instance=null,e}();e.RayGun=t}(RaygunHelper||(RaygunHelper={}));var LoaderHelper=function(){function e(){}return e.show=function(){var e=document.getElementById("loader");e&&(e.style.display="block")},e.hide=function(){var e=document.getElementById("loader");e&&(e.style.display="none")},e}(),SponsorLogo=function(){var e;function t(){}return t.load=function(){var t=new THREE.TextureLoader;t.crossOrigin="",t.load(h5branding.Branding.brandingLogoUrl,function(t){e=t,console.log("loading image")})},t.getLogo=function(){return e},t}();GEMIOLI={},GEMIOLI.BrandingLogo=null,AzerionHandler={};var adHandler,GOOGLE_ID="UA-144761097-40",GOOGLE_APP_NAME="Tomb Runner",GAME_KEY="476478b4d172771249eaa8e3834c9022",SECRET_KEY="73b48cccc10ee25ae4d4ff822ee785e08f623aa0";AzerionHandler.adHandler=function(){},AzerionHandler.adHandler.prototype.init=function(){var e=new h5ads.GameDistribution("f2af2ecc05a445edb6862c589e996a7e");h5ads.adWrapper.setAdProvider(e)},AzerionHandler.adHandler.prototype.showAd=function(e,t){h5ads.adWrapper.once(h5ads.AdEvents.CONTENT_PAUSED,function(){LoaderHelper.hide(),h5branding.google.sendScreenView("advertisement_"+e),GEMIOLI.SoundLoader.mute()}.bind(this)),h5ads.adWrapper.once(h5ads.AdEvents.CONTENT_RESUMED,function(){LoaderHelper.hide(),GEMIOLI.SoundLoader.unmute(),h5ads.adWrapper.removeAllListeners(h5ads.AdEvents.CONTENT_PAUSED),h5ads.adWrapper.removeAllListeners(h5ads.AdEvents.CONTENT_RESUMED),t&&t.call(this)}.bind(this)),h5ads.adWrapper.showAd(h5ads.AdType.interstitial)};var init=function(){h5branding.Branding.analyticsEnabled=!0,h5branding.SplashLoader.getInstance({gameId:"f2af2ecc05a445edb6862c589e996a7e",gameName:"Tomb Runner",gameTitle:"Tomb Runner",libs:[],version:version}).create().then(()=>{h5branding.Branding.analyticsEnabled&&RaygunHelper.RayGun.getInstance()})};init();var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(e){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="20px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.color="#000",t.style.padding="1.5em",this.webgl?t.innerHTML=e:t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://get.webgl.org/" style="color:#000">WebGL</a>.<br />',"Please update your browser or operation system."].join("\n"):['Your browser does not seem to support <a href="http://get.webgl.org/" style="color:#000">WebGL</a>.<br/>',"Please update your browser or operation system."].join("\n"),t},addGetWebGLMessage:function(e){var t,n;t=void 0!==(e=e||{}).parent?e.parent:document.body,n=Detector.getWebGLErrorMessage(e.message),t.appendChild(n);var i=document.createElement("img"),r=function(){var e=document.getElementById("webgl-error-message").clientHeight,t=window.innerWidth,n=window.innerHeight-e,r=Math.min(t/347,n/650);i.style.position="absolute",i.style.width=347*r+"px",i.style.height=650*r+"px",i.style.left=(t-347*r)/2+"px",i.style.top=e+(n-650*r)/2+"px"};i.onload=r,i.src="./icons/failed.png",t.appendChild(i),window.addEventListener("resize",r),t.style.backgroundColor="#ffe1a6"}};"object"==typeof module&&(module.exports=Detector),function(e){var t=void 0,n=1e5;function i(e){switch(typeof e){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return null===e?"null":"object"}}function r(e){return Object.prototype.toString.call(e).replace(/^\[object *|\]$/g,"")}function o(e){return"function"==typeof e}function a(e){if(null===e||e===t)throw TypeError();return Object(e)}function s(e){return e>>0}function l(e){return e>>>0}var c,h,u=Math.LN2,d=Math.abs,p=Math.floor,f=Math.log,E=Math.max,m=Math.min,g=Math.pow,v=Math.round;function y(e,t){var n=32-t;return e<<n>>n}function T(e,t){var n=32-t;return e<<n>>>n}function _(e){return[255&e]}function R(e){return y(e[0],8)}function b(e){return[255&e]}function x(e){return T(e[0],8)}function w(e){return[(e=v(Number(e)))<0?0:e>255?255:255&e]}function M(e){return[e>>8&255,255&e]}function L(e){return y(e[0]<<8|e[1],16)}function S(e){return[e>>8&255,255&e]}function H(e){return T(e[0]<<8|e[1],16)}function I(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}function A(e){return y(e[0]<<24|e[1]<<16|e[2]<<8|e[3],32)}function C(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}function O(e){return T(e[0]<<24|e[1]<<16|e[2]<<8|e[3],32)}function P(e,t,n){var i,r,o,a,s,l,c,h=(1<<t-1)-1;function E(e){var t=p(e),n=e-t;return n<.5?t:n>.5?t+1:t%2?t+1:t}for(e!=e?(r=(1<<t)-1,o=g(2,n-1),i=0):e===1/0||e===-1/0?(r=(1<<t)-1,o=0,i=e<0?1:0):0===e?(r=0,o=0,i=1/e==-1/0?1:0):(i=e<0,(e=d(e))>=g(2,1-h)?(r=m(p(f(e)/u),1023),(o=E(e/g(2,r)*g(2,n)))/g(2,n)>=2&&(r+=1,o=1),r>h?(r=(1<<t)-1,o=0):(r+=h,o-=g(2,n))):(r=0,o=E(e/g(2,1-h-n)))),s=[],a=n;a;a-=1)s.push(o%2?1:0),o=p(o/2);for(a=t;a;a-=1)s.push(r%2?1:0),r=p(r/2);for(s.push(i?1:0),s.reverse(),l=s.join(""),c=[];l.length;)c.push(parseInt(l.substring(0,8),2)),l=l.substring(8);return c}function G(e,t,n){var i,r,o,a,s,l,c,h,u=[];for(i=e.length;i;i-=1)for(o=e[i-1],r=8;r;r-=1)u.push(o%2?1:0),o>>=1;return u.reverse(),a=u.join(""),s=(1<<t-1)-1,l=parseInt(a.substring(0,1),2)?-1:1,c=parseInt(a.substring(1,1+t),2),h=parseInt(a.substring(1+t),2),c===(1<<t)-1?0!==h?NaN:l*(1/0):c>0?l*g(2,c-s)*(1+h/g(2,n)):0!==h?l*g(2,-(s-1))*(h/g(2,n)):l<0?-0:0}function D(e){return G(e,11,52)}function k(e){return P(e,11,52)}function B(e){return G(e,8,23)}function N(e){return P(e,8,23)}c=Object.defineProperty,h=!function(){try{return Object.defineProperty({},"x",{})}catch(e){return!1}}(),c&&!h||(Object.defineProperty=function(e,t,n){if(c)try{return c(e,t,n)}catch(e){}if(e!==Object(e))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in n&&Object.prototype.__defineGetter__.call(e,t,n.get),Object.prototype.__defineSetter__&&"set"in n&&Object.prototype.__defineSetter__.call(e,t,n.set),"value"in n&&(e[t]=n.value),e}),function(){function c(e){if((e=s(e))<0)throw RangeError("ArrayBuffer size is not a small enough positive integer.");Object.defineProperty(this,"byteLength",{value:e}),Object.defineProperty(this,"_bytes",{value:Array(e)});for(var t=0;t<e;t+=1)this._bytes[t]=0}function h(){if(!arguments.length||"object"!=typeof arguments[0])return function(e){if((e=s(e))<0)throw RangeError("length is not a small enough positive integer.");Object.defineProperty(this,"length",{value:e}),Object.defineProperty(this,"byteLength",{value:e*this.BYTES_PER_ELEMENT}),Object.defineProperty(this,"buffer",{value:new c(this.byteLength)}),Object.defineProperty(this,"byteOffset",{value:0})}.apply(this,arguments);if(arguments.length>=1&&"object"===i(arguments[0])&&arguments[0]instanceof h)return function(e){if(this.constructor!==e.constructor)throw TypeError();var t=e.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new c(t)}),Object.defineProperty(this,"byteLength",{value:t}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:e.length});for(var n=0;n<this.length;n+=1)this._setter(n,e._getter(n))}.apply(this,arguments);if(arguments.length>=1&&"object"===i(arguments[0])&&!(arguments[0]instanceof h)&&!(arguments[0]instanceof c||"ArrayBuffer"===r(arguments[0])))return function(e){var t=e.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new c(t)}),Object.defineProperty(this,"byteLength",{value:t}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:e.length});for(var n=0;n<this.length;n+=1){var i=e[n];this._setter(n,Number(i))}}.apply(this,arguments);if(arguments.length>=1&&"object"===i(arguments[0])&&(arguments[0]instanceof c||"ArrayBuffer"===r(arguments[0])))return function(e,n,i){if((n=l(n))>e.byteLength)throw RangeError("byteOffset out of range");if(n%this.BYTES_PER_ELEMENT)throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.");if(i===t){var r=e.byteLength-n;if(r%this.BYTES_PER_ELEMENT)throw RangeError("length of buffer minus byteOffset not a multiple of the element size");i=r/this.BYTES_PER_ELEMENT}else r=(i=l(i))*this.BYTES_PER_ELEMENT;if(n+r>e.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:e}),Object.defineProperty(this,"byteLength",{value:r}),Object.defineProperty(this,"byteOffset",{value:n}),Object.defineProperty(this,"length",{value:i})}.apply(this,arguments);throw TypeError()}e.ArrayBuffer=e.ArrayBuffer||c,Object.defineProperty(h,"from",{value:function(e){return new this(e)}}),Object.defineProperty(h,"of",{value:function(){return new this(arguments)}});var u={};function f(e,t,i){var r=function(){Object.defineProperty(this,"constructor",{value:r}),h.apply(this,arguments),function(e){if(e.length>n)throw RangeError("Array too large for polyfill");function t(t){Object.defineProperty(e,t,{get:function(){return e._getter(t)},set:function(n){e._setter(t,n)},enumerable:!0,configurable:!1})}var i;for(i=0;i<e.length;i+=1)t(i)}(this)};"__proto__"in r?r.__proto__=h:(r.from=h.from,r.of=h.of),r.BYTES_PER_ELEMENT=e;var o=function(){};return o.prototype=u,r.prototype=new o,Object.defineProperty(r.prototype,"BYTES_PER_ELEMENT",{value:e}),Object.defineProperty(r.prototype,"_pack",{value:t}),Object.defineProperty(r.prototype,"_unpack",{value:i}),r}h.prototype=u,Object.defineProperty(h.prototype,"_getter",{value:function(e){if(arguments.length<1)throw SyntaxError("Not enough arguments");if((e=l(e))>=this.length)return t;var n,i,r=[];for(n=0,i=this.byteOffset+e*this.BYTES_PER_ELEMENT;n<this.BYTES_PER_ELEMENT;n+=1,i+=1)r.push(this.buffer._bytes[i]);return this._unpack(r)}}),Object.defineProperty(h.prototype,"get",{value:h.prototype._getter}),Object.defineProperty(h.prototype,"_setter",{value:function(e,t){if(arguments.length<2)throw SyntaxError("Not enough arguments");if(!((e=l(e))>=this.length)){var n,i,r=this._pack(t);for(n=0,i=this.byteOffset+e*this.BYTES_PER_ELEMENT;n<this.BYTES_PER_ELEMENT;n+=1,i+=1)this.buffer._bytes[i]=r[n]}}}),Object.defineProperty(h.prototype,"constructor",{value:h}),Object.defineProperty(h.prototype,"copyWithin",{value:function(e,n){var i=arguments[2],r=a(this),o=l(r.length);o=E(o,0);var c,h=s(e);c=h<0?E(o+h,0):m(h,o);var u,d,p,f=s(n);u=f<0?E(o+f,0):m(f,o),p=(d=i===t?o:s(i))<0?E(o+d,0):m(d,o);var g,v=m(p-u,o-c);for(u<c&&c<u+v?(g=-1,u=u+v-1,c=c+v-1):g=1;v>0;)r._setter(c,r._getter(u)),u+=g,c+=g,v-=1;return r}}),Object.defineProperty(h.prototype,"every",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(!o(e))throw TypeError();for(var r=arguments[1],a=0;a<i;a++)if(!e.call(r,n._getter(a),a,n))return!1;return!0}}),Object.defineProperty(h.prototype,"fill",{value:function(e){var n=arguments[1],i=arguments[2],r=a(this),o=l(r.length);o=E(o,0);var c,h,u,d=s(n);for(c=d<0?E(o+d,0):m(d,o),u=(h=i===t?o:s(i))<0?E(o+h,0):m(h,o);c<u;)r._setter(c,e),c+=1;return r}}),Object.defineProperty(h.prototype,"filter",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(!o(e))throw TypeError();for(var r=[],a=arguments[1],s=0;s<i;s++){var c=n._getter(s);e.call(a,c,s,n)&&r.push(c)}return new this.constructor(r)}}),Object.defineProperty(h.prototype,"find",{value:function(e){var n=a(this),i=l(n.length);if(!o(e))throw TypeError();for(var r=arguments.length>1?arguments[1]:t,s=0;s<i;){var c=n._getter(s),h=e.call(r,c,s,n);if(Boolean(h))return c;++s}return t}}),Object.defineProperty(h.prototype,"findIndex",{value:function(e){var n=a(this),i=l(n.length);if(!o(e))throw TypeError();for(var r=arguments.length>1?arguments[1]:t,s=0;s<i;){var c=n._getter(s),h=e.call(r,c,s,n);if(Boolean(h))return s;++s}return-1}}),Object.defineProperty(h.prototype,"forEach",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(!o(e))throw TypeError();for(var r=arguments[1],a=0;a<i;a++)e.call(r,n._getter(a),a,n)}}),Object.defineProperty(h.prototype,"indexOf",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(0===i)return-1;var r=0;if(arguments.length>0&&((r=Number(arguments[1]))!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(r>0||-1)*p(d(r)))),r>=i)return-1;for(var o=r>=0?r:E(i-d(r),0);o<i;o++)if(n._getter(o)===e)return o;return-1}}),Object.defineProperty(h.prototype,"join",{value:function(e){if(this===t||null===this)throw TypeError();for(var n=Object(this),i=l(n.length),r=Array(i),o=0;o<i;++o)r[o]=n._getter(o);return r.join(e===t?",":e)}}),Object.defineProperty(h.prototype,"lastIndexOf",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(0===i)return-1;var r=i;arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(r>0||-1)*p(d(r))));for(var o=r>=0?m(r,i-1):i-d(r);o>=0;o--)if(n._getter(o)===e)return o;return-1}}),Object.defineProperty(h.prototype,"map",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(!o(e))throw TypeError();var r=[];r.length=i;for(var a=arguments[1],s=0;s<i;s++)r[s]=e.call(a,n._getter(s),s,n);return new this.constructor(r)}}),Object.defineProperty(h.prototype,"reduce",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(!o(e))throw TypeError();if(0===i&&1===arguments.length)throw TypeError();var r,a=0;for(r=arguments.length>=2?arguments[1]:n._getter(a++);a<i;)r=e.call(t,r,n._getter(a),a,n),a++;return r}}),Object.defineProperty(h.prototype,"reduceRight",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(!o(e))throw TypeError();if(0===i&&1===arguments.length)throw TypeError();var r,a=i-1;for(r=arguments.length>=2?arguments[1]:n._getter(a--);a>=0;)r=e.call(t,r,n._getter(a),a,n),a--;return r}}),Object.defineProperty(h.prototype,"reverse",{value:function(){if(this===t||null===this)throw TypeError();for(var e=Object(this),n=l(e.length),i=p(n/2),r=0,o=n-1;r<i;++r,--o){var a=e._getter(r);e._setter(r,e._getter(o)),e._setter(o,a)}return e}}),Object.defineProperty(h.prototype,"set",{value:function(e,t){if(arguments.length<1)throw SyntaxError("Not enough arguments");var n,i,r,o,a,s,c,h,u,d;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor){if(n=arguments[0],(r=l(arguments[1]))+n.length>this.length)throw RangeError("Offset plus length of array is out of range");if(h=this.byteOffset+r*this.BYTES_PER_ELEMENT,u=n.length*this.BYTES_PER_ELEMENT,n.buffer===this.buffer){for(d=[],a=0,s=n.byteOffset;a<u;a+=1,s+=1)d[a]=n.buffer._bytes[s];for(a=0,c=h;a<u;a+=1,c+=1)this.buffer._bytes[c]=d[a]}else for(a=0,s=n.byteOffset,c=h;a<u;a+=1,s+=1,c+=1)this.buffer._bytes[c]=n.buffer._bytes[s]}else{if("object"!=typeof arguments[0]||void 0===arguments[0].length)throw TypeError("Unexpected argument type(s)");if(o=l((i=arguments[0]).length),(r=l(arguments[1]))+o>this.length)throw RangeError("Offset plus length of array is out of range");for(a=0;a<o;a+=1)s=i[a],this._setter(r+a,Number(s))}}}),Object.defineProperty(h.prototype,"slice",{value:function(e,n){for(var i=a(this),r=l(i.length),o=s(e),c=o<0?E(r+o,0):m(o,r),h=n===t?r:s(n),u=h<0?E(r+h,0):m(h,r),d=u-c,p=new(0,i.constructor)(d),f=0;c<u;){var g=i._getter(c);p._setter(f,g),++c,++f}return p}}),Object.defineProperty(h.prototype,"some",{value:function(e){if(this===t||null===this)throw TypeError();var n=Object(this),i=l(n.length);if(!o(e))throw TypeError();for(var r=arguments[1],a=0;a<i;a++)if(e.call(r,n._getter(a),a,n))return!0;return!1}}),Object.defineProperty(h.prototype,"sort",{value:function(e){if(this===t||null===this)throw TypeError();for(var n=Object(this),i=l(n.length),r=Array(i),o=0;o<i;++o)r[o]=n._getter(o);for(e?r.sort(e):r.sort(),o=0;o<i;++o)n._setter(o,r[o]);return n}}),Object.defineProperty(h.prototype,"subarray",{value:function(e,t){function n(e,t,n){return e<t?t:e>n?n:e}e=s(e),t=s(t),arguments.length<1&&(e=0),arguments.length<2&&(t=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e=n(e,0,this.length);var i=(t=n(t,0,this.length))-e;return i<0&&(i=0),new this.constructor(this.buffer,this.byteOffset+e*this.BYTES_PER_ELEMENT,i)}});var g=f(1,_,R),v=f(1,b,x),y=f(1,w,x),T=f(2,M,L),P=f(2,S,H),G=f(4,I,A),j=f(4,C,O),F=f(4,N,B),U=f(8,k,D);e.Int8Array=e.Int8Array||g,e.Uint8Array=e.Uint8Array||v,e.Uint8ClampedArray=e.Uint8ClampedArray||y,e.Int16Array=e.Int16Array||T,e.Uint16Array=e.Uint16Array||P,e.Int32Array=e.Int32Array||G,e.Uint32Array=e.Uint32Array||j,e.Float32Array=e.Float32Array||F,e.Float64Array=e.Float64Array||U}(),function(){function n(e,t){return o(e.get)?e.get(t):e[t]}var i,a=(i=new Uint16Array([4660]),18===n(new Uint8Array(i.buffer),0));function s(e,n,i){if(!(e instanceof ArrayBuffer||"ArrayBuffer"===r(e)))throw TypeError();if((n=l(n))>e.byteLength)throw RangeError("byteOffset out of range");if(n+(i=i===t?e.byteLength-n:l(i))>e.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:e}),Object.defineProperty(this,"byteLength",{value:i}),Object.defineProperty(this,"byteOffset",{value:n})}function c(e){return function(t,i){if((t=l(t))+e.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");t+=this.byteOffset;for(var r=new Uint8Array(this.buffer,t,e.BYTES_PER_ELEMENT),o=[],s=0;s<e.BYTES_PER_ELEMENT;s+=1)o.push(n(r,s));return Boolean(i)===Boolean(a)&&o.reverse(),n(new e(new Uint8Array(o).buffer),0)}}function h(e){return function(t,i,r){if((t=l(t))+e.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");var o,s=new e([i]),c=new Uint8Array(s.buffer),h=[];for(o=0;o<e.BYTES_PER_ELEMENT;o+=1)h.push(n(c,o));Boolean(r)===Boolean(a)&&h.reverse(),new Uint8Array(this.buffer,t,e.BYTES_PER_ELEMENT).set(h)}}Object.defineProperty(s.prototype,"getUint8",{value:c(Uint8Array)}),Object.defineProperty(s.prototype,"getInt8",{value:c(Int8Array)}),Object.defineProperty(s.prototype,"getUint16",{value:c(Uint16Array)}),Object.defineProperty(s.prototype,"getInt16",{value:c(Int16Array)}),Object.defineProperty(s.prototype,"getUint32",{value:c(Uint32Array)}),Object.defineProperty(s.prototype,"getInt32",{value:c(Int32Array)}),Object.defineProperty(s.prototype,"getFloat32",{value:c(Float32Array)}),Object.defineProperty(s.prototype,"getFloat64",{value:c(Float64Array)}),Object.defineProperty(s.prototype,"setUint8",{value:h(Uint8Array)}),Object.defineProperty(s.prototype,"setInt8",{value:h(Int8Array)}),Object.defineProperty(s.prototype,"setUint16",{value:h(Uint16Array)}),Object.defineProperty(s.prototype,"setInt16",{value:h(Int16Array)}),Object.defineProperty(s.prototype,"setUint32",{value:h(Uint32Array)}),Object.defineProperty(s.prototype,"setInt32",{value:h(Int32Array)}),Object.defineProperty(s.prototype,"setFloat32",{value:h(Float32Array)}),Object.defineProperty(s.prototype,"setFloat64",{value:h(Float64Array)}),e.DataView=e.DataView||s}()}(this),function(e){var t=/iPhone/i,n=/iPod/i,i=/iPad/i,r=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,o=/Android/i,a=/IEMobile/i,s=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,l=/BlackBerry/i,c=/BB10/i,h=/Opera Mini/i,u=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,d=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),p=function(e,t){return e.test(t)},f=function(e){var f=e||navigator.userAgent;if(this.apple={phone:p(t,f),ipod:p(n,f),tablet:p(i,f),device:p(t,f)||p(n,f)||p(i,f)},this.android={phone:p(r,f),tablet:!p(r,f)&&p(o,f),device:p(r,f)||p(o,f)},this.windows={phone:p(a,f),tablet:p(s,f),device:p(a,f)||p(s,f)},this.other={blackberry:p(l,f),blackberry10:p(c,f),opera:p(h,f),firefox:p(u,f),device:p(l,f)||p(c,f)||p(h,f)||p(u,f)},this.seven_inch=p(d,f),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},E=function(){var e=new f;return e.Class=f,e};"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=f:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=E():"function"==typeof define&&define.amd?define(E()):e.isMobile=E()}(this),this.createjs=this.createjs||{},function(){var e=createjs.SoundJS=createjs.SoundJS||{};e.version="NEXT",e.buildDate="Thu, 29 Oct 2015 03:02:56 GMT"}(),this.createjs=this.createjs||{},createjs.extend=function(e,t){function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n},this.createjs=this.createjs||{},createjs.promote=function(e,t){var n=e.prototype,i=Object.getPrototypeOf&&Object.getPrototypeOf(n)||n.__proto__;if(i)for(var r in n[(t+="_")+"constructor"]=i.constructor,i)n.hasOwnProperty(r)&&"function"==typeof i[r]&&(n[t+r]=i[r]);return e},this.createjs=this.createjs||{},createjs.indexOf=function(e,t){for(var n=0,i=e.length;n<i;n++)if(t===e[n])return n;return-1},this.createjs=this.createjs||{},createjs.proxy=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,Array.prototype.slice.call(arguments,0).concat(n))}},this.createjs=this.createjs||{},function(){function e(){throw"BrowserDetect cannot be instantiated"}var t=e.agent=window.navigator.userAgent;e.isWindowPhone=t.indexOf("IEMobile")>-1||t.indexOf("Windows Phone")>-1,e.isFirefox=t.indexOf("Firefox")>-1,e.isOpera=null!=window.opera,e.isChrome=t.indexOf("Chrome")>-1,e.isIOS=(t.indexOf("iPod")>-1||t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1)&&!e.isWindowPhone,e.isAndroid=t.indexOf("Android")>-1&&!e.isWindowPhone,e.isBlackberry=t.indexOf("Blackberry")>-1,createjs.BrowserDetect=e}(),this.createjs=this.createjs||{},function(){function e(){this._listeners=null,this._captureListeners=null}var t=e.prototype;e.initialize=function(e){e.addEventListener=t.addEventListener,e.on=t.on,e.removeEventListener=e.off=t.removeEventListener,e.removeAllEventListeners=t.removeAllEventListeners,e.hasEventListener=t.hasEventListener,e.dispatchEvent=t.dispatchEvent,e._dispatchEvent=t._dispatchEvent,e.willTrigger=t.willTrigger},t.addEventListener=function(e,t,n){var i,r=(i=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{})[e];return r&&this.removeEventListener(e,t,n),(r=i[e])?r.push(t):i[e]=[t],t},t.on=function(e,t,n,i,r,o){return t.handleEvent&&(n=n||t,t=t.handleEvent),n=n||this,this.addEventListener(e,function(e){t.call(n,e,r),i&&e.remove()},o)},t.removeEventListener=function(e,t,n){var i=n?this._captureListeners:this._listeners;if(i){var r=i[e];if(r)for(var o=0,a=r.length;o<a;o++)if(r[o]==t){1==a?delete i[e]:r.splice(o,1);break}}},t.off=t.removeEventListener,t.removeAllEventListeners=function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},t.dispatchEvent=function(e){if("string"==typeof e){var t=this._listeners;if(!t||!t[e])return!1;e=new createjs.Event(e)}else e.target&&e.clone&&(e=e.clone());try{e.target=this}catch(e){}if(e.bubbles&&this.parent){for(var n=this,i=[n];n.parent;)i.push(n=n.parent);var r,o=i.length;for(r=o-1;r>=0&&!e.propagationStopped;r--)i[r]._dispatchEvent(e,1+(0==r));for(r=1;r<o&&!e.propagationStopped;r++)i[r]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented},t.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},t.willTrigger=function(e){for(var t=this;t;){if(t.hasEventListener(e))return!0;t=t.parent}return!1},t.toString=function(){return"[EventDispatcher]"},t._dispatchEvent=function(e,t){var n,i=1==t?this._captureListeners:this._listeners;if(e&&i){var r=i[e.type];if(!r||!(n=r.length))return;try{e.currentTarget=this}catch(e){}try{e.eventPhase=t}catch(e){}e.removed=!1,r=r.slice();for(var o=0;o<n&&!e.immediatePropagationStopped;o++){var a=r[o];a.handleEvent?a.handleEvent(e):a(e),e.removed&&(this.off(e.type,a,1==t),e.removed=!1)}}},createjs.EventDispatcher=e}(),this.createjs=this.createjs||{},function(){function e(e,t,n){this.type=e,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!t,this.cancelable=!!n,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var t=e.prototype;t.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},t.stopPropagation=function(){this.propagationStopped=!0},t.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.remove=function(){this.removed=!0},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},t.set=function(e){for(var t in e)this[t]=e[t];return this},t.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=e}(),this.createjs=this.createjs||{},function(){function e(e,t,n){this.Event_constructor("error"),this.title=e,this.message=t,this.data=n}createjs.extend(e,createjs.Event).clone=function(){return new createjs.ErrorEvent(this.title,this.message,this.data)},createjs.ErrorEvent=createjs.promote(e,"Event")}(),this.createjs=this.createjs||{},function(e){function t(e,t){this.Event_constructor("progress"),this.loaded=e,this.total=null==t?1:t,this.progress=0==t?0:this.loaded/this.total}createjs.extend(t,createjs.Event).clone=function(){return new createjs.ProgressEvent(this.loaded,this.total)},createjs.ProgressEvent=createjs.promote(t,"Event")}(window),this.createjs=this.createjs||{},function(){function e(){this.src=null,this.type=null,this.id=null,this.maintainOrder=!1,this.callback=null,this.data=null,this.method=createjs.LoadItem.GET,this.values=null,this.headers=null,this.withCredentials=!1,this.mimeType=null,this.crossOrigin=null,this.loadTimeout=n.LOAD_TIMEOUT_DEFAULT}var t=e.prototype={},n=e;n.LOAD_TIMEOUT_DEFAULT=8e3,n.create=function(t){if("string"==typeof t){var i=new e;return i.src=t,i}if(t instanceof n)return t;if(t instanceof Object&&t.src)return null==t.loadTimeout&&(t.loadTimeout=n.LOAD_TIMEOUT_DEFAULT),t;throw new Error("Type not recognized.")},t.set=function(e){for(var t in e)this[t]=e[t];return this},createjs.LoadItem=n}(),function(){var e={ABSOLUTE_PATT:/^(?:\w+:)?\/{2}/i,RELATIVE_PATT:/^[./]*?\//i,EXTENSION_PATT:/\/?[^/]+\.(\w{1,5})$/i,parseURI:function(t){var n={absolute:!1,relative:!1};if(null==t)return n;var i,r=t.indexOf("?");return r>-1&&(t=t.substr(0,r)),e.ABSOLUTE_PATT.test(t)?n.absolute=!0:e.RELATIVE_PATT.test(t)&&(n.relative=!0),(i=t.match(e.EXTENSION_PATT))&&(n.extension=i[1].toLowerCase()),n},formatQueryString:function(e,t){if(null==e)throw new Error("You must specify data.");var n=[];for(var i in e)n.push(i+"="+escape(e[i]));return t&&(n=n.concat(t)),n.join("&")},buildPath:function(e,t){if(null==t)return e;var n=[],i=e.indexOf("?");if(-1!=i){var r=e.slice(i+1);n=n.concat(r.split("&"))}return-1!=i?e.slice(0,i)+"?"+this._formatQueryString(t,n):e+"?"+this._formatQueryString(t,n)},isCrossDomain:function(e){var t=document.createElement("a");t.href=e.src;var n=document.createElement("a");return n.href=location.href,""!=t.hostname&&(t.port!=n.port||t.protocol!=n.protocol||t.hostname!=n.hostname)},isLocal:function(e){var t=document.createElement("a");return t.href=e.src,""==t.hostname&&"file:"==t.protocol},isBinary:function(e){switch(e){case createjs.AbstractLoader.IMAGE:case createjs.AbstractLoader.BINARY:return!0;default:return!1}},isImageTag:function(e){return e instanceof HTMLImageElement},isAudioTag:function(e){return!!window.HTMLAudioElement&&e instanceof HTMLAudioElement},isVideoTag:function(e){return!!window.HTMLVideoElement&&e instanceof HTMLVideoElement},isText:function(e){switch(e){case createjs.AbstractLoader.TEXT:case createjs.AbstractLoader.JSON:case createjs.AbstractLoader.MANIFEST:case createjs.AbstractLoader.XML:case createjs.AbstractLoader.CSS:case createjs.AbstractLoader.SVG:case createjs.AbstractLoader.JAVASCRIPT:case createjs.AbstractLoader.SPRITESHEET:return!0;default:return!1}},getTypeByExtension:function(e){if(null==e)return createjs.AbstractLoader.TEXT;switch(e.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.AbstractLoader.IMAGE;case"ogg":case"mp3":case"webm":return createjs.AbstractLoader.SOUND;case"mp4":case"webm":case"ts":return createjs.AbstractLoader.VIDEO;case"json":return createjs.AbstractLoader.JSON;case"xml":return createjs.AbstractLoader.XML;case"css":return createjs.AbstractLoader.CSS;case"js":return createjs.AbstractLoader.JAVASCRIPT;case"svg":return createjs.AbstractLoader.SVG;default:return createjs.AbstractLoader.TEXT}}};createjs.RequestUtils=e}(),this.createjs=this.createjs||{},function(){function e(e,t,n){this.EventDispatcher_constructor(),this.loaded=!1,this.canceled=!1,this.progress=0,this.type=n,this.resultFormatter=null,this._item=e?createjs.LoadItem.create(e):null,this._preferXHR=t,this._result=null,this._rawResult=null,this._loadedItems=null,this._tagSrcAttribute=null,this._tag=null}var t=createjs.extend(e,createjs.EventDispatcher),n=e;n.POST="POST",n.GET="GET",n.BINARY="binary",n.CSS="css",n.IMAGE="image",n.JAVASCRIPT="javascript",n.JSON="json",n.JSONP="jsonp",n.MANIFEST="manifest",n.SOUND="sound",n.VIDEO="video",n.SPRITESHEET="spritesheet",n.SVG="svg",n.TEXT="text",n.XML="xml",t.getItem=function(){return this._item},t.getResult=function(e){return e?this._rawResult:this._result},t.getTag=function(){return this._tag},t.setTag=function(e){this._tag=e},t.load=function(){this._createRequest(),this._request.on("complete",this,this),this._request.on("progress",this,this),this._request.on("loadStart",this,this),this._request.on("abort",this,this),this._request.on("timeout",this,this),this._request.on("error",this,this);var e=new createjs.Event("initialize");e.loader=this._request,this.dispatchEvent(e),this._request.load()},t.cancel=function(){this.canceled=!0,this.destroy()},t.destroy=function(){this._request&&(this._request.removeAllEventListeners(),this._request.destroy()),this._request=null,this._item=null,this._rawResult=null,this._result=null,this._loadItems=null,this.removeAllEventListeners()},t.getLoadedItems=function(){return this._loadedItems},t._createRequest=function(){this._preferXHR?this._request=new createjs.XHRRequest(this._item):this._request=new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},t._createTag=function(e){return null},t._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},t._sendProgress=function(e){if(!this._isCanceled()){var t=null;"number"==typeof e?(this.progress=e,t=new createjs.ProgressEvent(this.progress)):(t=e,this.progress=e.loaded/e.total,t.progress=this.progress,(isNaN(this.progress)||this.progress==1/0)&&(this.progress=0)),this.hasEventListener("progress")&&this.dispatchEvent(t)}},t._sendComplete=function(){if(!this._isCanceled()){this.loaded=!0;var e=new createjs.Event("complete");e.rawResult=this._rawResult,null!=this._result&&(e.result=this._result),this.dispatchEvent(e)}},t._sendError=function(e){!this._isCanceled()&&this.hasEventListener("error")&&(null==e&&(e=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY")),this.dispatchEvent(e))},t._isCanceled=function(){return!(null!=window.createjs&&!this.canceled)},t.resultFormatter=null,t.handleEvent=function(e){switch(e.type){case"complete":this._rawResult=e.target._response;var t=this.resultFormatter&&this.resultFormatter(this),n=this;t instanceof Function?t(function(e){n._result=e,n._sendComplete()}):(this._result=t||this._rawResult,this._sendComplete());break;case"progress":this._sendProgress(e);break;case"error":this._sendError(e);break;case"loadstart":this._sendLoadStart();break;case"abort":case"timeout":this._isCanceled()||this.dispatchEvent(e.type)}},t.buildPath=function(e,t){return createjs.RequestUtils.buildPath(e,t)},t.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=createjs.promote(e,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){function e(e,t,n){this.AbstractLoader_constructor(e,t,n),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src"}var t=createjs.extend(e,createjs.AbstractLoader);t.load=function(){this._tag||(this._tag=this._createTag(this._item.src)),this._tag.preload="auto",this._tag.load(),this.AbstractLoader_load()},t._createTag=function(){},t._createRequest=function(){this._preferXHR?this._request=new createjs.XHRRequest(this._item):this._request=new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},t._formatResult=function(e){return this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.onstalled=null,this._preferXHR&&(e.getTag().src=e.getResult(!0)),e.getTag()},createjs.AbstractMediaLoader=createjs.promote(e,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){var e=function(e){this._item=e},t=createjs.extend(e,createjs.EventDispatcher);t.load=function(){},t.destroy=function(){},t.cancel=function(){},createjs.AbstractRequest=createjs.promote(e,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){function e(e,t,n){this.AbstractRequest_constructor(e),this._tag=t,this._tagSrcAttribute=n,this._loadedHandler=createjs.proxy(this._handleTagComplete,this),this._addedToDOM=!1,this._startTagVisibility=null}var t=createjs.extend(e,createjs.AbstractRequest);t.load=function(){this._tag.onload=createjs.proxy(this._handleTagComplete,this),this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this),this._tag.onerror=createjs.proxy(this._handleError,this);var e=new createjs.Event("initialize");e.loader=this._tag,this.dispatchEvent(e),this._hideTag(),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout),this._tag[this._tagSrcAttribute]=this._item.src,null==this._tag.parentNode&&(window.document.body.appendChild(this._tag),this._addedToDOM=!0)},t.destroy=function(){this._clean(),this._tag=null,this.AbstractRequest_destroy()},t._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var e=this._tag;"loaded"!=e.readyState&&"complete"!=e.readyState||this._handleTagComplete()},t._handleError=function(){this._clean(),this.dispatchEvent("error")},t._handleTagComplete=function(){this._rawResult=this._tag,this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult,this._clean(),this._showTag(),this.dispatchEvent("complete")},t._handleTimeout=function(){this._clean(),this.dispatchEvent(new createjs.Event("timeout"))},t._clean=function(){this._tag.onload=null,this._tag.onreadystatechange=null,this._tag.onerror=null,this._addedToDOM&&null!=this._tag.parentNode&&this._tag.parentNode.removeChild(this._tag),clearTimeout(this._loadTimeout)},t._hideTag=function(){this._startTagVisibility=this._tag.style.visibility,this._tag.style.visibility="hidden"},t._showTag=function(){this._tag.style.visibility=this._startTagVisibility},t._handleStalled=function(){},createjs.TagRequest=createjs.promote(e,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){function e(e,t,n){this.AbstractRequest_constructor(e),this._tag=t,this._tagSrcAttribute=n,this._loadedHandler=createjs.proxy(this._handleTagComplete,this)}var t=createjs.extend(e,createjs.TagRequest);t.load=function(){var e=createjs.proxy(this._handleStalled,this);this._stalledCallback=e;var t=createjs.proxy(this._handleProgress,this);this._handleProgress=t,this._tag.addEventListener("stalled",e),this._tag.addEventListener("progress",t),this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,!1),this.TagRequest_load()},t._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var e=this._tag;"loaded"!=e.readyState&&"complete"!=e.readyState||this._handleTagComplete()},t._handleStalled=function(){},t._handleProgress=function(e){if(e&&!(e.loaded>0&&0==e.total)){var t=new createjs.ProgressEvent(e.loaded,e.total);this.dispatchEvent(t)}},t._clean=function(){this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.removeEventListener("stalled",this._stalledCallback),this._tag.removeEventListener("progress",this._progressCallback),this.TagRequest__clean()},createjs.MediaTagRequest=createjs.promote(e,"TagRequest")}(),this.createjs=this.createjs||{},function(){function e(e){this.AbstractRequest_constructor(e),this._request=null,this._loadTimeout=null,this._xhrLevel=1,this._response=null,this._rawResponse=null,this._canceled=!1,this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this),this._handleProgressProxy=createjs.proxy(this._handleProgress,this),this._handleAbortProxy=createjs.proxy(this._handleAbort,this),this._handleErrorProxy=createjs.proxy(this._handleError,this),this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this),this._handleLoadProxy=createjs.proxy(this._handleLoad,this),this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this),this._createXHR(e)}var t=createjs.extend(e,createjs.AbstractRequest);e.ACTIVEX_VERSIONS=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],t.getResult=function(e){return e&&this._rawResponse?this._rawResponse:this._response},t.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},t.load=function(){if(null!=this._request){this._request.addEventListener("loadstart",this._handleLoadStartProxy,!1),this._request.addEventListener("progress",this._handleProgressProxy,!1),this._request.addEventListener("abort",this._handleAbortProxy,!1),this._request.addEventListener("error",this._handleErrorProxy,!1),this._request.addEventListener("timeout",this._handleTimeoutProxy,!1),this._request.addEventListener("load",this._handleLoadProxy,!1),this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,!1),1==this._xhrLevel&&(this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout));try{this._item.values&&this._item.method!=createjs.AbstractLoader.GET?this._item.method==createjs.AbstractLoader.POST&&this._request.send(createjs.RequestUtils.formatQueryString(this._item.values)):this._request.send()}catch(e){this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,e))}}else this._handleError()},t.setResponseType=function(e){this._request.responseType=e},t.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},t.getResponseHeader=function(e){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(e):null},t._handleProgress=function(e){if(e&&!(e.loaded>0&&0==e.total)){var t=new createjs.ProgressEvent(e.loaded,e.total);this.dispatchEvent(t)}},t._handleLoadStart=function(e){clearTimeout(this._loadTimeout),this.dispatchEvent("loadstart")},t._handleAbort=function(e){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,e))},t._handleError=function(e){this._clean(),this.dispatchEvent(new createjs.ErrorEvent(e.message))},t._handleReadyStateChange=function(e){4==this._request.readyState&&this._handleLoad()},t._handleLoad=function(e){if(!this.loaded){this.loaded=!0;var t=this._checkError();t?this._handleError(t):(this._response=this._getResponse(),this._clean(),this.dispatchEvent(new createjs.Event("complete")))}},t._handleTimeout=function(e){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,e))},t._checkError=function(){var e=parseInt(this._request.status);switch(e){case 404:return new Error(e)}return null},t._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(e){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(e){}return null},t._createXHR=function(e){var t=createjs.RequestUtils.isCrossDomain(e),n={},i=null;if(window.XMLHttpRequest)i=new XMLHttpRequest,t&&void 0===i.withCredentials&&window.XDomainRequest&&(i=new XDomainRequest);else{for(var r=0,o=s.ACTIVEX_VERSIONS.length;r<o;r++){s.ACTIVEX_VERSIONS[r];try{i=new ActiveXObject(axVersions);break}catch(e){}}if(null==i)return!1}null==e.mimeType&&createjs.RequestUtils.isText(e.type)&&(e.mimeType="text/plain; charset=utf-8"),e.mimeType&&i.overrideMimeType&&i.overrideMimeType(e.mimeType),this._xhrLevel="string"==typeof i.responseType?2:1;var a=null;if(a=e.method==createjs.AbstractLoader.GET?createjs.RequestUtils.buildPath(e.src,e.values):e.src,i.open(e.method||createjs.AbstractLoader.GET,a,!0),t&&i instanceof XMLHttpRequest&&1==this._xhrLevel&&(n.Origin=location.origin),e.values&&e.method==createjs.AbstractLoader.POST&&(n["Content-Type"]="application/x-www-form-urlencoded"),t||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),e.headers)for(var l in e.headers)n[l]=e.headers[l];for(l in n)i.setRequestHeader(l,n[l]);return i instanceof XMLHttpRequest&&void 0!==e.withCredentials&&(i.withCredentials=e.withCredentials),this._request=i,!0},t._clean=function(){clearTimeout(this._loadTimeout),this._request.removeEventListener("loadstart",this._handleLoadStartProxy),this._request.removeEventListener("progress",this._handleProgressProxy),this._request.removeEventListener("abort",this._handleAbortProxy),this._request.removeEventListener("error",this._handleErrorProxy),this._request.removeEventListener("timeout",this._handleTimeoutProxy),this._request.removeEventListener("load",this._handleLoadProxy),this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy)},t.toString=function(){return"[PreloadJS XHRRequest]"},createjs.XHRRequest=createjs.promote(e,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){function e(e,t){this.AbstractMediaLoader_constructor(e,t,createjs.AbstractLoader.SOUND),createjs.RequestUtils.isAudioTag(e)?this._tag=e:createjs.RequestUtils.isAudioTag(e.src)?this._tag=e:createjs.RequestUtils.isAudioTag(e.tag)&&(this._tag=createjs.RequestUtils.isAudioTag(e)?e:e.src),null!=this._tag&&(this._preferXHR=!1)}var t=createjs.extend(e,createjs.AbstractMediaLoader);e.canLoadItem=function(e){return e.type==createjs.AbstractLoader.SOUND},t._createTag=function(e){var t=document.createElement("audio");return t.autoplay=!1,t.preload="none",t.src=e,t},createjs.SoundLoader=createjs.promote(e,"AbstractMediaLoader")}(),this.createjs=this.createjs||{},function(){var e=function(){this.interrupt=null,this.delay=null,this.offset=null,this.loop=null,this.volume=null,this.pan=null,this.startTime=null,this.duration=null},t=e.prototype={},n=e;n.create=function(e){if(e instanceof n||e instanceof Object){var t=new createjs.PlayPropsConfig;return t.set(e),t}throw new Error("Type not recognized.")},t.set=function(e){for(var t in e)this[t]=e[t];return this},t.toString=function(){return"[PlayPropsConfig]"},createjs.PlayPropsConfig=n}(),this.createjs=this.createjs||{},function(){function e(){throw"Sound cannot be instantiated"}var t=e;function n(e,t){this.init(e,t)}t.INTERRUPT_ANY="any",t.INTERRUPT_EARLY="early",t.INTERRUPT_LATE="late",t.INTERRUPT_NONE="none",t.PLAY_INITED="playInited",t.PLAY_SUCCEEDED="playSucceeded",t.PLAY_INTERRUPTED="playInterrupted",t.PLAY_FINISHED="playFinished",t.PLAY_FAILED="playFailed",t.SUPPORTED_EXTENSIONS=["mp3","ogg","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"],t.EXTENSION_MAP={m4a:"mp4"},t.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,t.defaultInterruptBehavior=t.INTERRUPT_NONE,t.alternateExtensions=[],t.activePlugin=null,t._masterVolume=1,Object.defineProperty(t,"volume",{get:function(){return this._masterVolume},set:function(e){if(null==Number(e))return!1;if(e=Math.max(0,Math.min(1,e)),t._masterVolume=e,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(e))for(var n=this._instances,i=0,r=n.length;i<r;i++)n[i].setMasterVolume(e)}}),t._masterMute=!1,Object.defineProperty(t,"muted",{get:function(){return this._masterMute},set:function(e){if(null==e)return!1;if(this._masterMute=e,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(e))for(var t=this._instances,n=0,i=t.length;n<i;n++)t[n].setMasterMute(e);return!0}}),Object.defineProperty(t,"capabilities",{get:function(){return null==t.activePlugin?null:t.activePlugin._capabilities},set:function(e){return!1}}),t._pluginsRegistered=!1,t._lastID=0,t._instances=[],t._idHash={},t._preloadHash={},t._defaultPlayPropsHash={},t.addEventListener=null,t.removeEventListener=null,t.removeAllEventListeners=null,t.dispatchEvent=null,t.hasEventListener=null,t._listeners=null,createjs.EventDispatcher.initialize(t),t.getPreloadHandlers=function(){return{callback:createjs.proxy(t.initLoad,t),types:["sound"],extensions:t.SUPPORTED_EXTENSIONS}},t._handleLoadComplete=function(e){var n=e.target.getItem().src;if(t._preloadHash[n])for(var i=0,r=t._preloadHash[n].length;i<r;i++){var o=t._preloadHash[n][i];if(t._preloadHash[n][i]=!0,t.hasEventListener("fileload"))(e=new createjs.Event("fileload")).src=o.src,e.id=o.id,e.data=o.data,e.sprite=o.sprite,t.dispatchEvent(e)}},t._handleLoadError=function(e){var n=e.target.getItem().src;if(t._preloadHash[n])for(var i=0,r=t._preloadHash[n].length;i<r;i++){var o=t._preloadHash[n][i];if(t._preloadHash[n][i]=!1,t.hasEventListener("fileerror"))(e=new createjs.Event("fileerror")).src=o.src,e.id=o.id,e.data=o.data,e.sprite=o.sprite,t.dispatchEvent(e)}},t._registerPlugin=function(e){return!!e.isSupported()&&(t.activePlugin=new e,!0)},t.registerPlugins=function(e){t._pluginsRegistered=!0;for(var n=0,i=e.length;n<i;n++)if(t._registerPlugin(e[n]))return!0;return!1},t.initializeDefaultPlugins=function(){return null!=t.activePlugin||!t._pluginsRegistered&&!!t.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])},t.isReady=function(){return null!=t.activePlugin},t.getCapabilities=function(){return null==t.activePlugin?null:t.activePlugin._capabilities},t.getCapability=function(e){return null==t.activePlugin?null:t.activePlugin._capabilities[e]},t.initLoad=function(e){return t._registerSound(e)},t._registerSound=function(e){if(!t.initializeDefaultPlugins())return!1;var i;if(e.src instanceof Object?(i=t._parseSrc(e.src)).src=e.path+i.src:i=t._parsePath(e.src),null==i)return!1;e.src=i.src,e.type="sound";var r=e.data,o=null;if(null!=r&&(isNaN(r.channels)?isNaN(r)||(o=parseInt(r)):o=parseInt(r.channels),r.audioSprite))for(var a,s=r.audioSprite.length;s--;)a=r.audioSprite[s],t._idHash[a.id]={src:e.src,startTime:parseInt(a.startTime),duration:parseInt(a.duration)},a.defaultPlayProps&&(t._defaultPlayPropsHash[a.id]=createjs.PlayPropsConfig.create(a.defaultPlayProps));null!=e.id&&(t._idHash[e.id]={src:e.src});var l=t.activePlugin.register(e);return n.create(e.src,o),null!=r&&isNaN(r)?e.data.channels=o||n.maxPerChannel():e.data=o||n.maxPerChannel(),l.type&&(e.type=l.type),e.defaultPlayProps&&(t._defaultPlayPropsHash[e.src]=createjs.PlayPropsConfig.create(e.defaultPlayProps)),l},t.registerSound=function(e,n,i,r,o){var a={src:e,id:n,data:i,defaultPlayProps:o};e instanceof Object&&e.src&&(r=n,a=e),(a=createjs.LoadItem.create(a)).path=r,null==r||a.src instanceof Object||(a.src=r+e);var s=t._registerSound(a);if(!s)return!1;if(t._preloadHash[a.src]||(t._preloadHash[a.src]=[]),t._preloadHash[a.src].push(a),1==t._preloadHash[a.src].length)s.on("complete",createjs.proxy(this._handleLoadComplete,this)),s.on("error",createjs.proxy(this._handleLoadError,this)),t.activePlugin.preload(s);else if(1==t._preloadHash[a.src][0])return!0;return a},t.registerSounds=function(e,t){var n=[];e.path&&(t?t+=e.path:t=e.path,e=e.manifest);for(var i=0,r=e.length;i<r;i++)n[i]=createjs.Sound.registerSound(e[i].src,e[i].id,e[i].data,t,e[i].defaultPlayProps);return n},t.removeSound=function(e,i){if(null==t.activePlugin)return!1;var r;if(e instanceof Object&&e.src&&(e=e.src),e instanceof Object?r=t._parseSrc(e):(e=t._getSrcById(e).src,r=t._parsePath(e)),null==r)return!1;for(var o in e=r.src,null!=i&&(e=i+e),t._idHash)t._idHash[o].src==e&&delete t._idHash[o];return n.removeSrc(e),delete t._preloadHash[e],t.activePlugin.removeSound(e),!0},t.removeSounds=function(e,t){var n=[];e.path&&(t?t+=e.path:t=e.path,e=e.manifest);for(var i=0,r=e.length;i<r;i++)n[i]=createjs.Sound.removeSound(e[i].src,t);return n},t.removeAllSounds=function(){t._idHash={},t._preloadHash={},n.removeAll(),t.activePlugin&&t.activePlugin.removeAllSounds()},t.loadComplete=function(e){if(!t.isReady())return!1;var n=t._parsePath(e);return e=n?t._getSrcById(n.src).src:t._getSrcById(e).src,void 0!=t._preloadHash[e]&&1==t._preloadHash[e][0]},t._parsePath=function(e){"string"!=typeof e&&(e=e.toString());var n=e.match(t.FILE_PATTERN);if(null==n)return!1;for(var i=n[4],r=n[5],o=t.capabilities,a=0;!o[r];)if(r=t.alternateExtensions[a++],a>t.alternateExtensions.length)return null;return{name:i,src:e=e.replace("."+n[5],"."+r),extension:r}},t._parseSrc=function(e){var n={name:void 0,src:void 0,extension:void 0},i=t.capabilities;for(var r in e)if(e.hasOwnProperty(r)&&i[r]){n.src=e[r],n.extension=r;break}if(!n.src)return!1;var o=n.src.lastIndexOf("/");return n.name=-1!=o?n.src.slice(o+1):n.src,n},t.play=function(e,n,i,r,o,a,s,l,c){var h;h=n instanceof Object||n instanceof createjs.PlayPropsConfig?createjs.PlayPropsConfig.create(n):createjs.PlayPropsConfig.create({interrupt:n,delay:i,offset:r,loop:o,volume:a,pan:s,startTime:l,duration:c});var u=t.createInstance(e,h.startTime,h.duration);return t._playInstance(u,h)||u._playFailed(),u},t.createInstance=function(e,i,r){if(!t.initializeDefaultPlugins())return new createjs.DefaultSoundInstance(e,i,r);var o=t._defaultPlayPropsHash[e];e=t._getSrcById(e);var a=t._parsePath(e.src),s=null;return null!=a&&null!=a.src?(n.create(a.src),null==i&&(i=e.startTime),s=t.activePlugin.create(a.src,i,r||e.duration),(o=o||t._defaultPlayPropsHash[a.src])&&s.applyPlayProps(o)):s=new createjs.DefaultSoundInstance(e,i,r),s.uniqueId=t._lastID++,s},t.stop=function(){for(var e=this._instances,t=e.length;t--;)e[t].stop()},t.setVolume=function(e){if(null==Number(e))return!1;if(e=Math.max(0,Math.min(1,e)),t._masterVolume=e,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(e))for(var n=this._instances,i=0,r=n.length;i<r;i++)n[i].setMasterVolume(e)},t.getVolume=function(){return this._masterVolume},t.setMute=function(e){if(null==e)return!1;if(this._masterMute=e,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(e))for(var t=this._instances,n=0,i=t.length;n<i;n++)t[n].setMasterMute(e);return!0},t.getMute=function(){return this._masterMute},t.setDefaultPlayProps=function(e,n){e=t._getSrcById(e),t._defaultPlayPropsHash[t._parsePath(e.src).src]=createjs.PlayPropsConfig.create(n)},t.getDefaultPlayProps=function(e){return e=t._getSrcById(e),t._defaultPlayPropsHash[t._parsePath(e.src).src]},t._playInstance=function(e,n){var i=t._defaultPlayPropsHash[e.src]||{};if(null==n.interrupt&&(n.interrupt=i.interrupt||t.defaultInterruptBehavior),null==n.delay&&(n.delay=i.delay||0),null==n.offset&&(n.offset=e.getPosition()),null==n.loop&&(n.loop=e.loop),null==n.volume&&(n.volume=e.volume),null==n.pan&&(n.pan=e.pan),0==n.delay){if(!t._beginPlaying(e,n))return!1}else{var r=setTimeout(function(){t._beginPlaying(e,n)},n.delay);e.delayTimeoutId=r}return this._instances.push(e),!0},t._beginPlaying=function(e,t){if(!n.add(e,t.interrupt))return!1;if(!e._beginPlaying(t)){var i=createjs.indexOf(this._instances,e);return i>-1&&this._instances.splice(i,1),!1}return!0},t._getSrcById=function(e){return t._idHash[e]||{src:e}},t._playFinished=function(e){n.remove(e);var t=createjs.indexOf(this._instances,e);t>-1&&this._instances.splice(t,1)},createjs.Sound=e,n.channels={},n.create=function(e,t){return null==n.get(e)&&(n.channels[e]=new n(e,t),!0)},n.removeSrc=function(e){var t=n.get(e);return null!=t&&(t._removeAll(),delete n.channels[e],!0)},n.removeAll=function(){for(var e in n.channels)n.channels[e]._removeAll();n.channels={}},n.add=function(e,t){var i=n.get(e.src);return null!=i&&i._add(e,t)},n.remove=function(e){var t=n.get(e.src);return null!=t&&(t._remove(e),!0)},n.maxPerChannel=function(){return i.maxDefault},n.get=function(e){return n.channels[e]};var i=n.prototype;i.constructor=n,i.src=null,i.max=null,i.maxDefault=100,i.length=0,i.init=function(e,t){this.src=e,this.max=t||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},i._get=function(e){return this._instances[e]},i._add=function(e,t){return!!this._getSlot(t,e)&&(this._instances.push(e),this.length++,!0)},i._remove=function(e){var t=createjs.indexOf(this._instances,e);return-1!=t&&(this._instances.splice(t,1),this.length--,!0)},i._removeAll=function(){for(var e=this.length-1;e>=0;e--)this._instances[e].stop()},i._getSlot=function(t,n){var i,r;if(t!=e.INTERRUPT_NONE&&null==(r=this._get(0)))return!0;for(var o=0,a=this.max;o<a;o++){if(null==(i=this._get(o)))return!0;if(i.playState==e.PLAY_FINISHED||i.playState==e.PLAY_INTERRUPTED||i.playState==e.PLAY_FAILED){r=i;break}t!=e.INTERRUPT_NONE&&((t==e.INTERRUPT_EARLY&&i.getPosition()<r.getPosition()||t==e.INTERRUPT_LATE&&i.getPosition()>r.getPosition())&&(r=i))}return null!=r&&(r._interrupt(),this._remove(r),!0)},i.toString=function(){return"[Sound SoundChannel]"}}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n,i){this.EventDispatcher_constructor(),this.src=e,this.uniqueId=-1,this.playState=null,this.delayTimeoutId=null,this._volume=1,Object.defineProperty(this,"volume",{get:this.getVolume,set:this.setVolume}),this._pan=0,Object.defineProperty(this,"pan",{get:this.getPan,set:this.setPan}),this._startTime=Math.max(0,t||0),Object.defineProperty(this,"startTime",{get:this.getStartTime,set:this.setStartTime}),this._duration=Math.max(0,n||0),Object.defineProperty(this,"duration",{get:this.getDuration,set:this.setDuration}),this._playbackResource=null,Object.defineProperty(this,"playbackResource",{get:this.getPlaybackResource,set:this.setPlaybackResource}),!1!==i&&!0!==i&&this.setPlaybackResource(i),this._position=0,Object.defineProperty(this,"position",{get:this.getPosition,set:this.setPosition}),this._loop=0,Object.defineProperty(this,"loop",{get:this.getLoop,set:this.setLoop}),this._muted=!1,Object.defineProperty(this,"muted",{get:this.getMuted,set:this.setMuted}),this._paused=!1,Object.defineProperty(this,"paused",{get:this.getPaused,set:this.setPaused})},t=createjs.extend(e,createjs.EventDispatcher);t.play=function(e,t,n,i,r,o){var a;return a=e instanceof Object||e instanceof createjs.PlayPropsConfig?createjs.PlayPropsConfig.create(e):createjs.PlayPropsConfig.create({interrupt:e,delay:t,offset:n,loop:i,volume:r,pan:o}),this.playState==createjs.Sound.PLAY_SUCCEEDED?(this.applyPlayProps(a),void(this._paused&&this.setPaused(!1))):(this._cleanUp(),createjs.Sound._playInstance(this,a),this)},t.stop=function(){return this._position=0,this._paused=!1,this._handleStop(),this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this},t.destroy=function(){this._cleanUp(),this.src=null,this.playbackResource=null,this.removeAllEventListeners()},t.applyPlayProps=function(e){return null!=e.offset&&this.setPosition(e.offset),null!=e.loop&&this.setLoop(e.loop),null!=e.volume&&this.setVolume(e.volume),null!=e.pan&&this.setPan(e.pan),null!=e.startTime&&(this.setStartTime(e.startTime),this.setDuration(e.duration)),this},t.toString=function(){return"[AbstractSoundInstance]"},t.getPaused=function(){return this._paused},t.setPaused=function(e){if(!(!0!==e&&!1!==e||this._paused==e||1==e&&this.playState!=createjs.Sound.PLAY_SUCCEEDED))return this._paused=e,e?this._pause():this._resume(),clearTimeout(this.delayTimeoutId),this},t.setVolume=function(e){return e==this._volume?this:(this._volume=Math.max(0,Math.min(1,e)),this._muted||this._updateVolume(),this)},t.getVolume=function(){return this._volume},t.setMuted=function(e){if(!0===e||!1===e)return this._muted=e,this._updateVolume(),this},t.getMuted=function(){return this._muted},t.setPan=function(e){return e==this._pan?this:(this._pan=Math.max(-1,Math.min(1,e)),this._updatePan(),this)},t.getPan=function(){return this._pan},t.getPosition=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||(this._position=this._calculateCurrentPosition()),this._position},t.setPosition=function(e){return this._position=Math.max(0,e),this.playState==createjs.Sound.PLAY_SUCCEEDED&&this._updatePosition(),this},t.getStartTime=function(){return this._startTime},t.setStartTime=function(e){return e==this._startTime?this:(this._startTime=Math.max(0,e||0),this._updateStartTime(),this)},t.getDuration=function(){return this._duration},t.setDuration=function(e){return e==this._duration?this:(this._duration=Math.max(0,e||0),this._updateDuration(),this)},t.setPlaybackResource=function(e){return this._playbackResource=e,0==this._duration&&this._setDurationFromSource(),this},t.getPlaybackResource=function(){return this._playbackResource},t.getLoop=function(){return this._loop},t.setLoop=function(e){null!=this._playbackResource&&(0!=this._loop&&0==e?this._removeLooping(e):0==this._loop&&0!=e&&this._addLooping(e)),this._loop=e},t._sendEvent=function(e){var t=new createjs.Event(e);this.dispatchEvent(t)},t._cleanUp=function(){clearTimeout(this.delayTimeoutId),this._handleCleanUp(),this._paused=!1,createjs.Sound._playFinished(this)},t._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._sendEvent("interrupted")},t._beginPlaying=function(e){return this.setPosition(e.offset),this.setLoop(e.loop),this.setVolume(e.volume),this.setPan(e.pan),null!=e.startTime&&(this.setStartTime(e.startTime),this.setDuration(e.duration)),null!=this._playbackResource&&this._position<this._duration?(this._paused=!1,this._handleSoundReady(),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._sendEvent("succeeded"),!0):(this._playFailed(),!1)},t._playFailed=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed")},t._handleSoundComplete=function(e){if(this._position=0,0!=this._loop)return this._loop--,this._handleLoop(),void this._sendEvent("loop");this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._sendEvent("complete")},t._handleSoundReady=function(){},t._updateVolume=function(){},t._updatePan=function(){},t._updateStartTime=function(){},t._updateDuration=function(){},t._setDurationFromSource=function(){},t._calculateCurrentPosition=function(){},t._updatePosition=function(){},t._removeLooping=function(e){},t._addLooping=function(e){},t._pause=function(){},t._resume=function(){},t._handleStop=function(){},t._handleCleanUp=function(){},t._handleLoop=function(){},createjs.AbstractSoundInstance=createjs.promote(e,"EventDispatcher"),createjs.DefaultSoundInstance=createjs.AbstractSoundInstance}(),this.createjs=this.createjs||{},function(){var e=function(){this._capabilities=null,this._loaders={},this._audioSources={},this._soundInstances={},this._volume=1,this._loaderClass,this._soundInstanceClass},t=e.prototype;e._capabilities=null,e.isSupported=function(){return!0},t.register=function(e){var t=this._loaders[e.src];return t&&!t.canceled?this._loaders[e.src]:(this._audioSources[e.src]=!0,this._soundInstances[e.src]=[],(t=new this._loaderClass(e)).on("complete",this._handlePreloadComplete,this),this._loaders[e.src]=t,t)},t.preload=function(e){e.on("error",this._handlePreloadError,this),e.load()},t.isPreloadStarted=function(e){return null!=this._audioSources[e]},t.isPreloadComplete=function(e){return!(null==this._audioSources[e]||1==this._audioSources[e])},t.removeSound=function(e){if(this._soundInstances[e]){for(var t=this._soundInstances[e].length;t--;){this._soundInstances[e][t].destroy()}delete this._soundInstances[e],delete this._audioSources[e],this._loaders[e]&&this._loaders[e].destroy(),delete this._loaders[e]}},t.removeAllSounds=function(){for(var e in this._audioSources)this.removeSound(e)},t.create=function(e,t,n){this.isPreloadStarted(e)||this.preload(this.register(e));var i=new this._soundInstanceClass(e,t,n,this._audioSources[e]);return this._soundInstances[e].push(i),i},t.setVolume=function(e){return this._volume=e,this._updateVolume(),!0},t.getVolume=function(){return this._volume},t.setMute=function(e){return this._updateVolume(),!0},t.toString=function(){return"[AbstractPlugin]"},t._handlePreloadComplete=function(e){var t=e.target.getItem().src;this._audioSources[t]=e.result;for(var n=0,i=this._soundInstances[t].length;n<i;n++){this._soundInstances[t][n].setPlaybackResource(this._audioSources[t])}},t._handlePreloadError=function(e){},t._updateVolume=function(){},createjs.AbstractPlugin=e}(),this.createjs=this.createjs||{},function(){function e(e){this.AbstractLoader_constructor(e,!0,createjs.AbstractLoader.SOUND)}var t=createjs.extend(e,createjs.AbstractLoader);e.context=null,t.toString=function(){return"[WebAudioLoader]"},t._createRequest=function(){this._request=new createjs.XHRRequest(this._item,!1),this._request.setResponseType("arraybuffer")},t._sendComplete=function(t){e.context.decodeAudioData(this._rawResult,createjs.proxy(this._handleAudioDecoded,this),createjs.proxy(this._sendError,this))},t._handleAudioDecoded=function(e){this._result=e,this.AbstractLoader__sendComplete()},createjs.WebAudioLoader=createjs.promote(e,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){function e(e,t,i,r){this.AbstractSoundInstance_constructor(e,t,i,r),this.gainNode=n.context.createGain(),this.panNode=n.context.createPanner(),this.panNode.panningModel=n._panningModel,this.panNode.connect(this.gainNode),this._updatePan(),this.sourceNode=null,this._soundCompleteTimeout=null,this._sourceNodeNext=null,this._playbackStartTime=0,this._endedHandler=createjs.proxy(this._handleSoundComplete,this)}var t=createjs.extend(e,createjs.AbstractSoundInstance),n=e;n.context=null,n._scratchBuffer=null,n.destinationNode=null,n._panningModel="equalpower",t.destroy=function(){this.AbstractSoundInstance_destroy(),this.panNode.disconnect(0),this.panNode=null,this.gainNode.disconnect(0),this.gainNode=null},t.toString=function(){return"[WebAudioSoundInstance]"},t._updatePan=function(){this.panNode.setPosition(this._pan,0,-.5)},t._removeLooping=function(e){this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)},t._addLooping=function(e){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},t._setDurationFromSource=function(){this._duration=1e3*this.playbackResource.duration},t._handleCleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout),this._playbackStartTime=0},t._cleanUpAudioNode=function(e){if(e){try{e.stop(0),e.disconnect(0)}catch(e){}try{e.buffer=n._scratchBuffer}catch(e){}e=null}return e},t._handleSoundReady=function(e){this.gainNode.connect(n.destinationNode);var t=.001*this._duration,i=.001*this._position;i>t&&(i=t),this.sourceNode=this._createAndPlayAudioNode((n.context.currentTime||0)-t,i),this._playbackStartTime=this.sourceNode.startTime-i,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(t-i)),0!=this._loop&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},t._createAndPlayAudioNode=function(e,t){var i=n.context.createBufferSource();i.buffer=this.playbackResource,i.connect(this.panNode);var r=.001*this._duration;return i.startTime=e+r,i.start(i.startTime,t+.001*this._startTime,r-t),i},t._pause=function(){this._position=1e3*(n.context.currentTime-this._playbackStartTime),this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout)},t._resume=function(){this._handleSoundReady()},t._updateVolume=function(){var e=this._muted?0:this._volume;e!=this.gainNode.gain.value&&(this.gainNode.gain.value=e)},t._calculateCurrentPosition=function(){return 1e3*(n.context.currentTime-this._playbackStartTime)},t._updatePosition=function(){this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout),this._paused||this._handleSoundReady()},t._handleLoop=function(){this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._playbackStartTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)},t._updateDuration=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._pause(),this._resume())},createjs.WebAudioSoundInstance=createjs.promote(e,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){function e(){this.AbstractPlugin_constructor(),this._panningModel=n._panningModel,this.context=n.context,this.dynamicsCompressorNode=this.context.createDynamicsCompressor(),this.dynamicsCompressorNode.connect(this.context.destination),this.gainNode=this.context.createGain(),this.gainNode.connect(this.dynamicsCompressorNode),createjs.WebAudioSoundInstance.destinationNode=this.gainNode,this._capabilities=n._capabilities,this._loaderClass=createjs.WebAudioLoader,this._soundInstanceClass=createjs.WebAudioSoundInstance,this._addPropsToClasses()}var t=createjs.extend(e,createjs.AbstractPlugin),n=e;n._capabilities=null,n._panningModel="equalpower",n.context=null,n._scratchBuffer=null,n._unlocked=!1,n.isSupported=function(){var e=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;return!("file:"==location.protocol&&!e&&!this._isFileXHRSupported())&&(n._generateCapabilities(),null!=n.context)},n.playEmptySound=function(){if(null!=n.context){var e=n.context.createBufferSource();e.buffer=n._scratchBuffer,e.connect(n.context.destination),e.start(0,0,0)}},n._isFileXHRSupported=function(){var e=!0,t=new XMLHttpRequest;try{t.open("GET","WebAudioPluginTest.fail",!1)}catch(t){return e=!1}t.onerror=function(){e=!1},t.onload=function(){e=404==this.status||200==this.status||0==this.status&&""!=this.response};try{t.send()}catch(t){e=!1}return e},n._generateCapabilities=function(){if(null==n._capabilities){var e=document.createElement("audio");if(null==e.canPlayType)return null;if(null==n.context)if(window.AudioContext)n.context=new AudioContext;else{if(!window.webkitAudioContext)return null;n.context=new webkitAudioContext}null==n._scratchBuffer&&(n._scratchBuffer=n.context.createBuffer(1,1,22050)),n._compatibilitySetUp(),"ontouchstart"in window&&"running"!=n.context.state&&(n._unlock(),document.addEventListener("mousedown",n._unlock,!0),document.addEventListener("touchend",n._unlock,!0)),n._capabilities={panning:!0,volume:!0,tracks:-1};for(var t=createjs.Sound.SUPPORTED_EXTENSIONS,i=createjs.Sound.EXTENSION_MAP,r=0,o=t.length;r<o;r++){var a=t[r],s=i[a]||a;n._capabilities[a]="no"!=e.canPlayType("audio/"+a)&&""!=e.canPlayType("audio/"+a)||"no"!=e.canPlayType("audio/"+s)&&""!=e.canPlayType("audio/"+s)}n.context.destination.numberOfChannels<2&&(n._capabilities.panning=!1)}},n._compatibilitySetUp=function(){if(n._panningModel="equalpower",!n.context.createGain){n.context.createGain=n.context.createGainNode;var e=n.context.createBufferSource();e.__proto__.start=e.__proto__.noteGrainOn,e.__proto__.stop=e.__proto__.noteOff,n._panningModel=0}},n._unlock=function(){n._unlocked||(n.playEmptySound(),"running"==n.context.state&&(document.removeEventListener("mousedown",n._unlock,!0),document.removeEventListener("touchend",n._unlock,!0),n._unlocked=!0))},t.toString=function(){return"[WebAudioPlugin]"},t._addPropsToClasses=function(){var e=this._soundInstanceClass;e.context=this.context,e._scratchBuffer=n._scratchBuffer,e.destinationNode=this.gainNode,e._panningModel=this._panningModel,this._loaderClass.context=this.context},t._updateVolume=function(){var e=createjs.Sound._masterMute?0:this._volume;e!=this.gainNode.gain.value&&(this.gainNode.gain.value=e)},createjs.WebAudioPlugin=createjs.promote(e,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){function e(){throw"HTMLAudioTagPool cannot be instantiated"}var t=e;function n(e){this._tags=[]}t._tags={},t._tagPool=new n,t._tagUsed={},t.get=function(e){var n=t._tags[e];return null==n?(n=t._tags[e]=t._tagPool.get()).src=e:t._tagUsed[e]?(n=t._tagPool.get()).src=e:t._tagUsed[e]=!0,n},t.set=function(e,n){n==t._tags[e]?t._tagUsed[e]=!1:t._tagPool.set(n)},t.remove=function(e){var n=t._tags[e];return null!=n&&(t._tagPool.set(n),delete t._tags[e],delete t._tagUsed[e],!0)},t.getDuration=function(e){var n=t._tags[e];return null!=n&&n.duration?1e3*n.duration:0},createjs.HTMLAudioTagPool=e;var i=n.prototype;i.constructor=n,i.get=function(){var e;return null==(e=0==this._tags.length?this._createTag():this._tags.pop()).parentNode&&document.body.appendChild(e),e},i.set=function(e){-1==createjs.indexOf(this._tags,e)&&(this._tags.src=null,this._tags.push(e))},i.toString=function(){return"[TagPool]"},i._createTag=function(){var e=document.createElement("audio");return e.autoplay=!1,e.preload="none",e}}(),this.createjs=this.createjs||{},function(){function e(e,t,n,i){this.AbstractSoundInstance_constructor(e,t,n,i),this._audioSpriteStopTime=null,this._delayTimeoutId=null,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleTagReady,this),this._stalledHandler=createjs.proxy(this._playFailed,this),this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this),this._loopHandler=createjs.proxy(this._handleSoundComplete,this),n?this._audioSpriteStopTime=.001*(t+n):this._duration=createjs.HTMLAudioTagPool.getDuration(this.src)}var t=createjs.extend(e,createjs.AbstractSoundInstance);t.setMasterVolume=function(e){this._updateVolume()},t.setMasterMute=function(e){this._updateVolume()},t.toString=function(){return"[HTMLAudioSoundInstance]"},t._removeLooping=function(){null!=this._playbackResource&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},t._addLooping=function(){null==this._playbackResource||this._audioSpriteStopTime||(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)},t._handleCleanUp=function(){var e=this._playbackResource;if(null!=e){e.pause(),e.loop=!1,e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1);try{e.currentTime=this._startTime}catch(e){}createjs.HTMLAudioTagPool.set(this.src,e),this._playbackResource=null}},t._beginPlaying=function(e){return this._playbackResource=createjs.HTMLAudioTagPool.get(this.src),this.AbstractSoundInstance__beginPlaying(e)},t._handleSoundReady=function(e){if(4!==this._playbackResource.readyState){var t=this._playbackResource;return t.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),t.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),t.preload="auto",void t.load()}this._updateVolume(),this._playbackResource.currentTime=.001*(this._startTime+this._position),this._audioSpriteStopTime?this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1):(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),0!=this._loop&&(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)),this._playbackResource.play()},t._handleTagReady=function(e){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),this._handleSoundReady()},t._pause=function(){this._playbackResource.pause()},t._resume=function(){this._playbackResource.play()},t._updateVolume=function(){if(null!=this._playbackResource){var e=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;e!=this._playbackResource.volume&&(this._playbackResource.volume=e)}},t._calculateCurrentPosition=function(){return 1e3*this._playbackResource.currentTime-this._startTime},t._updatePosition=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1);try{this._playbackResource.currentTime=.001*(this._position+this._startTime)}catch(e){this._handleSetPositionSeek(null)}},t._handleSetPositionSeek=function(e){null!=this._playbackResource&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},t._handleAudioSpriteLoop=function(e){this._playbackResource.currentTime<=this._audioSpriteStopTime||(this._playbackResource.pause(),0==this._loop?this._handleSoundComplete(null):(this._position=0,this._loop--,this._playbackResource.currentTime=.001*this._startTime,this._paused||this._playbackResource.play(),this._sendEvent("loop")))},t._handleLoop=function(e){0==this._loop&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},t._updateStartTime=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},t._updateDuration=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},t._setDurationFromSource=function(){this._duration=createjs.HTMLAudioTagPool.getDuration(this.src),this._playbackResource=null},createjs.HTMLAudioSoundInstance=createjs.promote(e,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){function e(){this.AbstractPlugin_constructor(),this.defaultNumChannels=2,this._capabilities=n._capabilities,this._loaderClass=createjs.SoundLoader,this._soundInstanceClass=createjs.HTMLAudioSoundInstance}var t=createjs.extend(e,createjs.AbstractPlugin),n=e;n.MAX_INSTANCES=30,n._AUDIO_READY="canplaythrough",n._AUDIO_ENDED="ended",n._AUDIO_SEEKED="seeked",n._AUDIO_STALLED="stalled",n._TIME_UPDATE="timeupdate",n._capabilities=null,n.isSupported=function(){return n._generateCapabilities(),null!=n._capabilities},n._generateCapabilities=function(){if(null==n._capabilities){var e=document.createElement("audio");if(null==e.canPlayType)return null;n._capabilities={panning:!1,volume:!0,tracks:-1};for(var t=createjs.Sound.SUPPORTED_EXTENSIONS,i=createjs.Sound.EXTENSION_MAP,r=0,o=t.length;r<o;r++){var a=t[r],s=i[a]||a;n._capabilities[a]="no"!=e.canPlayType("audio/"+a)&&""!=e.canPlayType("audio/"+a)||"no"!=e.canPlayType("audio/"+s)&&""!=e.canPlayType("audio/"+s)}}},t.register=function(e){var t=createjs.HTMLAudioTagPool.get(e.src),n=this.AbstractPlugin_register(e);return n.setTag(t),n},t.removeSound=function(e){this.AbstractPlugin_removeSound(e),createjs.HTMLAudioTagPool.remove(e)},t.create=function(e,t,n){var i=this.AbstractPlugin_create(e,t,n);return i.setPlaybackResource(null),i},t.toString=function(){return"[HTMLAudioPlugin]"},t.setVolume=t.getVolume=t.setMute=null,createjs.HTMLAudioPlugin=createjs.promote(e,"AbstractPlugin")}();var HANDJS=HANDJS||{};!function(){if(!window.PointerEvent){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=Object(this),n=t.length>>>0;if(0===n)return-1;var i=0;if(arguments.length>0&&((i=Number(arguments[1]))!=i?i=0:0!=i&&i!=1/0&&i!=-1/0&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=n)return-1;for(var r=i>=0?i:Math.max(n-Math.abs(i),0);r<n;r++)if(r in t&&t[r]===e)return r;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if(!(this&&e instanceof Function))throw new TypeError;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/,"")});var e=["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","pointerenter","pointerleave"],t=["PointerDown","PointerUp","PointerMove","PointerOver","PointerOut","PointerCancel","PointerEnter","PointerLeave"],n="touch",i="mouse",r={},o=function(e){for(;e&&!e.handjs_forcePreventDefault;)e=e.parentNode;return!!e||window.handjs_forcePreventDefault},a=function(e,t,r,o,a){var s;if(document.createEvent?(s=document.createEvent("MouseEvents")).initMouseEvent(t,r,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,a||e.relatedTarget):((s=document.createEventObject()).screenX=e.screenX,s.screenY=e.screenY,s.clientX=e.clientX,s.clientY=e.clientY,s.ctrlKey=e.ctrlKey,s.altKey=e.altKey,s.shiftKey=e.shiftKey,s.metaKey=e.metaKey,s.button=e.button,s.relatedTarget=a||e.relatedTarget),void 0===s.offsetX&&(void 0!==e.offsetX?(Object&&void 0!==Object.defineProperty&&(Object.defineProperty(s,"offsetX",{writable:!0}),Object.defineProperty(s,"offsetY",{writable:!0})),s.offsetX=e.offsetX,s.offsetY=e.offsetY):Object&&void 0!==Object.defineProperty?(Object.defineProperty(s,"offsetX",{get:function(){return this.currentTarget&&this.currentTarget.offsetLeft?e.clientX-this.currentTarget.offsetLeft:e.clientX}}),Object.defineProperty(s,"offsetY",{get:function(){return this.currentTarget&&this.currentTarget.offsetTop?e.clientY-this.currentTarget.offsetTop:e.clientY}})):void 0!==e.layerX&&(s.offsetX=e.layerX-e.currentTarget.offsetLeft,s.offsetY=e.layerY-e.currentTarget.offsetTop)),void 0!==e.isPrimary?s.isPrimary=e.isPrimary:s.isPrimary=!0,e.pressure)s.pressure=e.pressure;else{var l=0;void 0!==e.which?l=e.which:void 0!==e.button&&(l=e.button),s.pressure=0==l?0:.5}if(e.rotation?s.rotation=e.rotation:s.rotation=0,e.hwTimestamp?s.hwTimestamp=e.hwTimestamp:s.hwTimestamp=0,e.tiltX?s.tiltX=e.tiltX:s.tiltX=0,e.tiltY?s.tiltY=e.tiltY:s.tiltY=0,e.height?s.height=e.height:s.height=0,e.width?s.width=e.width:s.width=0,s.preventDefault=function(){void 0!==e.preventDefault&&e.preventDefault()},void 0!==s.stopPropagation){var c=s.stopPropagation;s.stopPropagation=function(){void 0!==e.stopPropagation&&e.stopPropagation(),c.call(this)}}switch(s.pointerId=e.pointerId,s.pointerType=e.pointerType,s.pointerType){case 2:s.pointerType=n;break;case 3:s.pointerType="pen";break;case 4:s.pointerType=i}o?o.dispatchEvent(s):e.target?e.target.dispatchEvent(s):e.srcElement.fireEvent("on"+d(t),s)},s=function(e,t,n,r,o){e.pointerId=1,e.pointerType=i,a(e,t,n,r,o)},l=function(e,t,i,r,o,s){var l=t.identifier+2;t.pointerId=l,t.pointerType=n,t.currentTarget=i,void 0!==r.preventDefault&&(t.preventDefault=function(){r.preventDefault()}),a(t,e,o,i,s)},c=function(e,t){return e.__handjsGlobalRegisteredEvents&&e.__handjsGlobalRegisteredEvents[t]},h=function(e,t){for(;e&&!c(e,t);)e=e.parentNode;return e||(c(window,t)?window:void 0)},u=function(e,t,n,i,r,o){h(n,e)&&l(e,t,n,i,r,o)},d=function(e){return e.toLowerCase().replace("pointer","mouse")},p=function(n,i){var r=e.indexOf(i);return n+t[r]},f=function(e,t,n){if(e.__handjsGlobalRegisteredEvents||(e.__handjsGlobalRegisteredEvents=[]),n){if(void 0!==e.__handjsGlobalRegisteredEvents[t])return void e.__handjsGlobalRegisteredEvents[t]++;e.__handjsGlobalRegisteredEvents[t]=1}else void 0!==e.__handjsGlobalRegisteredEvents[t]&&(e.__handjsGlobalRegisteredEvents[t]--,e.__handjsGlobalRegisteredEvents[t]<0&&(e.__handjsGlobalRegisteredEvents[t]=0));var i,r;switch(window.MSPointerEvent?(i=function(e){return p("MS",e)},r=a):(i=d,r=s),t){case"pointerenter":case"pointerleave":var o=i(t);void 0!==e["on"+o.toLowerCase()]&&function(e,t,n,i){if(void 0===e.__handjsRegisteredEvents&&(e.__handjsRegisteredEvents=[]),i){if(void 0!==e.__handjsRegisteredEvents[t])return void e.__handjsRegisteredEvents[t]++;e.__handjsRegisteredEvents[t]=1,e.addEventListener(t,n,!1)}else{if(-1!==e.__handjsRegisteredEvents.indexOf(t)&&(e.__handjsRegisteredEvents[t]--,0!=e.__handjsRegisteredEvents[t]))return;e.removeEventListener(t,n),e.__handjsRegisteredEvents[t]=0}}(e,o,function(e){r(e,t)},n)}},E=function(t){var n=t.prototype?t.prototype.addEventListener:t.addEventListener,i=function(t,i,r){-1!=e.indexOf(t)&&f(this,t,!0),void 0===n?this.attachEvent("on"+d(t),i):n.call(this,t,i,r)};t.prototype?t.prototype.addEventListener=i:t.addEventListener=i},m=function(t){var n=t.prototype?t.prototype.removeEventListener:t.removeEventListener,i=function(t,i,r){-1!=e.indexOf(t)&&f(this,t,!1),void 0===n?this.detachEvent(d(t),i):n.call(this,t,i,r)};t.prototype?t.prototype.removeEventListener=i:t.removeEventListener=i};E(window),E(window.HTMLElement||window.Element),E(document),E(HTMLBodyElement),E(HTMLDivElement),E(HTMLImageElement),E(HTMLUListElement),E(HTMLAnchorElement),E(HTMLLIElement),E(HTMLTableElement),window.HTMLSpanElement&&E(HTMLSpanElement),window.HTMLCanvasElement&&E(HTMLCanvasElement),window.SVGElement&&E(SVGElement),m(window),m(window.HTMLElement||window.Element),m(document),m(HTMLBodyElement),m(HTMLDivElement),m(HTMLImageElement),m(HTMLUListElement),m(HTMLAnchorElement),m(HTMLLIElement),m(HTMLTableElement),window.HTMLSpanElement&&m(HTMLSpanElement),window.HTMLCanvasElement&&m(HTMLCanvasElement),window.SVGElement&&m(SVGElement);var g=!1,v=-1;window.MSPointerEvent?x(function(e){return p("MS",e)},a):(x(d,s),void 0!==window.ontouchstart&&(window.addEventListener("touchstart",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t];r[n.identifier]=n.target,u("pointerover",n,n.target,e,!0),R(n.target,null,function(t){l("pointerenter",n,t,e,!1)}),u("pointerdown",n,n.target,e,!0)}y()}),window.addEventListener("touchend",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t],i=r[n.identifier];u("pointerup",n,i,e,!0),u("pointerout",n,i,e,!0),b(i,null,function(t){l("pointerleave",n,t,e,!1)})}y()}),window.addEventListener("touchmove",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t],i=document.elementFromPoint(n.clientX,n.clientY),a=r[n.identifier];a&&!0===o(a)&&e.preventDefault(),u("pointermove",n,a,e,!0),a!==i&&(a&&(u("pointerout",n,a,e,!0,i),a.contains(i)||b(a,i,function(t){l("pointerleave",n,t,e,!1,i)})),i&&(u("pointerover",n,i,e,!0,a),i.contains(a)||R(i,a,function(t){l("pointerenter",n,t,e,!1,a)})),r[n.identifier]=i)}y()}),window.addEventListener("touchcancel",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t];u("pointercancel",n,r[n.identifier],e,!0)}}))),void 0===navigator.pointerEnabled&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&(navigator.maxTouchPoints=navigator.msMaxTouchPoints)),document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){if(!HANDJS.doNotProcessCSS&&void 0===document.body.style.touchAction){var e=new RegExp(".+?{.*?}","m"),t=new RegExp(".+?{","m"),n=function(n){var i=e.exec(n);if(i){var r=i[0];n=n.replace(r,"").trim();var o=t.exec(r)[0].replace("{","").trim();if(-1!=r.replace(/\s/g,"").indexOf("touch-action:none"))for(var a=document.querySelectorAll(o),s=0;s<a.length;s++){var l=a[s];void 0!==l.style.msTouchAction?l.style.msTouchAction="none":l.handjs_forcePreventDefault=!0}return n}},i=function(e){if(window.setImmediate)e&&setImmediate(i,n(e));else for(;e;)e=n(e)};try{for(var r=0;r<document.styleSheets.length;r++){var o=document.styleSheets[r];if(void 0!=o.href){var a=new XMLHttpRequest;a.open("get",o.href),a.send();var s=a.responseText.replace(/(\n|\r)/g,"");i(s)}}}catch(e){}var l=document.getElementsByTagName("style");for(r=0;r<l.length;r++){var c=l[r].innerHTML.replace(/(\n|\r)/g,"").trim();i(c)}}},!1)}function y(){g=!0,clearTimeout(v),v=setTimeout(function(){g=!1},700)}function T(e){var t=[];if(e)for(t.unshift(e);e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}function _(e,t){for(var n=T(e),i=T(t),r=null;n.length>0&&n[0]==i.shift();)r=n.shift();return r}function R(e,t,n){for(var i=_(e,t),r=e,o=[];r&&r!=i;)c(r,"pointerenter")&&o.push(r),r=r.parentNode;for(;o.length>0;)n(o.pop())}function b(e,t,n){for(var i=_(e,t),r=e;r&&r!=i;)c(r,"pointerleave")&&n(r),r=r.parentNode}function x(e,t){["pointerdown","pointermove","pointerup","pointerover","pointerout"].forEach(function(n){window.addEventListener(e(n),function(e){!g&&h(e.target,n)&&t(e,n,!0)})}),void 0===window["on"+e("pointerenter").toLowerCase()]&&window.addEventListener(e("pointerover"),function(e){if(!g){var n=h(e.target,"pointerenter");n&&n!==window&&(n.contains(e.relatedTarget)||R(n,e.relatedTarget,function(n){t(e,"pointerenter",!1,n,e.relatedTarget)}))}}),void 0===window["on"+e("pointerleave").toLowerCase()]&&window.addEventListener(e("pointerout"),function(e){if(!g){var n=h(e.target,"pointerleave");n&&n!==window&&(n.contains(e.relatedTarget)||b(n,e.relatedTarget,function(n){t(e,"pointerleave",!1,n,e.relatedTarget)}))}})}}(),void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var e=[];return{REVISION:"14",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)},update:function(t){if(0===e.length)return!1;var n=0;for(t=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();n<e.length;)e[n].update(t)?n++:e.splice(n,1);return!0}}}();TWEEN.Tween=function(e){var t=e,n={},i={},r={},o=1e3,a=0,s=!1,l=!1,c=!1,h=0,u=null,d=TWEEN.Easing.Linear.None,p=TWEEN.Interpolation.Linear,f=[],E=null,m=!1,g=null,v=null,y=null;for(var T in e)n[T]=parseFloat(e[T],10);this.to=function(e,t){return void 0!==t&&(o=t),i=e,this},this.start=function(e){for(var o in TWEEN.add(this),l=!0,m=!1,u=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),u+=h,i){if(i[o]instanceof Array){if(0===i[o].length)continue;i[o]=[t[o]].concat(i[o])}n[o]=t[o],n[o]instanceof Array==!1&&(n[o]*=1),r[o]=n[o]||0}return this},this.stop=function(){return l?(TWEEN.remove(this),l=!1,null!==y&&y.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=f.length;e<t;e++)f[e].stop()},this.delay=function(e){return h=e,this},this.repeat=function(e){return a=e,this},this.yoyo=function(e){return s=e,this},this.easing=function(e){return d=e,this},this.interpolation=function(e){return p=e,this},this.chain=function(){return f=arguments,this},this.onStart=function(e){return E=e,this},this.onUpdate=function(e){return g=e,this},this.onComplete=function(e){return v=e,this},this.onStop=function(e){return y=e,this},this.update=function(e){var l;if(e<u)return!0;!1===m&&(null!==E&&E.call(t),m=!0);var y=(e-u)/o,T=d(y=y>1?1:y);for(l in i){var _=n[l]||0,R=i[l];R instanceof Array?t[l]=p(R,T):("string"==typeof R&&(R=_+parseFloat(R,10)),"number"==typeof R&&(t[l]=_+(R-_)*T))}if(null!==g&&g.call(t,T),1==y){if(a>0){for(l in isFinite(a)&&a--,r){if("string"==typeof i[l]&&(r[l]=r[l]+parseFloat(i[l],10)),s){var b=r[l];r[l]=i[l],i[l]=b}n[l]=r[l]}return s&&(c=!c),u=e+h,!0}null!==v&&v.call(t);for(var x=0,w=f.length;x<w;x++)f[x].start(e);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},Out:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},InOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),o=TWEEN.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],i):t>1?o(e[n],e[n-1],n-i):o(e[r],e[r+1>n?n:r+1],i-r)},Bezier:function(e,t){var n,i=0,r=e.length-1,o=Math.pow,a=TWEEN.Interpolation.Utils.Bernstein;for(n=0;n<=r;n++)i+=o(1-t,r-n)*o(t,n)*e[n]*a(r,n);return i},CatmullRom:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(r=Math.floor(i=n*(1+t))),o(e[(r-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],i-r)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[n]-(o(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):o(e[r?r-1:0],e[r],e[n<r+1?n:r+1],e[n<r+2?n:r+2],i-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=TWEEN.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n,i=1;if(e[t])return e[t];for(n=t;n>1;n--)i*=n;return e[t]=i}}(),CatmullRom:function(e,t,n,i,r){var o=.5*(n-e),a=.5*(i-t),s=r*r;return(2*t-2*n+o+a)*(r*s)+(-3*t+3*n-2*o-a)*s+o*r+t}}},"undefined"!=typeof module&&module.exports&&(module.exports=TWEEN);var THREE={REVISION:"71"};if("object"==typeof module&&(module.exports=THREE),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),THREE.log=function(){window.console&&window.console.log&&console.log.apply(console,arguments)},THREE.warn=function(){window.console&&window.console.log&&console.warn.apply(console,arguments)},THREE.error=function(){window.console&&window.console.log&&console.error.apply(console,arguments)},THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.MinEquation=103,THREE.MaxEquation=104,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=300,THREE.CubeReflectionMapping=301,THREE.CubeRefractionMapping=302,THREE.EquirectangularReflectionMapping=303,THREE.EquirectangularRefractionMapping=304,THREE.SphericalReflectionMapping=305,THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.HalfFloatType=1025,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGBEFormat=THREE.RGBAFormat,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.RGB_PVRTC_4BPPV1_Format=2100,THREE.RGB_PVRTC_2BPPV1_Format=2101,THREE.RGBA_PVRTC_4BPPV1_Format=2102,THREE.RGBA_PVRTC_2BPPV1_Format=2103,THREE.Projector=function(){THREE.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){THREE.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){THREE.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){THREE.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},THREE.CanvasRenderer=function(){THREE.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},THREE.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var i=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e},r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=i(o,r,e+1/3),this.g=i(o,r,e),this.b=i(o,r,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(THREE.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,n,i=e||{h:0,s:0,l:0},r=this.r,o=this.g,a=this.b,s=Math.max(r,o,a),l=Math.min(r,o,a),c=(l+s)/2;if(l===s)t=0,n=0;else{var h=s-l;switch(n=c<=.5?h/(s+l):h/(2-s-l),s){case r:t=(o-a)/h+(o<a?6:0);break;case o:t=(a-r)/h+2;break;case a:t=(r-o)/h+4}t/=6}return i.h=t,i.s=n,i.l=c,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=n,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==i?i:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof THREE.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(e._x/2),i=Math.cos(e._y/2),r=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*i*r+n*a*s,this._y=n*a*r-o*i*s,this._z=n*i*s+o*a*r,this._w=n*i*r-o*a*s):"YXZ"===e.order?(this._x=o*i*r+n*a*s,this._y=n*a*r-o*i*s,this._z=n*i*s-o*a*r,this._w=n*i*r+o*a*s):"ZXY"===e.order?(this._x=o*i*r-n*a*s,this._y=n*a*r+o*i*s,this._z=n*i*s+o*a*r,this._w=n*i*r-o*a*s):"ZYX"===e.order?(this._x=o*i*r-n*a*s,this._y=n*a*r+o*i*s,this._z=n*i*s-o*a*r,this._w=n*i*r+o*a*s):"YZX"===e.order?(this._x=o*i*r+n*a*s,this._y=n*a*r+o*i*s,this._z=n*i*s-o*a*r,this._w=n*i*r-o*a*s):"XZY"===e.order&&(this._x=o*i*r-n*a*s,this._y=n*a*r-o*i*s,this._z=n*i*s+o*a*r,this._w=n*i*r+o*a*s),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],l=n[9],c=n[2],h=n[6],u=n[10],d=i+s+u;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(h-l)*t,this._y=(o-c)*t,this._z=(a-r)*t):i>s&&i>u?(t=2*Math.sqrt(1+i-s-u),this._w=(h-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+c)/t):s>u?(t=2*Math.sqrt(1+s-i-u),this._w=(o-c)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+h)/t):(t=2*Math.sqrt(1+u-i-s),this._w=(a-r)/t,this._x=(o+c)/t,this._y=(l+h)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t;return function(n,i){return void 0===e&&(e=new THREE.Vector3),(t=n.dot(i)+1)<1e-6?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,i),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+o*a+i*l-r*s,this._y=i*c+o*s+r*a-n*l,this._z=r*c+o*l+n*s-i*a,this._w=o*c-n*a-i*s-r*l,this.onChangeCallback(),this},multiplyVector3:function(e){return THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var c=Math.sin((1-t)*s)/l,h=Math.sin(t*s)/l;return this._w=o*c+this._w*h,this._x=n*c+this._x*h,this._y=i*c+this._y*h,this._z=r*c+this._z*h,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(e,t,n,i){return n.copy(e).slerp(t,i)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},sub:function(e,t){return void 0!==t?(THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(n,i){return void 0===e&&(e=new THREE.Vector2,t=new THREE.Vector2),e.set(n,n),t.set(i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof THREE.Euler==!1&&THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,n){return void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,n)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12],this.y=r[1]*t+r[5]*n+r[9]*i+r[13],this.z=r[2]*t+r[6]*n+r[10]*i+r[14],this},applyProjection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,c=s*n+a*t-r*i,h=s*i+r*n-o*t,u=-r*t-o*n-a*i;return this.x=l*s+u*-r+c*-a-h*-o,this.y=c*s+u*-o+h*-r-l*-a,this.z=h*s+u*-a+l*-o-c*-r,this},project:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(n,i){return void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(n,n,n),t.set(i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},cross:function(e,t){if(void 0!==t)return THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this},projectOnVector:function(){var e,t;return function(n){return void 0===e&&(e=new THREE.Vector3),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},setEulerFromRotationMatrix:function(e,t){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){var n=4*e,i=t.elements;return this.x=i[n],this.y=i[n+1],this.z=i[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,r,o=.01,a=e.elements,s=a[0],l=a[4],c=a[8],h=a[1],u=a[5],d=a[9],p=a[2],f=a[6],E=a[10];if(Math.abs(l-h)<o&&Math.abs(c-p)<o&&Math.abs(d-f)<o){if(Math.abs(l+h)<.1&&Math.abs(c+p)<.1&&Math.abs(d+f)<.1&&Math.abs(s+u+E-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(s+1)/2,g=(u+1)/2,v=(E+1)/2,y=(l+h)/4,T=(c+p)/4,_=(d+f)/4;return m>g&&m>v?m<o?(n=0,i=.707106781,r=.707106781):(i=y/(n=Math.sqrt(m)),r=T/n):g>v?g<o?(n=.707106781,i=0,r=.707106781):(n=y/(i=Math.sqrt(g)),r=_/i):v<o?(n=.707106781,i=.707106781,r=0):(n=T/(r=Math.sqrt(v)),i=_/r),this.set(n,i,r,t),this}var R=Math.sqrt((f-d)*(f-d)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(R)<.001&&(R=1),this.x=(f-d)/R,this.y=(c-p)/R,this.z=(h-l)/R,this.w=Math.acos((s+u+E-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(n,i){return void 0===e&&(e=new THREE.Vector4,t=new THREE.Vector4),e.set(n,n,n,n),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=THREE.Math.clamp,r=e.elements,o=r[0],a=r[4],s=r[8],l=r[1],c=r[5],h=r[9],u=r[2],d=r[6],p=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-h,p),this._y=0)):THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,n,i){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,i),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new THREE.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,i){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var r=t.dot(t),o=t.dot(e)/r;return i&&(o=THREE.Math.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t),r=n||new THREE.Vector3;return this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(1/0,1/0),this.max=void 0!==t?t:new THREE.Vector2(-1/0,-1/0)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new THREE.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new THREE.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-1/0,-1/0,-1/0)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var n=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var i=t.geometry;if(void 0!==i)if(i instanceof THREE.Geometry)for(var r=i.vertices,o=0,a=r.length;o<a;o++)e.copy(r[o]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e);else if(i instanceof THREE.BufferGeometry&&void 0!==i.attributes.position){var s=i.attributes.position.array;for(o=0,a=s.length;o<a;o+=3)e.set(s[o],s[o+1],s[o+2]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new THREE.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new THREE.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var n=t||new THREE.Sphere;return n.center=this.center(),n.radius=.5*this.size(e).length(),n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,n,i,r,o,a,s,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=n,c[1]=i,c[4]=r,c[7]=o,c[2]=a,c[5]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,n,i){void 0===n&&(n=0),void 0===i&&(i=t.length);for(var r=0,o=n;r<i;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix3(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-n*r*c+n*a*s+i*r*l-i*o*s},getInverse:function(e,t){var n=e.elements,i=this.elements;i[0]=n[10]*n[5]-n[6]*n[9],i[1]=-n[10]*n[1]+n[2]*n[9],i[2]=n[6]*n[1]-n[2]*n[5],i[3]=-n[10]*n[4]+n[6]*n[8],i[4]=n[10]*n[0]-n[2]*n[8],i[5]=-n[6]*n[0]+n[2]*n[4],i[6]=n[9]*n[4]-n[5]*n[8],i[7]=-n[9]*n[0]+n[1]*n[8],i[8]=n[5]*n[0]-n[1]*n[4];var r=n[0]*i[0]+n[1]*i[3]+n[2]*i[6];if(0===r){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return THREE.warn(o),this.identity(),this}return this.multiplyScalar(1/r),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}},THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,i,r,o,a,s,l,c,h,u,d,p,f,E){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=i,m[1]=r,m[5]=o,m[9]=a,m[13]=s,m[2]=l,m[6]=c,m[10]=h,m[14]=u,m[3]=d,m[7]=p,m[11]=f,m[15]=E,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){var i=this.elements;return e.set(i[0],i[1],i[2]),t.set(i[4],i[5],i[6]),n.set(i[8],i[9],i[10]),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var n=this.elements,i=t.elements,r=1/e.set(i[0],i[1],i[2]).length(),o=1/e.set(i[4],i[5],i[6]).length(),a=1/e.set(i[8],i[9],i[10]).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[4]=i[4]*o,n[5]=i[5]*o,n[6]=i[6]*o,n[8]=i[8]*a,n[9]=i[9]*a,n[10]=i[10]*a,this}}(),makeRotationFromEuler:function(e){e instanceof THREE.Euler==!1&&THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){var u=o*c,d=o*h,p=a*c,f=a*h;t[0]=s*c,t[4]=-s*h,t[8]=l,t[1]=d+p*l,t[5]=u-f*l,t[9]=-a*s,t[2]=f-u*l,t[6]=p+d*l,t[10]=o*s}else if("YXZ"===e.order){var E=s*c,m=s*h,g=l*c,v=l*h;t[0]=E+v*a,t[4]=g*a-m,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-a,t[2]=m*a-g,t[6]=v+E*a,t[10]=o*s}else if("ZXY"===e.order){E=s*c,m=s*h,g=l*c,v=l*h;t[0]=E-v*a,t[4]=-o*h,t[8]=g+m*a,t[1]=m+g*a,t[5]=o*c,t[9]=v-E*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){u=o*c,d=o*h,p=a*c,f=a*h;t[0]=s*c,t[4]=p*l-d,t[8]=u*l+f,t[1]=s*h,t[5]=f*l+u,t[9]=d*l-p,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var y=o*s,T=o*l,_=a*s,R=a*l;t[0]=s*c,t[4]=R-y*h,t[8]=_*h+T,t[1]=h,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=T*h+_,t[10]=y-R*h}else if("XZY"===e.order){y=o*s,T=o*l,_=a*s,R=a*l;t[0]=s*c,t[4]=-h,t[8]=l*c,t[1]=y*h+R,t[5]=o*c,t[9]=T*h-_,t[2]=_*h-T,t[6]=a*c,t[10]=R*h+y}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z,o=e.w,a=n+n,s=i+i,l=r+r,c=n*a,h=n*s,u=n*l,d=i*s,p=i*l,f=r*l,E=o*a,m=o*s,g=o*l;return t[0]=1-(d+f),t[4]=h-g,t[8]=u+m,t[1]=h+g,t[5]=1-(c+f),t[9]=p-E,t[2]=u-m,t[6]=p+E,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(i,r,o){var a=this.elements;return n.subVectors(i,r).normalize(),0===n.length()&&(n.z=1),e.crossVectors(o,n).normalize(),0===e.length()&&(n.x+=1e-4,e.crossVectors(o,n).normalize()),t.crossVectors(n,e),a[0]=e.x,a[4]=t.x,a[8]=n.x,a[1]=e.y,a[5]=t.y,a[9]=n.y,a[2]=e.z,a[6]=t.z,a[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],f=n[6],E=n[10],m=n[14],g=n[3],v=n[7],y=n[11],T=n[15],_=i[0],R=i[4],b=i[8],x=i[12],w=i[1],M=i[5],L=i[9],S=i[13],H=i[2],I=i[6],A=i[10],C=i[14],O=i[3],P=i[7],G=i[11],D=i[15];return r[0]=o*_+a*w+s*H+l*O,r[4]=o*R+a*M+s*I+l*P,r[8]=o*b+a*L+s*A+l*G,r[12]=o*x+a*S+s*C+l*D,r[1]=c*_+h*w+u*H+d*O,r[5]=c*R+h*M+u*I+d*P,r[9]=c*b+h*L+u*A+d*G,r[13]=c*x+h*S+u*C+d*D,r[2]=p*_+f*w+E*H+m*O,r[6]=p*R+f*M+E*I+m*P,r[10]=p*b+f*L+E*A+m*G,r[14]=p*x+f*S+E*C+m*D,r[3]=g*_+v*w+y*H+T*O,r[7]=g*R+v*M+y*I+T*P,r[11]=g*b+v*L+y*A+T*G,r[15]=g*x+v*S+y*C+T*D,this},multiplyToArray:function(e,t,n){var i=this.elements;return this.multiplyMatrices(e,t),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,n,i){void 0===n&&(n=0),void 0===i&&(i=t.length);for(var r=0,o=n;r<i;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),rotateAxis:function(e){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*s*h-i*l*h-r*a*u+n*l*u+i*a*d-n*s*d)+e[7]*(+t*s*d-t*l*u+r*o*u-i*o*d+i*l*c-r*s*c)+e[11]*(+t*l*h-t*a*d-r*o*h+n*o*d+r*a*c-n*l*c)+e[15]*(-i*a*c-t*s*h+t*a*u+i*o*h-n*o*u+n*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],o=i[4],a=i[8],s=i[12],l=i[1],c=i[5],h=i[9],u=i[13],d=i[2],p=i[6],f=i[10],E=i[14],m=i[3],g=i[7],v=i[11],y=i[15];n[0]=h*E*g-u*f*g+u*p*v-c*E*v-h*p*y+c*f*y,n[4]=s*f*g-a*E*g-s*p*v+o*E*v+a*p*y-o*f*y,n[8]=a*u*g-s*h*g+s*c*v-o*u*v-a*c*y+o*h*y,n[12]=s*h*p-a*u*p-s*c*f+o*u*f+a*c*E-o*h*E,n[1]=u*f*m-h*E*m-u*d*v+l*E*v+h*d*y-l*f*y,n[5]=a*E*m-s*f*m+s*d*v-r*E*v-a*d*y+r*f*y,n[9]=s*h*m-a*u*m-s*l*v+r*u*v+a*l*y-r*h*y,n[13]=a*u*d-s*h*d+s*l*f-r*u*f-a*l*E+r*h*E,n[2]=c*E*m-u*p*m+u*d*g-l*E*g-c*d*y+l*p*y,n[6]=s*p*m-o*E*m-s*d*g+r*E*g+o*d*y-r*p*y,n[10]=o*u*m-s*c*m+s*l*g-r*u*g-o*l*y+r*c*y,n[14]=s*c*d-o*u*d-s*l*p+r*u*p+o*l*E-r*c*E,n[3]=h*p*m-c*f*m-h*d*g+l*f*g+c*d*v-l*p*v,n[7]=o*f*m-a*p*m+a*d*g-r*f*g-o*d*v+r*p*v,n[11]=a*c*m-o*h*m-a*l*g+r*h*g+o*l*v-r*c*v,n[15]=o*h*d-a*c*d+a*l*p-r*h*p-o*l*f+r*c*f;var T=r*n[0]+l*n[4]+d*n[8]+m*n[12];if(0==T){var _="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(_);return THREE.warn(_),this.identity(),this}return this.multiplyScalar(1/T),this},translate:function(e){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,i)))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,c=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,c*a+n,c*s-i*o,0,l*s-i*a,c*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new THREE.Vector3,t=new THREE.Matrix4;return function(n,i,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),n.x=o[12],n.y=o[13],n.z=o[14],t.elements.set(this.elements);var c=1/a,h=1/s,u=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=h,t.elements[5]*=h,t.elements[6]*=h,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,i.setFromRotationMatrix(t),r.x=a,r.y=s,r.z=l,this}}(),makeFrustum:function(e,t,n,i,r,o){var a=this.elements,s=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),u=-(o+r)/(o-r),d=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,n,i){var r=n*Math.tan(THREE.Math.degToRad(.5*e)),o=-r,a=o*t,s=r*t;return this.makeFrustum(a,s,o,r,n,i)},makeOrthographic:function(e,t,n,i,r,o){var a=this.elements,s=t-e,l=n-i,c=o-r,h=(t+e)/s,u=(n+i)/l,d=(o+r)/c;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new THREE.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new THREE.Vector3;n.subVectors(e,this.origin);var i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(i,r,o,a){e.copy(i).add(r).multiplyScalar(.5),t.copy(r).sub(i).normalize(),n.copy(this.origin).sub(e);var s,l,c,h,u=.5*i.distanceTo(r),d=-this.direction.dot(t),p=n.dot(this.direction),f=-n.dot(t),E=n.lengthSq(),m=Math.abs(1-d*d);if(m>0)if(l=d*p-f,h=u*m,(s=d*f-p)>=0)if(l>=-h)if(l<=h){var g=1/m;c=(s*=g)*(s+d*(l*=g)+2*p)+l*(d*s+l+2*f)+E}else l=u,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+E;else l=-u,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+E;else l<=-h?c=-(s=Math.max(0,-(-d*u+p)))*s+(l=s>0?-u:Math.min(Math.max(-u,-f),u))*(l+2*f)+E:l<=h?(s=0,c=(l=Math.min(Math.max(-u,-f),u))*(l+2*f)+E):c=-(s=Math.max(0,-(d*u+p)))*s+(l=s>0?u:Math.min(Math.max(-u,-f),u))*(l+2*f)+E;else l=d>0?-u:u,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+E;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(t).multiplyScalar(l).add(e),c}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new THREE.Vector3;return function(t,n){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),r=e.dot(e)-i*i,o=t.radius*t.radius;if(r>o)return null;var a=Math.sqrt(o-r),s=i-a,l=i+a;return s<0&&l<0?null:s<0?this.at(l,n):this.at(s,n)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var n,i,r,o,a,s,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(e.min.x-u.x)*l,i=(e.max.x-u.x)*l):(n=(e.max.x-u.x)*l,i=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,o=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,o=(e.min.y-u.y)*c),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),h>=0?(a=(e.min.z-u.z)*h,s=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,s=(e.min.z-u.z)*h),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3;return function(r,o,a,s,l){t.subVectors(o,r),n.subVectors(a,r),i.crossVectors(t,n);var c,h=this.direction.dot(i);if(h>0){if(s)return null;c=1}else{if(!(h<0))return null;c=-1,h=-h}e.subVectors(this.origin,r);var u=c*this.direction.dot(n.crossVectors(e,n));if(u<0)return null;var d=c*this.direction.dot(t.cross(e));if(d<0)return null;if(u+d>h)return null;var p=-c*e.dot(i);return p<0?null:this.at(p/h,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,n){var i=this.center;void 0!==n?i.copy(n):e.setFromPoints(t).center(i);for(var r=0,o=0,a=t.length;o<a;o++)r=Math.max(r,i.distanceToSquared(t[o]));return this.radius=Math.sqrt(r),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),i=t||new THREE.Vector3;return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,n,i,r,o){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==o?o:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,n,i,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],h=n[7],u=n[8],d=n[9],p=n[10],f=n[11],E=n[12],m=n[13],g=n[14],v=n[15];return t[0].setComponents(a-i,h-s,f-u,v-E).normalize(),t[1].setComponents(a+i,h+s,f+u,v+E).normalize(),t[2].setComponents(a+r,h+l,f+d,v+m).normalize(),t[3].setComponents(a-r,h-l,f-d,v-m).normalize(),t[4].setComponents(a-o,h-c,f-p,v-g).normalize(),t[5].setComponents(a+o,h+c,f+p,v+g).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){for(var i=this.planes,r=0;r<6;r++){var o=i[r];e.x=o.normal.x>0?n.min.x:n.max.x,t.x=o.normal.x>0?n.max.x:n.min.x,e.y=o.normal.y>0?n.min.y:n.max.y,t.y=o.normal.y>0?n.max.y:n.min.y,e.z=o.normal.z>0?n.min.z:n.max.z,t.z=o.normal.z>0?n.max.z:n.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(a<0&&s<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,i,r){var o=e.subVectors(r,i).cross(t.subVectors(n,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e);return(t||new THREE.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,n){var i=n||new THREE.Vector3,r=t.delta(e),o=this.normal.dot(r);if(0==o)return 0==this.distanceToPoint(t.start)?i.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/o;return a<0||a>1?void 0:i.copy(r).multiplyScalar(a).add(t.start)}}(),coplanarPoint:function(e){return(e||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Matrix3;return function(i,r){var o=r||n.getNormalMatrix(i),a=e.copy(this.normal).applyMatrix3(o),s=this.coplanarPoint(t);return s.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(a,s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),i=0;return function(){for(var r=0;r<36;r++)8==r||13==r||18==r||23==r?n[r]="-":14==r?n[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,n[r]=t[19==r?3&e|8:e]);return n.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},THREE.Spline=function(e){this.points=e;var t,n,i,r,o,a,s,l,c,h=[],u={x:0,y:0,z:0};function d(e,t,n,i,r,o,a){var s=.5*(n-e),l=.5*(i-t);return(2*(t-n)+s+l)*a+(-3*(t-n)-2*s-l)*o+s*r+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,n=Math.floor(t),i=t-n,h[0]=0===n?n:n-1,h[1]=n,h[2]=n>this.points.length-2?this.points.length-1:n+1,h[3]=n>this.points.length-3?this.points.length-1:n+2,a=this.points[h[0]],s=this.points[h[1]],l=this.points[h[2]],c=this.points[h[3]],o=i*(r=i*i),u.x=d(a.x,s.x,l.x,c.x,i,r,o),u.y=d(a.y,s.y,l.y,c.y,i,r,o),u.z=d(a.z,s.z,l.z,c.z,i,r,o),u},this.getControlPointsArray=function(){var e,t,n=this.points.length,i=[];for(e=0;e<n;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,n,i,r,o=0,a=0,s=0,l=new THREE.Vector3,c=new THREE.Vector3,h=[],u=0;for(h[0]=0,e||(e=100),i=this.points.length*e,l.copy(this.points[0]),t=1;t<i;t++)n=t/i,r=this.getPoint(n),c.copy(r),u+=c.distanceTo(l),l.copy(r),o=(this.points.length-1)*n,(a=Math.floor(o))!=s&&(h[a]=u,s=a);return h[h.length]=u,{chunks:h,total:u}},this.reparametrizeByArcLength=function(e){var t,n,i,r,o,a,s,l,c=[],h=new THREE.Vector3,u=this.getLength();for(c.push(h.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*a/u.total),r=(t-1)/(this.points.length-1),o=t/(this.points.length-1),n=1;n<s-1;n++)i=r+n*(1/s)*(o-r),l=this.getPoint(i),c.push(h.copy(l).clone());c.push(h.copy(this.points[t]).clone())}this.points=c}},THREE.Triangle=function(e,t,n){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==n?n:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,n,i,r){var o=r||new THREE.Vector3;o.subVectors(i,n),e.subVectors(t,n),o.cross(e);var a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(i,r,o,a,s){e.subVectors(a,r),t.subVectors(o,r),n.subVectors(i,r);var l=e.dot(e),c=e.dot(t),h=e.dot(n),u=t.dot(t),d=t.dot(n),p=l*u-c*c,f=s||new THREE.Vector3;if(0==p)return f.set(-2,-1,-1);var E=1/p,m=(u*h-c*d)*E,g=(l*d-c*h)*E;return f.set(1-m-g,g,m)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,n,i,r){var o=THREE.Triangle.barycoordFromPoint(t,n,i,r,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=[],i=t.length,r=0;r<i;r++)n[r]=t[r];for(r=0;r<i;r++)n[r].call(this,e)}}}},function(e){e.Raycaster=function(t,n,i,r){this.ray=new e.Ray(t,n),this.near=i||0,this.far=r||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance},n=function(e,t,i,r){if(e.raycast(t,i),!0===r)for(var o=e.children,a=0,s=o.length;a<s;a++)n(o[a],t,i,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,n){n instanceof e.PerspectiveCamera?(this.ray.origin.copy(n.position),this.ray.direction.set(t.x,t.y,.5).unproject(n).sub(n.position).normalize()):n instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld)):e.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,i){var r=[];return n(e,this,r,i),r.sort(t),r},intersectObjects:function(i,r){var o=[];if(i instanceof Array==!1)return e.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var a=0,s=i.length;a<s;a++)n(i[a],this,o,r);return o.sort(t),o}}}(THREE),THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=THREE.Object3D.DefaultUp.clone();var e=new THREE.Vector3,t=new THREE.Euler,n=new THREE.Quaternion,i=new THREE.Vector3(1,1,1);t.onChange(function(){n.setFromEuler(t,!1)}),n.onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:i}}),this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0),THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){return THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,t){return THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof THREE.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var n=this.children.indexOf(e);-1!==n&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getChildByName:function(e){return THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){var t=e||new THREE.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){var i=n||new THREE.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldRotation:function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Euler;return this.getWorldQuaternion(e),n.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new THREE.Vector3,t=new THREE.Quaternion;return function(n){var i=n||new THREE.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Vector3;return this.getWorldQuaternion(e),n.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverseVisible(e)}},traverseAncestors:function(e){this.parent&&(e(this.parent),this.parent.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},n={},i=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===n[t.uuid]){var i=t.toJSON();delete i.metadata,n[t.uuid]=i,e.materials.push(i)}return t.uuid},r=function(n){var o={};if(o.uuid=n.uuid,o.type=n.type,""!==n.name&&(o.name=n.name),"{}"!==JSON.stringify(n.userData)&&(o.userData=n.userData),!0!==n.visible&&(o.visible=n.visible),n instanceof THREE.PerspectiveCamera?(o.fov=n.fov,o.aspect=n.aspect,o.near=n.near,o.far=n.far):n instanceof THREE.OrthographicCamera?(o.left=n.left,o.right=n.right,o.top=n.top,o.bottom=n.bottom,o.near=n.near,o.far=n.far):n instanceof THREE.AmbientLight?o.color=n.color.getHex():n instanceof THREE.DirectionalLight?(o.color=n.color.getHex(),o.intensity=n.intensity):n instanceof THREE.PointLight?(o.color=n.color.getHex(),o.intensity=n.intensity,o.distance=n.distance,o.decay=n.decay):n instanceof THREE.SpotLight?(o.color=n.color.getHex(),o.intensity=n.intensity,o.distance=n.distance,o.angle=n.angle,o.exponent=n.exponent,o.decay=n.decay):n instanceof THREE.HemisphereLight?(o.color=n.color.getHex(),o.groundColor=n.groundColor.getHex()):n instanceof THREE.Mesh||n instanceof THREE.Line||n instanceof THREE.PointCloud?(o.geometry=function(n){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[n.uuid]){var i=n.toJSON();delete i.metadata,t[n.uuid]=i,e.geometries.push(i)}return n.uuid}(n.geometry),o.material=i(n.material),n instanceof THREE.Line&&(o.mode=n.mode)):n instanceof THREE.Sprite&&(o.material=i(n.material)),o.matrix=n.matrix.toArray(),n.children.length>0){o.children=[];for(var a=0;a<n.children.length;a++)o.children.push(r(n.children[a]))}return o};return e.object=r(this),e},clone:function(e,t){if(void 0===e&&(e=new THREE.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),!0===t)for(var n=0;n<this.children.length;n++){var i=this.children[n];e.add(i.clone())}return e}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Face3=function(e,t,n,i,r,o){this.a=e,this.b=t,this.c=n,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=r instanceof THREE.Color?r:new THREE.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,n,i,r,o,a){return THREE.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,n,r,o,a)},THREE.BufferAttribute=function(e,t){this.array=e,this.itemSize=t,this.needsUpdate=!1},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},THREE.Int8Attribute=function(e,t){return THREE.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Uint8Attribute=function(e,t){return THREE.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Uint8ClampedAttribute=function(e,t){return THREE.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Int16Attribute=function(e,t){return THREE.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Uint16Attribute=function(e,t){return THREE.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Int32Attribute=function(e,t){return THREE.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Uint32Attribute=function(e,t){return THREE.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Float32Attribute=function(e,t){return THREE.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Float64Attribute=function(e,t){return THREE.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.DynamicBufferAttribute=function(e,t){THREE.BufferAttribute.call(this,e,t),this.updateRange={offset:0,count:-1}},THREE.DynamicBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.DynamicBufferAttribute.prototype.constructor=THREE.DynamicBufferAttribute,THREE.DynamicBufferAttribute.prototype.clone=function(){return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)},THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,t){if(t instanceof THREE.BufferAttribute==!1)return THREE.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]});this.attributes[e]=t,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,n){this.drawcalls.push({start:e,count:t,index:void 0!==n?n:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new THREE.Matrix3).getNormalMatrix(e).applyToVector3Array(n.array),n.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new THREE.Matrix4).setPosition(e)),e},fromGeometry:function(e,t){t=t||{vertexColors:THREE.NoColors};var n=e.vertices,i=e.faces,r=e.faceVertexUvs,o=t.vertexColors,a=r[0].length>0,s=3==i[0].vertexNormals.length,l=new Float32Array(3*i.length*3);this.addAttribute("position",new THREE.BufferAttribute(l,3));var c=new Float32Array(3*i.length*3);if(this.addAttribute("normal",new THREE.BufferAttribute(c,3)),o!==THREE.NoColors){var h=new Float32Array(3*i.length*3);this.addAttribute("color",new THREE.BufferAttribute(h,3))}if(!0===a){var u=new Float32Array(3*i.length*2);this.addAttribute("uv",new THREE.BufferAttribute(u,2))}for(var d=0,p=0,f=0;d<i.length;d++,p+=6,f+=9){var E=i[d],m=n[E.a],g=n[E.b],v=n[E.c];if(l[f]=m.x,l[f+1]=m.y,l[f+2]=m.z,l[f+3]=g.x,l[f+4]=g.y,l[f+5]=g.z,l[f+6]=v.x,l[f+7]=v.y,l[f+8]=v.z,!0===s){var y=E.vertexNormals[0],T=E.vertexNormals[1],_=E.vertexNormals[2];c[f]=y.x,c[f+1]=y.y,c[f+2]=y.z,c[f+3]=T.x,c[f+4]=T.y,c[f+5]=T.z,c[f+6]=_.x,c[f+7]=_.y,c[f+8]=_.z}else{var R=E.normal;c[f]=R.x,c[f+1]=R.y,c[f+2]=R.z,c[f+3]=R.x,c[f+4]=R.y,c[f+5]=R.z,c[f+6]=R.x,c[f+7]=R.y,c[f+8]=R.z}if(o===THREE.FaceColors){var b=E.color;h[f]=b.r,h[f+1]=b.g,h[f+2]=b.b,h[f+3]=b.r,h[f+4]=b.g,h[f+5]=b.b,h[f+6]=b.r,h[f+7]=b.g,h[f+8]=b.b}else if(o===THREE.VertexColors){var x=E.vertexColors[0],w=E.vertexColors[1],M=E.vertexColors[2];h[f]=x.r,h[f+1]=x.g,h[f+2]=x.b,h[f+3]=w.r,h[f+4]=w.g,h[f+5]=w.b,h[f+6]=M.r,h[f+7]=M.g,h[f+8]=M.b}if(!0===a){var L=r[0][d][0],S=r[0][d][1],H=r[0][d][2];u[p]=L.x,u[p+1]=L.y,u[p+2]=S.x,u[p+3]=S.y,u[p+4]=H.x,u[p+5]=H.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var e=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var t=this.attributes.position.array;if(t){var n=this.boundingBox;n.makeEmpty();for(var i=0,r=t.length;i<r;i+=3)e.set(t[i],t[i+1],t[i+2]),n.expandByPoint(e)}void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();for(var i=this.boundingSphere.center,r=0,o=n.length;r<o;r+=3)t.set(n[r],n[r+1],n[r+2]),e.expandByPoint(t);e.center(i);var a=0;for(r=0,o=n.length;r<o;r+=3)t.set(n[r],n[r+1],n[r+2]),a=Math.max(a,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(t.length),3));else for(var n=0,i=(s=e.normal.array).length;n<i;n++)s[n]=0;var r,o,a,s=e.normal.array,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,u=new THREE.Vector3,d=new THREE.Vector3;if(e.index)for(var p=e.index.array,f=this.offsets.length>0?this.offsets:[{start:0,count:p.length,index:0}],E=0,m=f.length;E<m;++E){var g=f[E].start,v=f[E].count,y=f[E].index;for(n=g,i=g+v;n<i;n+=3)r=3*(y+p[n]),o=3*(y+p[n+1]),a=3*(y+p[n+2]),l.fromArray(t,r),c.fromArray(t,o),h.fromArray(t,a),u.subVectors(h,c),d.subVectors(l,c),u.cross(d),s[r]+=u.x,s[r+1]+=u.y,s[r+2]+=u.z,s[o]+=u.x,s[o+1]+=u.y,s[o+2]+=u.z,s[a]+=u.x,s[a+1]+=u.y,s[a+2]+=u.z}else for(n=0,i=t.length;n<i;n+=9)l.fromArray(t,n),c.fromArray(t,n+3),h.fromArray(t,n+6),u.subVectors(h,c),d.subVectors(l,c),u.cross(d),s[n]=u.x,s[n+1]=u.y,s[n+2]=u.z,s[n+3]=u.x,s[n+4]=u.y,s[n+5]=u.z,s[n+6]=u.x,s[n+7]=u.y,s[n+8]=u.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,n=this.attributes.normal.array,i=this.attributes.uv.array,r=t.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*r),4));for(var o=this.attributes.tangent.array,a=[],s=[],l=0;l<r;l++)a[l]=new THREE.Vector3,s[l]=new THREE.Vector3;var c,h,u,d,p,f,E,m,g,v,y,T,_,R,b,x,w,M,L=new THREE.Vector3,S=new THREE.Vector3,H=new THREE.Vector3,I=new THREE.Vector2,A=new THREE.Vector2,C=new THREE.Vector2,O=new THREE.Vector3,P=new THREE.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,e.length,0);var G,D,k,B=this.drawcalls;for(R=0,b=B.length;R<b;++R){var N=B[R].start,j=B[R].count,F=B[R].index;for(T=N,_=N+j;T<_;T+=3)x=F+e[T],w=F+e[T+1],M=F+e[T+2],G=x,D=w,k=M,L.fromArray(t,3*G),S.fromArray(t,3*D),H.fromArray(t,3*k),I.fromArray(i,2*G),A.fromArray(i,2*D),C.fromArray(i,2*k),c=S.x-L.x,h=H.x-L.x,u=S.y-L.y,d=H.y-L.y,p=S.z-L.z,f=H.z-L.z,E=A.x-I.x,m=C.x-I.x,g=A.y-I.y,v=C.y-I.y,y=1/(E*v-m*g),O.set((v*c-g*h)*y,(v*u-g*d)*y,(v*p-g*f)*y),P.set((E*h-m*c)*y,(E*d-m*u)*y,(E*f-m*p)*y),a[G].add(O),a[D].add(O),a[k].add(O),s[G].add(P),s[D].add(P),s[k].add(P)}var U,V,z,W=new THREE.Vector3,q=new THREE.Vector3,X=new THREE.Vector3,K=new THREE.Vector3;for(R=0,b=B.length;R<b;++R){N=B[R].start,j=B[R].count,F=B[R].index;for(T=N,_=N+j;T<_;T+=3)x=F+e[T],w=F+e[T+1],M=F+e[T+2],Y(x),Y(w),Y(M)}}else THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function Y(e){X.fromArray(n,3*e),K.copy(X),V=a[e],W.copy(V),W.sub(X.multiplyScalar(X.dot(V))).normalize(),q.crossVectors(K,V),z=q.dot(s[e]),U=z<0?-1:1,o[4*e]=W.x,o[4*e+1]=W.y,o[4*e+2]=W.z,o[4*e+3]=U}},computeOffsets:function(e){void 0===e&&(e=65535);for(var t=this.attributes.index.array,n=this.attributes.position.array,i=t.length/3,r=new Uint16Array(t.length),o=0,a=0,s=[{start:0,count:0,index:0}],l=s[0],c=0,h=new Int32Array(6),u=new Int32Array(n.length),d=new Int32Array(n.length),p=0;p<n.length;p++)u[p]=-1,d[p]=-1;for(var f=0;f<i;f++){c=0;for(var E=0;E<3;E++){-1==u[y=t[3*f+E]]?(h[2*E]=y,h[2*E+1]=-1,c++):u[y]<l.index?(h[2*E]=y,h[2*E+1]=-1,0):(h[2*E]=y,h[2*E+1]=u[y])}if(a+c>l.index+e){var m={start:o,count:0,index:a};s.push(m),l=m;for(var g=0;g<6;g+=2){(v=h[g+1])>-1&&v<l.index&&(h[g+1]=-1)}}for(g=0;g<6;g+=2){var v,y=h[g];-1===(v=h[g+1])&&(v=a++),u[y]=v,d[v]=y,r[o++]=v-l.index,l.count++}}return this.reorderBuffers(r,d,a),this.offsets=s,this.drawcalls=s,s},merge:function(e,t){if(e instanceof THREE.BufferGeometry!=!1){void 0===t&&(t=0);var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,o=e.attributes[i],a=o.array,s=0,l=o.itemSize*t;s<a.length;s++,l++)r[l]=a[s];return this}THREE.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e,t,n,i,r=this.attributes.normal.array,o=0,a=r.length;o<a;o+=3)e=r[o],t=r[o+1],n=r[o+2],i=1/Math.sqrt(e*e+t*t+n*n),r[o]*=i,r[o+1]*=i,r[o+2]*=i},reorderBuffers:function(e,t,n){var i={};for(var r in this.attributes)if("index"!=r){var o=this.attributes[r].array;i[r]=new o.constructor(this.attributes[r].itemSize*n)}for(var a=0;a<n;a++){var s=t[a];for(var r in this.attributes)if("index"!=r)for(var l=this.attributes[r].array,c=this.attributes[r].itemSize,h=i[r],u=0;u<c;u++)h[a*c+u]=l[s*c+u]}for(var r in this.attributes.index.array=e,this.attributes)"index"!=r&&(this.attributes[r].array=i[r],this.attributes[r].numItems=this.attributes[r].itemSize*n)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,n=this.offsets,i=this.boundingSphere;for(var r in t){var o=t[r],a=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:a}}return n.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(n))),null!==i&&(e.data.boundingSphere={center:i.center.toArray(),radius:i.radius}),e},clone:function(){var e=new THREE.BufferGeometry;for(var t in this.attributes){var n=this.attributes[t];e.addAttribute(t,n.clone())}for(var i=0,r=this.offsets.length;i<r;i++){var o=this.offsets[i];e.offsets.push({start:o.start,index:o.index,count:o.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++){this.vertices[n].applyMatrix4(e)}for(n=0,i=this.faces.length;n<i;n++){var r=this.faces[n];r.normal.applyMatrix3(t).normalize();for(var o=0,a=r.vertexNormals.length;o<a;o++)r.vertexNormals[o].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},fromBufferGeometry:function(e){for(var t=this,n=e.attributes,i=n.position.array,r=void 0!==n.index?n.index.array:void 0,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=[],c=[],h=0,u=0;h<i.length;h+=3,u+=2)t.vertices.push(new THREE.Vector3(i[h],i[h+1],i[h+2])),void 0!==o&&l.push(new THREE.Vector3(o[h],o[h+1],o[h+2])),void 0!==a&&t.colors.push(new THREE.Color(a[h],a[h+1],a[h+2])),void 0!==s&&c.push(new THREE.Vector2(s[u],s[u+1]));var d=function(e,n,i){var r=void 0!==o?[l[e].clone(),l[n].clone(),l[i].clone()]:[],h=void 0!==a?[t.colors[e].clone(),t.colors[n].clone(),t.colors[i].clone()]:[];t.faces.push(new THREE.Face3(e,n,i,r,h)),void 0!==s&&t.faceVertexUvs[0].push([c[e].clone(),c[n].clone(),c[i].clone()])};if(void 0!==r){var p=e.drawcalls;if(p.length>0)for(h=0;h<p.length;h++)for(var f=p[h],E=f.start,m=f.count,g=f.index,v=(u=E,E+m);u<v;u+=3)d(g+r[u],g+r[u+1],g+r[u+2]);else for(h=0;h<r.length;h+=3)d(r[h],r[h+1],r[h+2])}else for(h=0;h<i.length/3;h+=3)d(h,h+1,h+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new THREE.Matrix4).setPosition(e)),e},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,n=0,i=this.faces.length;n<i;n++){var r=this.faces[n],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,r,o,a;for(a=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)a[t]=new THREE.Vector3;if(e){var s,l,c,h=new THREE.Vector3,u=new THREE.Vector3;for(i=0,r=this.faces.length;i<r;i++)o=this.faces[i],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],h.subVectors(c,l),u.subVectors(s,l),h.cross(u),a[o.a].add(h),a[o.b].add(h),a[o.c].add(h)}else for(i=0,r=this.faces.length;i<r;i++)a[(o=this.faces[i]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)a[t].normalize();for(i=0,r=this.faces.length;i<r;i++)(o=this.faces[i]).vertexNormals[0]=a[o.a].clone(),o.vertexNormals[1]=a[o.b].clone(),o.vertexNormals[2]=a[o.c].clone()},computeMorphNormals:function(){var e,t,n,i,r;for(n=0,i=this.faces.length;n<i;n++)for((r=this.faces[n]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var o=new THREE.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)l=new THREE.Vector3,c={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},a.push(l),s.push(c)}var l,c,h=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)r=this.faces[n],l=h.faceNormals[n],c=h.vertexNormals[n],l.copy(r.normal),c.a.copy(r.vertexNormals[0]),c.b.copy(r.vertexNormals[1]),c.c.copy(r.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(r=this.faces[n]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeTangents:function(){var e,t,n,i,r,o,a,s,l,c,h,u,d,p,f,E,m,g,v,y,T,_,R,b,x,w,M,L,S,H,I,A,C,O,P=[],G=[],D=new THREE.Vector3,k=new THREE.Vector3,B=new THREE.Vector3,N=new THREE.Vector3,j=new THREE.Vector3;for(n=0,i=this.vertices.length;n<i;n++)P[n]=new THREE.Vector3,G[n]=new THREE.Vector3;for(e=0,t=this.faces.length;e<t;e++)a=this.faces[e],s=this.faceVertexUvs[0][e],L=this,S=a.a,H=a.b,I=a.c,A=0,C=1,O=2,l=L.vertices[S],c=L.vertices[H],h=L.vertices[I],u=s[A],d=s[C],p=s[O],f=c.x-l.x,E=h.x-l.x,m=c.y-l.y,g=h.y-l.y,v=c.z-l.z,y=h.z-l.z,T=d.x-u.x,_=p.x-u.x,R=d.y-u.y,b=p.y-u.y,x=1/(T*b-_*R),D.set((b*f-R*E)*x,(b*m-R*g)*x,(b*v-R*y)*x),k.set((T*E-_*f)*x,(T*g-_*m)*x,(T*y-_*v)*x),P[S].add(D),P[H].add(D),P[I].add(D),G[S].add(k),G[H].add(k),G[I].add(k);var F=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(a=this.faces[e],r=0;r<Math.min(a.vertexNormals.length,3);r++)j.copy(a.vertexNormals[r]),o=a[F[r]],w=P[o],B.copy(w),B.sub(j.multiplyScalar(j.dot(w))).normalize(),N.crossVectors(a.vertexNormals[r],w),M=N.dot(G[o])<0?-1:1,a.vertexTangents[r]=new THREE.Vector4(B.x,B.y,B.z,M);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,i=t.length;n<i;n++)n>0&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e instanceof THREE.Geometry!=!1){var i,r=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],h=e.faceVertexUvs[0];void 0===n&&(n=0),void 0!==t&&(i=(new THREE.Matrix3).getNormalMatrix(t));for(var u=0,d=a.length;u<d;u++){var p=a[u].clone();void 0!==t&&p.applyMatrix4(t),o.push(p)}for(u=0,d=l.length;u<d;u++){var f,E,m,g=l[u],v=g.vertexNormals,y=g.vertexColors;(f=new THREE.Face3(g.a+r,g.b+r,g.c+r)).normal.copy(g.normal),void 0!==i&&f.normal.applyMatrix3(i).normalize();for(var T=0,_=v.length;T<_;T++)E=v[T].clone(),void 0!==i&&E.applyMatrix3(i).normalize(),f.vertexNormals.push(E);f.color.copy(g.color);for(T=0,_=y.length;T<_;T++)m=y[T],f.vertexColors.push(m.clone());f.materialIndex=g.materialIndex+n,s.push(f)}for(u=0,d=h.length;u<d;u++){var R=h[u],b=[];if(void 0!==R){for(T=0,_=R.length;T<_;T++)b.push(R[T].clone());c.push(b)}}}else THREE.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e instanceof THREE.Mesh!=!1?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):THREE.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,i,r,o,a,s,l={},c=[],h=[],u=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],void 0===l[t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u)]?(l[t]=n,c.push(this.vertices[n]),h[n]=c.length-1):h[n]=h[l[t]];var d=[];for(n=0,i=this.faces.length;n<i;n++){(r=this.faces[n]).a=h[r.a],r.b=h[r.b],r.c=h[r.c],o=[r.a,r.b,r.c];for(var p=0;p<3;p++)if(o[p]==o[(p+1)%3]){p,d.push(n);break}}for(n=d.length-1;n>=0;n--){var f=d[n];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var E=this.vertices.length-c.length;return this.vertices=c,E},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var i=[],r=0;r<this.vertices.length;r++){var o=this.vertices[r];i.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],h={},u=[],d={};for(r=0;r<this.faces.length;r++){var p=this.faces[r],f=void 0!==this.faceVertexUvs[0][r],E=p.normal.length()>0,m=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,v=p.vertexColors.length>0,y=0;if(y=b(y=b(y=b(y=b(y=b(y=b(y=b(y=b(y,0,0),1,!1),2,!1),3,f),4,E),5,m),6,g),7,v),a.push(y),a.push(p.a,p.b,p.c),f){var T=this.faceVertexUvs[0][r];a.push(M(T[0]),M(T[1]),M(T[2]))}if(E&&a.push(x(p.normal)),m){var _=p.vertexNormals;a.push(x(_[0]),x(_[1]),x(_[2]))}if(g&&a.push(w(p.color)),v){var R=p.vertexColors;a.push(w(R[0]),w(R[1]),w(R[2]))}}function b(e,t,n){return n?e|1<<t:e&~(1<<t)}function x(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function w(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==h[t]?h[t]:(h[t]=c.length,c.push(e.getHex()),h[t])}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=u.length/2,u.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=i,e.data.normals=s,c.length>0&&(e.data.colors=c),u.length>0&&(e.data.uvs=[u]),e.data.faces=a,e},clone:function(){for(var e=new THREE.Geometry,t=this.vertices,n=0,i=t.length;n<i;n++)e.vertices.push(t[n].clone());var r=this.faces;for(n=0,i=r.length;n<i;n++)e.faces.push(r[n].clone());for(n=0,i=this.faceVertexUvs.length;n<i;n++){var o=this.faceVertexUvs[n];void 0===e.faceVertexUvs[n]&&(e.faceVertexUvs[n]=[]);for(var a=0,s=o.length;a<s;a++){for(var l=o[a],c=[],h=0,u=l.length;h<u;h++){var d=l[h];c.push(d.clone())}e.faceVertexUvs[n].push(c)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.Camera=function(){THREE.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.getWorldDirection=function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Vector3;return this.getWorldQuaternion(e),n.set(0,0,-1).applyQuaternion(e)}}(),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(e){return void 0===e&&(e=new THREE.Camera),THREE.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this),this.type="CubeCamera";var i=90,r=new THREE.PerspectiveCamera(i,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(1,0,0)),this.add(r);var o=new THREE.PerspectiveCamera(i,1,e,t);o.up.set(0,-1,0),o.lookAt(new THREE.Vector3(-1,0,0)),this.add(o);var a=new THREE.PerspectiveCamera(i,1,e,t);a.up.set(0,0,1),a.lookAt(new THREE.Vector3(0,1,0)),this.add(a);var s=new THREE.PerspectiveCamera(i,1,e,t);s.up.set(0,0,-1),s.lookAt(new THREE.Vector3(0,-1,0)),this.add(s);var l=new THREE.PerspectiveCamera(i,1,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,1)),this.add(l);var c=new THREE.PerspectiveCamera(i,1,e,t);c.up.set(0,-1,0),c.lookAt(new THREE.Vector3(0,0,-1)),this.add(c),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,i=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,o,n),n.activeCubeFace=2,e.render(t,a,n),n.activeCubeFace=3,e.render(t,s,n),n.activeCubeFace=4,e.render(t,l,n),n.generateMipmaps=i,n.activeCubeFace=5,e.render(t,c,n)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CubeCamera.prototype.constructor=THREE.CubeCamera,THREE.OrthographicCamera=function(e,t,n,i,r,o){THREE.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(n-e,n+e,i+t,i-t,this.near,this.far)},THREE.OrthographicCamera.prototype.clone=function(){var e=new THREE.OrthographicCamera;return THREE.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},THREE.PerspectiveCamera=function(e,t,n,i){THREE.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,i,r,o){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=i,this.width=r,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,n=Math.tan(THREE.Math.degToRad(.5*e))*this.near,i=-n,r=t*i,o=t*n,a=Math.abs(o-r),s=Math.abs(n-i);this.projectionMatrix.makeFrustum(r+this.x*a/this.fullWidth,r+(this.x+this.width)*a/this.fullWidth,n-(this.y+this.height)*s/this.fullHeight,n-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.clone=function(){var e=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},THREE.Light=function(e){THREE.Object3D.call(this),this.type="Light",this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e),this.type="AmbientLight"},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.type="AreaLight",this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.AreaLight.prototype.constructor=THREE.AreaLight,THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},THREE.HemisphereLight=function(e,t,n){THREE.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==n?n:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight,THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,n,i){THREE.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decay=this.decay,e},THREE.SpotLight=function(e,t,n,i,r,o){THREE.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==r?r:10,this.decay=void 0!==o?o:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decay=this.decay,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},THREE.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},THREE.Loader=function(e){this.showStatus=e,this.statusDomElement=e?THREE.Loader.prototype.addStatusElement():null,this.imageLoader=new THREE.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t);return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++){if(e[t]instanceof THREE.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var n=this;function i(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function r(e,r,o,a,s,l,c){var h,u=t+o,d=THREE.Loader.Handlers.get(u);if(null!==d?h=d.load(u):(h=new THREE.Texture,(d=n.imageLoader).crossOrigin=n.crossOrigin,d.load(u,function(e){if(!1===THREE.Math.isPowerOfTwo(e.width)||!1===THREE.Math.isPowerOfTwo(e.height)){var t=i(e.width),n=i(e.height),r=document.createElement("canvas");r.width=t,r.height=n,r.getContext("2d").drawImage(e,0,0,t,n),h.image=r}else h.image=e;h.needsUpdate=!0})),h.sourceFile=o,a&&(h.repeat.set(a[0],a[1]),1!==a[0]&&(h.wrapS=THREE.RepeatWrapping),1!==a[1]&&(h.wrapT=THREE.RepeatWrapping)),s&&h.offset.set(s[0],s[1]),l){var p={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==p[l[0]]&&(h.wrapS=p[l[0]]),void 0!==p[l[1]]&&(h.wrapT=p[l[1]])}c&&(h.anisotropy=c),e[r]=h}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var a="MeshLambertMaterial",s={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?a="MeshPhongMaterial":"basic"===l&&(a="MeshBasicMaterial")}void 0!==e.blending&&void 0!==THREE[e.blending]&&(s.blending=THREE[e.blending]),void 0!==e.transparent&&(s.transparent=e.transparent),void 0!==e.opacity&&e.opacity<1&&(s.transparent=!0),void 0!==e.depthTest&&(s.depthTest=e.depthTest),void 0!==e.depthWrite&&(s.depthWrite=e.depthWrite),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.flipSided&&(s.side=THREE.BackSide),void 0!==e.doubleSided&&(s.side=THREE.DoubleSide),void 0!==e.wireframe&&(s.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?s.vertexColors=THREE.FaceColors:e.vertexColors&&(s.vertexColors=THREE.VertexColors)),e.colorDiffuse?s.color=o(e.colorDiffuse):e.DbgColor&&(s.color=e.DbgColor),e.colorSpecular&&(s.specular=o(e.colorSpecular)),e.colorEmissive&&(s.emissive=o(e.colorEmissive)),void 0!==e.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),e.opacity=e.transparency),void 0!==e.opacity&&(s.opacity=e.opacity),e.specularCoef&&(s.shininess=e.specularCoef),e.mapDiffuse&&t&&r(s,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&r(s,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&r(s,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&r(s,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&r(s,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&r(s,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(s.bumpScale=e.mapBumpScale),e.mapNormalFactor&&(s.normalScale=new THREE.Vector2(e.mapNormalFactor,e.mapNormalFactor));var c=new THREE[a](s);return void 0!==e.DbgName&&(c.name=e.DbgName),c}},THREE.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,n=this.handlers.length;t<n;t+=2){var i=this.handlers[t],r=this.handlers[t+1];if(i.test(e))return r}return null}},THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,n,i){var r=this,o=THREE.Cache.get(e);if(void 0===o){var a=new XMLHttpRequest;a.open("GET",e,!0),a.addEventListener("load",function(n){THREE.Cache.add(e,this.response),t&&t(this.response),r.manager.itemEnd(e)},!1),void 0!==n&&a.addEventListener("progress",function(e){n(e)},!1),void 0!==i&&a.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),a.send(null),r.manager.itemStart(e)}else t&&t(o)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,n,i){var r=this,o=THREE.Cache.get(e);if(void 0===o){var a=document.createElement("img");return a.addEventListener("load",function(n){THREE.Cache.add(e,this),t&&t(this),r.manager.itemEnd(e)},!1),void 0!==n&&a.addEventListener("progress",function(e){n(e)},!1),void 0!==i&&a.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),a.src=e,r.manager.itemStart(e),a}t(o)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.constructor=THREE.JSONLoader,THREE.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,i,r){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText),l=s.metadata;if(void 0!==l){if("object"===l.type)return void THREE.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===l.type)return void THREE.error("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.")}var c=e.parse(s,i);n(c.geometry,c.materials)}else THREE.error("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.");e.onLoadComplete()}else THREE.error("THREE.JSONLoader: Couldn't load "+t+" ("+o.status+")");else o.readyState===o.LOADING?r&&(0===a&&(a=o.getResponseHeader("Content-Length")),r({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},THREE.JSONLoader.prototype.parse=function(e,t){var n=new THREE.Geometry,i=void 0!==e.scale?1/e.scale:1;if(function(t){function i(e,t){return e&1<<t}var r,o,a,s,l,c,h,u,d,p,f,E,m,g,v,y,T,_,R,b,x,w,M,L,S,H,I,A=e.faces,C=e.vertices,O=e.normals,P=e.colors,G=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&G++;for(r=0;r<G;r++)n.faceVertexUvs[r]=[]}s=0,l=C.length;for(;s<l;)(_=new THREE.Vector3).x=C[s++]*t,_.y=C[s++]*t,_.z=C[s++]*t,n.vertices.push(_);s=0,l=A.length;for(;s<l;)if(p=A[s++],f=i(p,0),E=i(p,1),m=i(p,3),g=i(p,4),v=i(p,5),y=i(p,6),T=i(p,7),f){if((b=new THREE.Face3).a=A[s],b.b=A[s+1],b.c=A[s+3],(x=new THREE.Face3).a=A[s+1],x.b=A[s+2],x.c=A[s+3],s+=4,E&&(d=A[s++],b.materialIndex=d,x.materialIndex=d),a=n.faces.length,m)for(r=0;r<G;r++)for(L=e.uvs[r],n.faceVertexUvs[r][a]=[],n.faceVertexUvs[r][a+1]=[],o=0;o<4;o++)u=A[s++],H=L[2*u],I=L[2*u+1],S=new THREE.Vector2(H,I),2!==o&&n.faceVertexUvs[r][a].push(S),0!==o&&n.faceVertexUvs[r][a+1].push(S);if(g&&(h=3*A[s++],b.normal.set(O[h++],O[h++],O[h]),x.normal.copy(b.normal)),v)for(r=0;r<4;r++)h=3*A[s++],M=new THREE.Vector3(O[h++],O[h++],O[h]),2!==r&&b.vertexNormals.push(M),0!==r&&x.vertexNormals.push(M);if(y&&(c=A[s++],w=P[c],b.color.setHex(w),x.color.setHex(w)),T)for(r=0;r<4;r++)c=A[s++],w=P[c],2!==r&&b.vertexColors.push(new THREE.Color(w)),0!==r&&x.vertexColors.push(new THREE.Color(w));n.faces.push(b),n.faces.push(x)}else{if((R=new THREE.Face3).a=A[s++],R.b=A[s++],R.c=A[s++],E&&(d=A[s++],R.materialIndex=d),a=n.faces.length,m)for(r=0;r<G;r++)for(L=e.uvs[r],n.faceVertexUvs[r][a]=[],o=0;o<3;o++)u=A[s++],H=L[2*u],I=L[2*u+1],S=new THREE.Vector2(H,I),n.faceVertexUvs[r][a].push(S);if(g&&(h=3*A[s++],R.normal.set(O[h++],O[h++],O[h])),v)for(r=0;r<3;r++)h=3*A[s++],M=new THREE.Vector3(O[h++],O[h++],O[h]),R.vertexNormals.push(M);if(y&&(c=A[s++],R.color.setHex(P[c])),T)for(r=0;r<3;r++)c=A[s++],R.vertexColors.push(new THREE.Color(P[c]));n.faces.push(R)}}(i),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var i=0,r=e.skinWeights.length;i<r;i+=t){var o=e.skinWeights[i],a=t>1?e.skinWeights[i+1]:0,s=t>2?e.skinWeights[i+2]:0,l=t>3?e.skinWeights[i+3]:0;n.skinWeights.push(new THREE.Vector4(o,a,s,l))}if(e.skinIndices)for(var i=0,r=e.skinIndices.length;i<r;i+=t){var c=e.skinIndices[i],h=t>1?e.skinIndices[i+1]:0,u=t>2?e.skinIndices[i+2]:0,d=t>3?e.skinIndices[i+3]:0;n.skinIndices.push(new THREE.Vector4(c,h,u,d))}n.bones=e.bones,n.bones&&n.bones.length>0&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&THREE.warn("THREE.JSONLoader: When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match.");n.animation=e.animation,n.animations=e.animations}(),function(t){var i,r,o,a,s,l,c,h,u,d,p;if(void 0!==e.morphTargets)for(s=0,l=e.morphTargets.length;s<l;s++)for(n.morphTargets[s]={},n.morphTargets[s].name=e.morphTargets[s].name,n.morphTargets[s].vertices=[],o=n.morphTargets[s].vertices,a=e.morphTargets[s].vertices,i=0,r=a.length;i<r;i+=3){var f=new THREE.Vector3;f.x=a[i]*t,f.y=a[i+1]*t,f.z=a[i+2]*t,o.push(f)}if(void 0!==e.morphColors)for(s=0,l=e.morphColors.length;s<l;s++)for(n.morphColors[s]={},n.morphColors[s].name=e.morphColors[s].name,n.morphColors[s].colors=[],u=n.morphColors[s].colors,d=e.morphColors[s].colors,c=0,h=d.length;c<h;c+=3)(p=new THREE.Color(16755200)).setRGB(d[c],d[c+1],d[c+2]),u.push(p)}(i),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:n};var r=this.initMaterials(e.materials,t);return this.needsTangents(r)&&n.computeTangents(),{geometry:n,materials:r}},THREE.LoadingManager=function(e,t,n){var i=this,r=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++},this.itemEnd=function(e){r++,void 0!==i.onProgress&&i.onProgress(e,r,o),r===o&&void 0!==i.onLoad&&i.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,n,i){var r=this,o=new THREE.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry,n=e.data.attributes;for(var i in n){var r=n[i],o=new self[r.type](r.array);t.addAttribute(i,new THREE.BufferAttribute(o,r.itemSize))}var a=e.data.offsets;void 0!==a&&(t.offsets=JSON.parse(JSON.stringify(a)));var s=e.data.boundingSphere;if(void 0!==s){var l=new THREE.Vector3;void 0!==s.center&&l.fromArray(s.center),t.boundingSphere=new THREE.Sphere(l,s.radius)}return t}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,n,i){var r=this,o=new THREE.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.materials)for(var n=0,i=e.materials.length;n<i;n++)t.materials.push(this.parse(e.materials[n]));return t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.texturePath=""},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,n,i){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var r=this,o=new THREE.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){r.parse(JSON.parse(e),t)},n,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var n=this.parseGeometries(e.geometries),i=this.parseImages(e.images,function(){void 0!==t&&t(a)}),r=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,r),a=this.parseObject(e.object,n,o);return void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseGeometries:function(e){var t={};if(void 0!==e)for(var n=new THREE.JSONLoader,i=new THREE.BufferGeometryLoader,r=0,o=e.length;r<o;r++){var a,s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new THREE[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new THREE.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":a=new THREE.CircleGeometry(s.radius,s.segments);break;case"CylinderGeometry":a=new THREE.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":a=new THREE.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":a=new THREE.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":a=new THREE.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new THREE.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=i.parse(s);break;case"Geometry":a=n.parse(s.data).geometry}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e,t){var n={};if(void 0!==e)for(var i=function(e){return void 0===t[e]&&THREE.warn("THREE.ObjectLoader: Undefined texture",e),t[e]},r=new THREE.MaterialLoader,o=0,a=e.length;o<a;o++){var s=e[o],l=r.parse(s);l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.map&&(l.map=i(s.map)),void 0!==s.bumpMap&&(l.bumpMap=i(s.bumpMap),s.bumpScale&&(l.bumpScale=new THREE.Vector2(s.bumpScale,s.bumpScale))),void 0!==s.alphaMap&&(l.alphaMap=i(s.alphaMap)),void 0!==s.envMap&&(l.envMap=i(s.envMap)),void 0!==s.normalMap&&(l.normalMap=i(s.normalMap),s.normalScale&&(l.normalScale=new THREE.Vector2(s.normalScale,s.normalScale))),void 0!==s.lightMap&&(l.lightMap=i(s.lightMap)),void 0!==s.specularMap&&(l.specularMap=i(s.specularMap)),n[s.uuid]=l}return n},parseImages:function(e,t){var n=this,i={};if(void 0!==e&&e.length>0){var r=new THREE.LoadingManager(t),o=new THREE.ImageLoader(r);o.setCrossOrigin(this.crossOrigin);for(var a=function(e){return n.manager.itemStart(e),o.load(e,function(){n.manager.itemEnd(e)})},s=0,l=e.length;s<l;s++){var c=e[s],h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:n.texturePath+c.url;i[c.uuid]=a(h)}}return i},parseTextures:function(e,t){var n={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var o=e[i];void 0===o.image&&THREE.warn('THREE.ObjectLoader: No "image" speficied for',o.uuid),void 0===t[o.image]&&THREE.warn("THREE.ObjectLoader: Undefined image",o.image);var a=new THREE.Texture(t[o.image]);a.needsUpdate=!0,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.repeat&&(a.repeat=new THREE.Vector2(o.repeat[0],o.repeat[1])),void 0!==o.minFilter&&(a.minFilter=THREE[o.minFilter]),void 0!==o.magFilter&&(a.magFilter=THREE[o.magFilter]),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),o.wrap instanceof Array&&(a.wrapS=THREE[o.wrap[0]],a.wrapT=THREE[o.wrap[1]]),n[o.uuid]=a}return n},parseObject:function(){var e=new THREE.Matrix4;return function(t,n,i){var r,o=function(e){return void 0===n[e]&&THREE.warn("THREE.ObjectLoader: Undefined geometry",e),n[e]},a=function(e){return void 0===i[e]&&THREE.warn("THREE.ObjectLoader: Undefined material",e),i[e]};switch(t.type){case"Scene":r=new THREE.Scene;break;case"PerspectiveCamera":r=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":r=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":r=new THREE.AmbientLight(t.color);break;case"DirectionalLight":r=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":r=new THREE.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":r=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":r=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":r=new THREE.Mesh(o(t.geometry),a(t.material));break;case"Line":r=new THREE.Line(o(t.geometry),a(t.material),t.mode);break;case"PointCloud":r=new THREE.PointCloud(o(t.geometry),a(t.material));break;case"Sprite":r=new THREE.Sprite(a(t.material));break;case"Group":r=new THREE.Group;break;default:r=new THREE.Object3D}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.children)for(var s in t.children)r.add(this.parseObject(t.children[s],n,i));return r}}()},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,n,i){var r=new THREE.ImageLoader(this.manager);r.setCrossOrigin(this.crossOrigin),r.load(e,function(e){var n=new THREE.Texture(e);n.needsUpdate=!0,void 0!==t&&t(n)},n,i)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(){this._parser=null},THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(e,t,n,i){var r=this,o=new THREE.DataTexture,a=new THREE.XHRLoader;return a.setResponseType("arraybuffer"),a.load(e,function(e){var n=r._parser(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,o.wrapT=void 0!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,o.magFilter=void 0!==n.magFilter?n.magFilter:THREE.LinearFilter,o.minFilter=void 0!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps),1===n.mipmapCount&&(o.minFilter=THREE.LinearFilter),o.needsUpdate=!0,t&&t(o,n))},n,i),o}},THREE.CompressedTextureLoader=function(){this._parser=null},THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(e,t,n){var i=this,r=[],o=new THREE.CompressedTexture;o.image=r;var a=new THREE.XHRLoader;if(a.setResponseType("arraybuffer"),e instanceof Array)for(var s=0,l=function(n){a.load(e[n],function(e){var a=i._parser(e,!0);r[n]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps},6===(s+=1)&&(1==a.mipmapCount&&(o.minFilter=THREE.LinearFilter),o.format=a.format,o.needsUpdate=!0,t&&t(o))})},c=0,h=e.length;c<h;++c)l(c);else a.load(e,function(e){var n=i._parser(e,!0);if(n.isCubemap)for(var a=n.mipmaps.length/n.mipmapCount,s=0;s<a;s++){r[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)r[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),r[s].format=n.format,r[s].width=n.width,r[s].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=THREE.LinearFilter),o.format=n.format,o.needsUpdate=!0,t&&t(o)});return o}},THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Material",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){if(t in this){var i=this[t];i instanceof THREE.Color?i.set(n):i instanceof THREE.Vector3&&n instanceof THREE.Vector3?i.copy(n):this[t]="overdraw"==t?Number(n):n}}else THREE.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(e.name=this.name),this instanceof THREE.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==THREE.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&(e.blending=this.blending),this.side!==THREE.FrontSide&&(e.side=this.side)):this instanceof THREE.MeshLambertMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==THREE.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==THREE.SmoothShading&&(e.shading=this.shading),this.blending!==THREE.NormalBlending&&(e.blending=this.blending),this.side!==THREE.FrontSide&&(e.side=this.side)):this instanceof THREE.MeshPhongMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==THREE.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==THREE.SmoothShading&&(e.shading=this.shading),this.blending!==THREE.NormalBlending&&(e.blending=this.blending),this.side!==THREE.FrontSide&&(e.side=this.side)):this instanceof THREE.MeshNormalMaterial?(this.blending!==THREE.NormalBlending&&(e.blending=this.blending),this.side!==THREE.FrontSide&&(e.side=this.side)):this instanceof THREE.MeshDepthMaterial?(this.blending!==THREE.NormalBlending&&(e.blending=this.blending),this.side!==THREE.FrontSide&&(e.side=this.side)):this instanceof THREE.PointCloudMaterial?(e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.color=this.color.getHex(),this.vertexColors!==THREE.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&(e.blending=this.blending)):this instanceof THREE.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof THREE.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),!1!==this.transparent&&(e.transparent=this.transparent),!1!==this.wireframe&&(e.wireframe=this.wireframe),e},clone:function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.blendSrcAlpha=this.blendSrcAlpha,e.blendDstAlpha=this.blendDstAlpha,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.type="LineBasicMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.type="LineDashedMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial,THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.type="MeshBasicMaterial",this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.type="MeshLambertMaterial",this.color=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.type="MeshPhongMaterial",this.color=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.uuid=THREE.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,n=this.materials.length;t<n;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new THREE.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},THREE.PointCloudMaterial=function(e){THREE.Material.call(this),this.type="PointCloudMaterial",this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype),THREE.PointCloudMaterial.prototype.constructor=THREE.PointCloudMaterial,THREE.PointCloudMaterial.prototype.clone=function(){var e=new THREE.PointCloudMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleBasicMaterial=function(e){return THREE.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new THREE.PointCloudMaterial(e)},THREE.ParticleSystemMaterial=function(e){return THREE.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new THREE.PointCloudMaterial(e)},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial,THREE.RawShaderMaterial.prototype.clone=function(){var e=new THREE.RawShaderMaterial;return THREE.ShaderMaterial.prototype.clone.call(this,e),e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.type="SpriteMaterial",this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial,THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},THREE.Texture=function(e,t,n,i,r,o,a,s,l){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:THREE.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:THREE.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},THREE.Texture.DEFAULT_IMAGE=void 0,THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping,THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CubeTexture=function(e,t,n,i,r,o,a,s,l){t=void 0!==t?t:THREE.CubeReflectionMapping,THREE.Texture.call(this,e,t,n,i,r,o,a,s,l),this.images=e},THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CubeTexture.prototype.constructor=THREE.CubeTexture,THREE.CubeTexture.clone=function(e){return void 0===e&&(e=new THREE.CubeTexture),THREE.Texture.prototype.clone.call(this,e),e.images=this.images,e},THREE.CompressedTexture=function(e,t,n,i,r,o,a,s,l,c,h){THREE.Texture.call(this,null,o,a,s,l,c,i,r,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture,THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,n,i,r,o,a,s,l,c,h){THREE.Texture.call(this,null,o,a,s,l,c,i,r,h),this.image={data:e,width:t,height:n}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.VideoTexture=function(e,t,n,i,r,o,a,s,l){THREE.Texture.call(this,e,t,n,i,r,o,a,s,l),this.generateMipmaps=!1;var c=this,h=function(){requestAnimationFrame(h),e.readyState===e.HAVE_ENOUGH_DATA&&(c.needsUpdate=!0)};h()},THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype),THREE.VideoTexture.prototype.constructor=THREE.VideoTexture,THREE.Group=function(){THREE.Object3D.call(this),this.type="Group"},THREE.Group.prototype=Object.create(THREE.Object3D.prototype),THREE.Group.prototype.constructor=THREE.Group,THREE.PointCloud=function(e,t){THREE.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.PointCloudMaterial({color:16777215*Math.random()})},THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype),THREE.PointCloud.prototype.constructor=THREE.PointCloud,THREE.PointCloud.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray;return function(n,i){var r=this,o=r.geometry,a=n.params.PointCloud.threshold;if(e.getInverse(this.matrixWorld),t.copy(n.ray).applyMatrix4(e),null===o.boundingBox||!1!==t.isIntersectionBox(o.boundingBox)){var s=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=new THREE.Vector3,c=function(e,o){var a=t.distanceToPoint(e);if(a<s){var l=t.closestPointToPoint(e);l.applyMatrix4(r.matrixWorld);var c=n.ray.origin.distanceTo(l);i.push({distance:c,distanceToRay:a,point:l.clone(),index:o,face:null,object:r})}};if(o instanceof THREE.BufferGeometry){var h=o.attributes,u=h.position.array;if(void 0!==h.index){var d=h.index.array,p=o.offsets;if(0===p.length)p=[{start:0,count:d.length,index:0}];for(var f=0,E=p.length;f<E;++f)for(var m=p[f].start,g=p[f].count,v=p[f].index,y=m,T=m+g;y<T;y++){var _=v+d[y];l.fromArray(u,3*_),c(l,_)}}else{var R=u.length/3;for(y=0;y<R;y++)l.set(u[3*y],u[3*y+1],u[3*y+2]),c(l,y)}}else{var b=this.geometry.vertices;for(y=0;y<b.length;y++)c(b[y],y)}}}}(),THREE.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new THREE.PointCloud(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){return THREE.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new THREE.PointCloud(e,t)},THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==n?n:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.constructor=THREE.Line,THREE.Line.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,n=new THREE.Sphere;return function(i,r){var o=i.linePrecision,a=o*o,s=this.geometry;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==i.ray.isIntersectionSphere(n)){e.getInverse(this.matrixWorld),t.copy(i.ray).applyMatrix4(e);var l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,u=new THREE.Vector3,d=this.mode===THREE.LineStrip?1:2;if(s instanceof THREE.BufferGeometry){var p=s.attributes;if(void 0!==p.index){var f=p.index.array,E=p.position.array,m=s.offsets;0===m.length&&(m=[{start:0,count:f.length,index:0}]);for(var g=0;g<m.length;g++)for(var v=m[g].start,y=m[g].count,T=m[g].index,_=v;_<v+y-1;_+=d){var R=T+f[_],b=T+f[_+1];if(l.fromArray(E,3*R),c.fromArray(E,3*b),!(t.distanceSqToSegment(l,c,u,h)>a))(M=t.origin.distanceTo(u))<i.near||M>i.far||r.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:_,offsetIndex:g,face:null,faceIndex:null,object:this})}}else for(E=p.position.array,_=0;_<E.length/3-1;_+=d){if(l.fromArray(E,3*_),c.fromArray(E,3*_+3),!(t.distanceSqToSegment(l,c,u,h)>a))(M=t.origin.distanceTo(u))<i.near||M>i.far||r.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else if(s instanceof THREE.Geometry){var x=s.vertices,w=x.length;for(_=0;_<w-1;_+=d){var M;if(!(t.distanceSqToSegment(x[_],x[_+1],u,h)>a))(M=t.origin.distanceTo(u))<i.near||M>i.far||r.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}}(),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.mode)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,n=new THREE.Sphere,i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3;return function(a,s){var l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),n.copy(l.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==a.ray.isIntersectionSphere(n)&&(e.getInverse(this.matrixWorld),t.copy(a.ray).applyMatrix4(e),null===l.boundingBox||!1!==t.isIntersectionBox(l.boundingBox)))if(l instanceof THREE.BufferGeometry){if(void 0===(A=this.material))return;var c=l.attributes,h=a.precision;if(void 0!==c.index){var u=c.index.array,d=c.position.array,p=l.offsets;0===p.length&&(p=[{start:0,count:u.length,index:0}]);for(var f=0,E=p.length;f<E;++f)for(var m=p[f].start,g=p[f].count,v=p[f].index,y=m,T=m+g;y<T;y+=3){if(b=v+u[y],x=v+u[y+1],w=v+u[y+2],i.fromArray(d,3*b),r.fromArray(d,3*x),o.fromArray(d,3*w),A.side===THREE.BackSide)var _=t.intersectTriangle(o,r,i,!0);else _=t.intersectTriangle(i,r,o,A.side!==THREE.DoubleSide);if(null!==_)_.applyMatrix4(this.matrixWorld),(N=a.ray.origin.distanceTo(_))<h||N<a.near||N>a.far||s.push({distance:N,point:_,face:new THREE.Face3(b,x,w,THREE.Triangle.normal(i,r,o)),faceIndex:null,object:this})}}else{y=0;var R=0;for(T=(d=c.position.array).length;y<T;y+=3,R+=9){if(b=y,x=y+1,w=y+2,i.fromArray(d,R),r.fromArray(d,R+3),o.fromArray(d,R+6),A.side===THREE.BackSide)_=t.intersectTriangle(o,r,i,!0);else _=t.intersectTriangle(i,r,o,A.side!==THREE.DoubleSide);if(null!==_)_.applyMatrix4(this.matrixWorld),(N=a.ray.origin.distanceTo(_))<h||N<a.near||N>a.far||s.push({distance:N,point:_,face:new THREE.Face3(b,x,w,THREE.Triangle.normal(i,r,o)),faceIndex:null,object:this})}}}else if(l instanceof THREE.Geometry)for(var b,x,w,M=this.material instanceof THREE.MeshFaceMaterial,L=!0===M?this.material.materials:null,S=(h=a.precision,l.vertices),H=0,I=l.faces.length;H<I;H++){var A,C=l.faces[H];if(void 0!==(A=!0===M?L[C.materialIndex]:this.material)){if(b=S[C.a],x=S[C.b],w=S[C.c],!0===A.morphTargets){var O=l.morphTargets,P=this.morphTargetInfluences;i.set(0,0,0),r.set(0,0,0),o.set(0,0,0);for(var G=0,D=O.length;G<D;G++){var k=P[G];if(0!==k){var B=O[G].vertices;i.x+=(B[C.a].x-b.x)*k,i.y+=(B[C.a].y-b.y)*k,i.z+=(B[C.a].z-b.z)*k,r.x+=(B[C.b].x-x.x)*k,r.y+=(B[C.b].y-x.y)*k,r.z+=(B[C.b].z-x.z)*k,o.x+=(B[C.c].x-w.x)*k,o.y+=(B[C.c].y-w.y)*k,o.z+=(B[C.c].z-w.z)*k}}i.add(b),r.add(x),o.add(w),b=i,x=r,w=o}if(A.side===THREE.BackSide)_=t.intersectTriangle(w,x,b,!0);else _=t.intersectTriangle(b,x,w,A.side!==THREE.DoubleSide);var N;if(null!==_)_.applyMatrix4(this.matrixWorld),(N=a.ray.origin.distanceTo(_))<h||N<a.near||N>a.far||s.push({distance:N,point:_,face:C,faceIndex:H,object:this})}}}}(),THREE.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e,t),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.type="Bone",this.skin=e},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.constructor=THREE.Bone,THREE.Skeleton=function(e,t,n){var i;(this.useVertexTexture=void 0===n||n,this.identityMatrix=new THREE.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture)?(i=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=i,this.boneTextureHeight=i,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{THREE.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new THREE.Matrix4)}},THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new THREE.Matrix4;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},THREE.Skeleton.prototype.pose=function(){for(var e,t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},THREE.Skeleton.prototype.update=function(){var e=new THREE.Matrix4;return function(){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),THREE.SkinnedMesh=function(e,t,n){THREE.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new THREE.Matrix4,this.bindMatrixInverse=new THREE.Matrix4;var i=[];if(this.geometry&&void 0!==this.geometry.bones){for(var r,o,a,s,l,c=0,h=this.geometry.bones.length;c<h;++c)a=(o=this.geometry.bones[c]).pos,s=o.rotq,l=o.scl,r=new THREE.Bone(this),i.push(r),r.name=o.name,r.position.set(a[0],a[1],a[2]),r.quaternion.set(s[0],s[1],s[2],s[3]),void 0!==l?r.scale.set(l[0],l[1],l[2]):r.scale.set(1,1,1);for(c=0,h=this.geometry.bones.length;c<h;++c)-1!==(o=this.geometry.bones[c]).parent?i[o.parent].add(i[c]):this.add(i[c])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new THREE.Skeleton(i,void 0,n))},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();n!==1/0?t.multiplyScalar(n):t.set(1)}},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):THREE.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh,THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,i=/([a-z]+)_?(\d+)/,r=0,o=e.morphTargets.length;r<o;r++){var a=e.morphTargets[r].name.match(i);if(a&&a.length>1){var s=a[1];n[s]||(n[s]={start:1/0,end:-1/0});var l=n[s];r<l.start&&(l.start=r),r>l.end&&(l.end=r),t||(t=s)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/t*1e3,this.time=0):THREE.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var n=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);n!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[n]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=n);var i=this.time%t/t;this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},THREE.MorphAnimMesh.prototype.interpolateTargets=function(e,t,n){for(var i=this.morphTargetInfluences,r=0,o=i.length;r<o;r++)i[r]=0;e>-1&&(i[e]=1-n),t>-1&&(i[t]=n)},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length&&!(t<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},THREE.LOD.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,n)}}(),THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){if(this.objects.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=!0;for(var r=1,o=this.objects.length;r<o&&i>=this.objects[r].distance;r++)this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0;for(;r<o;r++)this.objects[r].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(e){void 0===e&&(e=new THREE.LOD),THREE.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;t<n;t++){var i=this.objects[t].object.clone();i.visible=0===t,e.addLevel(i,this.objects[t].distance)}return e},THREE.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),n=new Float32Array([0,0,1,0,1,1,0,1]),i=new THREE.BufferGeometry;return i.addAttribute("index",new THREE.BufferAttribute(e,1)),i.addAttribute("position",new THREE.BufferAttribute(t,3)),i.addAttribute("uv",new THREE.BufferAttribute(n,2)),function(e){THREE.Object3D.call(this),this.type="Sprite",this.geometry=i,this.material=void 0!==e?e:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceToPoint(e);i>this.scale.x||n.push({distance:i,point:this.position,face:null,object:this})}}(),THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Particle=THREE.Sprite,THREE.LensFlare=function(e,t,n,i,r){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,i,r)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.add=function(e,t,n,i,r,o){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===o&&(o=1),void 0===r&&(r=new THREE.Color(16777215)),void 0===i&&(i=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:r,blending:i})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,n=this.lensFlares.length,i=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;e<n;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.Scene=function(){THREE.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.clone=function(e){return void 0===e&&(e=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},THREE.Fog=function(e,t,n){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.ShaderChunk={},THREE.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n",THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",THREE.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n",THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n",THREE.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",THREE.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",THREE.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n",THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif",THREE.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",THREE.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n",THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif",THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",THREE.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif",THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif",THREE.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif",THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif",THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",THREE.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n",THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",THREE.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n",THREE.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",THREE.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",THREE.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n",THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n#ifdef BONE_TEXTURE\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#else\n\n\tmat4 boneMatX = getBoneMatrix( int(skinIndex.x) );\n\tmat4 boneMatY = getBoneMatrix( int(skinIndex.y) );\n\tmat4 boneMatZ = getBoneMatrix( int(skinIndex.z) );\n\tmat4 boneMatW = getBoneMatrix( int(skinIndex.w) );\n\n#endif\n\n#endif",THREE.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif",THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif",THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",THREE.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ 0 ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ 0 ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ 0 ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ 0 ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n",THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n",THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif",THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in int i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ i ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif",THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",THREE.UniformsUtils={merge:function(e){for(var t={},n=0;n<e.length;n++){var i=this.clone(e[n]);for(var r in i)t[r]=i[r]}return t},clone:function(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?t[n][i]=r.clone():r instanceof Array?t[n][i]=r.slice():t[n][i]=r}return t}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"\t#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphatest_fragment,"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}},THREE.WebGLRenderer=function(e){window.console&&window.console.log&&console.log("THREE.WebGLRenderer",THREE.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),n=void 0!==e.context?e.context:null,i=1,r=void 0!==e.precision?e.precision:"highp",o=void 0!==e.alpha&&e.alpha,a=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,c=void 0===e.premultipliedAlpha||e.premultipliedAlpha,h=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,d=new THREE.Color(0),p=0,f=[],E={},m=[],g=[],v=[],y=[],T=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _,R=this,b=[],x=null,w=null,M=-1,L="",S=null,H=0,I=0,A=0,C=t.width,O=t.height,P=0,G=0,D=new THREE.Frustum,k=new THREE.Matrix4,B=new THREE.Vector3,N=new THREE.Vector3,j=!0,F={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var U={alpha:o,depth:a,stencil:s,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:h};if(null===(_=n||t.getContext("webgl",U)||t.getContext("experimental-webgl",U)))throw null!==t.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";t.addEventListener("webglcontextlost",function(e){e.preventDefault(),X(),q(),E={}},!1)}catch(e){THREE.error("THREE.WebGLRenderer: "+e)}var V=new THREE.WebGLState(_,lt);void 0===_.getShaderPrecisionFormat&&(_.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var z=new THREE.WebGLExtensions(_);z.get("OES_texture_float"),z.get("OES_texture_float_linear"),z.get("OES_texture_half_float"),z.get("OES_texture_half_float_linear"),z.get("OES_standard_derivatives"),u&&z.get("EXT_frag_depth");var W=function(e,t,n,i){!0===c&&(e*=i,t*=i,n*=i),_.clearColor(e,t,n,i)},q=function(){_.clearColor(0,0,0,1),_.clearDepth(1),_.clearStencil(0),_.enable(_.DEPTH_TEST),_.depthFunc(_.LEQUAL),_.frontFace(_.CCW),_.cullFace(_.BACK),_.enable(_.CULL_FACE),_.enable(_.BLEND),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA),_.viewport(I,A,C,O),W(d.r,d.g,d.b,p)},X=function(){x=null,S=null,L="",M=-1,j=!0,V.reset()};q(),this.context=_,this.state=V;var K,Y=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS),Q=_.getParameter(_.MAX_VERTEX_TEXTURE_IMAGE_UNITS),J=_.getParameter(_.MAX_TEXTURE_SIZE),Z=_.getParameter(_.MAX_CUBE_MAP_TEXTURE_SIZE),$=Q>0,ee=$&&z.get("OES_texture_float"),te=_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.HIGH_FLOAT),ne=_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.MEDIUM_FLOAT),ie=_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.HIGH_FLOAT),re=_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.MEDIUM_FLOAT),oe=function(){if(void 0!==K)return K;if(K=[],z.get("WEBGL_compressed_texture_pvrtc")||z.get("WEBGL_compressed_texture_s3tc"))for(var e=_.getParameter(_.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)K.push(e[t]);return K},ae=te.precision>0&&ie.precision>0,se=ne.precision>0&&re.precision>0;"highp"!==r||ae||(se?(r="mediump",THREE.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(r="lowp",THREE.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==r||se||(r="lowp",THREE.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var le=new THREE.ShadowMapPlugin(this,f,E,m),ce=new THREE.SpritePlugin(this,y),he=new THREE.LensFlarePlugin(this,T);function ue(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglNormalBuffer=_.createBuffer(),e.__webglTangentBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),e.__webglUVBuffer=_.createBuffer(),e.__webglUV2Buffer=_.createBuffer(),e.__webglSkinIndicesBuffer=_.createBuffer(),e.__webglSkinWeightsBuffer=_.createBuffer(),e.__webglFaceBuffer=_.createBuffer(),e.__webglLineBuffer=_.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var n=0,i=t;n<i;n++)e.__webglMorphTargetsBuffers.push(_.createBuffer())}var r=e.numMorphNormals;if(r){e.__webglMorphNormalsBuffers=[];for(n=0,i=r;n<i;n++)e.__webglMorphNormalsBuffers.push(_.createBuffer())}R.info.memory.geometries++}this.getContext=function(){return _},this.forceContextLoss=function(){z.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return $},this.supportsFloatTextures=function(){return z.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return z.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return z.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return z.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return z.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return z.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=z.get("EXT_texture_filter_anisotropic");return e=null!==t?_.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return r},this.getPixelRatio=function(){return i},this.setPixelRatio=function(e){i=e},this.setSize=function(e,n,r){t.width=e*i,t.height=n*i,!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n)},this.setViewport=function(e,t,n,r){I=e*i,A=t*i,C=n*i,O=r*i,_.viewport(I,A,C,O)},this.setScissor=function(e,t,n,r){_.scissor(e*i,t*i,n*i,r*i)},this.enableScissorTest=function(e){e?_.enable(_.SCISSOR_TEST):_.disable(_.SCISSOR_TEST)},this.getClearColor=function(){return d},this.setClearColor=function(e,t){d.set(e),p=void 0!==t?t:1,W(d.r,d.g,d.b,p)},this.getClearAlpha=function(){return p},this.setClearAlpha=function(e){p=e,W(d.r,d.g,d.b,p)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=_.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=_.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=_.STENCIL_BUFFER_BIT),_.clear(i)},this.clearColor=function(){_.clear(_.COLOR_BUFFER_BIT)},this.clearDepth=function(){_.clear(_.DEPTH_BUFFER_BIT)},this.clearStencil=function(){_.clear(_.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,i){this.setRenderTarget(e),this.clear(t,n,i)},this.resetGLState=X;var de=function(e){e.target.traverse(function(e){e.removeEventListener("remove",de),function(e){if(e instanceof THREE.Mesh||e instanceof THREE.PointCloud||e instanceof THREE.Line){var t=E[e.id];if(t){for(;t.length>0;)Fe.push(t.pop());je.push(t),E[e.id]=null}}else(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}(m,e);e.__webglInit=!1,Pe.release(e._modelViewMatrix),e._modelViewMatrix=null,Ge.release(e._normalMatrix),e._normalMatrix=null,e.__webglActive=!1}(e)})},pe=function(e){var t=e.target;t.removeEventListener("dispose",pe),ve(t)},fe=function(e){var t=e.target;t.removeEventListener("dispose",fe),ye(t),R.info.memory.textures--},Ee=function(e){var t=e.target;t.removeEventListener("dispose",Ee),Te(t),R.info.memory.textures--},me=function(e){var t=e.target;t.removeEventListener("dispose",me),_e(t)},ge=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],n=0,i=t.length;n<i;n++){void 0!==e[r=t[n]]&&(_.deleteBuffer(e[r]),delete e[r])}if(void 0!==e.__webglCustomAttributesList){for(var r in e.__webglCustomAttributesList)_.deleteBuffer(e.__webglCustomAttributesList[r].buffer);delete e.__webglCustomAttributesList}R.info.memory.geometries--},ve=function(e){if(delete e.__webglInit,e instanceof THREE.BufferGeometry){for(var t in e.attributes){var n=e.attributes[t];void 0!==n.buffer&&(_.deleteBuffer(n.buffer),delete n.buffer)}R.info.memory.geometries--}else{var i=ke[e.id];if(void 0!==i){for(var r=0,o=i.length;r<o;r++){var a=i[r];if(void 0!==a.numMorphTargets){for(var s=0,l=a.numMorphTargets;s<l;s++)_.deleteBuffer(a.__webglMorphTargetsBuffers[s]);delete a.__webglMorphTargetsBuffers}if(void 0!==a.numMorphNormals){for(s=0,l=a.numMorphNormals;s<l;s++)_.deleteBuffer(a.__webglMorphNormalsBuffers[s]);delete a.__webglMorphNormalsBuffers}ge(a)}delete ke[e.id]}else ge(e)}L=""},ye=function(e){if(e.image&&e.image.__webglTextureCube)_.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;_.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},Te=function(e){if(e&&void 0!==e.__webglTexture){if(_.deleteTexture(e.__webglTexture),delete e.__webglTexture,e instanceof THREE.WebGLRenderTargetCube)for(var t=0;t<6;t++)_.deleteFramebuffer(e.__webglFramebuffer[t]),_.deleteRenderbuffer(e.__webglRenderbuffer[t]);else _.deleteFramebuffer(e.__webglFramebuffer),_.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},_e=function(e){var t=e.program.program;if(void 0!==t){var n,i,r;e.program=void 0;var o=!1;for(n=0,i=b.length;n<i;n++)if((r=b[n]).program===t){r.usedTimes--,0===r.usedTimes&&(o=!0);break}if(!0===o){var a=[];for(n=0,i=b.length;n<i;n++)(r=b[n]).program!==t&&a.push(r);b=a,_.deleteProgram(t),R.info.memory.programs--}}};function Re(e){var t=e.geometry,n=e.material,i=t.vertices.length;if(n.attributes)for(var r in void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]),n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=_.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}function be(e,t){var n=t.geometry,i=e.faces3,r=3*i.length,o=1*i.length,a=3*i.length,s=xe(t,e);e.__vertexArray=new Float32Array(3*r),e.__normalArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__uvArray=new Float32Array(2*r),n.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*r)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*r)),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*r),e.__skinWeightArray=new Float32Array(4*r));var l=null!==z.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;e.__typeArray=l,e.__faceArray=new l(3*o),e.__lineArray=new l(2*a);var c=e.numMorphTargets;if(c){e.__morphTargetsArrays=[];for(var h=0,u=c;h<u;h++)e.__morphTargetsArrays.push(new Float32Array(3*r))}var d=e.numMorphNormals;if(d){e.__morphNormalsArrays=[];for(h=0,u=d;h<u;h++)e.__morphNormalsArrays.push(new Float32Array(3*r))}if(e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes)for(var p in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),s.attributes){var f=s.attributes[p],E={};for(var m in f)E[m]=f[m];if(!E.__webglInitialized||E.createUniqueBuffers){E.__webglInitialized=!0;var g=1;"v2"===E.type?g=2:"v3"===E.type?g=3:"v4"===E.type?g=4:"c"===E.type&&(g=3),E.size=g,E.array=new Float32Array(r*g),E.buffer=_.createBuffer(),E.buffer.belongsToAttribute=p,f.needsUpdate=!0,E.__original=f}e.__webglCustomAttributesList.push(E)}e.__inittedArrays=!0}function xe(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function we(e,t,n,i,r){if(e.__inittedArrays){var o,a,s,l,c,h,u,d,p,f,E,m,g,v,y,T,R,b,x,w,M,L,S,H,I,A,C,O,P,G,D,k,B,N,j,F,U,V,z,W,q,X=function(e){return e instanceof THREE.MeshPhongMaterial==0&&e.shading===THREE.FlatShading}(r),K=0,Y=0,Q=0,J=0,Z=0,$=0,ee=0,te=0,ne=0,ie=0,re=0,oe=0,ae=e.__vertexArray,se=e.__uvArray,le=e.__uv2Array,ce=e.__normalArray,he=e.__tangentArray,ue=e.__colorArray,de=e.__skinIndexArray,pe=e.__skinWeightArray,fe=e.__morphTargetsArrays,Ee=e.__morphNormalsArrays,me=e.__webglCustomAttributesList,ge=e.__faceArray,ve=e.__lineArray,ye=t.geometry,Te=ye.verticesNeedUpdate,_e=ye.elementsNeedUpdate,Re=ye.uvsNeedUpdate,be=ye.normalsNeedUpdate,xe=ye.tangentsNeedUpdate,we=ye.colorsNeedUpdate,Me=ye.morphTargetsNeedUpdate,Le=ye.vertices,Se=e.faces3,He=ye.faces,Ie=ye.faceVertexUvs[0],Ae=ye.faceVertexUvs[1],Ce=ye.skinIndices,Oe=ye.skinWeights,Pe=ye.morphTargets,Ge=ye.morphNormals;if(Te){for(o=0,a=Se.length;o<a;o++)E=Le[(s=He[Se[o]]).a],m=Le[s.b],g=Le[s.c],ae[Y]=E.x,ae[Y+1]=E.y,ae[Y+2]=E.z,ae[Y+3]=m.x,ae[Y+4]=m.y,ae[Y+5]=m.z,ae[Y+6]=g.x,ae[Y+7]=g.y,ae[Y+8]=g.z,Y+=9;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,ae,n)}if(Me)for(N=0,j=Pe.length;N<j;N++){for(re=0,o=0,a=Se.length;o<a;o++)s=He[V=Se[o]],E=Pe[N].vertices[s.a],m=Pe[N].vertices[s.b],g=Pe[N].vertices[s.c],(F=fe[N])[re]=E.x,F[re+1]=E.y,F[re+2]=E.z,F[re+3]=m.x,F[re+4]=m.y,F[re+5]=m.z,F[re+6]=g.x,F[re+7]=g.y,F[re+8]=g.z,r.morphNormals&&(X?(b=R=Ge[N].faceNormals[V],x=R):(R=(z=Ge[N].vertexNormals[V]).a,b=z.b,x=z.c),(U=Ee[N])[re]=R.x,U[re+1]=R.y,U[re+2]=R.z,U[re+3]=b.x,U[re+4]=b.y,U[re+5]=b.z,U[re+6]=x.x,U[re+7]=x.y,U[re+8]=x.z),re+=9;_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[N]),_.bufferData(_.ARRAY_BUFFER,fe[N],n),r.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[N]),_.bufferData(_.ARRAY_BUFFER,Ee[N],n))}if(Oe.length){for(o=0,a=Se.length;o<a;o++)S=Oe[(s=He[Se[o]]).a],H=Oe[s.b],I=Oe[s.c],pe[ie]=S.x,pe[ie+1]=S.y,pe[ie+2]=S.z,pe[ie+3]=S.w,pe[ie+4]=H.x,pe[ie+5]=H.y,pe[ie+6]=H.z,pe[ie+7]=H.w,pe[ie+8]=I.x,pe[ie+9]=I.y,pe[ie+10]=I.z,pe[ie+11]=I.w,A=Ce[s.a],C=Ce[s.b],O=Ce[s.c],de[ie]=A.x,de[ie+1]=A.y,de[ie+2]=A.z,de[ie+3]=A.w,de[ie+4]=C.x,de[ie+5]=C.y,de[ie+6]=C.z,de[ie+7]=C.w,de[ie+8]=O.x,de[ie+9]=O.y,de[ie+10]=O.z,de[ie+11]=O.w,ie+=12;ie>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),_.bufferData(_.ARRAY_BUFFER,de,n),_.bindBuffer(_.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),_.bufferData(_.ARRAY_BUFFER,pe,n))}if(we){for(o=0,a=Se.length;o<a;o++)h=(s=He[Se[o]]).vertexColors,u=s.color,3===h.length&&r.vertexColors===THREE.VertexColors?(w=h[0],M=h[1],L=h[2]):(w=u,M=u,L=u),ue[ne]=w.r,ue[ne+1]=w.g,ue[ne+2]=w.b,ue[ne+3]=M.r,ue[ne+4]=M.g,ue[ne+5]=M.b,ue[ne+6]=L.r,ue[ne+7]=L.g,ue[ne+8]=L.b,ne+=9;ne>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,ue,n))}if(xe&&ye.hasTangents){for(o=0,a=Se.length;o<a;o++)v=(d=(s=He[Se[o]]).vertexTangents)[0],y=d[1],T=d[2],he[ee]=v.x,he[ee+1]=v.y,he[ee+2]=v.z,he[ee+3]=v.w,he[ee+4]=y.x,he[ee+5]=y.y,he[ee+6]=y.z,he[ee+7]=y.w,he[ee+8]=T.x,he[ee+9]=T.y,he[ee+10]=T.z,he[ee+11]=T.w,ee+=12;_.bindBuffer(_.ARRAY_BUFFER,e.__webglTangentBuffer),_.bufferData(_.ARRAY_BUFFER,he,n)}if(be){for(o=0,a=Se.length;o<a;o++)if(l=(s=He[Se[o]]).vertexNormals,c=s.normal,3===l.length&&!1===X)for(P=0;P<3;P++)D=l[P],ce[$]=D.x,ce[$+1]=D.y,ce[$+2]=D.z,$+=3;else for(P=0;P<3;P++)ce[$]=c.x,ce[$+1]=c.y,ce[$+2]=c.z,$+=3;_.bindBuffer(_.ARRAY_BUFFER,e.__webglNormalBuffer),_.bufferData(_.ARRAY_BUFFER,ce,n)}if(Re&&Ie){for(o=0,a=Se.length;o<a;o++)if(void 0!==(p=Ie[Se[o]]))for(P=0;P<3;P++)k=p[P],se[Q]=k.x,se[Q+1]=k.y,Q+=2;Q>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUVBuffer),_.bufferData(_.ARRAY_BUFFER,se,n))}if(Re&&Ae){for(o=0,a=Se.length;o<a;o++)if(void 0!==(f=Ae[Se[o]]))for(P=0;P<3;P++)B=f[P],le[J]=B.x,le[J+1]=B.y,J+=2;J>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUV2Buffer),_.bufferData(_.ARRAY_BUFFER,le,n))}if(_e){for(o=0,a=Se.length;o<a;o++)ge[Z]=K,ge[Z+1]=K+1,ge[Z+2]=K+2,Z+=3,ve[te]=K,ve[te+1]=K+1,ve[te+2]=K,ve[te+3]=K+2,ve[te+4]=K+1,ve[te+5]=K+2,te+=6,K+=3;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,ge,n),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,ve,n)}if(me)for(P=0,G=me.length;P<G;P++)if((q=me[P]).__original.needsUpdate){var De;if(oe=0,1===q.size){if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,a=Se.length;o<a;o++)s=He[Se[o]],q.array[oe]=q.value[s.a],q.array[oe+1]=q.value[s.b],q.array[oe+2]=q.value[s.c],oe+=3;else if("faces"===q.boundTo)for(o=0,a=Se.length;o<a;o++)W=q.value[Se[o]],q.array[oe]=W,q.array[oe+1]=W,q.array[oe+2]=W,oe+=3}else if(2===q.size){if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,a=Se.length;o<a;o++)s=He[Se[o]],E=q.value[s.a],m=q.value[s.b],g=q.value[s.c],q.array[oe]=E.x,q.array[oe+1]=E.y,q.array[oe+2]=m.x,q.array[oe+3]=m.y,q.array[oe+4]=g.x,q.array[oe+5]=g.y,oe+=6;else if("faces"===q.boundTo)for(o=0,a=Se.length;o<a;o++)E=W=q.value[Se[o]],m=W,g=W,q.array[oe]=E.x,q.array[oe+1]=E.y,q.array[oe+2]=m.x,q.array[oe+3]=m.y,q.array[oe+4]=g.x,q.array[oe+5]=g.y,oe+=6}else if(3===q.size){if(De="c"===q.type?["r","g","b"]:["x","y","z"],void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,a=Se.length;o<a;o++)s=He[Se[o]],E=q.value[s.a],m=q.value[s.b],g=q.value[s.c],q.array[oe]=E[De[0]],q.array[oe+1]=E[De[1]],q.array[oe+2]=E[De[2]],q.array[oe+3]=m[De[0]],q.array[oe+4]=m[De[1]],q.array[oe+5]=m[De[2]],q.array[oe+6]=g[De[0]],q.array[oe+7]=g[De[1]],q.array[oe+8]=g[De[2]],oe+=9;else if("faces"===q.boundTo)for(o=0,a=Se.length;o<a;o++)E=W=q.value[Se[o]],m=W,g=W,q.array[oe]=E[De[0]],q.array[oe+1]=E[De[1]],q.array[oe+2]=E[De[2]],q.array[oe+3]=m[De[0]],q.array[oe+4]=m[De[1]],q.array[oe+5]=m[De[2]],q.array[oe+6]=g[De[0]],q.array[oe+7]=g[De[1]],q.array[oe+8]=g[De[2]],oe+=9;else if("faceVertices"===q.boundTo)for(o=0,a=Se.length;o<a;o++)E=(W=q.value[Se[o]])[0],m=W[1],g=W[2],q.array[oe]=E[De[0]],q.array[oe+1]=E[De[1]],q.array[oe+2]=E[De[2]],q.array[oe+3]=m[De[0]],q.array[oe+4]=m[De[1]],q.array[oe+5]=m[De[2]],q.array[oe+6]=g[De[0]],q.array[oe+7]=g[De[1]],q.array[oe+8]=g[De[2]],oe+=9}else if(4===q.size)if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,a=Se.length;o<a;o++)s=He[Se[o]],E=q.value[s.a],m=q.value[s.b],g=q.value[s.c],q.array[oe]=E.x,q.array[oe+1]=E.y,q.array[oe+2]=E.z,q.array[oe+3]=E.w,q.array[oe+4]=m.x,q.array[oe+5]=m.y,q.array[oe+6]=m.z,q.array[oe+7]=m.w,q.array[oe+8]=g.x,q.array[oe+9]=g.y,q.array[oe+10]=g.z,q.array[oe+11]=g.w,oe+=12;else if("faces"===q.boundTo)for(o=0,a=Se.length;o<a;o++)E=W=q.value[Se[o]],m=W,g=W,q.array[oe]=E.x,q.array[oe+1]=E.y,q.array[oe+2]=E.z,q.array[oe+3]=E.w,q.array[oe+4]=m.x,q.array[oe+5]=m.y,q.array[oe+6]=m.z,q.array[oe+7]=m.w,q.array[oe+8]=g.x,q.array[oe+9]=g.y,q.array[oe+10]=g.z,q.array[oe+11]=g.w,oe+=12;else if("faceVertices"===q.boundTo)for(o=0,a=Se.length;o<a;o++)E=(W=q.value[Se[o]])[0],m=W[1],g=W[2],q.array[oe]=E.x,q.array[oe+1]=E.y,q.array[oe+2]=E.z,q.array[oe+3]=E.w,q.array[oe+4]=m.x,q.array[oe+5]=m.y,q.array[oe+6]=m.z,q.array[oe+7]=m.w,q.array[oe+8]=g.x,q.array[oe+9]=g.y,q.array[oe+10]=g.z,q.array[oe+11]=g.w,oe+=12;_.bindBuffer(_.ARRAY_BUFFER,q.buffer),_.bufferData(_.ARRAY_BUFFER,q.array,n)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Me(e,t,n,i){for(var r=n.attributes,o=t.attributes,a=t.attributesKeys,s=0,l=a.length;s<l;s++){var c=a[s],h=o[c];if(h>=0){var u=r[c];if(void 0!==u){var d=u.itemSize;_.bindBuffer(_.ARRAY_BUFFER,u.buffer),V.enableAttribute(h),_.vertexAttribPointer(h,d,_.FLOAT,!1,0,i*d*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[c].length?_.vertexAttrib2fv(h,e.defaultAttributeValues[c]):3===e.defaultAttributeValues[c].length&&_.vertexAttrib3fv(h,e.defaultAttributeValues[c]))}}V.disableUnusedAttributes()}function Le(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Se(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function He(e,t){return t[0]-e[0]}function Ie(e,t,n,i,r){for(var o,a=0,s=e.length;a<s;a++){var l=e[a],c=l.object,h=l.buffer;if($e(c,t),r)o=r;else{if(!(o=l.material))continue;Ke(o)}R.setMaterialFaces(o),h instanceof THREE.BufferGeometry?R.renderBufferDirect(t,n,i,o,h,c):R.renderBuffer(t,n,i,o,h,c)}}function Ae(e,t,n,i,r,o){for(var a,s=0,l=e.length;s<l;s++){var c=e[s],h=c.object;if(h.visible){if(o)a=o;else{if(!(a=c[t]))continue;Ke(a)}R.renderImmediateObject(n,i,r,a,h)}}}function Ce(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function Oe(e){var t=e.object,n=e.buffer,i=t.geometry,r=t.material;if(r instanceof THREE.MeshFaceMaterial){var o=i instanceof THREE.BufferGeometry?0:n.materialIndex;r=r.materials[o],e.material=r,r.transparent?v.push(e):g.push(e)}else r&&(e.material=r,r.transparent?v.push(e):g.push(e))}this.renderBufferImmediate=function(e,t,n){if(V.initAttributes(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=_.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=_.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=_.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=_.createBuffer()),e.hasPositions&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,e.positionArray,_.DYNAMIC_DRAW),V.enableAttribute(t.attributes.position),_.vertexAttribPointer(t.attributes.position,3,_.FLOAT,!1,0,0)),e.hasNormals){if(_.bindBuffer(_.ARRAY_BUFFER,e.__webglNormalBuffer),n instanceof THREE.MeshPhongMaterial==!1&&n.shading===THREE.FlatShading){var i,r,o,a,s,l,c,h,u,d,p,f=3*e.count;for(p=0;p<f;p+=9)a=(d=e.normalArray)[p],l=d[p+1],h=d[p+2],s=d[p+3],c=d[p+4],u=d[p+5],i=(a+s+d[p+6])/3,r=(l+c+d[p+7])/3,o=(h+u+d[p+8])/3,d[p]=i,d[p+1]=r,d[p+2]=o,d[p+3]=i,d[p+4]=r,d[p+5]=o,d[p+6]=i,d[p+7]=r,d[p+8]=o}_.bufferData(_.ARRAY_BUFFER,e.normalArray,_.DYNAMIC_DRAW),V.enableAttribute(t.attributes.normal),_.vertexAttribPointer(t.attributes.normal,3,_.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUvBuffer),_.bufferData(_.ARRAY_BUFFER,e.uvArray,_.DYNAMIC_DRAW),V.enableAttribute(t.attributes.uv),_.vertexAttribPointer(t.attributes.uv,2,_.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==THREE.NoColors&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,e.colorArray,_.DYNAMIC_DRAW),V.enableAttribute(t.attributes.color),_.vertexAttribPointer(t.attributes.color,3,_.FLOAT,!1,0,0)),V.disableUnusedAttributes(),_.drawArrays(_.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,o,a){if(!1!==r.visible){Ve(a);var s=Ye(e,t,n,r,a),l=!1,c=r.wireframe?1:0,h="direct_"+o.id+"_"+s.id+"_"+c;if(h!==L&&(L=h,l=!0),l&&V.initAttributes(),a instanceof THREE.Mesh){var u=!0===r.wireframe?_.LINES:_.TRIANGLES;if(m=o.attributes.index){if(m.array instanceof Uint32Array&&z.get("OES_element_index_uint")?(g=_.UNSIGNED_INT,v=4):(g=_.UNSIGNED_SHORT,v=2),0===(y=o.offsets).length)l&&(Me(r,s,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(u,m.array.length,g,0),R.info.render.calls++,R.info.render.vertices+=m.array.length,R.info.render.faces+=m.array.length/3;else{l=!0;for(var d=0,p=y.length;d<p;d++){var f=y[d].index;l&&(Me(r,s,o,f),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(u,y[d].count,g,y[d].start*v),R.info.render.calls++,R.info.render.vertices+=y[d].count,R.info.render.faces+=y[d].count/3}}}else{l&&Me(r,s,o,0);var E=o.attributes.position;_.drawArrays(u,0,E.array.length/E.itemSize),R.info.render.calls++,R.info.render.vertices+=E.array.length/E.itemSize,R.info.render.faces+=E.array.length/(3*E.itemSize)}}else if(a instanceof THREE.PointCloud){u=_.POINTS;if(m=o.attributes.index){if(m.array instanceof Uint32Array&&z.get("OES_element_index_uint")?(g=_.UNSIGNED_INT,v=4):(g=_.UNSIGNED_SHORT,v=2),0===(y=o.offsets).length)l&&(Me(r,s,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(u,m.array.length,g,0),R.info.render.calls++,R.info.render.points+=m.array.length;else{y.length>1&&(l=!0);for(d=0,p=y.length;d<p;d++){f=y[d].index;l&&(Me(r,s,o,f),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(u,y[d].count,g,y[d].start*v),R.info.render.calls++,R.info.render.points+=y[d].count}}}else{l&&Me(r,s,o,0);E=o.attributes.position;if(0===(y=o.offsets).length)_.drawArrays(u,0,E.array.length/3),R.info.render.calls++,R.info.render.points+=E.array.length/3;else for(d=0,p=y.length;d<p;d++)_.drawArrays(u,y[d].index,y[d].count),R.info.render.calls++,R.info.render.points+=y[d].count}}else if(a instanceof THREE.Line){var m;u=a.mode===THREE.LineStrip?_.LINE_STRIP:_.LINES;if(V.setLineWidth(r.linewidth*i),m=o.attributes.index){var g,v;if(m.array instanceof Uint32Array?(g=_.UNSIGNED_INT,v=4):(g=_.UNSIGNED_SHORT,v=2),0===(y=o.offsets).length)l&&(Me(r,s,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(u,m.array.length,g,0),R.info.render.calls++,R.info.render.vertices+=m.array.length;else{y.length>1&&(l=!0);for(d=0,p=y.length;d<p;d++){f=y[d].index;l&&(Me(r,s,o,f),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(u,y[d].count,g,y[d].start*v),R.info.render.calls++,R.info.render.vertices+=y[d].count}}}else{l&&Me(r,s,o,0);var y;E=o.attributes.position;if(0===(y=o.offsets).length)_.drawArrays(u,0,E.array.length/3),R.info.render.calls++,R.info.render.vertices+=E.array.length/3;else for(d=0,p=y.length;d<p;d++)_.drawArrays(u,y[d].index,y[d].count),R.info.render.calls++,R.info.render.vertices+=y[d].count}}}},this.renderBuffer=function(e,t,n,r,o,a){if(!1!==r.visible){Ve(a);var s=Ye(e,t,n,r,a),l=s.attributes,c=!1,h=r.wireframe?1:0,u=o.id+"_"+s.id+"_"+h;if(u!==L&&(L=u,c=!0),c&&V.initAttributes(),!r.morphTargets&&l.position>=0?c&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglVertexBuffer),V.enableAttribute(l.position),_.vertexAttribPointer(l.position,3,_.FLOAT,!1,0,0)):a.morphTargetBase&&function(e,t,n){var i=e.program.attributes;-1!==n.morphTargetBase&&i.position>=0?(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n.morphTargetBase]),V.enableAttribute(i.position),_.vertexAttribPointer(i.position,3,_.FLOAT,!1,0,0)):i.position>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglVertexBuffer),V.enableAttribute(i.position),_.vertexAttribPointer(i.position,3,_.FLOAT,!1,0,0));if(n.morphTargetForcedOrder.length)for(var r=0,o=n.morphTargetForcedOrder,a=n.morphTargetInfluences;r<e.numSupportedMorphTargets&&r<o.length;)(s=i["morphTarget"+r])>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[r]]),V.enableAttribute(s),_.vertexAttribPointer(s,3,_.FLOAT,!1,0,0)),(s=i["morphNormal"+r])>=0&&e.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[r]]),V.enableAttribute(s),_.vertexAttribPointer(s,3,_.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[r]=a[o[r]],r++;else{var s,l=[],a=n.morphTargetInfluences,c=n.geometry.morphTargets;a.length>c.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),a.length=c.length);for(var h=0,u=a.length;h<u;h++){var d=a[h];l.push([d,h])}l.length>e.numSupportedMorphTargets?(l.sort(He),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(He):0===l.length&&l.push([0,0]);for(var r=0,p=e.numSupportedMorphTargets;r<p;r++)if(l[r]){var f=l[r][1];(s=i["morphTarget"+r])>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[f]),V.enableAttribute(s),_.vertexAttribPointer(s,3,_.FLOAT,!1,0,0)),(s=i["morphNormal"+r])>=0&&e.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[f]),V.enableAttribute(s),_.vertexAttribPointer(s,3,_.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[r]=a[f]}else n.__webglMorphTargetInfluences[r]=0}null!==e.program.uniforms.morphTargetInfluences&&_.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}(r,o,a),c){if(o.__webglCustomAttributesList)for(var d=0,p=o.__webglCustomAttributesList.length;d<p;d++){var f=o.__webglCustomAttributesList[d];l[f.buffer.belongsToAttribute]>=0&&(_.bindBuffer(_.ARRAY_BUFFER,f.buffer),V.enableAttribute(l[f.buffer.belongsToAttribute]),_.vertexAttribPointer(l[f.buffer.belongsToAttribute],f.size,_.FLOAT,!1,0,0))}l.color>=0&&(a.geometry.colors.length>0||a.geometry.faces.length>0?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglColorBuffer),V.enableAttribute(l.color),_.vertexAttribPointer(l.color,3,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib3fv(l.color,r.defaultAttributeValues.color)),l.normal>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglNormalBuffer),V.enableAttribute(l.normal),_.vertexAttribPointer(l.normal,3,_.FLOAT,!1,0,0)),l.tangent>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglTangentBuffer),V.enableAttribute(l.tangent),_.vertexAttribPointer(l.tangent,4,_.FLOAT,!1,0,0)),l.uv>=0&&(a.geometry.faceVertexUvs[0]?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglUVBuffer),V.enableAttribute(l.uv),_.vertexAttribPointer(l.uv,2,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib2fv(l.uv,r.defaultAttributeValues.uv)),l.uv2>=0&&(a.geometry.faceVertexUvs[1]?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglUV2Buffer),V.enableAttribute(l.uv2),_.vertexAttribPointer(l.uv2,2,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib2fv(l.uv2,r.defaultAttributeValues.uv2)),r.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),V.enableAttribute(l.skinIndex),_.vertexAttribPointer(l.skinIndex,4,_.FLOAT,!1,0,0),_.bindBuffer(_.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),V.enableAttribute(l.skinWeight),_.vertexAttribPointer(l.skinWeight,4,_.FLOAT,!1,0,0)),l.lineDistance>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglLineDistanceBuffer),V.enableAttribute(l.lineDistance),_.vertexAttribPointer(l.lineDistance,1,_.FLOAT,!1,0,0))}if(V.disableUnusedAttributes(),a instanceof THREE.Mesh){var E=o.__typeArray===Uint32Array?_.UNSIGNED_INT:_.UNSIGNED_SHORT;r.wireframe?(V.setLineWidth(r.wireframeLinewidth*i),c&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),_.drawElements(_.LINES,o.__webglLineCount,E,0)):(c&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),_.drawElements(_.TRIANGLES,o.__webglFaceCount,E,0)),R.info.render.calls++,R.info.render.vertices+=o.__webglFaceCount,R.info.render.faces+=o.__webglFaceCount/3}else if(a instanceof THREE.Line){var m=a.mode===THREE.LineStrip?_.LINE_STRIP:_.LINES;V.setLineWidth(r.linewidth*i),_.drawArrays(m,0,o.__webglLineCount),R.info.render.calls++}else a instanceof THREE.PointCloud&&(_.drawArrays(_.POINTS,0,o.__webglParticleCount),R.info.render.calls++,R.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,n,i){if(t instanceof THREE.Camera!=!1){var r=e.fog;L="",M=-1,S=null,j=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),e.traverse(function(e){e instanceof THREE.SkinnedMesh&&e.skeleton.update()}),t.matrixWorldInverse.getInverse(t.matrixWorld),k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),D.setFromMatrix(k),f.length=0,g.length=0,v.length=0,y.length=0,T.length=0,function e(t){if(!1===t.visible)return;if(t instanceof THREE.Scene||t instanceof THREE.Group);else if(De(t),t instanceof THREE.Light)f.push(t);else if(t instanceof THREE.Sprite)y.push(t);else if(t instanceof THREE.LensFlare)T.push(t);else{var n=E[t.id];if(n&&(!1===t.frustumCulled||!0===D.intersectsObject(t)))for(var i=0,r=n.length;i<r;i++){var o=n[i];Oe(o),o.render=!0,!0===R.sortObjects&&(B.setFromMatrixPosition(t.matrixWorld),B.applyProjection(k),o.z=B.z)}}for(var i=0,r=t.children.length;i<r;i++)e(t.children[i])}(e),!0===R.sortObjects&&(g.sort(Le),v.sort(Se)),le.render(e,t),R.info.render.calls=0,R.info.render.vertices=0,R.info.render.faces=0,R.info.render.points=0,this.setRenderTarget(n),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var o=0,a=m.length;o<a;o++){var s=m[o],l=s.object;l.visible&&($e(l,t),Ce(s))}if(e.overrideMaterial){var c=e.overrideMaterial;Ke(c),Ie(g,t,f,r,c),Ie(v,t,f,r,c),Ae(m,"",t,f,r,c)}else V.setBlending(THREE.NoBlending),Ie(g,t,f,r,null),Ae(m,"opaque",t,f,r,null),Ie(v,t,f,r,null),Ae(m,"transparent",t,f,r,null);ce.render(e,t),he.render(e,t,P,G),n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&function(e){e instanceof THREE.WebGLRenderTargetCube?(_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture),_.generateMipmap(_.TEXTURE_CUBE_MAP),_.bindTexture(_.TEXTURE_CUBE_MAP,null)):(_.bindTexture(_.TEXTURE_2D,e.__webglTexture),_.generateMipmap(_.TEXTURE_2D),_.bindTexture(_.TEXTURE_2D,null))}(n),V.setDepthTest(!0),V.setDepthWrite(!0),V.setColorWrite(!0)}else THREE.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,n,i,r){var o=Ye(e,t,n,i,r);L="",R.setMaterialFaces(i),r.immediateRenderCallback?r.immediateRenderCallback(o,_,D):r.render(function(e){R.renderBufferImmediate(e,o,i)})};var Pe={objects:[],get:function(){var e=this.objects.pop();return e||(e=new THREE.Matrix4),e},release:function(e){e&&this.objects.push(e)}},Ge={objects:[],get:function(){var e=this.objects.pop();return e||(e=new THREE.Matrix3),e},release:function(e){e&&this.objects.push(e)}};function De(e){e.__webglInit||(e.__webglInit=!0,e._modelViewMatrix=Pe.get(),e._normalMatrix=Ge.get(),e.addEventListener("removed",de));var t=e.geometry;if(void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",pe),t instanceof THREE.BufferGeometry?R.info.memory.geometries++:e instanceof THREE.Mesh?Ne(e,t):e instanceof THREE.Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),e.__webglLineDistanceBuffer=_.createBuffer(),R.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__lineDistanceArray=new Float32Array(1*n),e.__webglLineCount=n,Re(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof THREE.PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),R.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__webglParticleCount=n,Re(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0)),!e.__webglActive)if(e.__webglActive=!0,e instanceof THREE.Mesh){if(t instanceof THREE.BufferGeometry)Ue(E,t,e);else if(t instanceof THREE.Geometry)for(var n=ke[t.id],i=0,r=n.length;i<r;i++)Ue(E,n[i],e)}else e instanceof THREE.Line||e instanceof THREE.PointCloud?Ue(E,t,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}(m,e)}this.initObjectFunc=De;var ke={},Be=0;function Ne(e,t){var n=e.material,i=!1;void 0!==ke[t.id]&&!0!==t.groupsNeedUpdate||(delete E[e.id],ke[t.id]=function(e,t){for(var n,i,r=z.get("OES_element_index_uint")?4294967296:65535,o={},a=e.morphTargets.length,s=e.morphNormals.length,l={},c=[],h=0,u=e.faces.length;h<u;h++){var d=e.faces[h],p=t?d.materialIndex:0;p in o||(o[p]={hash:p,counter:0}),(n=o[p].hash+"_"+o[p].counter)in l||(i={id:Be++,faces3:[],materialIndex:p,vertices:0,numMorphTargets:a,numMorphNormals:s},l[n]=i,c.push(i)),l[n].vertices+3>r&&(o[p].counter+=1,(n=o[p].hash+"_"+o[p].counter)in l||(i={id:Be++,faces3:[],materialIndex:p,vertices:0,numMorphTargets:a,numMorphNormals:s},l[n]=i,c.push(i))),l[n].faces3.push(h),l[n].vertices+=3}return c}(t,n instanceof THREE.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var r=ke[t.id],o=0,a=r.length;o<a;o++){var s=r[o];void 0===s.__webglVertexBuffer?(ue(s),be(s,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,i=!0):i=!1,(i||void 0===e.__webglActive)&&Ue(E,s,e)}e.__webglActive=!0}var je=[],Fe=[];function Ue(e,t,n){var i=n.id;e[i]=e[i]||je.pop()||[];var r=Fe.pop()||{};r.id=i,r.buffer=t,r.object=n,r.material=null,r.z=0,e[i].push(r)}function Ve(e){var t=e.geometry;if(t instanceof THREE.BufferGeometry)for(var n=t.attributes,i=t.attributesKeys,r=0,o=i.length;r<o;r++){var a=i[r],s=n[a],l="index"===a?_.ELEMENT_ARRAY_BUFFER:_.ARRAY_BUFFER;void 0===s.buffer?(s.buffer=_.createBuffer(),_.bindBuffer(l,s.buffer),_.bufferData(l,s.array,s instanceof THREE.DynamicBufferAttribute?_.DYNAMIC_DRAW:_.STATIC_DRAW),s.needsUpdate=!1):!0===s.needsUpdate&&(_.bindBuffer(l,s.buffer),void 0===s.updateRange||-1===s.updateRange.count?_.bufferSubData(l,0,s.array):0===s.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(_.bufferSubData(l,s.updateRange.offset*s.array.BYTES_PER_ELEMENT,s.array.subarray(s.updateRange.offset,s.updateRange.offset+s.updateRange.count)),s.updateRange.count=0),s.needsUpdate=!1)}else if(e instanceof THREE.Mesh){!0===t.groupsNeedUpdate&&Ne(e,t);for(var c=ke[t.id],h=(r=0,c.length);r<h;r++){var u=c[r],d=(p=xe(e,u)).attributes&&ze(p);(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||d)&&we(u,e,_.DYNAMIC_DRAW,!t.dynamic,p)}t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,p.attributes&&We(p)}else if(e instanceof THREE.Line){d=(p=xe(e,t)).attributes&&ze(p);(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||d)&&function(e,t){var n,i,r,o,a,s,l,c,h,u,d,p,f=e.vertices,E=e.colors,m=e.lineDistances,g=f.length,v=E.length,y=m.length,T=e.__vertexArray,R=e.__colorArray,b=e.__lineDistanceArray,x=e.verticesNeedUpdate,w=e.colorsNeedUpdate,M=e.lineDistancesNeedUpdate,L=e.__webglCustomAttributesList;if(x){for(n=0;n<g;n++)o=f[n],T[a=3*n]=o.x,T[a+1]=o.y,T[a+2]=o.z;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,T,t)}if(w){for(i=0;i<v;i++)s=E[i],R[a=3*i]=s.r,R[a+1]=s.g,R[a+2]=s.b;_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,R,t)}if(M){for(r=0;r<y;r++)b[r]=m[r];_.bindBuffer(_.ARRAY_BUFFER,e.__webglLineDistanceBuffer),_.bufferData(_.ARRAY_BUFFER,b,t)}if(L)for(l=0,c=L.length;l<c;l++)if((p=L[l]).needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(a=0,u=p.value.length,1===p.size)for(h=0;h<u;h++)p.array[h]=p.value[h];else if(2===p.size)for(h=0;h<u;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,a+=2;else if(3===p.size)if("c"===p.type)for(h=0;h<u;h++)d=p.value[h],p.array[a]=d.r,p.array[a+1]=d.g,p.array[a+2]=d.b,a+=3;else for(h=0;h<u;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,a+=3;else if(4===p.size)for(h=0;h<u;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,p.array[a+3]=d.w,a+=4;_.bindBuffer(_.ARRAY_BUFFER,p.buffer),_.bufferData(_.ARRAY_BUFFER,p.array,t),p.needsUpdate=!1}}(t,_.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,p.attributes&&We(p)}else if(e instanceof THREE.PointCloud){var p;d=(p=xe(e,t)).attributes&&ze(p);(t.verticesNeedUpdate||t.colorsNeedUpdate||d)&&function(e,t,n){var i,r,o,a,s,l,c,h,u,d,p,f=e.vertices,E=f.length,m=e.colors,g=m.length,v=e.__vertexArray,y=e.__colorArray,T=e.verticesNeedUpdate,R=e.colorsNeedUpdate,b=e.__webglCustomAttributesList;if(T){for(i=0;i<E;i++)o=f[i],v[a=3*i]=o.x,v[a+1]=o.y,v[a+2]=o.z;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,v,t)}if(R){for(r=0;r<g;r++)s=m[r],y[a=3*r]=s.r,y[a+1]=s.g,y[a+2]=s.b;_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,y,t)}if(b)for(l=0,c=b.length;l<c;l++){if((p=b[l]).needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo))if(u=p.value.length,a=0,1===p.size)for(h=0;h<u;h++)p.array[h]=p.value[h];else if(2===p.size)for(h=0;h<u;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,a+=2;else if(3===p.size)if("c"===p.type)for(h=0;h<u;h++)d=p.value[h],p.array[a]=d.r,p.array[a+1]=d.g,p.array[a+2]=d.b,a+=3;else for(h=0;h<u;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,a+=3;else if(4===p.size)for(h=0;h<u;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,p.array[a+3]=d.w,a+=4;_.bindBuffer(_.ARRAY_BUFFER,p.buffer),_.bufferData(_.ARRAY_BUFFER,p.array,t),p.needsUpdate=!1}}(t,_.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,p.attributes&&We(p)}}function ze(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function We(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}this.updateObjectFunc=Ve;var qe={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function Xe(e,t,n,i){e.addEventListener("dispose",me);var o=qe[e.type];if(o){var a=THREE.ShaderLib[o];e.__webglShader={uniforms:THREE.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var s=function(e){for(var t=0,n=0,i=0,r=0,o=0,a=e.length;o<a;o++){var s=e[o];s.onlyShadow||!1===s.visible||(s instanceof THREE.DirectionalLight&&t++,s instanceof THREE.PointLight&&n++,s instanceof THREE.SpotLight&&i++,s instanceof THREE.HemisphereLight&&r++)}return{directional:t,point:n,spot:i,hemi:r}}(t),l=function(e){for(var t=0,n=0,i=e.length;n<i;n++){var r=e[n];r.castShadow&&(r instanceof THREE.SpotLight&&t++,r instanceof THREE.DirectionalLight&&!r.shadowCascade&&t++)}return t}(t),c={precision:r,supportsVertexTextures:$,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof THREE.FogExp2,flatShading:e.shading===THREE.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:u,skinning:e.skinning,maxBones:20,useVertexTexture:ee&&i&&i.skeleton&&i.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:R.maxMorphTargets,maxMorphNormals:R.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:l,shadowMapEnabled:R.shadowMapEnabled&&i.receiveShadow&&l>0,shadowMapType:R.shadowMapType,shadowMapDebug:R.shadowMapDebug,shadowMapCascade:R.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},h=[];if(o?h.push(o):(h.push(e.fragmentShader),h.push(e.vertexShader)),void 0!==e.defines)for(var d in e.defines)h.push(d),h.push(e.defines[d]);for(var d in c)h.push(d),h.push(c[d]);for(var p,f=h.join(),E=0,m=b.length;E<m;E++){var g=b[E];if(g.code===f){(p=g).usedTimes++;break}}void 0===p&&(p=new THREE.WebGLProgram(R,f,e,c),b.push(p),R.info.memory.programs=b.length),e.program=p;var v=p.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;for(var y="morphTarget",T=0;T<R.maxMorphTargets;T++)v[y+T]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;y="morphNormal";for(T=0;T<R.maxMorphNormals;T++)v[y+T]>=0&&e.numSupportedMorphNormals++}for(var _ in e.uniformsList=[],e.__webglShader.uniforms){var x=e.program.uniforms[_];x&&e.uniformsList.push([e.__webglShader.uniforms[_],x])}}function Ke(e){!0===e.transparent?V.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):V.setBlending(THREE.NoBlending),V.setDepthTest(e.depthTest),V.setDepthWrite(e.depthWrite),V.setColorWrite(e.colorWrite),V.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Ye(e,n,i,r,o){H=0,r.needsUpdate&&(r.program&&_e(r),Xe(r,n,i,o),r.needsUpdate=!1),r.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(R.maxMorphTargets)));var a=!1,s=!1,l=!1,c=r.program,h=c.uniforms,d=r.__webglShader.uniforms;if(c.id!==x&&(_.useProgram(c.program),x=c.id,a=!0,s=!0,l=!0),r.id!==M&&(-1===M&&(l=!0),M=r.id,s=!0),(a||e!==S)&&(_.uniformMatrix4fv(h.projectionMatrix,!1,e.projectionMatrix.elements),u&&_.uniform1f(h.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==S&&(S=e),(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==h.cameraPosition&&(B.setFromMatrixPosition(e.matrixWorld),_.uniform3f(h.cameraPosition,B.x,B.y,B.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshBasicMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==h.viewMatrix&&_.uniformMatrix4fv(h.viewMatrix,!1,e.matrixWorldInverse.elements)),r.skinning)if(o.bindMatrix&&null!==h.bindMatrix&&_.uniformMatrix4fv(h.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==h.bindMatrixInverse&&_.uniformMatrix4fv(h.bindMatrixInverse,!1,o.bindMatrixInverse.elements),ee&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==h.boneTexture){var p=Ze();_.uniform1i(h.boneTexture,p),R.setTexture(o.skeleton.boneTexture,p)}null!==h.boneTextureWidth&&_.uniform1i(h.boneTextureWidth,o.skeleton.boneTextureWidth),null!==h.boneTextureHeight&&_.uniform1i(h.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==h.boneGlobalMatrices&&_.uniformMatrix4fv(h.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return s&&(i&&r.fog&&function(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}(d,i),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights)&&(j&&(l=!0,function(e){var t,n,i,r,o,a,s,l,c=0,h=0,u=0,d=F,p=d.directional.colors,f=d.directional.positions,E=d.point.colors,m=d.point.positions,g=d.point.distances,v=d.point.decays,y=d.spot.colors,T=d.spot.positions,_=d.spot.distances,R=d.spot.directions,b=d.spot.anglesCos,x=d.spot.exponents,w=d.spot.decays,M=d.hemi.skyColors,L=d.hemi.groundColors,S=d.hemi.positions,H=0,I=0,A=0,C=0,O=0,P=0,G=0,D=0,k=0,j=0,U=0,V=0;for(t=0,n=e.length;t<n;t++)if(!(i=e[t]).onlyShadow)if(r=i.color,s=i.intensity,l=i.distance,i instanceof THREE.AmbientLight){if(!i.visible)continue;c+=r.r,h+=r.g,u+=r.b}else if(i instanceof THREE.DirectionalLight){if(O+=1,!i.visible)continue;N.setFromMatrixPosition(i.matrixWorld),B.setFromMatrixPosition(i.target.matrixWorld),N.sub(B),N.normalize(),f[k=3*H]=N.x,f[k+1]=N.y,f[k+2]=N.z,et(p,k,r,s),H+=1}else if(i instanceof THREE.PointLight){if(P+=1,!i.visible)continue;et(E,j=3*I,r,s),B.setFromMatrixPosition(i.matrixWorld),m[j]=B.x,m[j+1]=B.y,m[j+2]=B.z,g[I]=l,v[I]=0===i.distance?0:i.decay,I+=1}else if(i instanceof THREE.SpotLight){if(G+=1,!i.visible)continue;et(y,U=3*A,r,s),N.setFromMatrixPosition(i.matrixWorld),T[U]=N.x,T[U+1]=N.y,T[U+2]=N.z,_[A]=l,B.setFromMatrixPosition(i.target.matrixWorld),N.sub(B),N.normalize(),R[U]=N.x,R[U+1]=N.y,R[U+2]=N.z,b[A]=Math.cos(i.angle),x[A]=i.exponent,w[A]=0===i.distance?0:i.decay,A+=1}else if(i instanceof THREE.HemisphereLight){if(D+=1,!i.visible)continue;N.setFromMatrixPosition(i.matrixWorld),N.normalize(),S[V=3*C]=N.x,S[V+1]=N.y,S[V+2]=N.z,o=i.color,a=i.groundColor,et(M,V,o,s),et(L,V,a,s),C+=1}for(t=3*H,n=Math.max(p.length,3*O);t<n;t++)p[t]=0;for(t=3*I,n=Math.max(E.length,3*P);t<n;t++)E[t]=0;for(t=3*A,n=Math.max(y.length,3*G);t<n;t++)y[t]=0;for(t=3*C,n=Math.max(M.length,3*D);t<n;t++)M[t]=0;for(t=3*C,n=Math.max(L.length,3*D);t<n;t++)L[t]=0;d.directional.length=H,d.point.length=I,d.spot.length=A,d.hemi.length=C,d.ambient[0]=c,d.ambient[1]=h,d.ambient[2]=u}(n),j=!1),l?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(d,F),Je(d,!0)):Je(d,!1)),(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var n;t.map?n=t.map:t.specularMap?n=t.specularMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.alphaMap&&(n=t.alphaMap);if(void 0!==n){var i=n.offset,r=n.repeat;e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(d,r),r instanceof THREE.LineBasicMaterial?Qe(d,r):r instanceof THREE.LineDashedMaterial?(Qe(d,r),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(d,r)):r instanceof THREE.PointCloudMaterial?function(e,n){if(e.psColor.value=n.color,e.opacity.value=n.opacity,e.size.value=n.size,e.scale.value=t.height/2,e.map.value=n.map,null!==n.map){var i=n.map.offset,r=n.map.repeat;e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}}(d,r):r instanceof THREE.MeshPhongMaterial?function(e,t){e.shininess.value=t.shininess,e.emissive.value=t.emissive,e.specular.value=t.specular,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,r):r instanceof THREE.MeshLambertMaterial?function(e,t){e.emissive.value=t.emissive,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,r):r instanceof THREE.MeshDepthMaterial?(d.mNear.value=e.near,d.mFar.value=e.far,d.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(d.opacity.value=r.opacity),o.receiveShadow&&!r._shadowPass&&function(e,t){if(e.shadowMatrix)for(var n=0,i=0,r=t.length;i<r;i++){var o=t[i];o.castShadow&&((o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[n]=o.shadowMap,e.shadowMapSize.value[n]=o.shadowMapSize,e.shadowMatrix.value[n]=o.shadowMatrix,e.shadowDarkness.value[n]=o.shadowDarkness,e.shadowBias.value[n]=o.shadowBias,n++))}}(d,n),function(e){for(var t,n,i,r=0,o=e.length;r<o;r++){var a=e[r][0];if(!1!==a.needsUpdate){var s=a.type,l=a.value,c=e[r][1];switch(s){case"1i":_.uniform1i(c,l);break;case"1f":_.uniform1f(c,l);break;case"2f":_.uniform2f(c,l[0],l[1]);break;case"3f":_.uniform3f(c,l[0],l[1],l[2]);break;case"4f":_.uniform4f(c,l[0],l[1],l[2],l[3]);break;case"1iv":_.uniform1iv(c,l);break;case"3iv":_.uniform3iv(c,l);break;case"1fv":_.uniform1fv(c,l);break;case"2fv":_.uniform2fv(c,l);break;case"3fv":_.uniform3fv(c,l);break;case"4fv":_.uniform4fv(c,l);break;case"Matrix3fv":_.uniformMatrix3fv(c,!1,l);break;case"Matrix4fv":_.uniformMatrix4fv(c,!1,l);break;case"i":_.uniform1i(c,l);break;case"f":_.uniform1f(c,l);break;case"v2":_.uniform2f(c,l.x,l.y);break;case"v3":_.uniform3f(c,l.x,l.y,l.z);break;case"v4":_.uniform4f(c,l.x,l.y,l.z,l.w);break;case"c":_.uniform3f(c,l.r,l.g,l.b);break;case"iv1":_.uniform1iv(c,l);break;case"iv":_.uniform3iv(c,l);break;case"fv1":_.uniform1fv(c,l);break;case"fv":_.uniform3fv(c,l);break;case"v2v":void 0===a._array&&(a._array=new Float32Array(2*l.length));for(var h=0,u=l.length;h<u;h++)i=2*h,a._array[i]=l[h].x,a._array[i+1]=l[h].y;_.uniform2fv(c,a._array);break;case"v3v":void 0===a._array&&(a._array=new Float32Array(3*l.length));for(var h=0,u=l.length;h<u;h++)i=3*h,a._array[i]=l[h].x,a._array[i+1]=l[h].y,a._array[i+2]=l[h].z;_.uniform3fv(c,a._array);break;case"v4v":void 0===a._array&&(a._array=new Float32Array(4*l.length));for(var h=0,u=l.length;h<u;h++)i=4*h,a._array[i]=l[h].x,a._array[i+1]=l[h].y,a._array[i+2]=l[h].z,a._array[i+3]=l[h].w;_.uniform4fv(c,a._array);break;case"m3":_.uniformMatrix3fv(c,!1,l.elements);break;case"m3v":void 0===a._array&&(a._array=new Float32Array(9*l.length));for(var h=0,u=l.length;h<u;h++)l[h].flattenToArrayOffset(a._array,9*h);_.uniformMatrix3fv(c,!1,a._array);break;case"m4":_.uniformMatrix4fv(c,!1,l.elements);break;case"m4v":void 0===a._array&&(a._array=new Float32Array(16*l.length));for(var h=0,u=l.length;h<u;h++)l[h].flattenToArrayOffset(a._array,16*h);_.uniformMatrix4fv(c,!1,a._array);break;case"t":if(t=l,n=Ze(),_.uniform1i(c,n),!t)continue;t instanceof THREE.CubeTexture||t.image instanceof Array&&6===t.image.length?it(t,n):t instanceof THREE.WebGLRenderTargetCube?rt(t,n):R.setTexture(t,n);break;case"tv":void 0===a._array&&(a._array=[]);for(var h=0,u=a.value.length;h<u;h++)a._array[h]=Ze();_.uniform1iv(c,a._array);for(var h=0,u=a.value.length;h<u;h++)t=a.value[h],n=a._array[h],t&&R.setTexture(t,n);break;default:THREE.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}}(r.uniformsList)),function(e,t){_.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&_.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}(h,o),null!==h.modelMatrix&&_.uniformMatrix4fv(h.modelMatrix,!1,o.matrixWorld.elements),c}function Qe(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Je(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Ze(){var e=H;return e>=Y&&THREE.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Y),H+=1,e}function $e(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function et(e,t,n,i){e[t]=n.r*i,e[t+1]=n.g*i,e[t+2]=n.b*i}function tt(e,t,n){var i;n?(_.texParameteri(e,_.TEXTURE_WRAP_S,lt(t.wrapS)),_.texParameteri(e,_.TEXTURE_WRAP_T,lt(t.wrapT)),_.texParameteri(e,_.TEXTURE_MAG_FILTER,lt(t.magFilter)),_.texParameteri(e,_.TEXTURE_MIN_FILTER,lt(t.minFilter))):(_.texParameteri(e,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(e,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),t.wrapS===THREE.ClampToEdgeWrapping&&t.wrapT===THREE.ClampToEdgeWrapping||THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),_.texParameteri(e,_.TEXTURE_MAG_FILTER,st(t.magFilter)),_.texParameteri(e,_.TEXTURE_MIN_FILTER,st(t.minFilter)),t.minFilter!==THREE.NearestFilter&&t.minFilter!==THREE.LinearFilter&&THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(i=z.get("EXT_texture_filter_anisotropic"))&&t.type!==THREE.FloatType&&t.type!==THREE.HalfFloatType&&(t.anisotropy>1||t.__currentAnisotropy)&&(_.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,R.getMaxAnisotropy())),t.__currentAnisotropy=t.anisotropy)}function nt(e,t){if(e.width>t||e.height>t){var n=t/Math.max(e.width,e.height),i=document.createElement("canvas");return i.width=Math.floor(e.width*n),i.height=Math.floor(e.height*n),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),THREE.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height,e),i}return e}function it(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",fe),e.image.__webglTextureCube=_.createTexture(),R.info.memory.textures++),_.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var n=e instanceof THREE.CompressedTexture,i=e.image[0]instanceof THREE.DataTexture,r=[],o=0;o<6;o++)!R.autoScaleCubemaps||n||i?r[o]=i?e.image[o].image:e.image[o]:r[o]=nt(e.image[o],Z);var a=r[0],s=THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height),l=lt(e.format),c=lt(e.type);tt(_.TEXTURE_CUBE_MAP,e,s);for(o=0;o<6;o++)if(n)for(var h,u=r[o].mipmaps,d=0,p=u.length;d<p;d++)h=u[d],e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat?oe().indexOf(l)>-1?_.compressedTexImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,h.width,h.height,0,h.data):THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,h.width,h.height,0,l,c,h.data);else i?_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,r[o].width,r[o].height,0,l,c,r[o].data):_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,l,c,r[o]);e.generateMipmaps&&s&&_.generateMipmap(_.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else _.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function rt(e,t){_.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture)}function ot(e,t,n){_.bindFramebuffer(_.FRAMEBUFFER,e),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,n,t.__webglTexture,0)}function at(e,t){_.bindRenderbuffer(_.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_COMPONENT16,t.width,t.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_STENCIL,t.width,t.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,e)):_.renderbufferStorage(_.RENDERBUFFER,_.RGBA4,t.width,t.height)}function st(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?_.NEAREST:_.LINEAR}function lt(e){var t;if(e===THREE.RepeatWrapping)return _.REPEAT;if(e===THREE.ClampToEdgeWrapping)return _.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return _.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return _.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return _.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return _.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return _.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return _.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return _.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return _.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return _.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return _.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return _.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return _.BYTE;if(e===THREE.ShortType)return _.SHORT;if(e===THREE.UnsignedShortType)return _.UNSIGNED_SHORT;if(e===THREE.IntType)return _.INT;if(e===THREE.UnsignedIntType)return _.UNSIGNED_INT;if(e===THREE.FloatType)return _.FLOAT;if(null!==(t=z.get("OES_texture_half_float"))&&e===THREE.HalfFloatType)return t.HALF_FLOAT_OES;if(e===THREE.AlphaFormat)return _.ALPHA;if(e===THREE.RGBFormat)return _.RGB;if(e===THREE.RGBAFormat)return _.RGBA;if(e===THREE.LuminanceFormat)return _.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return _.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return _.FUNC_ADD;if(e===THREE.SubtractEquation)return _.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return _.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return _.ZERO;if(e===THREE.OneFactor)return _.ONE;if(e===THREE.SrcColorFactor)return _.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return _.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return _.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return _.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return _.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return _.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return _.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return _.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return _.SRC_ALPHA_SATURATE;if(null!==(t=z.get("WEBGL_compressed_texture_s3tc"))){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=z.get("WEBGL_compressed_texture_pvrtc"))){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=z.get("EXT_blend_minmax"))){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?_.disable(_.CULL_FACE):(t===THREE.FrontFaceDirectionCW?_.frontFace(_.CW):_.frontFace(_.CCW),e===THREE.CullFaceBack?_.cullFace(_.BACK):e===THREE.CullFaceFront?_.cullFace(_.FRONT):_.cullFace(_.FRONT_AND_BACK),_.enable(_.CULL_FACE))},this.setMaterialFaces=function(e){V.setDoubleSided(e.side===THREE.DoubleSide),V.setFlipSided(e.side===THREE.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",fe),e.__webglTexture=_.createTexture(),R.info.memory.textures++),_.bindTexture(_.TEXTURE_2D,e.__webglTexture),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,e.flipY),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),_.pixelStorei(_.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=nt(e.image,J);var t=e.image,n=THREE.Math.isPowerOfTwo(t.width)&&THREE.Math.isPowerOfTwo(t.height),i=lt(e.format),r=lt(e.type);tt(_.TEXTURE_2D,e,n);var o,a=e.mipmaps;if(e instanceof THREE.DataTexture)if(a.length>0&&n){for(var s=0,l=a.length;s<l;s++)o=a[s],_.texImage2D(_.TEXTURE_2D,s,i,o.width,o.height,0,i,r,o.data);e.generateMipmaps=!1}else _.texImage2D(_.TEXTURE_2D,0,i,t.width,t.height,0,i,r,t.data);else if(e instanceof THREE.CompressedTexture)for(s=0,l=a.length;s<l;s++)o=a[s],e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat?oe().indexOf(i)>-1?_.compressedTexImage2D(_.TEXTURE_2D,s,i,o.width,o.height,0,o.data):THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_.texImage2D(_.TEXTURE_2D,s,i,o.width,o.height,0,i,r,o.data);else if(a.length>0&&n){for(s=0,l=a.length;s<l;s++)o=a[s],_.texImage2D(_.TEXTURE_2D,s,i,i,r,o);e.generateMipmaps=!1}else _.texImage2D(_.TEXTURE_2D,0,i,i,r,e.image);e.generateMipmaps&&n&&_.generateMipmap(_.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){_.activeTexture(_.TEXTURE0+t),e.needsUpdate?R.uploadTexture(e):_.bindTexture(_.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,n,i,r,o,a=e instanceof THREE.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Ee),e.__webglTexture=_.createTexture(),R.info.memory.textures++;var s=THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height),l=lt(e.format),c=lt(e.type);if(a){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture),tt(_.TEXTURE_CUBE_MAP,e,s);for(var h=0;h<6;h++)e.__webglFramebuffer[h]=_.createFramebuffer(),e.__webglRenderbuffer[h]=_.createRenderbuffer(),_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,l,e.width,e.height,0,l,c,null),ot(e.__webglFramebuffer[h],e,_.TEXTURE_CUBE_MAP_POSITIVE_X+h),at(e.__webglRenderbuffer[h],e);s&&_.generateMipmap(_.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=_.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=_.createRenderbuffer(),_.bindTexture(_.TEXTURE_2D,e.__webglTexture),tt(_.TEXTURE_2D,e,s),_.texImage2D(_.TEXTURE_2D,0,l,e.width,e.height,0,l,c,null),ot(e.__webglFramebuffer,e,_.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,e.__webglRenderbuffer):at(e.__webglRenderbuffer,e),s&&_.generateMipmap(_.TEXTURE_2D);a?_.bindTexture(_.TEXTURE_CUBE_MAP,null):_.bindTexture(_.TEXTURE_2D,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null)}e?(t=a?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,i=e.height,r=0,o=0):(t=null,n=C,i=O,r=I,o=A),t!==w&&(_.bindFramebuffer(_.FRAMEBUFFER,t),_.viewport(r,o,n,i),w=t),P=n,G=i},this.readRenderTargetPixels=function(e,t,n,i,r,o){if(e instanceof THREE.WebGLRenderTarget){if(e.__webglFramebuffer){if(e.format!==THREE.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var a=!1;e.__webglFramebuffer!==w&&(_.bindFramebuffer(_.FRAMEBUFFER,e.__webglFramebuffer),a=!0),_.checkFramebufferStatus(_.FRAMEBUFFER)===_.FRAMEBUFFER_COMPLETE?_.readPixels(t,n,i,r,_.RGBA,_.UNSIGNED_BYTE,o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),a&&_.bindFramebuffer(_.FRAMEBUFFER,w)}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.initMaterial=function(){THREE.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){THREE.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},THREE.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:THREE.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==n.format?n.format:THREE.RGBAFormat,this.type=void 0!==n.type?n.type:THREE.UnsignedByteType,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==n.shareDepthFrom?n.shareDepthFrom:null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.WebGLExtensions=function(e){var t={};this.get=function(n){if(void 0!==t[n])return t[n];var i;switch(n){case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return null===i&&THREE.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=i,i}},THREE.WebGLProgram=function(){var e=0;return function(t,n,i,r){var o=t,a=o.context,s=i.defines,l=i.__webglShader.uniforms,c=i.attributes,h=i.__webglShader.vertexShader,u=i.__webglShader.fragmentShader,d=i.index0AttributeName;void 0===d&&!0===r.morphTargets&&(d="position");var p="SHADOWMAP_TYPE_BASIC";r.shadowMapType===THREE.PCFShadowMap?p="SHADOWMAP_TYPE_PCF":r.shadowMapType===THREE.PCFSoftShadowMap&&(p="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",E="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(i.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:f="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:f="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:f="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:E="ENVMAP_MODE_REFRACTION"}switch(i.combine){case THREE.MultiplyOperation:m="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:m="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:m="ENVMAP_BLENDING_ADD"}}var g,v,y=t.gammaFactor>0?t.gammaFactor:1,T=function(e){var t,n,i=[];for(var r in e)!1!==(t=e[r])&&(n="#define "+r+" "+t,i.push(n));return i.join("\n")}(s),_=a.createProgram();i instanceof THREE.RawShaderMaterial?(g="",v=""):(g=["precision "+r.precision+" float;","precision "+r.precision+" int;",T,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,"#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+E:"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals?"#define USE_MORPHNORMALS":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+p:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n"),v=["precision "+r.precision+" float;","precision "+r.precision+" int;",r.bumpMap||r.normalMap||r.flatShading?"#extension GL_OES_standard_derivatives : enable":"",T,"#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+f:"",r.envMap?"#define "+E:"",r.envMap?"#define "+m:"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.metal?"#define METAL":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+p:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var R=new THREE.WebGLShader(a,a.VERTEX_SHADER,g+h),b=new THREE.WebGLShader(a,a.FRAGMENT_SHADER,v+u);a.attachShader(_,R),a.attachShader(_,b),void 0!==d&&a.bindAttribLocation(_,0,d),a.linkProgram(_);var x=a.getProgramInfoLog(_);!1===a.getProgramParameter(_,a.LINK_STATUS)&&THREE.error("THREE.WebGLProgram: shader error: "+a.getError(),"gl.VALIDATE_STATUS",a.getProgramParameter(_,a.VALIDATE_STATUS),"gl.getPRogramInfoLog",x),""!==x&&THREE.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+x),a.deleteShader(R),a.deleteShader(b);var w=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];for(var M in r.useVertexTexture?(w.push("boneTexture"),w.push("boneTextureWidth"),w.push("boneTextureHeight")):w.push("boneGlobalMatrices"),r.logarithmicDepthBuffer&&w.push("logDepthBufFC"),l)w.push(M);this.uniforms=function(e,t,n){for(var i={},r=0,o=n.length;r<o;r++){var a=n[r];i[a]=e.getUniformLocation(t,a)}return i}(a,_,w),w=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var L=0;L<r.maxMorphTargets;L++)w.push("morphTarget"+L);for(L=0;L<r.maxMorphNormals;L++)w.push("morphNormal"+L);for(var S in c)w.push(S);return this.attributes=function(e,t,n){for(var i={},r=0,o=n.length;r<o;r++){var a=n[r];i[a]=e.getAttribLocation(t,a)}return i}(a,_,w),this.attributesKeys=Object.keys(this.attributes),this.id=e++,this.code=n,this.usedTimes=1,this.program=_,this.vertexShader=R,this.fragmentShader=b,this}}(),THREE.WebGLShader=function(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),!1===e.getShaderParameter(i,e.COMPILE_STATUS)&&THREE.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(i)&&THREE.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(i),function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(n)),i},THREE.WebGLState=function(e,t){var n=new Uint8Array(16),i=new Uint8Array(16),r=null,o=null,a=null,s=null,l=null,c=null,h=null,u=null,d=null,p=null,f=null,E=null,m=null,g=null,v=null,y=null;this.initAttributes=function(){for(var e=0,t=n.length;e<t;e++)n[e]=0},this.enableAttribute=function(t){n[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1)},this.disableUnusedAttributes=function(){for(var t=0,r=i.length;t<r;t++)i[t]!==n[t]&&(e.disableVertexAttribArray(t),i[t]=0)},this.setBlending=function(n,i,u,d,p,f,E){n!==r&&(n===THREE.NoBlending?e.disable(e.BLEND):n===THREE.AdditiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):n===THREE.SubtractiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):n===THREE.MultiplyBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):n===THREE.CustomBlending?e.enable(e.BLEND):(e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),r=n),n===THREE.CustomBlending?(p=p||i,f=f||u,E=E||d,i===o&&p===l||(e.blendEquationSeparate(t(i),t(p)),o=i,l=p),u===a&&d===s&&f===c&&E===h||(e.blendFuncSeparate(t(u),t(d),t(f),t(E)),a=u,s=d,c=f,h=E)):(o=null,a=null,s=null,l=null,c=null,h=null)},this.setDepthTest=function(t){u!==t&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),u=t)},this.setDepthWrite=function(t){d!==t&&(e.depthMask(t),d=t)},this.setColorWrite=function(t){p!==t&&(e.colorMask(t,t,t,t),p=t)},this.setDoubleSided=function(t){f!==t&&(t?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),f=t)},this.setFlipSided=function(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)},this.setLineWidth=function(t){t!==m&&(e.lineWidth(t),m=t)},this.setPolygonOffset=function(t,n,i){g!==t&&(t?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),g=t),!t||v===n&&y===i||(e.polygonOffset(n,i),v=n,y=i)},this.reset=function(){for(var e=0;e<i.length;e++)i[e]=0;r=null,u=null,d=null,p=null,f=null,E=null}},THREE.LensFlarePlugin=function(e,t){var n,i,r,o,a,s,l,c,h=e.context,u=function(){var t,u=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),d=new Uint16Array([0,1,2,0,2,3]);n=h.createBuffer(),i=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,n),h.bufferData(h.ARRAY_BUFFER,u,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),h.bufferData(h.ELEMENT_ARRAY_BUFFER,d,h.STATIC_DRAW),l=h.createTexture(),c=h.createTexture(),h.bindTexture(h.TEXTURE_2D,l),h.texImage2D(h.TEXTURE_2D,0,h.RGB,16,16,0,h.RGB,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.bindTexture(h.TEXTURE_2D,c),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,16,16,0,h.RGBA,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),t=(s=h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0)?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},r=function(t){var n=h.createProgram(),i=h.createShader(h.FRAGMENT_SHADER),r=h.createShader(h.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return h.shaderSource(i,o+t.fragmentShader),h.shaderSource(r,o+t.vertexShader),h.compileShader(i),h.compileShader(r),h.attachShader(n,i),h.attachShader(n,r),h.linkProgram(n),n}(t),o={vertex:h.getAttribLocation(r,"position"),uv:h.getAttribLocation(r,"uv")},a={renderType:h.getUniformLocation(r,"renderType"),map:h.getUniformLocation(r,"map"),occlusionMap:h.getUniformLocation(r,"occlusionMap"),opacity:h.getUniformLocation(r,"opacity"),color:h.getUniformLocation(r,"color"),scale:h.getUniformLocation(r,"scale"),rotation:h.getUniformLocation(r,"rotation"),screenPosition:h.getUniformLocation(r,"screenPosition")}};this.render=function(d,p,f,E){if(0!==t.length){var m=new THREE.Vector3,g=E/f,v=.5*f,y=.5*E,T=16/E,_=new THREE.Vector2(T*g,T),R=new THREE.Vector3(1,1,0),b=new THREE.Vector2(1,1);void 0===r&&u(),h.useProgram(r),h.enableVertexAttribArray(o.vertex),h.enableVertexAttribArray(o.uv),h.uniform1i(a.occlusionMap,0),h.uniform1i(a.map,1),h.bindBuffer(h.ARRAY_BUFFER,n),h.vertexAttribPointer(o.vertex,2,h.FLOAT,!1,16,0),h.vertexAttribPointer(o.uv,2,h.FLOAT,!1,16,8),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),h.disable(h.CULL_FACE),h.depthMask(!1);for(var x=0,w=t.length;x<w;x++){T=16/E,_.set(T*g,T);var M=t[x];if(m.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),m.applyMatrix4(p.matrixWorldInverse),m.applyProjection(p.projectionMatrix),R.copy(m),b.x=R.x*v+v,b.y=R.y*y+y,s||b.x>0&&b.x<f&&b.y>0&&b.y<E){h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,l),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGB,b.x-8,b.y-8,16,16,0),h.uniform1i(a.renderType,0),h.uniform2f(a.scale,_.x,_.y),h.uniform3f(a.screenPosition,R.x,R.y,R.z),h.disable(h.BLEND),h.enable(h.DEPTH_TEST),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,c),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,b.x-8,b.y-8,16,16,0),h.uniform1i(a.renderType,1),h.disable(h.DEPTH_TEST),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,l),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),M.positionScreen.copy(R),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),h.uniform1i(a.renderType,2),h.enable(h.BLEND);for(var L=0,S=M.lensFlares.length;L<S;L++){var H=M.lensFlares[L];H.opacity>.001&&H.scale>.001&&(R.x=H.x,R.y=H.y,R.z=H.z,T=H.size*H.scale/E,_.x=T*g,_.y=T,h.uniform3f(a.screenPosition,R.x,R.y,R.z),h.uniform2f(a.scale,_.x,_.y),h.uniform1f(a.rotation,H.rotation),h.uniform1f(a.opacity,H.opacity),h.uniform3f(a.color,H.color.r,H.color.g,H.color.b),e.state.setBlending(H.blending,H.blendEquation,H.blendSrc,H.blendDst),e.setTexture(H.texture,1),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0))}}}h.enable(h.CULL_FACE),h.enable(h.DEPTH_TEST),h.depthMask(!0),e.resetGLState()}}},THREE.ShadowMapPlugin=function(e,t,n,i){var r,o,a,s,l=e.context,c=new THREE.Frustum,h=new THREE.Matrix4,u=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3,f=[],E=THREE.ShaderLib.depthRGBA,m=THREE.UniformsUtils.clone(E.uniforms);function g(e,t,i){if(t.visible){var r=n[t.id];if(r&&t.castShadow&&(!1===t.frustumCulled||!0===c.intersectsObject(t)))for(var o=0,a=r.length;o<a;o++){var s=r[o];t._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),f.push(s)}for(o=0,a=t.children.length;o<a;o++)g(e,t.children[o],i)}}function v(e,t){var n=new THREE.DirectionalLight;n.isVirtual=!0,n.onlyShadow=!0,n.castShadow=!0,n.shadowCameraNear=e.shadowCameraNear,n.shadowCameraFar=e.shadowCameraFar,n.shadowCameraLeft=e.shadowCameraLeft,n.shadowCameraRight=e.shadowCameraRight,n.shadowCameraBottom=e.shadowCameraBottom,n.shadowCameraTop=e.shadowCameraTop,n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t],n.shadowMapWidth=e.shadowCascadeWidth[t],n.shadowMapHeight=e.shadowCascadeHeight[t],n.pointsWorld=[],n.pointsFrustum=[];for(var i=n.pointsWorld,r=n.pointsFrustum,o=0;o<8;o++)i[o]=new THREE.Vector3,r[o]=new THREE.Vector3;var a=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return r[0].set(-1,-1,a),r[1].set(1,-1,a),r[2].set(-1,1,a),r[3].set(1,1,a),r[4].set(-1,-1,s),r[5].set(1,-1,s),r[6].set(-1,1,s),r[7].set(1,1,s),n}function y(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position),n.target.position.copy(e.target.position),n.lookAt(n.target),n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],r=e.shadowCascadeFarZ[t],o=n.pointsFrustum;o[0].z=i,o[1].z=i,o[2].z=i,o[3].z=i,o[4].z=r,o[5].z=r,o[6].z=r,o[7].z=r}function T(e,t){var n=t.shadowCamera,i=t.pointsFrustum,r=t.pointsWorld;u.set(1/0,1/0,1/0),d.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var a=r[o];a.copy(i[o]),a.unproject(e),a.applyMatrix4(n.matrixWorldInverse),a.x<u.x&&(u.x=a.x),a.x>d.x&&(d.x=a.x),a.y<u.y&&(u.y=a.y),a.y>d.y&&(d.y=a.y),a.z<u.z&&(u.z=a.z),a.z>d.z&&(d.z=a.z)}n.left=u.x,n.right=d.x,n.top=d.y,n.bottom=u.y,n.updateProjectionMatrix()}function _(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}r=new THREE.ShaderMaterial({uniforms:m,vertexShader:E.vertexShader,fragmentShader:E.fragmentShader}),o=new THREE.ShaderMaterial({uniforms:m,vertexShader:E.vertexShader,fragmentShader:E.fragmentShader,morphTargets:!0}),a=new THREE.ShaderMaterial({uniforms:m,vertexShader:E.vertexShader,fragmentShader:E.fragmentShader,skinning:!0}),s=new THREE.ShaderMaterial({uniforms:m,vertexShader:E.vertexShader,fragmentShader:E.fragmentShader,morphTargets:!0,skinning:!0}),r._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0,s._shadowPass=!0,this.render=function(n,u){if(!1!==e.shadowMapEnabled){var d,E,m,R,b,x,w,M,L,S,H,I,A,C=[],O=0,P=null;for(l.clearColor(1,1,1,1),l.disable(l.BLEND),l.enable(l.CULL_FACE),l.frontFace(l.CCW),e.shadowMapCullFace===THREE.CullFaceFront?l.cullFace(l.FRONT):l.cullFace(l.BACK),e.state.setDepthTest(!0),d=0,E=t.length;d<E;d++)if((A=t[d]).castShadow)if(A instanceof THREE.DirectionalLight&&A.shadowCascade)for(b=0;b<A.shadowCascadeCount;b++){var G;if(A.shadowCascadeArray[b])G=A.shadowCascadeArray[b];else{(G=v(A,b)).originalCamera=u;var D=new THREE.Gyroscope;D.position.copy(A.shadowCascadeOffset),D.add(G),D.add(G.target),u.add(D),A.shadowCascadeArray[b]=G}y(A,b),C[O]=G,O++}else C[O]=A,O++;for(d=0,E=C.length;d<E;d++){if(!(A=C[d]).shadowMap){var k=THREE.LinearFilter;e.shadowMapType===THREE.PCFSoftShadowMap&&(k=THREE.NearestFilter);var B={minFilter:k,magFilter:k,format:THREE.RGBAFormat};A.shadowMap=new THREE.WebGLRenderTarget(A.shadowMapWidth,A.shadowMapHeight,B),A.shadowMapSize=new THREE.Vector2(A.shadowMapWidth,A.shadowMapHeight),A.shadowMatrix=new THREE.Matrix4}if(!A.shadowCamera){if(A instanceof THREE.SpotLight)A.shadowCamera=new THREE.PerspectiveCamera(A.shadowCameraFov,A.shadowMapWidth/A.shadowMapHeight,A.shadowCameraNear,A.shadowCameraFar);else{if(!(A instanceof THREE.DirectionalLight)){THREE.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",A);continue}A.shadowCamera=new THREE.OrthographicCamera(A.shadowCameraLeft,A.shadowCameraRight,A.shadowCameraTop,A.shadowCameraBottom,A.shadowCameraNear,A.shadowCameraFar)}n.add(A.shadowCamera),!0===n.autoUpdate&&n.updateMatrixWorld()}var N,j,F;for(A.shadowCameraVisible&&!A.cameraHelper&&(A.cameraHelper=new THREE.CameraHelper(A.shadowCamera),n.add(A.cameraHelper)),A.isVirtual&&G.originalCamera==u&&T(u,A),x=A.shadowMap,w=A.shadowMatrix,(M=A.shadowCamera).position.setFromMatrixPosition(A.matrixWorld),p.setFromMatrixPosition(A.target.matrixWorld),M.lookAt(p),M.updateMatrixWorld(),M.matrixWorldInverse.getInverse(M.matrixWorld),A.cameraHelper&&(A.cameraHelper.visible=A.shadowCameraVisible),A.shadowCameraVisible&&A.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(M.projectionMatrix),w.multiply(M.matrixWorldInverse),h.multiplyMatrices(M.projectionMatrix,M.matrixWorldInverse),c.setFromMatrix(h),e.setRenderTarget(x),e.clear(),f.length=0,g(n,n,M),m=0,R=f.length;m<R;m++)I=(H=f[m]).object,L=H.buffer,N=_(I),j=void 0!==I.geometry.morphTargets&&I.geometry.morphTargets.length>0&&N.morphTargets,F=I instanceof THREE.SkinnedMesh&&N.skinning,S=I.customDepthMaterial?I.customDepthMaterial:F?j?s:a:j?o:r,e.setMaterialFaces(N),L instanceof THREE.BufferGeometry?e.renderBufferDirect(M,t,P,S,L,I):e.renderBuffer(M,t,P,S,L,I);for(m=0,R=i.length;m<R;m++)(I=(H=i[m]).object).visible&&I.castShadow&&(I._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,I.matrixWorld),e.renderImmediateObject(M,t,P,r,I))}var U=e.getClearColor(),V=e.getClearAlpha();l.clearColor(U.r,U.g,U.b,V),l.enable(l.BLEND),e.shadowMapCullFace===THREE.CullFaceFront&&l.cullFace(l.BACK),e.resetGLState()}}},THREE.SpritePlugin=function(e,t){var n,i,r,o,a,s,l=e.context,c=new THREE.Vector3,h=new THREE.Quaternion,u=new THREE.Vector3,d=function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),c=new Uint16Array([0,1,2,0,2,3]);n=l.createBuffer(),i=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,n),l.bufferData(l.ARRAY_BUFFER,t,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),l.bufferData(l.ELEMENT_ARRAY_BUFFER,c,l.STATIC_DRAW),r=function(){var t=l.createProgram(),n=l.createShader(l.VERTEX_SHADER),i=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(n),l.compileShader(i),l.attachShader(t,n),l.attachShader(t,i),l.linkProgram(t),t}(),o={position:l.getAttribLocation(r,"position"),uv:l.getAttribLocation(r,"uv")},a={uvOffset:l.getUniformLocation(r,"uvOffset"),uvScale:l.getUniformLocation(r,"uvScale"),rotation:l.getUniformLocation(r,"rotation"),scale:l.getUniformLocation(r,"scale"),color:l.getUniformLocation(r,"color"),map:l.getUniformLocation(r,"map"),opacity:l.getUniformLocation(r,"opacity"),modelViewMatrix:l.getUniformLocation(r,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(r,"projectionMatrix"),fogType:l.getUniformLocation(r,"fogType"),fogDensity:l.getUniformLocation(r,"fogDensity"),fogNear:l.getUniformLocation(r,"fogNear"),fogFar:l.getUniformLocation(r,"fogFar"),fogColor:l.getUniformLocation(r,"fogColor"),alphaTest:l.getUniformLocation(r,"alphaTest")};var h=document.createElement("canvas");h.width=8,h.height=8;var u=h.getContext("2d");u.fillStyle="white",u.fillRect(0,0,8,8),(s=new THREE.Texture(h)).needsUpdate=!0};function p(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(f,E){if(0!==t.length){void 0===r&&d(),l.useProgram(r),l.enableVertexAttribArray(o.position),l.enableVertexAttribArray(o.uv),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,n),l.vertexAttribPointer(o.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(o.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),l.uniformMatrix4fv(a.projectionMatrix,!1,E.projectionMatrix.elements),l.activeTexture(l.TEXTURE0),l.uniform1i(a.map,0);var m=0,g=0,v=f.fog;v?(l.uniform3f(a.fogColor,v.color.r,v.color.g,v.color.b),v instanceof THREE.Fog?(l.uniform1f(a.fogNear,v.near),l.uniform1f(a.fogFar,v.far),l.uniform1i(a.fogType,1),m=1,g=1):v instanceof THREE.FogExp2&&(l.uniform1f(a.fogDensity,v.density),l.uniform1i(a.fogType,2),m=2,g=2)):(l.uniform1i(a.fogType,0),m=0,g=0);for(var y=0,T=t.length;y<T;y++){(R=t[y])._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,R.matrixWorld),R.z=-R._modelViewMatrix.elements[14]}t.sort(p);var _=[];for(y=0,T=t.length;y<T;y++){var R,b=(R=t[y]).material;l.uniform1f(a.alphaTest,b.alphaTest),l.uniformMatrix4fv(a.modelViewMatrix,!1,R._modelViewMatrix.elements),R.matrixWorld.decompose(c,h,u),_[0]=u.x,_[1]=u.y;var x=0;f.fog&&b.fog&&(x=g),m!==x&&(l.uniform1i(a.fogType,x),m=x),null!==b.map?(l.uniform2f(a.uvOffset,b.map.offset.x,b.map.offset.y),l.uniform2f(a.uvScale,b.map.repeat.x,b.map.repeat.y)):(l.uniform2f(a.uvOffset,0,0),l.uniform2f(a.uvScale,1,1)),l.uniform1f(a.opacity,b.opacity),l.uniform3f(a.color,b.color.r,b.color.g,b.color.b),l.uniform1f(a.rotation,b.rotation),l.uniform2fv(a.scale,_),e.state.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),e.state.setDepthTest(b.depthTest),e.state.setDepthWrite(b.depthWrite),b.map&&b.map.image&&b.map.image.width?e.setTexture(b.map,0):e.setTexture(s,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}l.enable(l.CULL_FACE),e.resetGLState()}}},THREE.GeometryUtils={merge:function(e,t,n){var i;THREE.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return THREE.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,n,i){var r=new THREE.ImageLoader;r.crossOrigin=this.crossOrigin;var o=new THREE.Texture(void 0,t);return r.load(e,function(e){o.image=e,o.needsUpdate=!0,n&&n(o)},void 0,function(e){i&&i(e)}),o.sourceFile=e,o},loadTextureCube:function(e,t,n,i){var r=new THREE.ImageLoader;r.crossOrigin=this.crossOrigin;var o=new THREE.CubeTexture([],t);o.flipY=!1;for(var a=0,s=function(t){r.load(e[t],function(e){o.images[t]=e,6===(a+=1)&&(o.needsUpdate=!0,n&&n(o))},void 0,i)},l=0,c=e.length;l<c;++l)s(l);return o},loadCompressedTexture:function(){THREE.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){THREE.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var n=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var r=e.width,o=e.height,a=document.createElement("canvas");a.width=r,a.height=o;var s=a.getContext("2d");s.drawImage(e,0,0);for(var l,c,h=s.getImageData(0,0,r,o).data,u=s.createImageData(r,o),d=u.data,p=0;p<r;p++)for(var f=0;f<o;f++){var E=f-1<0?0:f-1,m=f+1>o-1?o-1:f+1,g=p-1<0?0:p-1,v=p+1>r-1?r-1:p+1,y=[],T=[0,0,h[4*(f*r+p)]/255*t];y.push([-1,0,h[4*(f*r+g)]/255*t]),y.push([-1,-1,h[4*(E*r+g)]/255*t]),y.push([0,-1,h[4*(E*r+p)]/255*t]),y.push([1,-1,h[4*(E*r+v)]/255*t]),y.push([1,0,h[4*(f*r+v)]/255*t]),y.push([1,1,h[4*(m*r+v)]/255*t]),y.push([0,1,h[4*(m*r+p)]/255*t]),y.push([-1,1,h[4*(m*r+g)]/255*t]);for(var _=[],R=y.length,b=0;b<R;b++){var x=y[b],w=y[(b+1)%R];x=n(x,T),w=n(w,T),_.push(i((c=w,[(l=x)[1]*c[2]-l[2]*c[1],l[2]*c[0]-l[0]*c[2],l[0]*c[1]-l[1]*c[0]])))}var M=[0,0,0];for(b=0;b<_.length;b++)M[0]+=_[b][0],M[1]+=_[b][1],M[2]+=_[b][2];M[0]/=_.length,M[1]/=_.length,M[2]/=_.length;var L=4*(f*r+p);d[L]=(M[0]+1)/2*255|0,d[L+1]=(M[1]+1)/2*255|0,d[L+2]=255*M[2]|0,d[L+3]=255}return s.putImageData(u,0,0),a},generateDataTexture:function(e,t,n){for(var i=e*t,r=new Uint8Array(3*i),o=Math.floor(255*n.r),a=Math.floor(255*n.g),s=Math.floor(255*n.b),l=0;l<i;l++)r[3*l]=o,r[3*l+1]=a,r[3*l+2]=s;var c=new THREE.DataTexture(r,e,t,THREE.RGBFormat);return c.needsUpdate=!0,c}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var n=new THREE.Object3D,i=0,r=t.length;i<r;i++)n.add(new THREE.Mesh(e,t[i]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var i=new THREE.Matrix4;i.getInverse(n.matrixWorld),e.applyMatrix(i),t.remove(e),n.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),n=this;return n.faces[t]=n.faces[t]||{},n.faces[t][e.cssFontWeight]=n.faces[t][e.cssFontWeight]||{},n.faces[t][e.cssFontWeight][e.cssFontStyle]=e,n.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,n=this.getFace(),i=this.size/n.resolution,r=0,o=String(e).split(""),a=o.length,s=[];for(t=0;t<a;t++){var l=new THREE.Path,c=this.extractGlyphPoints(o[t],n,i,r,l);r+=c.offset,s.push(c.path)}return{paths:s,offset:r/2}},extractGlyphPoints:function(e,t,n,i,r){var o,a,s,l,c,h,u,d,p,f,E,m,g,v,y,T,_,R,b=[],x=t.glyphs[e]||t.glyphs["?"];if(x){if(x.o)for(c=(l=x._cachedOutline||(x._cachedOutline=x.o.split(" "))).length,h=n,u=n,o=0;o<c;)switch(l[o++]){case"m":d=l[o++]*h+i,p=l[o++]*u,r.moveTo(d,p);break;case"l":d=l[o++]*h+i,p=l[o++]*u,r.lineTo(d,p);break;case"q":if(f=l[o++]*h+i,E=l[o++]*u,v=l[o++]*h+i,y=l[o++]*u,r.quadraticCurveTo(v,y,f,E),R=b[b.length-1])for(m=R.x,g=R.y,a=1,s=this.divisions;a<=s;a++){var w=a/s;THREE.Shape.Utils.b2(w,m,v,f),THREE.Shape.Utils.b2(w,g,y,E)}break;case"b":if(f=l[o++]*h+i,E=l[o++]*u,v=l[o++]*h+i,y=l[o++]*u,T=l[o++]*h+i,_=l[o++]*u,r.bezierCurveTo(v,y,T,_,f,E),R=b[b.length-1])for(m=R.x,g=R.y,a=1,s=this.divisions;a<=s;a++){w=a/s;THREE.Shape.Utils.b3(w,m,v,T,f),THREE.Shape.Utils.b3(w,g,y,_,E)}}return{offset:x.ha*n,path:r}}}},THREE.FontUtils.generateShapes=function(e,t){var n=void 0!==(t=t||{}).size?t.size:100,i=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=n,THREE.FontUtils.divisions=i,THREE.FontUtils.face=r,THREE.FontUtils.weight=o,THREE.FontUtils.style=a;for(var s=THREE.FontUtils.drawText(e).paths,l=[],c=0,h=s.length;c<h;c++)Array.prototype.push.apply(l,s[c].toShapes());return l},function(e){var t=1e-10,n=function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},i=function(e,n,i,r,o,a){var s,l,c,h,u,d,p,f,E,m,g,v,y,T,_;if(l=e[a[n]].x,c=e[a[n]].y,h=e[a[i]].x,u=e[a[i]].y,d=e[a[r]].x,p=e[a[r]].y,t>(h-l)*(p-c)-(u-c)*(d-l))return!1;for(m=d-h,g=p-u,v=l-d,y=c-p,T=h-l,_=u-c,s=0;s<o;s++)if(f=e[a[s]].x,E=e[a[s]].y,!(f===l&&E===c||f===h&&E===u||f===d&&E===p)&&m*(E-u)-g*(f-h)>=-t&&v*(E-p)-y*(f-d)>=-t&&T*(E-c)-_*(f-l)>=-t)return!1;return!0};e.Triangulate=function(e,t){var r=e.length;if(r<3)return null;var o,a,s,l=[],c=[],h=[];if(n(e)>0)for(a=0;a<r;a++)c[a]=a;else for(a=0;a<r;a++)c[a]=r-1-a;var u=r,d=2*u;for(a=u-1;u>2;){if(d--<=0)return THREE.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),t?h:l;if(u<=(o=a)&&(o=0),u<=(a=o+1)&&(a=0),u<=(s=a+1)&&(s=0),i(e,o,a,s,u,c)){var p,f,E,m,g;for(p=c[o],f=c[a],E=c[s],l.push([e[p],e[f],e[E]]),h.push([c[o],c[a],c[s]]),m=a,g=a+1;g<u;m++,g++)c[m]=c[g];d=2*--u}}return t?h:l},e.Triangulate.area=n}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Audio=function(e){THREE.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.isPlaying=!1},THREE.Audio.prototype=Object.create(THREE.Object3D.prototype),THREE.Audio.prototype.constructor=THREE.Audio,THREE.Audio.prototype.load=function(e){var t=this,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},n.send(),this},THREE.Audio.prototype.play=function(){if(!0!==this.isPlaying){var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.connect(this.panner),e.start(0,this.startTime),this.isPlaying=!0,this.source=e}else THREE.warn("THREE.Audio: Audio is already playing.")},THREE.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},THREE.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},THREE.Audio.prototype.onEnded=function(){this.isPlaying=!1},THREE.Audio.prototype.setLoop=function(e){this.source.loop=e},THREE.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},THREE.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},THREE.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},THREE.Audio.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;return function(t){THREE.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),THREE.AudioListener=function(){THREE.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype),THREE.AudioListener.prototype.constructor=THREE.AudioListener,THREE.AudioListener.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3,t=new THREE.Quaternion,n=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3;return function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);var s=this.context.listener,l=this.up;this.matrixWorld.decompose(e,t,n),i.set(0,0,-1).applyQuaternion(t),r.subVectors(e,o),s.setPosition(e.x,e.y,e.z),s.setOrientation(i.x,i.y,i.z,l.x,l.y,l.z),s.setVelocity(r.x,r.y,r.z),o.copy(e)}}(),THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(e){return THREE.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],r=this.getPoint(0),o=0;for(i.push(0),n=1;n<=e;n++)o+=(t=this.getPoint(n/e)).distanceTo(r),i.push(o),r=t;return this.cacheArcLengths=i,i},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n,i=this.getLengths(),r=0,o=i.length;n=t||e*i[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=i[r=Math.floor(s+(l-s)/2)]-n)<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(i[r=l]==n)return r/(o-1);var c=i[r];return(r+(n-c)/(i[r+1]-c))/(o-1)},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var i=this.getPoint(t);return this.getPoint(n).clone().sub(i).normalize()},THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,i){return 2*(1-e)*(n-t)+2*e*(i-n)},tangentCubicBezier:function(e,t,n,i,r){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*r},tangentSpline:function(e,t,n,i,r){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,i,r){var o=.5*(n-e),a=.5*(i-t),s=r*r;return(2*t-2*n+o+a)*(r*s)+(-3*t+3*n-2*o-a)*s+o*r+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t,n=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=n){var o=1-(i[r]-n)/(t=this.curves[r]).getLength();return t.getPointAt(o)}r++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],n=0,i=this.curves.length;for(e=0;e<i;e++)n+=this.curves[e].getLength(),t.push(n);return this.cacheLengths=t,t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,n,i,r,o,a,s,l,c,h=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=r=Number.POSITIVE_INFINITY;var u=h[0]instanceof THREE.Vector3;for(c=u?new THREE.Vector3:new THREE.Vector2,s=0,l=h.length;s<l;s++)(a=h[s]).x>e?e=a.x:a.x<i&&(i=a.x),a.y>t?t=a.y:a.y<r&&(r=a.y),u&&(a.z>n?n=a.z:a.z<o&&(o=a.z)),c.add(a);var d={minX:i,minY:r,maxX:e,maxY:t};return u&&(d.maxZ=n,d.minZ=o),d},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,e[n].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n,i,r=this.getPoints(e);for(t||(t=this.bends),n=0,i=t.length;n<i;n++)r=this.getWrapPoints(r,t[n]);return r},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n,i,r=this.getSpacedPoints(e);for(t||(t=this.bends),n=0,i=t.length;n<i;n++)r=this.getWrapPoints(r,t[n]);return r},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n,i,r,o,a,s,l=this.getBoundingBox();for(n=0,i=e.length;n<i;n++){o=(r=e[n]).x,a=r.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var c=t.getPoint(s),h=t.getTangent(s);h.set(-h.y,h.x).multiplyScalar(a),r.x=c.x+h.x,r.y=c.y+h.y}return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.constructor=THREE.Gyroscope,THREE.Gyroscope.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3,t=new THREE.Quaternion,n=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Quaternion,o=new THREE.Vector3;return function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(i,r,o),this.matrix.decompose(e,t,n),this.matrixWorld.compose(i,t,o)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var s=0,l=this.children.length;s<l;s++)this.children[s].updateMatrixWorld(a)}}(),THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.Path.prototype.constructor=THREE.Path,THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],o=i[i.length-1],a=new THREE.LineCurve(new THREE.Vector2(r,o),new THREE.Vector2(e,t));this.curves.push(a),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,i){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],l=new THREE.QuadraticBezierCurve(new THREE.Vector2(a,s),new THREE.Vector2(e,t),new THREE.Vector2(n,i));this.curves.push(l),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:r})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,i,r,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1],h=new THREE.CubicBezierCurve(new THREE.Vector2(l,c),new THREE.Vector2(e,t),new THREE.Vector2(n,i),new THREE.Vector2(r,o));this.curves.push(h),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,i=n[n.length-2],r=n[n.length-1],o=[new THREE.Vector2(i,r)];Array.prototype.push.apply(o,e);var a=new THREE.SplineCurve(o);this.curves.push(a),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,i,r,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(e+s,t+l,n,i,r,o)},THREE.Path.prototype.absarc=function(e,t,n,i,r,o){this.absellipse(e,t,n,n,i,r,o)},THREE.Path.prototype.ellipse=function(e,t,n,i,r,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1];this.absellipse(e+l,t+c,n,i,r,o,a)},THREE.Path.prototype.absellipse=function(e,t,n,i,r,o,a){var s=Array.prototype.slice.call(arguments),l=new THREE.EllipseCurve(e,t,n,i,r,o,a);this.curves.push(l);var c=l.getPoint(1);s.push(c.x),s.push(c.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})},THREE.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var n=[],i=0;i<e;i++)n.push(this.getPoint(i/e));return n},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return window.console&&window.console.log&&console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var n,i,r,o,a,s,l,c,h,u,d,p,f,E,m,g,v,y,T=[];for(n=0,i=this.actions.length;n<i;n++)switch(o=(r=this.actions[n]).action,a=r.args,o){case THREE.PathActions.MOVE_TO:case THREE.PathActions.LINE_TO:T.push(new THREE.Vector2(a[0],a[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],l=a[3],u=a[0],d=a[1],T.length>0?(p=(E=T[T.length-1]).x,f=E.y):(p=(E=this.actions[n-1].args)[E.length-2],f=E[E.length-1]),m=1;m<=e;m++)g=m/e,v=THREE.Shape.Utils.b2(g,p,u,s),y=THREE.Shape.Utils.b2(g,f,d,l),T.push(new THREE.Vector2(v,y));break;case THREE.PathActions.BEZIER_CURVE_TO:for(s=a[4],l=a[5],u=a[0],d=a[1],c=a[2],h=a[3],T.length>0?(p=(E=T[T.length-1]).x,f=E.y):(p=(E=this.actions[n-1].args)[E.length-2],f=E[E.length-1]),m=1;m<=e;m++)g=m/e,v=THREE.Shape.Utils.b3(g,p,u,c,s),y=THREE.Shape.Utils.b3(g,f,d,h,l),T.push(new THREE.Vector2(v,y));break;case THREE.PathActions.CSPLINE_THRU:E=this.actions[n-1].args;var _=[new THREE.Vector2(E[E.length-2],E[E.length-1])],R=e*a[0].length;_=_.concat(a[0]);var b=new THREE.SplineCurve(_);for(m=1;m<=R;m++)T.push(b.getPointAt(m/R));break;case THREE.PathActions.ARC:var x=a[0],w=a[1],M=a[2],L=a[3],S=a[4],H=!!a[5],I=S-L,A=2*e;for(m=1;m<=A;m++)g=m/A,H||(g=1-g),C=L+g*I,v=x+M*Math.cos(C),y=w+M*Math.sin(C),T.push(new THREE.Vector2(v,y));break;case THREE.PathActions.ELLIPSE:x=a[0],w=a[1];var C,O=a[2],P=a[3];L=a[4],S=a[5],H=!!a[6],I=S-L,A=2*e;for(m=1;m<=A;m++)g=m/A,H||(g=1-g),C=L+g*I,v=x+O*Math.cos(C),y=w+P*Math.sin(C),T.push(new THREE.Vector2(v,y))}var G=T[T.length-1];return Math.abs(G.x-T[0].x)<1e-10&&Math.abs(G.y-T[0].y)<1e-10&&T.splice(T.length-1,1),t&&T.push(T[0]),T},THREE.Path.prototype.toShapes=function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],o=new THREE.Shape;o.actions=r.actions,o.curves=r.curves,t.push(o)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,o=0;o<n;r=o++){var a=t[r],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>1e-10){if(c<0&&(a=t[o],l=-l,s=t[r],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y==a.y){if(e.x==a.x)return!0}else{var h=c*(e.x-a.x)-l*(e.y-a.y);if(0==h)return!0;if(h<0)continue;i=!i}}else{if(e.y!=a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var r=function(e){var t,n,i,r,o,a=[],s=new THREE.Path;for(t=0,n=e.length;t<n;t++)o=(i=e[t]).args,(r=i.action)==THREE.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new THREE.Path),s[r].apply(s,o);return 0!=s.actions.length&&a.push(s),a}(this.actions);if(0==r.length)return[];if(!0===t)return n(r);var o,a,s,l=[];if(1==r.length)return a=r[0],(s=new THREE.Shape).actions=a.actions,s.curves=a.curves,l.push(s),l;var c=!THREE.Shape.Utils.isClockWise(r[0].getPoints());c=e?!c:c;var h,u,d,p,f,E,m=[],g=[],v=[],y=0;for(g[y]=void 0,v[y]=[],u=0,d=r.length;u<d;u++)h=(a=r[u]).getPoints(),o=THREE.Shape.Utils.isClockWise(h),(o=e?!o:o)?(!c&&g[y]&&y++,g[y]={s:new THREE.Shape,p:h},g[y].s.actions=a.actions,g[y].s.curves=a.curves,c&&y++,v[y]=[]):v[y].push({h:a,p:h[0]});if(!g[0])return n(r);if(g.length>1){for(var T=!1,_=[],R=0,b=g.length;R<b;R++)m[R]=[];for(R=0,b=g.length;R<b;R++)for(var x=v[R],w=0;w<x.length;w++){for(var M=x[w],L=!0,S=0;S<g.length;S++)i(M.p,g[S].p)&&(R!=S&&_.push({froms:R,tos:S,hole:w}),L?(L=!1,m[S].push(M)):T=!0);L&&m[R].push(M)}_.length>0&&(T||(v=m))}for(u=0,d=g.length;u<d;u++)for(s=g[u].s,l.push(s),f=0,E=(p=v[u]).length;f<E;f++)s.holes.push(p[f].h);return l},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.constructor=THREE.Shape,THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,i=[];for(t=0;t<n;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,i=[];for(t=0;t<n;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){return e.x!=t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function i(e,t,i,r,o){var a=t.x-e.x,s=t.y-e.y,l=r.x-i.x,c=r.y-i.y,h=e.x-i.x,u=e.y-i.y,d=s*l-a*c,p=s*h-a*u;if(Math.abs(d)>1e-10){var f;if(d>0){if(p<0||p>d)return[];if((f=c*h-l*u)<0||f>d)return[]}else{if(p>0||p<d)return[];if((f=c*h-l*u)>0||f<d)return[]}if(0==f)return!o||0!=p&&p!=d?[e]:[];if(f==d)return!o||0!=p&&p!=d?[t]:[];if(0==p)return[i];if(p==d)return[r];var E=f/d;return[{x:e.x+E*a,y:e.y+E*s}]}if(0!=p||c*h!=l*u)return[];var m,g,v,y,T,_,R,b,x=0==a&&0==s,w=0==l&&0==c;return x&&w?e.x!=i.x||e.y!=i.y?[]:[e]:x?n(i,r,e)?[e]:[]:w?n(e,t,i)?[i]:[]:(0!=a?(e.x<t.x?(m=e,v=e.x,g=t,y=t.x):(m=t,v=t.x,g=e,y=e.x),i.x<r.x?(T=i,R=i.x,_=r,b=r.x):(T=r,R=r.x,_=i,b=i.x)):(e.y<t.y?(m=e,v=e.y,g=t,y=t.y):(m=t,v=t.y,g=e,y=e.y),i.y<r.y?(T=i,R=i.y,_=r,b=r.y):(T=r,R=r.y,_=i,b=i.y)),v<=R?y<R?[]:y==R?o?[]:[T]:y<=b?[T,g]:[T,_]:v>b?[]:v==b?o?[]:[m]:y<=b?[m,g]:[m,_])}function r(e,t,n,i){var r=t.x-e.x,o=t.y-e.y,a=n.x-e.x,s=n.y-e.y,l=i.x-e.x,c=i.y-e.y,h=r*s-o*a,u=r*c-o*l;if(Math.abs(h)>1e-10){var d=l*s-c*a;return h>0?u>=0&&d>=0:u>=0||d>=0}return u>0}for(var o,a,s,l,c,h,u={},d=e.concat(),p=0,f=t.length;p<f;p++)Array.prototype.push.apply(d,t[p]);for(o=0,a=d.length;o<a;o++)void 0!==u[c=d[o].x+":"+d[o].y]&&THREE.warn("THREE.Shape: Duplicate point",c),u[c]=o;var E=function(e,t){var n,o=e.concat();function a(e,t){var i=o.length-1,a=e-1;a<0&&(a=i);var s=e+1;s>i&&(s=0);var l=r(o[e],o[a],o[s],n[t]);if(!l)return!1;var c=n.length-1,h=t-1;h<0&&(h=c);var u=t+1;return u>c&&(u=0),!!(l=r(n[t],n[h],n[u],o[e]))}function s(e,t){var n,r;for(n=0;n<o.length;n++)if(r=n+1,r%=o.length,i(e,t,o[n],o[r],!0).length>0)return!0;return!1}var l=[];function c(e,n){var r,o,a,s;for(r=0;r<l.length;r++)for(o=t[l[r]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,i(e,n,o[a],o[s],!0).length>0)return!0;return!1}for(var h,u,d,p,f,E,m,g,v,y,T=[],_=0,R=t.length;_<R;_++)l.push(_);for(var b=0,x=2*l.length;l.length>0;){if(--x<0){window.console&&window.console.log&&console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(u=b;u<o.length;u++){for(d=o[u],h=-1,_=0;_<l.length;_++)if(f=l[_],void 0===T[E=d.x+":"+d.y+":"+f]){n=t[f];for(var w=0;w<n.length;w++)if(p=n[w],a(u,w)&&!s(d,p)&&!c(d,p)){h=w,l.splice(_,1),m=o.slice(0,u+1),g=o.slice(u),v=n.slice(h),y=n.slice(0,h+1),o=m.concat(v).concat(y).concat(g),b=u;break}if(h>=0)break;T[E]=!0}if(h>=0)break}}return o}(e,t),m=THREE.FontUtils.Triangulate(E,!1);for(o=0,a=m.length;o<a;o++)for(l=m[o],s=0;s<3;s++)void 0!==(h=u[c=l[s].x+":"+l[s].y])&&(l[s]=h);return m.concat()},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,i){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,i)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,i,r){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,i)+this.b3p3(e,r)}},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new THREE.Vector2;return t.x=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new THREE.Vector2;return t.x=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},THREE.CubicBezierCurve=function(e,t,n,i){this.v0=e,this.v1=t,this.v2=n,this.v3=i},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,n)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,n;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new THREE.Vector2(t,n);return i.normalize(),i},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t=this.points,n=(t.length-1)*e,i=Math.floor(n),r=n-i,o=t[0==i?i:i-1],a=t[i],s=t[i>t.length-2?t.length-1:i+1],l=t[i>t.length-3?t.length-1:i+2],c=new THREE.Vector2;return c.x=THREE.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,r),c.y=THREE.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,r),c},THREE.EllipseCurve=function(e,t,n,i,r,o,a){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve,THREE.EllipseCurve.prototype.getPoint=function(e){var t,n=this.aEndAngle-this.aStartAngle;n<0&&(n+=2*Math.PI),n>2*Math.PI&&(n-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-n):this.aStartAngle+e*n;var i=new THREE.Vector2;return i.x=this.aX+this.xRadius*Math.cos(t),i.y=this.aY+this.yRadius*Math.sin(t),i},THREE.ArcCurve=function(e,t,n,i,r,o){THREE.EllipseCurve.call(this,e,t,n,n,i,r,o)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t=new THREE.Vector3;return t.x=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,i){this.v0=e,this.v1=t,this.v2=n,this.v3=i},function(e){var t=new THREE.Vector3;return t.x=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,n=(t.length-1)*e,i=Math.floor(n),r=n-i,o=t[0==i?i:i-1],a=t[i],s=t[i>t.length-2?t.length-1:i+1],l=t[i>t.length-3?t.length-1:i+2],c=new THREE.Vector3;return c.x=THREE.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,r),c.y=THREE.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,r),c.z=THREE.Curve.Utils.interpolate(o.z,a.z,s.z,l.z,r),c}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,n=(t.length-0)*e,i=Math.floor(n),r=n-i,o=t[((i+=i>0?0:(Math.floor(Math.abs(i)/t.length)+1)*t.length)-1)%t.length],a=t[i%t.length],s=t[(i+1)%t.length],l=t[(i+2)%t.length],c=new THREE.Vector3;return c.x=THREE.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,r),c.y=THREE.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,r),c.z=THREE.Curve.Utils.interpolate(o.z,a.z,s.z,l.z,r),c}),THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){THREE.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){THREE.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){THREE.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++)if(e.hierarchy[t].keys[n].time<0&&(e.hierarchy[t].keys[n].time=0),void 0!==e.hierarchy[t].keys[n].rot&&!(e.hierarchy[t].keys[n].rot instanceof THREE.Quaternion)){var i=e.hierarchy[t].keys[n].rot;e.hierarchy[t].keys[n].rot=(new THREE.Quaternion).fromArray(i)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var r={};for(n=0;n<e.hierarchy[t].keys.length;n++)for(var o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++){r[s=e.hierarchy[t].keys[n].morphTargets[o]]=-1}e.hierarchy[t].usedMorphTargets=r;for(n=0;n<e.hierarchy[t].keys.length;n++){var a={};for(var s in r){for(o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++)if(e.hierarchy[t].keys[n].morphTargets[o]===s){a[s]=e.hierarchy[t].keys[n].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[n].morphTargets.length&&(a[s]=0)}e.hierarchy[t].keys[n].morphTargetsInfluences=a}}for(n=1;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time&&(e.hierarchy[t].keys.splice(n,1),n--);for(n=0;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].index=n}return e.initialized=!0,e},parse:function(e){var t=function(e,n){n.push(e);for(var i=0;i<e.children.length;i++)t(e.children[i],n)},n=[];if(e instanceof THREE.SkinnedMesh)for(var i=0;i<e.skeleton.bones.length;i++)n.push(e.skeleton.bones[i]);else t(e,n);return n},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(t=0;t<this.animations.length;t++)this.animations[t].update(e)}},THREE.Animation=function(e,t){this.root=e,this.data=THREE.AnimationHandler.init(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=THREE.AnimationHandler.LINEAR},THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,THREE.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];void 0===n.animationCache&&(n.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var i=this.data.name,r=n.animationCache.animations,o=r[i];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:n.matrix},r[i]=o);for(var a=0;a<3;a++){for(var s=this.keyTypes[a],l=this.data.hierarchy[e].keys[0],c=this.getNextKeyWith(s,e,1);c.time<this.currentTime&&c.index>l.index;)l=c,c=this.getNextKeyWith(s,e,c.index+1);o.prevKey[s]=l,o.nextKey[s]=c}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e].animationCache;if(void 0!==n){var i=n.blending;i.positionWeight=0,i.quaternionWeight=0,i.scaleWeight=0}}},update:function(){var e=[],t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Quaternion,r=function(e,t){var n,i,r,a,s,l,c,h,u,d=[],p=[];return r=(n=(e.length-1)*t)-(i=Math.floor(n)),d[0]=0===i?i:i-1,d[1]=i,d[2]=i>e.length-2?i:i+1,d[3]=i>e.length-3?i:i+2,l=e[d[0]],c=e[d[1]],h=e[d[2]],u=e[d[3]],s=r*(a=r*r),p[0]=o(l[0],c[0],h[0],u[0],r,a,s),p[1]=o(l[1],c[1],h[1],u[1],r,a,s),p[2]=o(l[2],c[2],h[2],u[2],r,a,s),p},o=function(e,t,n,i,r,o,a){var s=.5*(n-e),l=.5*(i-t);return(2*(t-n)+s+l)*a+(-3*(t-n)-2*s-l)*o+s*r+t};return function(o){if(!1!==this.isPlaying&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var a=this.data.length;(this.currentTime>a||this.currentTime<0)&&(this.loop?(this.currentTime%=a,this.currentTime<0&&(this.currentTime+=a),this.reset()):this.stop());for(var s=0,l=this.hierarchy.length;s<l;s++)for(var c=this.hierarchy[s],h=c.animationCache.animations[this.data.name],u=c.animationCache.blending,d=0;d<3;d++){var p=this.keyTypes[d],f=h.prevKey[p],E=h.nextKey[p];if(this.timeScale>0&&E.time<=this.currentTime||this.timeScale<0&&f.time>=this.currentTime){for(f=this.data.hierarchy[s].keys[0],E=this.getNextKeyWith(p,s,1);E.time<this.currentTime&&E.index>f.index;)f=E,E=this.getNextKeyWith(p,s,E.index+1);h.prevKey[p]=f,h.nextKey[p]=E}var m=(this.currentTime-f.time)/(E.time-f.time),g=f[p],v=E[p];if(m<0&&(m=0),m>1&&(m=1),"pos"===p){if(this.interpolationType===THREE.AnimationHandler.LINEAR){n.x=g[0]+(v[0]-g[0])*m,n.y=g[1]+(v[1]-g[1])*m,n.z=g[2]+(v[2]-g[2])*m;var y=this.weight/(this.weight+u.positionWeight);c.position.lerp(n,y),u.positionWeight+=this.weight}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",s,f.index-1).pos,e[1]=g,e[2]=v,e[3]=this.getNextKeyWith("pos",s,E.index+1).pos;var T=r(e,m=.33*m+.33);y=this.weight/(this.weight+u.positionWeight);u.positionWeight+=this.weight;var _=c.position;if(_.x=_.x+(T[0]-_.x)*y,_.y=_.y+(T[1]-_.y)*y,_.z=_.z+(T[2]-_.z)*y,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var R=r(e,1.01*m);t.set(R[0],R[1],R[2]),t.sub(_),t.y=0,t.normalize();var b=Math.atan2(t.x,t.z);c.rotation.set(0,b,0)}}}else if("rot"===p)if(THREE.Quaternion.slerp(g,v,i,m),0===u.quaternionWeight)c.quaternion.copy(i),u.quaternionWeight=this.weight;else{y=this.weight/(this.weight+u.quaternionWeight);THREE.Quaternion.slerp(c.quaternion,i,c.quaternion,y),u.quaternionWeight+=this.weight}else if("scl"===p){n.x=g[0]+(v[0]-g[0])*m,n.y=g[1]+(v[1]-g[1])*m,n.z=g[2]+(v[2]-g[2])*m;y=this.weight/(this.weight+u.scaleWeight);c.scale.lerp(n,y),u.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n=n<i.length-1?n:i.length-1:n%=i.length;n<i.length;n++)if(void 0!==i[n][e])return i[n];return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+i.length;n>=0;n--)if(void 0!==i[n][e])return i[n];return this.data.hierarchy[t].keys[i.length-1]}},THREE.KeyFrameAnimation=function(e){this.root=e.node,this.data=THREE.AnimationHandler.init(e),this.hierarchy=THREE.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,n=this.hierarchy.length;t<n;t++){var i=this.data.hierarchy[t].keys,r=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(i.length&&r){for(var a=0;a<r.length;a++){var s=r[a],l=this.getNextKeyWith(s,t,0);l&&l.apply(s)}o.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,n,i,r=this.hierarchy.length;for(t=0;t<r;t++){n=this.hierarchy[t],void 0===(i=this.data.hierarchy[t]).animationCache&&(i.animationCache={},i.animationCache.prevKey=null,i.animationCache.nextKey=null,i.animationCache.originalMatrix=n.matrix);var o=this.data.hierarchy[t].keys;o.length&&(i.animationCache.prevKey=o[0],i.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(void 0!==n.animationCache){var i=n.animationCache.originalMatrix;i.copy(t.matrix),t.matrix=i,delete n.animationCache}}},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var n=0,i=this.hierarchy.length;n<i;n++){var r=this.hierarchy[n],o=this.data.hierarchy[n],a=o.keys,s=o.animationCache;if(a.length){var l=s.prevKey,c=s.nextKey;if(c.time<=this.currentTime){for(;c.time<this.currentTime&&c.index>l.index;)c=a[(l=c).index+1];s.prevKey=l,s.nextKey=c}c.time>=this.currentTime?l.interpolate(c,this.currentTime):l.interpolate(c,c.time),this.data.hierarchy[n].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(n%=i.length;n<i.length;n++)if(i[n].hasTarget(e))return i[n];return i[0]},getPrevKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(n=n>=0?n:n+i.length;n>=0;n--)if(i[n].hasTarget(e))return i[n];return i[i.length-1]}},THREE.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},THREE.MorphAnimation.prototype={constructor:THREE.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,n=Math.floor(this.currentTime/t),i=this.mesh.morphTargetInfluences;n!=this.currentFrame&&(i[this.lastFrame]=0,i[this.currentFrame]=1,i[n]=0,this.lastFrame=this.currentFrame,this.currentFrame=n),i[n]=this.currentTime%t/t,i[this.lastFrame]=1-i[n]}}},THREE.BoxGeometry=function(e,t,n,i,r,o){THREE.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o},this.widthSegments=i||1,this.heightSegments=r||1,this.depthSegments=o||1;var a=this,s=e/2,l=t/2,c=n/2;function h(e,t,n,i,r,o,s,l){var c,h,u,d=a.widthSegments,p=a.heightSegments,f=r/2,E=o/2,m=a.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",p=a.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",d=a.depthSegments);var g=d+1,v=p+1,y=r/d,T=o/p,_=new THREE.Vector3;for(_[c]=s>0?1:-1,u=0;u<v;u++)for(h=0;h<g;h++){var R=new THREE.Vector3;R[e]=(h*y-f)*n,R[t]=(u*T-E)*i,R[c]=s,a.vertices.push(R)}for(u=0;u<p;u++)for(h=0;h<d;h++){var b=h+g*u,x=h+g*(u+1),w=h+1+g*(u+1),M=h+1+g*u,L=new THREE.Vector2(h/d,1-u/p),S=new THREE.Vector2(h/d,1-(u+1)/p),H=new THREE.Vector2((h+1)/d,1-(u+1)/p),I=new THREE.Vector2((h+1)/d,1-u/p),A=new THREE.Face3(b+m,x+m,M+m);A.normal.copy(_),A.vertexNormals.push(_.clone(),_.clone(),_.clone()),A.materialIndex=l,a.faces.push(A),a.faceVertexUvs[0].push([L,S,I]),(A=new THREE.Face3(x+m,w+m,M+m)).normal.copy(_),A.vertexNormals.push(_.clone(),_.clone(),_.clone()),A.materialIndex=l,a.faces.push(A),a.faceVertexUvs[0].push([S.clone(),H,I.clone()])}}h("z","y",-1,-1,n,t,s,0),h("z","y",1,-1,n,t,-s,1),h("x","z",1,1,e,n,l,2),h("x","z",1,-1,e,n,-l,3),h("x","y",1,-1,e,t,c,4),h("x","y",-1,-1,e,t,-c,5),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry,THREE.CircleGeometry=function(e,t,n,i){THREE.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||50,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var r,o=[],a=new THREE.Vector3,s=new THREE.Vector2(.5,.5);for(this.vertices.push(a),o.push(s),r=0;r<=t;r++){var l=new THREE.Vector3,c=n+r/t*i;l.x=e*Math.cos(c),l.y=e*Math.sin(c),this.vertices.push(l),o.push(new THREE.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var h=new THREE.Vector3(0,0,1);for(r=1;r<=t;r++)this.faces.push(new THREE.Face3(r,r+1,0,[h.clone(),h.clone(),h.clone()])),this.faceVertexUvs[0].push([o[r].clone(),o[r+1].clone(),s.clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry,THREE.CubeGeometry=function(e,t,n,i,r,o){return THREE.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new THREE.BoxGeometry(e,t,n,i,r,o)},THREE.CylinderGeometry=function(e,t,n,i,r,o,a,s){THREE.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},e=void 0!==e?e:20,t=void 0!==t?t:20,n=void 0!==n?n:100,i=i||8,r=r||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var l,c,h=n/2,u=[],d=[];for(c=0;c<=r;c++){var p=[],f=[],E=c/r,m=E*(t-e)+e;for(l=0;l<=i;l++){var g=l/i,v=new THREE.Vector3;v.x=m*Math.sin(g*s+a),v.y=-E*n+h,v.z=m*Math.cos(g*s+a),this.vertices.push(v),p.push(this.vertices.length-1),f.push(new THREE.Vector2(g,1-E))}u.push(p),d.push(f)}var y,T,_=(t-e)/n;for(l=0;l<i;l++)for(0!==e?(y=this.vertices[u[0][l]].clone(),T=this.vertices[u[0][l+1]].clone()):(y=this.vertices[u[1][l]].clone(),T=this.vertices[u[1][l+1]].clone()),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*_).normalize(),T.setY(Math.sqrt(T.x*T.x+T.z*T.z)*_).normalize(),c=0;c<r;c++){var R=u[c][l],b=u[c+1][l],x=u[c+1][l+1],w=u[c][l+1],M=y.clone(),L=y.clone(),S=T.clone(),H=T.clone(),I=d[c][l].clone(),A=d[c+1][l].clone(),C=d[c+1][l+1].clone(),O=d[c][l+1].clone();this.faces.push(new THREE.Face3(R,b,w,[M,L,H])),this.faceVertexUvs[0].push([I,A,O]),this.faces.push(new THREE.Face3(b,x,w,[L.clone(),S,H.clone()])),this.faceVertexUvs[0].push([A.clone(),C,O.clone()])}if(!1===o&&e>0)for(this.vertices.push(new THREE.Vector3(0,h,0)),l=0;l<i;l++){R=u[0][l],b=u[0][l+1],x=this.vertices.length-1,M=new THREE.Vector3(0,1,0),L=new THREE.Vector3(0,1,0),S=new THREE.Vector3(0,1,0),I=d[0][l].clone(),A=d[0][l+1].clone(),C=new THREE.Vector2(A.x,0);this.faces.push(new THREE.Face3(R,b,x,[M,L,S])),this.faceVertexUvs[0].push([I,A,C])}if(!1===o&&t>0)for(this.vertices.push(new THREE.Vector3(0,-h,0)),l=0;l<i;l++){R=u[r][l+1],b=u[r][l],x=this.vertices.length-1,M=new THREE.Vector3(0,-1,0),L=new THREE.Vector3(0,-1,0),S=new THREE.Vector3(0,-1,0),I=d[r][l+1].clone(),A=d[r][l].clone(),C=new THREE.Vector2(A.x,1);this.faces.push(new THREE.Face3(R,b,x,[M,L,S])),this.faceVertexUvs[0].push([I,A,C])}this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.ExtrudeGeometry=function(e,t){void 0!==e?(THREE.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),this.computeFaceNormals()):e=[]},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,i=0;i<n;i++){var r=e[i];this.addShape(r,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){var n,i,r,o,a,s,l,c,h=void 0!==t.amount?t.amount:100,u=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:u-2,p=void 0!==t.bevelSegments?t.bevelSegments:3,f=void 0===t.bevelEnabled||t.bevelEnabled,E=void 0!==t.curveSegments?t.curveSegments:12,m=void 0!==t.steps?t.steps:1,g=t.extrudePath,v=!1,y=t.material,T=t.extrudeMaterial,_=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;g&&(n=g.getSpacedPoints(m),v=!0,f=!1,i=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(g,m,!1),r=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3),f||(p=0,u=0,d=0);var R=this,b=this.vertices.length,x=e.extractPoints(E),w=x.shape,M=x.holes,L=!THREE.Shape.Utils.isClockWise(w);if(L){for(w=w.reverse(),l=0,c=M.length;l<c;l++)s=M[l],THREE.Shape.Utils.isClockWise(s)&&(M[l]=s.reverse());L=!1}var S=THREE.Shape.Utils.triangulateShape(w,M),H=w;for(l=0,c=M.length;l<c;l++)s=M[l],w=w.concat(s);function I(e,t,n){return t||THREE.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var A,C,O,P,G,D,k=w.length,B=S.length;function N(e,t,n){var i,r,o=1e-10,a=1,s=e.x-t.x,l=e.y-t.y,c=n.x-e.x,h=n.y-e.y,u=s*s+l*l,d=s*h-l*c;if(Math.abs(d)>o){var p=Math.sqrt(u),f=Math.sqrt(c*c+h*h),E=t.x-l/p,m=t.y+s/p,g=((n.x-h/f-E)*h-(n.y+c/f-m)*c)/(s*h-l*c),v=(i=E+s*g-e.x)*i+(r=m+l*g-e.y)*r;if(v<=2)return new THREE.Vector2(i,r);a=Math.sqrt(v/2)}else{var y=!1;s>o?c>o&&(y=!0):s<-o?c<-o&&(y=!0):Math.sign(l)==Math.sign(h)&&(y=!0),y?(i=-l,r=s,a=Math.sqrt(u)):(i=s,r=l,a=Math.sqrt(u/2))}return new THREE.Vector2(i/a,r/a)}for(var j=[],F=0,U=H.length,V=U-1,z=F+1;F<U;F++,V++,z++)V===U&&(V=0),z===U&&(z=0),j[F]=N(H[F],H[V],H[z]);var W,q,X=[],K=j.concat();for(l=0,c=M.length;l<c;l++){for(s=M[l],W=[],F=0,V=(U=s.length)-1,z=F+1;F<U;F++,V++,z++)V===U&&(V=0),z===U&&(z=0),W[F]=N(s[F],s[V],s[z]);X.push(W),K=K.concat(W)}for(A=0;A<p;A++){for(P=u*(1-(O=A/p)),C=d*Math.sin(O*Math.PI/2),F=0,U=H.length;F<U;F++)Q((G=I(H[F],j[F],C)).x,G.y,-P);for(l=0,c=M.length;l<c;l++)for(s=M[l],W=X[l],F=0,U=s.length;F<U;F++)Q((G=I(s[F],W[F],C)).x,G.y,-P)}for(C=d,F=0;F<k;F++)G=f?I(w[F],K[F],C):w[F],v?(o.copy(i.normals[0]).multiplyScalar(G.x),r.copy(i.binormals[0]).multiplyScalar(G.y),a.copy(n[0]).add(o).add(r),Q(a.x,a.y,a.z)):Q(G.x,G.y,0);for(q=1;q<=m;q++)for(F=0;F<k;F++)G=f?I(w[F],K[F],C):w[F],v?(o.copy(i.normals[q]).multiplyScalar(G.x),r.copy(i.binormals[q]).multiplyScalar(G.y),a.copy(n[q]).add(o).add(r),Q(a.x,a.y,a.z)):Q(G.x,G.y,h/m*q);for(A=p-1;A>=0;A--){for(P=u*(1-(O=A/p)),C=d*Math.sin(O*Math.PI/2),F=0,U=H.length;F<U;F++)Q((G=I(H[F],j[F],C)).x,G.y,h+P);for(l=0,c=M.length;l<c;l++)for(s=M[l],W=X[l],F=0,U=s.length;F<U;F++)G=I(s[F],W[F],C),v?Q(G.x,G.y+n[m-1].y,n[m-1].x+P):Q(G.x,G.y,h+P)}function Y(e,t){var n,i;for(F=e.length;--F>=0;){n=F,(i=F-1)<0&&(i=e.length-1);var r=0,o=m+2*p;for(r=0;r<o;r++){var a=k*r,s=k*(r+1);Z(t+n+a,t+i+a,t+i+s,t+n+s,e,r,o,n,i)}}}function Q(e,t,n){R.vertices.push(new THREE.Vector3(e,t,n))}function J(e,t,n){e+=b,t+=b,n+=b,R.faces.push(new THREE.Face3(e,t,n,null,null,y));var i=_.generateTopUV(R,e,t,n);R.faceVertexUvs[0].push(i)}function Z(e,t,n,i,r,o,a,s,l){e+=b,t+=b,n+=b,i+=b,R.faces.push(new THREE.Face3(e,t,i,null,null,T)),R.faces.push(new THREE.Face3(t,n,i,null,null,T));var c=_.generateSideWallUV(R,e,t,n,i);R.faceVertexUvs[0].push([c[0],c[1],c[3]]),R.faceVertexUvs[0].push([c[1],c[2],c[3]])}!function(){if(f){var e=0,t=k*e;for(F=0;F<B;F++)J((D=S[F])[2]+t,D[1]+t,D[0]+t);for(t=k*(e=m+2*p),F=0;F<B;F++)J((D=S[F])[0]+t,D[1]+t,D[2]+t)}else{for(F=0;F<B;F++)J((D=S[F])[2],D[1],D[0]);for(F=0;F<B;F++)J((D=S[F])[0]+k*m,D[1]+k*m,D[2]+k*m)}}(),function(){var e=0;for(Y(H,e),e+=H.length,l=0,c=M.length;l<c;l++)Y(s=M[l],e),e+=s.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,i){var r=e.vertices,o=r[t],a=r[n],s=r[i];return[new THREE.Vector2(o.x,o.y),new THREE.Vector2(a.x,a.y),new THREE.Vector2(s.x,s.y)]},generateSideWallUV:function(e,t,n,i,r){var o=e.vertices,a=o[t],s=o[n],l=o[i],c=o[r];return Math.abs(a.y-s.y)<.01?[new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(s.x,1-s.z),new THREE.Vector2(l.x,1-l.z),new THREE.Vector2(c.x,1-c.z)]:[new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(s.y,1-s.z),new THREE.Vector2(l.y,1-l.z),new THREE.Vector2(c.y,1-c.z)]}},THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry,THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,i=e.length;n<i;n++)this.addShape(e[n],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var n,i,r,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,c=e.extractPoints(o),h=c.shape,u=c.holes,d=!THREE.Shape.Utils.isClockWise(h);if(d){for(h=h.reverse(),n=0,i=u.length;n<i;n++)r=u[n],THREE.Shape.Utils.isClockWise(r)&&(u[n]=r.reverse());d=!1}var p=THREE.Shape.Utils.triangulateShape(h,u);for(n=0,i=u.length;n<i;n++)r=u[n],h=h.concat(r);var f,E,m=h.length,g=p.length;for(n=0;n<m;n++)f=h[n],this.vertices.push(new THREE.Vector3(f.x,f.y,0));for(n=0;n<g;n++){var v=(E=p[n])[0]+l,y=E[1]+l,T=E[2]+l;this.faces.push(new THREE.Face3(v,y,T,null,null,a)),this.faceVertexUvs[0].push(s.generateTopUV(this,v,y,T))}},THREE.LatheGeometry=function(e,t,n,i){THREE.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=t||12,n=n||0,i=i||2*Math.PI;for(var r=1/(e.length-1),o=1/t,a=0,s=t;a<=s;a++)for(var l=n+a*o*i,c=Math.cos(l),h=Math.sin(l),u=0,d=e.length;u<d;u++){var p=e[u],f=new THREE.Vector3;f.x=c*p.x-h*p.y,f.y=h*p.x+c*p.y,f.z=p.z,this.vertices.push(f)}var E=e.length;for(a=0,s=t;a<s;a++)for(u=0,d=e.length-1;u<d;u++){var m=u+E*a,g=m,v=m+E,y=(c=m+1+E,m+1),T=a*o,_=u*r,R=T+o,b=_+r;this.faces.push(new THREE.Face3(g,v,y)),this.faceVertexUvs[0].push([new THREE.Vector2(T,_),new THREE.Vector2(R,_),new THREE.Vector2(T,b)]),this.faces.push(new THREE.Face3(v,c,y)),this.faceVertexUvs[0].push([new THREE.Vector2(R,_),new THREE.Vector2(R,b),new THREE.Vector2(T,b)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,n,i){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),THREE.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new THREE.PlaneBufferGeometry(e,t,n,i))},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.PlaneBufferGeometry=function(e,t,n,i){THREE.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};for(var r=e/2,o=t/2,a=n||1,s=i||1,l=a+1,c=s+1,h=e/a,u=t/s,d=new Float32Array(l*c*3),p=new Float32Array(l*c*3),f=new Float32Array(l*c*2),E=0,m=0,g=0;g<c;g++)for(var v=g*u-o,y=0;y<l;y++){var T=y*h-r;d[E]=T,d[E+1]=-v,p[E+2]=1,f[m]=y/a,f[m+1]=1-g/s,E+=3,m+=2}E=0;var _=new(d.length/3>65535?Uint32Array:Uint16Array)(a*s*6);for(g=0;g<s;g++)for(y=0;y<a;y++){var R=y+l*g,b=y+l*(g+1),x=y+1+l*(g+1),w=y+1+l*g;_[E]=R,_[E+1]=b,_[E+2]=w,_[E+3]=b,_[E+4]=x,_[E+5]=w,E+=6}this.addAttribute("index",new THREE.BufferAttribute(_,1)),this.addAttribute("position",new THREE.BufferAttribute(d,3)),this.addAttribute("normal",new THREE.BufferAttribute(p,3)),this.addAttribute("uv",new THREE.BufferAttribute(f,2))},THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry,THREE.RingGeometry=function(e,t,n,i,r,o){THREE.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},e=e||0,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,l=[],c=e,h=(t-e)/(i=void 0!==i?Math.max(1,i):8);for(a=0;a<i+1;a++){for(s=0;s<n+1;s++){var u=new THREE.Vector3,d=r+s/n*o;u.x=c*Math.cos(d),u.y=c*Math.sin(d),this.vertices.push(u),l.push(new THREE.Vector2((u.x/t+1)/2,(u.y/t+1)/2))}c+=h}var p=new THREE.Vector3(0,0,1);for(a=0;a<i;a++){var f=a*(n+1);for(s=0;s<n;s++){var E=d=s+f,m=d+n+1,g=d+n+2;this.faces.push(new THREE.Face3(E,m,g,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([l[E].clone(),l[m].clone(),l[g].clone()]),E=d,m=d+n+2,g=d+1,this.faces.push(new THREE.Face3(E,m,g,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([l[E].clone(),l[m].clone(),l[g].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry.prototype.constructor=THREE.RingGeometry,THREE.SphereGeometry=function(e,t,n,i,r,o,a){THREE.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,c=[],h=[];for(l=0;l<=n;l++){var u=[],d=[];for(s=0;s<=t;s++){var p=s/t,f=l/n,E=new THREE.Vector3;E.x=-e*Math.cos(i+p*r)*Math.sin(o+f*a),E.y=e*Math.cos(o+f*a),E.z=e*Math.sin(i+p*r)*Math.sin(o+f*a),this.vertices.push(E),u.push(this.vertices.length-1),d.push(new THREE.Vector2(p,1-f))}c.push(u),h.push(d)}for(l=0;l<n;l++)for(s=0;s<t;s++){var m=c[l][s+1],g=c[l][s],v=c[l+1][s],y=c[l+1][s+1],T=this.vertices[m].clone().normalize(),_=this.vertices[g].clone().normalize(),R=this.vertices[v].clone().normalize(),b=this.vertices[y].clone().normalize(),x=h[l][s+1].clone(),w=h[l][s].clone(),M=h[l+1][s].clone(),L=h[l+1][s+1].clone();Math.abs(this.vertices[m].y)===e?(x.x=(x.x+w.x)/2,this.faces.push(new THREE.Face3(m,v,y,[T,R,b])),this.faceVertexUvs[0].push([x,M,L])):Math.abs(this.vertices[v].y)===e?(M.x=(M.x+L.x)/2,this.faces.push(new THREE.Face3(m,g,v,[T,_,R])),this.faceVertexUvs[0].push([x,w,M])):(this.faces.push(new THREE.Face3(m,g,y,[T,_,b])),this.faceVertexUvs[0].push([x,w,L]),this.faces.push(new THREE.Face3(g,v,y,[_.clone(),R,b.clone()])),this.faceVertexUvs[0].push([w.clone(),M,L.clone()]))}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.TextGeometry=function(e,t){t=t||{};var n=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,n,t),this.type="TextGeometry"},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.TorusGeometry=function(e,t,n,i,r){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},e=e||100,t=t||40,n=n||8,i=i||6,r=r||2*Math.PI;for(var o=new THREE.Vector3,a=[],s=[],l=0;l<=n;l++)for(var c=0;c<=i;c++){var h=c/i*r,u=l/n*Math.PI*2;o.x=e*Math.cos(h),o.y=e*Math.sin(h);var d=new THREE.Vector3;d.x=(e+t*Math.cos(u))*Math.cos(h),d.y=(e+t*Math.cos(u))*Math.sin(h),d.z=t*Math.sin(u),this.vertices.push(d),a.push(new THREE.Vector2(c/i,l/n)),s.push(d.clone().sub(o).normalize())}for(l=1;l<=n;l++)for(c=1;c<=i;c++){var p=(i+1)*l+c-1,f=(i+1)*(l-1)+c-1,E=(i+1)*(l-1)+c,m=(i+1)*l+c,g=new THREE.Face3(p,f,m,[s[p].clone(),s[f].clone(),s[m].clone()]);this.faces.push(g),this.faceVertexUvs[0].push([a[p].clone(),a[f].clone(),a[m].clone()]),g=new THREE.Face3(f,E,m,[s[f].clone(),s[E].clone(),s[m].clone()]),this.faces.push(g),this.faceVertexUvs[0].push([a[f].clone(),a[E].clone(),a[m].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotGeometry=function(e,t,n,i,r,o,a){THREE.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,p:r,q:o,heightScale:a},e=e||100,t=t||40,n=n||64,i=i||8,r=r||2,o=o||3,a=a||1;for(var s=new Array(n),l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,u=0;u<n;++u){s[u]=new Array(i);var d=u/n*2*r*Math.PI,p=I(d,o,r,e,a),f=I(d+.01,o,r,e,a);l.subVectors(f,p),c.addVectors(f,p),h.crossVectors(l,c),c.crossVectors(h,l),h.normalize(),c.normalize();for(var E=0;E<i;++E){var m=E/i*2*Math.PI,g=-t*Math.cos(m),v=t*Math.sin(m),y=new THREE.Vector3;y.x=p.x+g*c.x+v*h.x,y.y=p.y+g*c.y+v*h.y,y.z=p.z+g*c.z+v*h.z,s[u][E]=this.vertices.push(y)-1}}for(u=0;u<n;++u)for(E=0;E<i;++E){var T=(u+1)%n,_=(E+1)%i,R=s[u][E],b=s[T][E],x=s[T][_],w=s[u][_],M=new THREE.Vector2(u/n,E/i),L=new THREE.Vector2((u+1)/n,E/i),S=new THREE.Vector2((u+1)/n,(E+1)/i),H=new THREE.Vector2(u/n,(E+1)/i);this.faces.push(new THREE.Face3(R,b,w)),this.faceVertexUvs[0].push([M,L,H]),this.faces.push(new THREE.Face3(b,x,w)),this.faceVertexUvs[0].push([L.clone(),S,H.clone()])}function I(e,t,n,i,r){var o=Math.cos(e),a=Math.sin(e),s=t/n*e,l=Math.cos(s),c=i*(2+l)*.5*o,h=i*(2+l)*a*.5,u=r*i*Math.sin(s)*.5;return new THREE.Vector3(c,h,u)}this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.TubeGeometry=function(e,t,n,i,r,o){THREE.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:n,radialSegments:i,closed:r},t=t||64,n=n||1,i=i||8,r=r||!1,o=o||THREE.TubeGeometry.NoTaper;var a,s,l,c,h,u,d,p,f,E,m,g,v,y,T,_,R,b,x,w,M,L,S,H=[],I=this,A=t+1,C=new THREE.Vector3,O=new THREE.TubeGeometry.FrenetFrames(e,t,r),P=O.tangents,G=O.normals,D=O.binormals;for(this.tangents=P,this.normals=G,this.binormals=D,f=0;f<A;f++)for(H[f]=[],l=f/(A-1),p=e.getPointAt(l),P[f],a=G[f],s=D[f],h=n*o(l),E=0;E<i;E++)c=E/i*2*Math.PI,u=-h*Math.cos(c),d=h*Math.sin(c),C.copy(p),C.x+=u*a.x+d*s.x,C.y+=u*a.y+d*s.y,C.z+=u*a.z+d*s.z,H[f][E]=(M=C.x,L=C.y,S=C.z,I.vertices.push(new THREE.Vector3(M,L,S))-1);for(f=0;f<t;f++)for(E=0;E<i;E++)m=r?(f+1)%t:f+1,g=(E+1)%i,v=H[f][E],y=H[m][E],T=H[m][g],_=H[f][g],R=new THREE.Vector2(f/t,E/i),b=new THREE.Vector2((f+1)/t,E/i),x=new THREE.Vector2((f+1)/t,(E+1)/i),w=new THREE.Vector2(f/t,(E+1)/i),this.faces.push(new THREE.Face3(v,y,_)),this.faceVertexUvs[0].push([R,b,w]),this.faces.push(new THREE.Face3(y,T,_)),this.faceVertexUvs[0].push([b.clone(),x,w.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry,THREE.TubeGeometry.NoTaper=function(e){return 1},THREE.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},THREE.TubeGeometry.FrenetFrames=function(e,t,n){var i,r,o,a,s,l,c,h=new THREE.Vector3,u=[],d=[],p=[],f=new THREE.Vector3,E=new THREE.Matrix4,m=t+1;for(this.tangents=u,this.normals=d,this.binormals=p,l=0;l<m;l++)c=l/(m-1),u[l]=e.getTangentAt(c),u[l].normalize();for(function(){d[0]=new THREE.Vector3,p[0]=new THREE.Vector3,r=Number.MAX_VALUE,o=Math.abs(u[0].x),a=Math.abs(u[0].y),s=Math.abs(u[0].z),o<=r&&(r=o,h.set(1,0,0));a<=r&&(r=a,h.set(0,1,0));s<=r&&h.set(0,0,1);f.crossVectors(u[0],h).normalize(),d[0].crossVectors(u[0],f),p[0].crossVectors(u[0],d[0])}(),l=1;l<m;l++)d[l]=d[l-1].clone(),p[l]=p[l-1].clone(),f.crossVectors(u[l-1],u[l]),f.length()>1e-4&&(f.normalize(),i=Math.acos(THREE.Math.clamp(u[l-1].dot(u[l]),-1,1)),d[l].applyMatrix4(E.makeRotationAxis(f,i))),p[l].crossVectors(u[l],d[l]);if(n)for(i=Math.acos(THREE.Math.clamp(d[0].dot(d[m-1]),-1,1)),i/=m-1,u[0].dot(f.crossVectors(d[0],d[m-1]))>0&&(i=-i),l=1;l<m;l++)d[l].applyMatrix4(E.makeRotationAxis(u[l],i*l)),p[l].crossVectors(u[l],d[l])},THREE.PolyhedronGeometry=function(e,t,n,i){THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1,i=i||0;for(var r=this,o=0,a=e.length;o<a;o+=3)T(new THREE.Vector3(e[o],e[o+1],e[o+2]));var s=this.vertices,l=[],c=(o=0,0);for(a=t.length;o<a;o+=3,c++){var h=s[t[o]],u=s[t[o+1]],d=s[t[o+2]];l[c]=new THREE.Face3(h.index,u.index,d.index,[h.clone(),u.clone(),d.clone()])}var p=new THREE.Vector3;for(o=0,a=l.length;o<a;o++)R(l[o],i);for(o=0,a=this.faceVertexUvs[0].length;o<a;o++){var f=this.faceVertexUvs[0][o],E=f[0].x,m=f[1].x,g=f[2].x,v=Math.max(E,Math.max(m,g)),y=Math.min(E,Math.min(m,g));v>.9&&y<.1&&(E<.2&&(f[0].x+=1),m<.2&&(f[1].x+=1),g<.2&&(f[2].x+=1))}for(o=0,a=this.vertices.length;o<a;o++)this.vertices[o].multiplyScalar(n);function T(e){var t=e.normalize().clone();t.index=r.vertices.push(t)-1;var n=b(e)/2/Math.PI+.5,i=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new THREE.Vector2(n,1-i),t}function _(e,t,n){var i=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);r.faces.push(i),p.copy(e).add(t).add(n).divideScalar(3);var o=b(p);r.faceVertexUvs[0].push([x(e.uv,e,o),x(t.uv,t,o),x(n.uv,n,o)])}function R(e,t){for(var n=Math.pow(2,t),i=T(r.vertices[e.a]),o=T(r.vertices[e.b]),a=T(r.vertices[e.c]),s=[],l=0;l<=n;l++){s[l]=[];for(var c=T(i.clone().lerp(a,l/n)),h=T(o.clone().lerp(a,l/n)),u=n-l,d=0;d<=u;d++)s[l][d]=0==d&&l==n?c:T(c.clone().lerp(h,d/u))}for(l=0;l<n;l++)for(d=0;d<2*(n-l)-1;d++){var p=Math.floor(d/2);d%2==0?_(s[l][p+1],s[l+1][p],s[l][p]):_(s[l][p+1],s[l+1][p+1],s[l+1][p])}}function b(e){return Math.atan2(e.z,-e.x)}function x(e,t,n){return n<0&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry,THREE.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i];THREE.PolyhedronGeometry.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t)},THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry,THREE.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];THREE.PolyhedronGeometry.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry,THREE.ParametricGeometry=function(e,t,n){THREE.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};var i,r,o,a,s,l,c,h,u,d,p,f,E=this.vertices,m=this.faces,g=this.faceVertexUvs[0],v=t+1;for(i=0;i<=n;i++)for(a=i/n,r=0;r<=t;r++)o=e(r/t,a),E.push(o);for(i=0;i<n;i++)for(r=0;r<t;r++)s=i*v+r,l=i*v+r+1,c=(i+1)*v+r+1,h=(i+1)*v+r,u=new THREE.Vector2(r/t,i/n),d=new THREE.Vector2((r+1)/t,i/n),p=new THREE.Vector2((r+1)/t,(i+1)/n),f=new THREE.Vector2(r/t,(i+1)/n),m.push(new THREE.Face3(s,l,h)),g.push([u,d,f]),m.push(new THREE.Face3(l,c,h)),g.push([d.clone(),p,f.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry,THREE.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.BufferAttribute(t,3)),i.addAttribute("color",new THREE.BufferAttribute(n,3));var r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,i,r,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.AxisHelper.prototype.constructor=THREE.AxisHelper,THREE.ArrowHelper=function(){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var t=new THREE.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),function(n,i,r,o,a,s){THREE.Object3D.call(this),void 0===o&&(o=16776960),void 0===r&&(r=1),void 0===a&&(a=.2*r),void 0===s&&(s=.2*a),this.position.copy(i),this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(r,a,s)}}(),THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper,THREE.ArrowHelper.prototype.setDirection=function(){var e,t=new THREE.Vector3;return function(n){n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(n.z,0,-n.x).normalize(),e=Math.acos(n.y),this.quaternion.setFromAxisAngle(t,e))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,e-t,1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},THREE.BoxHelper=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3)),THREE.Line.call(this,t,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.constructor=THREE.BoxHelper,THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var n=t.boundingBox.min,i=t.boundingBox.max,r=this.geometry.attributes.position.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=n.x,r[4]=i.y,r[5]=i.z,r[6]=n.x,r[7]=i.y,r[8]=i.z,r[9]=n.x,r[10]=n.y,r[11]=i.z,r[12]=n.x,r[13]=n.y,r[14]=i.z,r[15]=i.x,r[16]=n.y,r[17]=i.z,r[18]=i.x,r[19]=n.y,r[20]=i.z,r[21]=i.x,r[22]=i.y,r[23]=i.z,r[24]=i.x,r[25]=i.y,r[26]=n.z,r[27]=n.x,r[28]=i.y,r[29]=n.z,r[30]=n.x,r[31]=i.y,r[32]=n.z,r[33]=n.x,r[34]=n.y,r[35]=n.z,r[36]=n.x,r[37]=n.y,r[38]=n.z,r[39]=i.x,r[40]=n.y,r[41]=n.z,r[42]=i.x,r[43]=n.y,r[44]=n.z,r[45]=i.x,r[46]=i.y,r[47]=n.z,r[48]=i.x,r[49]=i.y,r[50]=i.z,r[51]=i.x,r[52]=i.y,r[53]=n.z,r[54]=n.x,r[55]=i.y,r[56]=i.z,r[57]=n.x,r[58]=i.y,r[59]=n.z,r[60]=n.x,r[61]=n.y,r[62]=i.z,r[63]=n.x,r[64]=n.y,r[65]=n.z,r[66]=i.x,r[67]=n.y,r[68]=i.z,r[69]=i.x,r[70]=n.y,r[71]=n.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.BoundingBoxHelper=function(e,t){var n=void 0!==t?t:8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:n,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper,THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){var t=new THREE.Geometry,n=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),i={},r=16755200,o=16711680,a=43775,s=3355443;function l(e,t,n){c(e,n),c(t,n)}function c(e,n){t.vertices.push(new THREE.Vector3),t.colors.push(new THREE.Color(n)),void 0===i[e]&&(i[e]=[]),i[e].push(t.vertices.length-1)}l("n1","n2",r),l("n2","n4",r),l("n4","n3",r),l("n3","n1",r),l("f1","f2",r),l("f2","f4",r),l("f4","f3",r),l("f3","f1",r),l("n1","f1",r),l("n2","f2",r),l("n3","f3",r),l("n4","f4",r),l("p","n1",o),l("p","n2",o),l("p","n3",o),l("p","n4",o),l("u1","u2",a),l("u2","u3",a),l("u3","u1",a),l("c","t",16777215),l("p","c",s),l("cn1","cn2",s),l("cn3","cn4",s),l("cf1","cf2",s),l("cf3","cf4",s),THREE.Line.call(this,t,n,THREE.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){var e,t,n=new THREE.Vector3,i=new THREE.Camera,r=function(r,o,a,s){n.set(o,a,s).unproject(i);var l=t[r];if(void 0!==l)for(var c=0,h=l.length;c<h;c++)e.vertices[l[c]].copy(n)};return function(){e=this.geometry,t=this.pointMap;i.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),e.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(-t,t,0),new THREE.Vector3(t,t,0),new THREE.Vector3(t,-t,0),new THREE.Vector3(-t,-t,0),new THREE.Vector3(-t,t,0));var i=new THREE.LineBasicMaterial({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Line(n,i),this.add(this.lightPlane),(n=new THREE.Geometry).vertices.push(new THREE.Vector3,new THREE.Vector3),(i=new THREE.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(n,i),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper,THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(e,t,n){var i=void 0!==t?t:16777215;n=void 0!==n?n:1;var r,o=Math.cos(THREE.Math.degToRad(n)),a=[0,0],s={},l=function(e,t){return e-t},c=["a","b","c"],h=new THREE.BufferGeometry;e.geometry instanceof THREE.BufferGeometry?(r=new THREE.Geometry).fromBufferGeometry(e.geometry):r=e.geometry.clone(),r.mergeVertices(),r.computeFaceNormals();for(var u=r.vertices,d=r.faces,p=0,f=0,E=d.length;f<E;f++)for(var m=d[f],g=0;g<3;g++){a[0]=m[c[g]],a[1]=m[c[(g+1)%3]],a.sort(l),void 0===s[T=a.toString()]?(s[T]={vert1:a[0],vert2:a[1],face1:f,face2:void 0},p++):s[T].face2=f}var v=new Float32Array(2*p*3),y=0;for(var T in s){var _=s[T];if(void 0===_.face2||d[_.face1].normal.dot(d[_.face2].normal)<=o){var R=u[_.vert1];v[y++]=R.x,v[y++]=R.y,v[y++]=R.z,R=u[_.vert2],v[y++]=R.x,v[y++]=R.y,v[y++]=R.z}}h.addAttribute("position",new THREE.BufferAttribute(v,3)),THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:i}),THREE.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype),THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper,THREE.FaceNormalsHelper=function(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==n?n:16776960,o=void 0!==i?i:1,a=new THREE.Geometry,s=0,l=this.object.geometry.faces.length;s<l;s++)a.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:r,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper,THREE.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,n=t.geometry.vertices,i=t.geometry.faces,r=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(r);for(var o=0,a=0,s=i.length;o<s;o++,a+=2){var l=i[o];e[a].copy(n[l.a]).add(n[l.b]).add(n[l.c]).divideScalar(3).applyMatrix4(r),e[a+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[a])}return this.geometry.verticesNeedUpdate=!0,this},THREE.GridHelper=function(e,t){var n=new THREE.Geometry,i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var r=-e;r<=e;r+=t){n.vertices.push(new THREE.Vector3(-e,0,r),new THREE.Vector3(e,0,r),new THREE.Vector3(r,0,-e),new THREE.Vector3(r,0,e));var o=0===r?this.color1:this.color2;n.colors.push(o,o,o,o)}THREE.Line.call(this,n,i,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.constructor=THREE.GridHelper,THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var n=new THREE.SphereGeometry(t,4,2);n.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var i=0;i<8;i++)n.faces[i].color=this.colors[i<4?0:1];var r=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(n,r),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper,THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var n=new THREE.SphereGeometry(t,4,2),i=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper,THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new THREE.Geometry,n=0;n<this.bones.length;n++){this.bones[n].parent instanceof THREE.Bone&&(t.vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3),t.colors.push(new THREE.Color(0,0,1)),t.colors.push(new THREE.Color(0,1,0)))}var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.Line.call(this,t,i,THREE.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype),THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper,THREE.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof THREE.Bone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,this.getBoneList(e.children[n]));return t},THREE.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new THREE.Matrix4).getInverse(this.root.matrixWorld),n=new THREE.Matrix4,i=0,r=0;r<this.bones.length;r++){var o=this.bones[r];o.parent instanceof THREE.Bone&&(n.multiplyMatrices(t,o.matrixWorld),e.vertices[i].setFromMatrixPosition(n),n.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[i+1].setFromMatrixPosition(n),i+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new THREE.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var n=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(t,n),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper,THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,i=n*Math.tan(this.light.angle);this.cone.scale.set(i,i,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==n?n:16711680,o=void 0!==i?i:1,a=new THREE.Geometry,s=e.geometry.faces,l=0,c=s.length;l<c;l++)for(var h=0,u=s[l].vertexNormals.length;h<u;h++)a.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:r,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper,THREE.VertexNormalsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,l=0,c=o.length;l<c;l++)for(var h=o[l],u=0,d=h.vertexNormals.length;u<d;u++){var p=r[h[n[u]]],f=h.vertexNormals[u];i[s].copy(p).applyMatrix4(a),t.copy(f).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(i[s]),i[s+=1].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==n?n:255,o=void 0!==i?i:1,a=new THREE.Geometry,s=e.geometry.faces,l=0,c=s.length;l<c;l++)for(var h=0,u=s[l].vertexTangents.length;h<u;h++)a.vertices.push(new THREE.Vector3),a.vertices.push(new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:r,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.constructor=THREE.VertexTangentsHelper,THREE.VertexTangentsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var i=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,l=0,c=o.length;l<c;l++)for(var h=o[l],u=0,d=h.vertexTangents.length;u<d;u++){var p=r[h[n[u]]],f=h.vertexTangents[u];i[s].copy(p).applyMatrix4(a),t.copy(f).transformDirection(a).multiplyScalar(this.size),t.add(i[s]),i[s+=1].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(e,t){var n=void 0!==t?t:16777215,i=[0,0],r={},o=function(e,t){return e-t},a=["a","b","c"],s=new THREE.BufferGeometry;if(e.geometry instanceof THREE.Geometry){for(var l=e.geometry.vertices,c=e.geometry.faces,h=0,u=new Uint32Array(6*c.length),d=0,p=c.length;d<p;d++)for(var f=c[d],E=0;E<3;E++){i[0]=f[a[E]],i[1]=f[a[(E+1)%3]],i.sort(o),void 0===r[M=i.toString()]&&(u[2*h]=i[0],u[2*h+1]=i[1],r[M]=!0,h++)}var m=new Float32Array(2*h*3);for(d=0,p=h;d<p;d++)for(E=0;E<2;E++){var g=l[u[2*d+E]];m[(x=6*d+3*E)+0]=g.x,m[x+1]=g.y,m[x+2]=g.z}s.addAttribute("position",new THREE.BufferAttribute(m,3))}else if(e.geometry instanceof THREE.BufferGeometry)if(void 0!==e.geometry.attributes.index){l=e.geometry.attributes.position.array;var v=e.geometry.attributes.index.array,y=e.geometry.drawcalls;h=0;0===y.length&&(y=[{count:v.length,index:0,start:0}]);u=new Uint32Array(2*v.length);for(var T=0,_=y.length;T<_;++T)for(var R=y[T].start,b=y[T].count,x=y[T].index,w=(d=R,R+b);d<w;d+=3)for(E=0;E<3;E++){var M;i[0]=x+v[d+E],i[1]=x+v[d+(E+1)%3],i.sort(o),void 0===r[M=i.toString()]&&(u[2*h]=i[0],u[2*h+1]=i[1],r[M]=!0,h++)}for(m=new Float32Array(2*h*3),d=0,p=h;d<p;d++)for(E=0;E<2;E++){x=6*d+3*E;var L=3*u[2*d+E];m[x+0]=l[L],m[x+1]=l[L+1],m[x+2]=l[L+2]}s.addAttribute("position",new THREE.BufferAttribute(m,3))}else{var S=(h=(l=e.geometry.attributes.position.array).length/3)/3;for(m=new Float32Array(2*h*3),d=0,p=S;d<p;d++)for(E=0;E<3;E++){var H=9*d+3*E;m[(x=18*d+6*E)+0]=l[H],m[x+1]=l[H+1],m[x+2]=l[H+2];L=9*d+(E+1)%3*3;m[x+3]=l[L],m[x+4]=l[L+1],m[x+5]=l[L+2]}s.addAttribute("position",new THREE.BufferAttribute(m,3))}THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper,THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(e){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject,THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,i="__default",r=n-1,o=n/1;this.createAnimation(i,0,r,o),this.setAnimationWeight(i,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh,THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,i){var r={startFrame:t,endFrame:n,length:n-t+1,fps:i,duration:(n-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=r,this.animationsList.push(r)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,n=/([a-z]+)_?(\d+)/,i={},r=this.geometry,o=0,a=r.morphTargets.length;o<a;o++){var s=r.morphTargets[o].name.match(n);if(s&&s.length>1)i[l=s[1]]||(i[l]={start:1/0,end:-1/0}),o<(c=i[l]).start&&(c.start=o),o>c.end&&(c.end=o),t||(t=l)}for(var l in i){var c=i[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,n=this.animationsMap[e];return n&&(t=n.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,n=this.animationsMap[e];return n&&(t=n.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):THREE.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var i=this.animationsList[t];if(i.active){var r=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var o=i.startFrame+THREE.Math.clamp(Math.floor(i.time/r),0,i.length-1),a=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*a,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o);var s=i.time%r/r;i.directionBackwards&&(s=1-s),this.morphTargetInfluences[i.currentFrame]=s*a,this.morphTargetInfluences[i.lastFrame]=(1-s)*a}}},GEMIOLI.Utils={},GEMIOLI.Utils.path=function(e){var t={},n=e.lastIndexOf("/"),i=e.lastIndexOf("\\");n<i?(t.dir=e.substr(0,i),e=e.substr(i+1),t.backslash=!0):i<n?(t.dir=e.substr(0,n),e=e.substr(n+1)):t.dir="";var r=e.lastIndexOf(".");return-1!=r?(t.ext=e.substr(r+1),t.file=e.substr(0,r)):(t.ext="",t.file=e),t},GEMIOLI.Utils.clamp=function(e,t,n){return Math.max(t,Math.min(n,e))},GEMIOLI.Utils.rand=function(){return Math.floor(2147483647*Math.random())},GEMIOLI.Utils.randInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},GEMIOLI.Utils.isMobile=function(){var e=isMobile.any;return function(){return e}}(),GEMIOLI.Utils.LOCAL_STORAGE_PATH="com.gemioli.tombrunner.",GEMIOLI.Utils.getLocalStorage=function(){var e;try{"localStorage"in window&&null!==window.localStorage?(e=window.localStorage).test=1:e={}}catch(t){e={}}return function(){return e}}(),GEMIOLI.Utils.resetLocalStorage=function(){var e=GEMIOLI.Utils.getLocalStorage();for(var t in e)delete e[t]},GEMIOLI.Utils.getBool=function(e,t){var n=GEMIOLI.Utils.getLocalStorage();return void 0!==n[GEMIOLI.Utils.LOCAL_STORAGE_PATH+e]?0!==parseInt(n[GEMIOLI.Utils.LOCAL_STORAGE_PATH+e]):t},GEMIOLI.Utils.setBool=function(e,t){return GEMIOLI.Utils.getLocalStorage()[GEMIOLI.Utils.LOCAL_STORAGE_PATH+e]=t?1:0,t},GEMIOLI.Utils.getInt=function(e,t){var n=GEMIOLI.Utils.getLocalStorage();return void 0!==n[GEMIOLI.Utils.LOCAL_STORAGE_PATH+e]?parseInt(n[GEMIOLI.Utils.LOCAL_STORAGE_PATH+e]):t},GEMIOLI.Utils.setInt=function(e,t){return GEMIOLI.Utils.getLocalStorage()[GEMIOLI.Utils.LOCAL_STORAGE_PATH+e]=t,t},GEMIOLI.Utils.openLink=function(e){window.open(e,"_blank")},GEMIOLI.Cache=function(){this.files={}},GEMIOLI.Cache.prototype={constructor:GEMIOLI.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},GEMIOLI.Mapper=function(){this.map=new GEMIOLI.Cache,this.mapFunctions=[]},GEMIOLI.Mapper.prototype={constructor:GEMIOLI.Mapper,get:function(e){for(var t,n=0;n<this.mapFunctions.length;++n)if(null!=(t=this.mapFunctions[n](e)))return this.get(t);return(t=this.map.get(e))?this.get(e):e},set:function(e,t){this.map.add(e,t)}},GEMIOLI.Loader=function(){GEMIOLI.Loader.loaders.push(this),GEMIOLI.Application.hasEventListener("update",GEMIOLI.Loader.update)||GEMIOLI.Application.addEventListener("update",GEMIOLI.Loader.update),window.hasOwnProperty("fbrqSA")&&!0===window.fbrqSA&&(h5branding.Utils.ASSET_LOCATION="assets/"),SponsorLogo.load()},GEMIOLI.Loader.prototype={getQueueLength:function(){return 0}},GEMIOLI.Loader.loadFunctions=[],GEMIOLI.Loader.loading=[],GEMIOLI.Loader.loaders=[],GEMIOLI.Loader.getQueueLength=function(){for(var e=0,t=0;t<GEMIOLI.Loader.loaders.length;++t)e+=GEMIOLI.Loader.loaders[t].getQueueLength();return e},GEMIOLI.Loader.update=function(e){if(GEMIOLI.Loader.loading.length<6&&GEMIOLI.Loader.loadFunctions.length>0){var t=GEMIOLI.Loader.loadFunctions.shift();GEMIOLI.Loader.loading.push(t),t()}},GEMIOLI.Loader.finishLoading=function(e){for(var t=0;t<GEMIOLI.Loader.loading.length;++t)if(GEMIOLI.Loader.loading[t]===e)return void GEMIOLI.Loader.loading.splice(t,1)},GEMIOLI.QueryString=function(){for(var e={},t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");if(void 0===e[i[0]])e[i[0]]=i[1];else if("string"==typeof e[i[0]]){var r=[e[i[0]],i[1]];e[i[0]]=r}else e[i[0]].push(i[1])}return e}(),GEMIOLI.doLoadDone=!1,GEMIOLI.doLoad=function(){GEMIOLI.doLoadDone||(GEMIOLI.doLoadDone=!0,GEMIOLI.QueryString.container=document.getElementById("container"),GEMIOLI.Application.init(GEMIOLI.QueryString))},document.addEventListener)document.addEventListener("DOMContentLoaded",function(){GEMIOLI.doLoad()},!1);else if(document.attachEvent){if(document.documentElement.doScroll&&window==window.top){function tryScroll(){if(!GEMIOLI.doLoadDone&&document.body)try{document.documentElement.doScroll("left"),GEMIOLI.doLoad()}catch(e){setTimeout(tryScroll,0)}}tryScroll()}document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&GEMIOLI.doLoad()})}window.addEventListener?window.addEventListener("load",GEMIOLI.doLoad,!1):window.attachEvent?window.attachEvent("onload",GEMIOLI.doLoad):window.onload?window.onload=GEMIOLI.doLoad:document.body&&(document.body.onload=GEMIOLI.doLoad),GEMIOLI.Image=function(e){this.image=e,e.crossOrigin=""},THREE.EventDispatcher.prototype.apply(GEMIOLI.Image.prototype),GEMIOLI.ImageLoader=function(){GEMIOLI.Loader.call(this),this.loaded=new GEMIOLI.Cache,this.loading=new GEMIOLI.Cache},GEMIOLI.ImageLoader.prototype=Object.create(GEMIOLI.Loader.prototype),GEMIOLI.ImageLoader.prototype.load=function(e,t,n){var i=this.loaded.get(e);if(i)return t&&t(i),i;var r=this.loading.get(e);if(r)return t&&r.addEventListener("load",function(e){r.removeEventListener("load",arguments.callee),t(r)},!1),n&&r.addEventListener("error",function(e){r.removeEventListener("error",arguments.callee),n(e)},!1),r;var o=this,a=new GEMIOLI.Image(document.createElement("img"));this.loading.add(e,a),t&&a.addEventListener("load",function(e){a.removeEventListener("load",arguments.callee),t(a)},!1),n&&a.addEventListener("error",function(e){a.removeEventListener("error",arguments.callee),n(e)},!1);var s=function(){a.tries++,a.image.src=GEMIOLI.Mapper.get(e)},l=function(t){a.image.clearListeners(),GEMIOLI.Loader.finishLoading(s),o.loading.remove(e),o.loaded.add(e,a),a.dispatchEvent({type:"load"})},c=function(t){GEMIOLI.Loader.finishLoading(s),a.tries>3?(a.image.clearListeners(),o.loading.remove(e),a.dispatchEvent(t),GEMIOLI.Application.crash("Can't load ["+e+"] from ["+GEMIOLI.Mapper.get(e)+"]. Please refresh the page.")):GEMIOLI.Loader.loadFunctions.push(s)};return a.tries=0,a.image.addEventListener("load",l,!1),a.image.addEventListener("error",c,!1),a.image.clearListeners=function(){this.removeEventListener("load",l),this.removeEventListener("error",c),delete a.image.clearListeners},GEMIOLI.Loader.loadFunctions.push(s),a},GEMIOLI.ImageLoader.prototype.remove=function(e){var t=this.loaded.get(e);if(t)return this.loaded.remove(e),t.image.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",void(t.image=null);var n=this.loading.get(e);return n?(this.loading.remove(e),n.image.clearListeners(),n.image.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",void(n.image=null)):void 0},GEMIOLI.ImageLoader.prototype.getQueueLength=function(){return Object.keys(this.loading.files).length},GEMIOLI.XHRRequest=function(e){this.request=e,this.url=""},THREE.EventDispatcher.prototype.apply(GEMIOLI.XHRRequest.prototype),GEMIOLI.XHRLoader=function(){GEMIOLI.Loader.call(this),this.loaded=new GEMIOLI.Cache,this.loading=new GEMIOLI.Cache},GEMIOLI.XHRLoader.prototype=Object.create(GEMIOLI.Loader.prototype),GEMIOLI.XHRLoader.prototype.constructor=GEMIOLI.XHRLoader,GEMIOLI.XHRLoader.prototype.load=function(e,t,n){var i=this.loaded.get(e);if(i)return t&&t(i),i;var r=this.loading.get(e);if(r)return t&&r.addEventListener("load",function(e){r.removeEventListener("load",arguments.callee),t(r)},!1),n&&r.addEventListener("error",function(e){r.removeEventListener("error",arguments.callee),n(e)},!1),r;var o=this,a=new GEMIOLI.XHRRequest(new XMLHttpRequest);a.url=e,this.loading.add(e,a),t&&a.addEventListener("load",function(e){a.removeEventListener("load",arguments.callee),t(a)},!1),n&&a.addEventListener("error",function(e){a.removeEventListener("error",arguments.callee),n(e)},!1);var s=function(){a.tries++,a.request.abort(),a.request.open("GET",GEMIOLI.Mapper.get(e),!0),a.request.send(null)},l=function(t){GEMIOLI.Loader.finishLoading(s),200===a.request.status||304===a.request.status||0===a.request.status?(a.request.clearListeners(),o.loading.remove(e),o.loaded.add(e,a),a.dispatchEvent({type:"load"})):a.tries>3?(a.request.clearListeners(),o.loading.remove(e),a.dispatchEvent({type:"error",message:a.request.statusText}),GEMIOLI.Application.crash("Can't load ["+e+"] from ["+GEMIOLI.Mapper.get(e)+"]. Please refresh the page.")):GEMIOLI.Loader.loadFunctions.push(s)},c=function(t){GEMIOLI.Loader.finishLoading(s),a.tries>3?(a.request.clearListeners(),o.loading.remove(e),a.dispatchEvent(t),GEMIOLI.Application.crash("Can't load ["+e+"] from ["+GEMIOLI.Mapper.get(e)+"]. Please refresh the page.")):GEMIOLI.Loader.loadFunctions.push(s)};return a.tries=0,a.request.addEventListener("load",l,!1),a.request.addEventListener("error",c,!1),a.request.clearListeners=function(){this.removeEventListener("load",l),this.removeEventListener("error",c),delete a.request.clearListeners},GEMIOLI.Loader.loadFunctions.push(s),a},GEMIOLI.XHRLoader.prototype.remove=function(e){var t=this.loaded.get(e);if(t)return this.loaded.remove(e),t.request.abort(),void(t.request=null);var n=this.loading.get(e);return n?(this.loading.remove(e),n.request.clearListeners(),n.request.abort(),void(n.request=null)):void 0},GEMIOLI.XHRLoader.prototype.getQueueLength=function(){return Object.keys(this.loading.files).length},GEMIOLI.Sound=function(e){this.id=e,this.instances=[];var t=this;this.onComplete=function(e){e.target.removeEventListener("complete",t.onComplete,!1),t.instances.push(e.target)},this.seed=GEMIOLI.SoundLoader.webaudio?null:GEMIOLI.Utils.getInt("soundSeed",1),GEMIOLI.SoundLoader.webaudio||GEMIOLI.Utils.setInt("soundSeed",this.seed+1)},GEMIOLI.Sound.prototype.constructor=GEMIOLI.Sound,GEMIOLI.Sound.prototype.play=function(e,t){if(!GEMIOLI.SoundLoader.enabled)return this.defaultInstance;var n=this.instances.pop();if(!n){var i=(n=createjs.Sound.createInstance(this.atlas?this.atlas:this.id,this.atlas?this.start:null,this.atlas?this.end-this.start:null)).stop,r=this;n.stop=function(){this.removeEventListener("complete",r.onComplete,!1),r.instances.push(this),i.call(this)}}return n.addEventListener("complete",this.onComplete,!1),n.play(createjs.Sound.INTERRUPT_ANY,0,e?1e3*e:0,t?-1:0),n},GEMIOLI.Sound.prototype.defaultInstance={stop:function(){},volume:0,addEventListener:function(e,t,n){},removeEventListener:function(e,t,n){}},THREE.EventDispatcher.prototype.apply(GEMIOLI.Sound.prototype),GEMIOLI.SoundLoader=function(){GEMIOLI.Loader.call(this),this.loaded=new GEMIOLI.Cache,this.loading=new GEMIOLI.Cache,this.atlasesLoaded=new GEMIOLI.Cache,this.atlasesLoading=new GEMIOLI.Cache,this.enabled=!1,this.webaudio=!1,GEMIOLI.Utils.isMobile()?(this.enabled=createjs.Sound.registerPlugins([createjs.WebAudioPlugin]),this.enabled&&(this.webaudio=!0)):(this.enabled=createjs.Sound.registerPlugins([createjs.WebAudioPlugin]),this.enabled?this.webaudio=!0:this.enabled=createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin])),createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.setVolume(GEMIOLI.Utils.getBool("sound",!0)?1:0),window.console&&window.console.log&&console.log("Sound: "+this.enabled,"WebAudio: "+this.webaudio)},GEMIOLI.SoundLoader.prototype=Object.create(GEMIOLI.Loader.prototype),GEMIOLI.SoundLoader.prototype.constructor=GEMIOLI.SoundLoader,GEMIOLI.SoundLoader.prototype.mute=function(){createjs.Sound.setVolume(0)},GEMIOLI.SoundLoader.prototype.unmute=function(){createjs.Sound.setVolume(GEMIOLI.Utils.getBool("sound",!0)?1:0)},GEMIOLI.SoundLoader.prototype.load=function(e,t,n,i){var r=this.loaded.get(e);if(r)return n&&n(r),r;var o=this.loading.get(e);if(o)return n&&o.addEventListener("load",function(e){o.removeEventListener("load",arguments.callee,!1),n(o)},!1),i&&o.addEventListener("error",function(e){o.removeEventListener("error",arguments.callee,!1),i(e)},!1),o;var a=this,s=new GEMIOLI.Sound(e);this.loading.add(e,s),n&&s.addEventListener("load",function(e){s.removeEventListener("load",arguments.callee,!1),n(s)},!1),i&&s.addEventListener("error",function(e){s.removeEventListener("error",arguments.callee,!1),i(e)},!1);var l=function(){GEMIOLI.SoundLoader.enabled?(createjs.Sound.removeSound(e),s.tries++,createjs.Sound.registerSound(GEMIOLI.Mapper.get(t)+(s.seed?"?s="+s.seed:""),e)):createjs.Sound.dispatchEvent({type:"fileload",id:e})},c=function(t){t.id===e&&(s.clearListeners(),GEMIOLI.Loader.finishLoading(l),a.loading.remove(e),a.loaded.add(e,s),s.dispatchEvent({type:"load"}))},h=function(n){n.id===e&&(GEMIOLI.Loader.finishLoading(l),s.tries>3?(s.clearListeners(),a.loading.remove(e),s.dispatchEvent({type:"error",message:"unknown"}),GEMIOLI.Application.crash("Can't load ["+e+"] from ["+t+"]. Please refresh the page.")):GEMIOLI.Loader.loadFunctions.push(l))};return s.tries=0,createjs.Sound.addEventListener("fileload",c,!1),createjs.Sound.addEventListener("fileerror",h,!1),s.clearListeners=function(){createjs.Sound.removeEventListener("fileload",c,!1),createjs.Sound.removeEventListener("fileerror",h,!1),delete s.clearListeners},GEMIOLI.Loader.loadFunctions.push(l),s},GEMIOLI.SoundAtlas=function(e,t){this.url=e,this.soundUrl=t},GEMIOLI.SoundAtlas.prototype={constructor:GEMIOLI.SoundAtlas},THREE.EventDispatcher.prototype.apply(GEMIOLI.SoundAtlas.prototype),GEMIOLI.SoundLoader.prototype.loadAtlas=function(e,t,n,i){var r=this.atlasesLoaded.get(e);if(r)return n&&n(r),r;var o=this.atlasesLoading.get(e);if(o)return n&&o.addEventListener("load",function(e){o.removeEventListener("load",arguments.callee,!1),n(o)},!1),i&&o.addEventListener("error",function(e){o.removeEventListener("error",arguments.callee,!1),i(e)},!1),o;var a=this,s=new GEMIOLI.SoundAtlas(e,t);return this.atlasesLoading.add(e,s),n&&s.addEventListener("load",function(e){s.removeEventListener("load",arguments.callee,!1),n(s)},!1),i&&s.addEventListener("error",function(e){s.removeEventListener("error",arguments.callee,!1),i(e)},!1),GEMIOLI.XHRLoader.load(e,function(n){GEMIOLI.SoundLoader.load(t,t,function(i){for(var r,o=JSON.parse(n.request.response),l=0,c=o.length;l<c;++l)(r=new GEMIOLI.Sound(o[l].id)).atlas=t,r.start=1e3*o[l].s,r.end=1e3*o[l].e,a.loaded.add(o[l].id,r);a.atlasesLoading.get(e)&&(a.atlasesLoading.remove(e),a.atlasesLoaded.add(e,s)),s.dispatchEvent({type:"load"})},function(t){a.atlasesLoading.get(e)&&a.atlasesLoading.remove(e),s.dispatchEvent(t)})},function(t){a.atlasesLoading.remove(e),s.dispatchEvent(t)}),s},GEMIOLI.SoundLoader.prototype.getQueueLength=function(){return Object.keys(this.loading.files).length},GEMIOLI.TextureLoader=function(){this.loaded=new GEMIOLI.Cache,this.loading=new GEMIOLI.Cache,this.loaded.add(GEMIOLI.TextureLoader.DEFAULT_ID,GEMIOLI.TextureLoader.DEFAULT)},GEMIOLI.TextureLoader.prototype={constructor:GEMIOLI.TextureLoader,load:function(e,t,n){var i=this.loaded.get(e);if(i)return t&&t(i),i;var r=this.loading.get(e);if(r)return t&&r.addEventListener("load",function(e){r.removeEventListener("load",arguments.callee),t(r)},!1),n&&r.addEventListener("error",function(e){r.removeEventListener("error",arguments.callee),n(e)},!1),r;var o=this,a=new THREE.Texture;return a.minFilter=a.magFilter=THREE.LinearFilter,a.generateMipmaps=!1,t&&a.addEventListener("load",function(e){a.removeEventListener("load",arguments.callee),t(a)},!1),n&&a.addEventListener("error",function(e){a.removeEventListener("error",arguments.callee),n(e)},!1),this.loading.add(e,a),a.sourceFile=e,GEMIOLI.ImageLoader.load(e,function(t){a.image=t.image,a.needsUpdate=!0,o.loading.get(e)&&(o.loading.remove(e),o.loaded.add(e,a),GEMIOLI.Renderer.uploadTexture(a)),a.dispatchEvent({type:"load"})},function(t){o.loading.get(e)&&o.loading.remove(e),a.dispatchEvent(t)}),a},DEFAULT:new THREE.Texture,DEFAULT_ID:"default"},GEMIOLI.Model=function(e,t){this.geometry=e,this.materials=t,this.url=""},THREE.EventDispatcher.prototype.apply(GEMIOLI.Model.prototype),GEMIOLI.ModelBatch=function(){this.models={},this.url=""},THREE.EventDispatcher.prototype.apply(GEMIOLI.ModelBatch.prototype),GEMIOLI.ModelBatchLoader=function(){this.loaded=new GEMIOLI.Cache,this.loading=new GEMIOLI.Cache,this.JSONLoader=new THREE.JSONLoader},GEMIOLI.ModelBatchLoader.prototype={constructor:GEMIOLI.ModelBatchLoader,load:function(e,t,n,i){var r=this.loaded.get(e);if(r)return n&&n(r),r;var o=this.loading.get(e);if(o)return n&&o.addEventListener("load",function(e){o.removeEventListener("load",arguments.callee),n(o)},!1),i&&o.addEventListener("error",function(e){o.removeEventListener("error",arguments.callee),i(e)},!1),o;var a=this,s=new GEMIOLI.ModelBatch;return s.url=e,this.loading.add(e,s),n&&s.addEventListener("load",function(e){s.removeEventListener("load",arguments.callee),n(s)},!1),i&&s.addEventListener("error",function(e){s.removeEventListener("error",arguments.callee),i(e)},!1),GEMIOLI.XHRLoader.load(e,function(n){var i,r,o,l=JSON.parse(n.request.response);function c(e,t){return e&1<<t}for(var h in GEMIOLI.XHRLoader.remove(e),l){var u=GEMIOLI.Utils.path(e).dir+"/",d=u+h,p=l[h],f=null,E=new THREE.MeshBasicMaterial;if(void 0!==p.materials&&0!==p.materials.length){var m=p.materials[0];if(m.mapDiffuse){var g=u+m.mapDiffuse;if(t&&(f=t.get(m.mapDiffuse)))E.map=f.texture;else{var v=THREE.Loader.Handlers.get(g);null!==v&&(E.map=v.load(g)),E.map&&(E.map.sourceFile=m.mapDiffuse)}}}var y=p.vertices,T=p.normals,_=p.uvs[0];if(f)for(var R=f.u1,b=f.u2-f.u1,x=f.v1,w=f.v2-f.v1,M=0,L=_.length;M<L;M+=2)_[M]=_[M]*b+R,_[M+1]=(1-_[M+1])*w+x;for(var S,H,I,A,C,O,P,G,D,k,B,N,j,F=p.faces,U=p.skinWeights,V=p.skinIndices,z=void 0!==p.influencesPerVertex?p.influencesPerVertex:2,W=[],q=[],X=[],K=[],Y=[],Q=[],J=[],Z=(M=0,F.length),$=function(e,t,n){return W[3*e]===y[3*t]&&W[3*e+1]===y[3*t+1]&&W[3*e+2]===y[3*t+2]&&Y[2*e]===_[2*n]&&Y[2*e+1]===_[2*n+1]},ee=function(e,t,n){var i=W.length/3;return W[3*i]=y[3*e],W[3*i+1]=y[3*e+1],W[3*i+2]=y[3*e+2],Y[2*i]=_[2*t],Y[2*i+1]=_[2*t+1],U&&(X[4*i]=U[z*e],X[4*i+1]=z>1?U[z*e+1]:0,X[4*i+2]=z>2?U[z*e+2]:0,X[4*i+3]=z>3?U[z*e+3]:0),V&&(K[4*i]=V[z*e],K[4*i+1]=z>1?V[z*e+1]:0,K[4*i+2]=z>2?V[z*e+2]:0,K[4*i+3]=z>3?V[z*e+3]:0),-1!==n&&(q[3*i]=T[3*n],q[3*i+1]=T[3*n+1],q[3*i+2]=T[3*n+2]),i};M<Z;){if(c(H=F[M++],0),i=c(H,1),r=c(H,3),c(H,4),o=c(H,5),c(H,6),c(H,7),I=F[M++],A=F[M++],C=F[M++],i&&M++,r&&(O=F[M++],P=F[M++],G=F[M++]),o?(D=F[M++],k=F[M++],B=F[M++]):D=k=B=-1,N=-1,void 0!==typeof J[I])if(J[I]instanceof Array){for(S=0;S<J[I].length;++S)if($(j=J[I][S],I,O)){N=j;break}-1===N&&J[I].push(N=ee(I,O,D))}else $(j=J[I],I,O)?N=j:J[I]=[j,N=ee(I,O,D)];else N=J[I]=ee(I,O,D);if(Q.push(N),N=-1,void 0!==typeof J[A])if(J[A]instanceof Array){for(S=0;S<J[A].length;++S)if($(j=J[A][S],A,P)){N=j;break}-1===N&&J[A].push(N=ee(A,P,k))}else $(j=J[A],A,P)?N=j:J[A]=[j,N=ee(A,P,k)];else N=J[A]=ee(A,P,k);if(Q.push(N),N=-1,void 0!==typeof J[C])if(J[C]instanceof Array){for(S=0;S<J[C].length;++S)if($(j=J[C][S],C,G)){N=j;break}-1===N&&J[C].push(N=ee(C,G,B))}else $(j=J[C],C,G)?N=j:J[C]=[j,N=ee(C,G,B)];else N=J[C]=ee(C,G,B);Q.push(N)}var te=new THREE.BufferGeometry;te.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(Q),1)),te.addAttribute("position",new THREE.BufferAttribute(new Float32Array(W),3)),te.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(Y),2)),q.length>0&&te.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(q),3)),U&&te.addAttribute("skinWeight",new THREE.BufferAttribute(new Float32Array(X),4)),V&&te.addAttribute("skinIndex",new THREE.BufferAttribute(new Float32Array(K),4)),te.computeBoundingSphere(),te.bones=p.bones,te.animation=p.animation,te.animations=p.animations,s.models[d]={geometry:te,material:E},s.models[d].url=d}a.loading.get(e)&&(a.loading.remove(e),a.loaded.add(e,s)),s.dispatchEvent({type:"load"})},function(t){a.loading.get(e)&&a.loading.remove(e),s.dispatchEvent(t)}),s},remove:function(e){this.loaded.get(e)?this.loaded.remove(e):this.loading.get(e)&&this.loading.remove(e)}},GEMIOLI.ModelLoader=function(){this.loaded=new GEMIOLI.Cache,this.loading=new GEMIOLI.Cache,this.JSONLoader=new THREE.JSONLoader},GEMIOLI.ModelLoader.prototype={constructor:GEMIOLI.ModelLoader,load:function(e,t,n){var i=this.loaded.get(e);if(i)return t&&t(i),i;var r=this.loading.get(e);if(r)return t&&r.addEventListener("load",function(e){r.removeEventListener("load",arguments.callee),t(r)},!1),n&&r.addEventListener("error",function(e){r.removeEventListener("error",arguments.callee),n(e)},!1),r;var o=this,a=new GEMIOLI.Model([],[]);return a.url=e,this.loading.add(e,a),t&&a.addEventListener("load",function(e){a.removeEventListener("load",arguments.callee),t(a)},!1),n&&a.addEventListener("error",function(e){a.removeEventListener("error",arguments.callee),n(e)},!1),GEMIOLI.XHRLoader.load(e,function(t){var n=JSON.parse(t.request.response);if(GEMIOLI.XHRLoader.remove(e),void 0!==n.metadata&&"scene"===n.metadata.type)o.loading.get(e)&&o.loading.remove(e),a.dispatchEvent({type:"error",message:'Model data from "'+e+'" seems to be a Scene, not a model.'});else{o.loading.get(e)&&(o.loading.remove(e),o.loaded.add(e,a));var i=o.JSONLoader.parse(n,GEMIOLI.Utils.path(e).dir+"/");a.geometry=i.geometry,a.materials=i.materials,a.dispatchEvent({type:"load"})}},function(t){o.loading.get(e)&&o.loading.remove(e),a.dispatchEvent(t)}),a}},GEMIOLI.AtlasRegion=function(){this.u1=0,this.u2=1,this.v1=0,this.v2=1,this.texture=GEMIOLI.TextureLoader.DEFAULT},GEMIOLI.AtlasRegion.prototype={constructor:GEMIOLI.AtlasRegion},THREE.EventDispatcher.prototype.apply(GEMIOLI.AtlasRegion.prototype),GEMIOLI.Atlas=function(){this.regions=new GEMIOLI.Cache,this.textures={}},GEMIOLI.Atlas.prototype={constructor:GEMIOLI.Atlas,get:function(e){return this.regions.get(GEMIOLI.Utils.path(this.url).dir+"/"+e)}},THREE.EventDispatcher.prototype.apply(GEMIOLI.Atlas.prototype),GEMIOLI.AtlasLoader=function(){this.loaded=new GEMIOLI.Cache,this.loading=new GEMIOLI.Cache},GEMIOLI.AtlasLoader.prototype={constructor:GEMIOLI.AtlasLoader,load:function(e,t,n){var i=this.loaded.get(e);if(i)return t&&t(i),i;var r=this.loading.get(e);if(r)return t&&r.addEventListener("load",function(e){r.removeEventListener("load",arguments.callee),t(r)},!1),n&&r.addEventListener("error",function(e){r.removeEventListener("error",arguments.callee),n(e)},!1),r;var o=this,a=new GEMIOLI.Atlas;return t&&a.addEventListener("load",function(e){a.removeEventListener("load",arguments.callee),t(a)},!1),n&&a.addEventListener("error",function(e){a.removeEventListener("error",arguments.callee),n(e)},!1),this.loading.add(e,a),a.url=e,GEMIOLI.XHRLoader.load(e,function(t){o.loading.get(e)&&(o.loading.remove(e),o.loaded.add(e,a));var n=GEMIOLI.Utils.path(e).dir+"/",i=t.request.response.split(/\r\n|\r|\n/g);GEMIOLI.XHRLoader.remove(e);for(var r,s,l,c,h=0;h<i.length;)if(0!==i[h].length){var u=i[h+2].match(/\d+/g),d=i[h+3].match(/\d+/g),p=parseInt(u[0]),f=parseInt(u[1]),E=parseInt(d[0]),m=parseInt(d[1]),g=n+i[h]+".png",v=a.regions.get(g);v||(v=new GEMIOLI.AtlasRegion,a.regions.add(g,v)),v.u1=p/l,v.u2=(p+E)/l,v.v1=1-f/c,v.v2=1-(f+m)/c,v.texture=a.textures[r],v.dispatchEvent({type:"load"}),h+=7}else{if(++h===i.length)continue;r=n+i[h],s=i[h+1].match(/size: \d+,\d+/g)[0],l=parseInt(s.match(/\d+/g)[0]),c=parseInt(s.match(/\d+/g)[1]),h+=5,a.textures[r]=GEMIOLI.TextureLoader.load(r)}a.dispatchEvent({type:"load"})},function(t){o.loading.remove(e),a.dispatchEvent(t)}),a},loadRegion:function(e,t,n,i){var r,o=GEMIOLI.Utils.path(e).dir+"/"+t+".png",a=this.load(e,function(e){(r=e.regions.get(o))||(r=new GEMIOLI.AtlasRegion,e.regions.add(o,r)),n&&n(r)},function(e){i&&i(e)});return r||(r=a.regions.get(o)),r||(r=new GEMIOLI.AtlasRegion,a.regions.add(o,r)),r}},GEMIOLI.FontGlyph=function(e,t,n,i,r,o,a,s,l,c,h){this.id=e,this.x=t,this.y=n,this.w=i,this.h=r,this.xa=o,this.p=a,this.u1=s,this.u2=l,this.v1=c,this.v2=h},GEMIOLI.Font=function(){this.glyphs=[],this.pages=[],this.size=12,this.height=12,this.base=10},THREE.EventDispatcher.prototype.apply(GEMIOLI.Font.prototype),GEMIOLI.FontLoader=function(){this.loaded=new GEMIOLI.Cache,this.loading=new GEMIOLI.Cache},GEMIOLI.FontLoader.prototype={constructor:GEMIOLI.FontLoader,load:function(e,t,n){var i=this.loaded.get(e);if(i)return t&&t(i),i;var r=this.loading.get(e);if(r)return t&&r.addEventListener("load",function(e){r.removeEventListener("load",arguments.callee),t(r)},!1),n&&r.addEventListener("error",function(e){r.removeEventListener("error",arguments.callee),n(e)},!1),r;var o=this,a=new GEMIOLI.Font;return t&&a.addEventListener("load",function(e){a.removeEventListener("load",arguments.callee),t(a)},!1),n&&a.addEventListener("error",function(e){a.removeEventListener("error",arguments.callee),n(e)},!1),this.loading.add(e,a),GEMIOLI.XHRLoader.load(e,function(t){o.loading.get(e)&&(o.loading.remove(e),o.loaded.add(e,a));var n=o.parse(a,e,t);GEMIOLI.XHRLoader.remove(e);for(var i=0;i<n.length;++i)a.pages[i]=GEMIOLI.TextureLoader.load(n[i]);a.dispatchEvent({type:"load"})},function(t){o.loading.remove(e),a.dispatchEvent(t)}),a},loadFromAtlas:function(e,t,n,i){var r=this.loaded.get(e);if(r)return n&&n(r),r;var o=this.loading.get(e);if(o)return n&&o.addEventListener("load",function(e){o.removeEventListener("load",arguments.callee),n(o)},!1),i&&o.addEventListener("error",function(e){o.removeEventListener("error",arguments.callee),i(e)},!1),o;var a=this,s=new GEMIOLI.Font;return n&&s.addEventListener("load",function(e){s.removeEventListener("load",arguments.callee),n(s)},!1),i&&s.addEventListener("error",function(e){s.removeEventListener("error",arguments.callee),i(e)},!1),this.loading.add(e,s),GEMIOLI.XHRLoader.load(e,function(n){a.loading.get(e)&&(a.loading.remove(e),a.loaded.add(e,s));var i=a.parse(s,e,n);GEMIOLI.XHRLoader.remove(e);for(var r=0;r<i.length;++r){var o=r;GEMIOLI.AtlasLoader.loadRegion(t,GEMIOLI.Utils.path(i[r]).file,function(e){s.pages[o]=e.texture;for(var t=0;t<s.glyphs.length;++t){var n=s.glyphs[t];n&&n.p===o&&(n.u1=(e.u2-e.u1)*n.u1+e.u1,n.u2=(e.u2-e.u1)*n.u2+e.u1,n.v1=(e.v1-e.v2)*n.v1+e.v2,n.v2=(e.v1-e.v2)*n.v2+e.v2)}})}s.dispatchEvent({type:"load"})},function(t){a.loading.remove(e),s.dispatchEvent(t)}),s},parse:function(e,t,n){for(var i=GEMIOLI.Utils.path(t).dir+"/",r=n.request.response.split(/\r\n|\r|\n/g),o=256,a=256,s=[],l=0;l<r.length;++l){var c=r[l].split(" ");if(0!==c.length)if("info"===c[0])for(var h=0;h<c.length;++h){(_=c[h].split("=")).length<2||"size"===_[0]&&(e.size=parseInt(_[1]))}else if("common"===c[0])for(h=0;h<c.length;++h){(_=c[h].split("=")).length<2||("lineHeight"===_[0]?e.height=parseInt(_[1]):"base"===_[0]?e.base=parseInt(_[1]):"scaleW"===_[0]?o=parseInt(_[1]):"scaleH"===_[0]&&(a=parseInt(_[1])))}else if("page"===c[0]){var u=0,d="";for(h=0;h<c.length;++h){(_=c[h].split("=")).length<2||("id"===_[0]?u=parseInt(_[1]):"file"===_[0]&&(d=i+_[1].substr(1,_[1].length-2)))}s[u]=d}else if("char"===c[0]){u=0;var p=0,f=0,E=0,m=0,g=0,v=0,y=0,T=0;for(h=0;h<c.length;++h){var _;(_=c[h].split("=")).length<2||("id"===_[0]?u=parseInt(_[1]):"x"===_[0]?f=parseInt(_[1]):"y"===_[0]?E=parseInt(_[1]):"width"===_[0]?m=parseInt(_[1]):"height"===_[0]?g=parseInt(_[1]):"xoffset"===_[0]?v=parseInt(_[1]):"yoffset"===_[0]?y=parseInt(_[1]):"xadvance"===_[0]?T=parseInt(_[1]):"page"===_[0]&&(p=parseInt(_[1])))}e.glyphs[u]=new GEMIOLI.FontGlyph(u,v,y,m,g,T,p,f/o,(f+m)/o,1-E/a,1-(E+g)/a)}}return s}},GEMIOLI.Animation=function(e,t,n){if(this.root=e,this.data=THREE.AnimationHandler.init(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,n)for(var i=0;i<n.length;++i)for(var r=0;r<this.hierarchy.length;++r)if(this.hierarchy[r]&&n[i]===this.hierarchy[r].name){this.hierarchy[r]=null;break}},GEMIOLI.Animation.prototype={constructor:GEMIOLI.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,THREE.AnimationHandler.stop(this)},reset:function(){for(var e,t,n,i,r,o,a,s,l,c,h=this,u=h.currentTime,d=h.hierarchy,p=h.data,f=p.name,E=h.keyTypes,m=0,g=d.length;m<g;m++)if(e=d[m])for(void 0===e.animationCache&&(e.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}),void 0===(n=(t=e.animationCache.animations)[f])&&(n={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:e.matrix},t[f]=n),r=(i=p.hierarchy[m].keys).length,a=0;a<3;++a){for(o=E[a],s=i[0],c=r-1,l=void 0;c>0;--c)if(void 0!==i[c][o]){l=i[c];break}for(void 0===l&&(l=s);l.index-s.index>1;)if(c=l.index+s.index>>1,averageKey=i[c],averageKey.time<=u)if(void 0!==averageKey[o])s=averageKey;else{for(s=void 0;c<r;++c)if(void 0!==i[c][o]){s=i[c];break}void 0===s&&(s=l)}else if(void 0!==averageKey[o])l=averageKey;else{for(l=void 0;c>0;--c)if(void 0!==i[c][o]){l=i[c];break}void 0===l&&(l=s)}n.prevKey[o]=s,n.nextKey[o]=l}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];if(n){var i=n.animationCache;if(void 0!==i){var r=i.blending;r.positionWeight=0,r.quaternionWeight=0,r.scaleWeight=0}}}},getBone:function(e){for(var t=0,n=this.hierarchy.length;t<n;t++){var i=this.hierarchy[t];if(i&&i.name===e)return i}return null},update:function(){new THREE.Vector3;var e=new THREE.Vector3,t=new THREE.Quaternion;return function(n){if(!1!==this.isPlaying&&(this.currentTime+=n*this.timeScale,0!==this.weight)){var i=this.data.length;(this.currentTime>i||this.currentTime<0)&&(this.loop?(this.currentTime%=i,this.currentTime<0&&(this.currentTime+=i),this.reset()):this.stop());for(var r=0,o=this.hierarchy.length;r<o;r++){var a=this.hierarchy[r];if(a)for(var s=a.animationCache.animations[this.data.name],l=a.animationCache.blending,c=0;c<3;c++){var h=this.keyTypes[c],u=s.prevKey[h],d=s.nextKey[h];if(this.timeScale>0&&d.time<=this.currentTime||this.timeScale<0&&u.time>=this.currentTime){for(u=this.data.hierarchy[r].keys[0],d=this.getNextKeyWith(h,r,1);d.time<this.currentTime&&d.index>u.index;)u=d,d=this.getNextKeyWith(h,r,d.index+1);s.prevKey[h]=u,s.nextKey[h]=d}var p=(this.currentTime-u.time)/(d.time-u.time),f=u[h],E=d[h];if(p<0&&(p=0),p>1&&(p=1),"pos"===h){e.x=f[0]+(E[0]-f[0])*p,e.y=f[1]+(E[1]-f[1])*p,e.z=f[2]+(E[2]-f[2])*p;var m=this.weight/(this.weight+l.positionWeight);a.position.lerp(e,m),l.positionWeight+=this.weight}else if("rot"===h)if(THREE.Quaternion.slerp(f,E,t,p),0===l.quaternionWeight)a.quaternion.copy(t),l.quaternionWeight=this.weight;else{m=this.weight/(this.weight+l.quaternionWeight);THREE.Quaternion.slerp(a.quaternion,t,a.quaternion,m),l.quaternionWeight+=this.weight}else if("scl"===h){e.x=f[0]+(E[0]-f[0])*p,e.y=f[1]+(E[1]-f[1])*p,e.z=f[2]+(E[2]-f[2])*p;m=this.weight/(this.weight+l.scaleWeight);a.scale.lerp(e,m),l.scaleWeight+=this.weight}}}return!0}}}(),getNextKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(n%=i.length;n<i.length;n++)if(void 0!==i[n][e])return i[n];return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(n=n>=0?n:n+i.length;n>=0;n--)if(void 0!==i[n][e])return i[n];return this.data.hierarchy[t].keys[i.length-1]}},GEMIOLI.AnimationController=function(e,t){this.animation=e,this.description=t,this.fps=this.animation.data.fps,this.invfps=1/this.fps,this.active=null,this.loop=!1,this.time=0,this.startFrame=0,this.endFrame=0,this.start=0,this.end=0,this.animationId=null;var n=this,i=this.animation.update;this.animation.update=function(e){if(!1!==this.isPlaying){var t=n.end>n.start?1:-1,r=Math.floor(n.time*n.fps),o=n.time+e*t,a=t>0?Math.floor(o*n.fps):Math.ceil(o*n.fps);r!==a?t>0?o>=n.end?n.loop?(n.time=(o-n.end)%(n.end-n.start)+n.start,n.animation.play(Math.floor(n.time*n.fps)*n.invfps),i.call(this,0)):(n.animation.play(n.endFrame*n.invfps),i.call(this,0),n.animation.stop(),n.time=n.end):(n.animation.play(a*n.invfps),i.call(this,0),n.time=o):o<=n.end?n.loop?(n.time=-(n.start-o)%(n.start-n.end)+n.start,n.animation.play(Math.ceil(n.time*n.fps)*n.invfps),i.call(this,0)):(n.animation.play(n.endFrame*n.invfps),i.call(this,0),n.animation.stop(),n.time=n.end):(n.animation.play(a*n.invfps),i.call(this,0),n.time=o):n.time=o}},this.animation.reset()},GEMIOLI.AnimationController.prototype={play:function(e,t){this.active&&(this.animation.stop(),this.animation.reset(),this.animationId=null),this.active=this.description[e],this.loop=t,this.active&&(this.animationId=e,this.startFrame=this.active.start,this.endFrame=this.active.end,this.start=this.startFrame*this.invfps,this.end=(this.endFrame+(this.startFrame>this.endFrame?-1:1))*this.invfps,this.animation.play(this.start,1),this.time=this.start,GEMIOLI.Animation.prototype.update.call(this.animation,0))},getAnimationLength:function(e){var t=this.description[e];return t?Math.abs(t.end-t.start+1)*this.invfps:0},hasAnimation:function(e){return this.description[e]},isPlaying:function(){return this.time!==this.end},update:function(e){this.animation.resetBlendWeights(),this.animation.update(e)}},GEMIOLI.Matrix=function(e,t,n,i,r,o){this.a=e||0,this.b=t||0,this.c=n||0,this.d=i||0,this.tx=r||0,this.ty=o||0},GEMIOLI.Matrix.prototype={constructor:GEMIOLI.Matrix,identity:function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},clone:function(){return new GEMIOLI.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},set:function(e,t,n,i,r,o){return this.a=e,this.b=t,this.c=n,this.d=i,this.tx=r,this.ty=o,this},concat:function(e){var t=this.a*e.a+this.b*e.c;this.b=this.a*e.b+this.b*e.d,this.a=t;var n=this.c*e.a+this.d*e.c;this.d=this.c*e.b+this.d*e.d,this.c=n;var i=this.tx*e.a+this.ty*e.c+e.tx;return this.ty=this.tx*e.b+this.ty*e.d+e.ty,this.tx=i,this},prepend:function(e){return this.set(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.tx+this.a*e.tx+this.c*e.ty,this.ty+this.b*e.tx+this.d*e.ty),this},invert:function(){var e=this.a*this.d-this.b*this.c;if(0===e)this.a=this.b=this.c=this.d=0,this.tx=-this.tx,this.ty=-this.ty;else{e=1/e;var t=this.d*e;this.d=this.a*e,this.a=t,this.b*=-e,this.c*=-e;var n=-this.a*this.tx-this.c*this.ty;this.ty=-this.b*this.tx-this.d*this.ty,this.tx=n}return this},copyFrom:function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}},GEMIOLI.Color=function(e,t,n,i){this.r=e,this.g=t,this.b=n,this.a=i},GEMIOLI.Color.prototype={constructor:GEMIOLI.Color,set:function(e,t,n,i){this.r=e,this.g=t,this.b=n,this.a=i},setHex:function(e){this.a=(e>>24&255)/255,this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255},copyFrom:function(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a},concat:function(e){this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a},prepend:function(e){this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a},clone:function(){return new GEMIOLI.Color(this.r,this.g,this.b,this.a)}},GEMIOLI.DisplayObject=function(){this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this._x=0,this._y=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._skewA=1,this._skewB=0,this._skewC=0,this._skewD=1,this._matrix=new GEMIOLI.Matrix(1,0,0,1,0,0),this.visible=!0,this.blending=THREE.NormalBlending,this.name="",this.parent=null,this.tint=new GEMIOLI.Color(1,1,1,1)},GEMIOLI.DisplayObject.HELP_MATRIX=new GEMIOLI.Matrix,GEMIOLI.DisplayObject.prototype={constructor:GEMIOLI.DisplayObject,getAlpha:function(){return this.tint.a},setAlpha:function(e){e!==this.tint.a&&(this.tint.a=e<0?0:e>1?1:e)},updateMatrix:function(){var e=this._skewA*this.scaleX,t=this._skewB*this.scaleX,n=this._skewC*this.scaleY,i=this._skewD*this.scaleY,r=this.rotation*Math.PI/180,o=Math.sin(r),a=Math.cos(r);this._matrix.a=e*a-t*o,this._matrix.b=e*o+t*a,this._matrix.c=n*a-i*o,this._matrix.d=n*o+i*a,this._matrix.tx=this.x,this._matrix.ty=this.y,this._x=this.x,this._y=this.y,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._rotation=this.rotation},getMatrix:function(){return this.x===this._x&&this.y===this._y&&this.scaleX===this._scaleX&&this.scaleY===this._scaleY&&this.rotation===this._rotation||this.updateMatrix(),this._matrix},setMatrix:function(e){this.x=e.tx,this.y=e.ty;var t=Math.sqrt(e.a*e.a+e.b*e.b),n=Math.sqrt(e.c*e.c+e.d*e.d);e.a*e.d-e.b*e.c<0&&(0===e.b&&0===e.c&&1===e.d?t=-t:n=-n),this.scaleX=t,this.scaleY=n;var i=Math.atan2(e.b,t<0?-e.a:e.a);this.rotation=180*i/Math.PI;var r=Math.sin(-i),o=Math.cos(-i);this._skewA=e.a*o-e.b*r,this._skewB=e.a*r+e.b*o,this._skewC=e.c*o-e.d*r,this._skewD=e.c*r+e.d*o,0!==t&&(this.skewA/=t,this.skewB/=t),0!==n&&(this.skewC/=n,this.skewD/=n),updateMatrix()},setParent:function(e){for(var t=e;t!==this&&null!==t;)t=t.parent;t===this&&(window.console&&window.console.log?console.log("An object cannot be added as a child to itself or one of its children (or children's children, etc.)"):parent=e)},globalToLocal:function(e,t){var n=GEMIOLI.DisplayObject.HELP_MATRIX;n.copyFrom(this.getMatrix());for(var i=this.parent;i;)n.concat(i.getMatrix()),i=i.parent;n.invert(),t.set(e.x*n.a+e.y*n.c+n.tx,e.x*n.b+e.y*n.d+n.ty)},localToGlobal:function(e,t){var n=GEMIOLI.DisplayObject.HELP_MATRIX;n.copyFrom(this.getMatrix());for(var i=this.parent;i;)n.concat(i.getMatrix()),i=i.parent;t.set(e.x*n.a+e.y*n.c+n.tx,e.x*n.b+e.y*n.d+n.ty)},render:function(e){}},THREE.EventDispatcher.prototype.apply(GEMIOLI.DisplayObject.prototype),GEMIOLI.DisplayObjectContainer=function(){GEMIOLI.DisplayObject.call(this),this.children=[]},GEMIOLI.DisplayObjectContainer.prototype=Object.create(GEMIOLI.DisplayObject.prototype),GEMIOLI.DisplayObjectContainer.prototype.constructor=GEMIOLI.DisplayObjectContainer,GEMIOLI.DisplayObjectContainer.prototype.getNumChildren=function(){return this.children.length},GEMIOLI.DisplayObjectContainer.prototype.addChild=function(e){return e?(e.parent===this?this.setChildIndex(e,this.children.length-1):(null!==e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this,e.dispatchEvent({type:"added",local:!0})),e):(window.console&&window.console.log&&console.log("Child can't be null in addChild of DisplayObjectContainer"),e)},GEMIOLI.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(!e)return window.console&&window.console.log&&console.log("Child can't be null in addChildAt of DisplayObjectContainer"),e;var n=this.children.length;return t>=0&&t<=n?(null!==e.parent&&e.parent.removeChild(e),t===n?this.children.push(e):this.children.splice(t,0,e),e.parent=this,e.dispatchEvent({type:"added",local:!0})):window.console&&window.console.log&&console.log("Invalid child index in addChildAt of DisplayObjectContainer"),e},GEMIOLI.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.getChildIndex(e);return-1!==t&&(e.dispatchEvent({type:"removed",local:!0}),e.parent=null,(t=this.children.indexOf(e))>=0&&this.children.splice(t,1)),e},GEMIOLI.DisplayObjectContainer.prototype.removeChildAt=function(e){if(e>=0&&e<=this.children.length){var t=this.children[e];return t.dispatchEvent({type:"removed",local:!0}),t.parent=null,(e=this.children.indexOf(t))>=0&&this.children.splice(e,1),t}return window.console&&window.console.log&&console.log("Invalid child index in removeChildAt of DisplayObjectContainer"),null},GEMIOLI.DisplayObjectContainer.prototype.removeChildren=function(e){for(;this.children.length;)this.removeChildAt(0)},GEMIOLI.DisplayObjectContainer.prototype.getChildAt=function(e){return e>=0&&e<this.children.length?this.children[e]:null},GEMIOLI.DisplayObjectContainer.prototype.getChildByName=function(e){for(var t=this.children,n=t.length,i=0;i<n;++i){var r=t[i];if(r.name===e)return r}return null},GEMIOLI.DisplayObjectContainer.prototype.getChildIndex=function(e){return this.children.indexOf(e)},GEMIOLI.DisplayObjectContainer.prototype.setChildIndex=function(e,t){var n=this.getChildIndex(e);n!==t&&(-1!==n?(this.children.splice(n,1),this.children.insert(t,e)):window.console&&window.console.log&&console.log("Not a child of this container in setChildIndex of DisplayObjectContainer"))},GEMIOLI.DisplayObjectContainer.prototype.contains=function(e){for(;null!==e;){if(e===this)return!0;e=e.parent}return!1},GEMIOLI.DisplayObjectContainer.prototype.swapChildren=function(e,t){var n=this.getChildIndex(e),i=this.getChildIndex(t);-1!==n&&-1!==i||(window.console&&window.console.log?console.log("Not a child of this container in swapChildren of DisplayObjectContainer"):(this.children[n]=t,this.children[i]=e))},GEMIOLI.DisplayObjectContainer.prototype.swapChildrenAt=function(e,t){var n=this.getChildAt(e),i=this.getChildAt(t);this.children[e]=i,this.children[t]=n},GEMIOLI.DisplayObjectContainer.prototype.dispatchEvent=function(e){if(!e.local){var t=this.children,n=[],i=0,r=t.length;for(i=0;i<r;++i)n.push(t[i]);for(i=r-1;i>=0;--i){if(n[i].dispatchEvent(e),e.cancelled)return}}GEMIOLI.DisplayObject.prototype.dispatchEvent.call(this,e)},GEMIOLI.DisplayObjectContainer.prototype.render=function(e){var t=this.children.length;if(t>0&&this.visible&&this.tint.a>0)for(var n=0;n<t;++n){var i=this.children[n];i.visible&&i.tint.a>0&&(e.pushColor(),e.pushMatrix(),e.prependColor(i.tint),e.prependMatrix(i.getMatrix()),i.render(e),e.popMatrix(),e.popColor())}},GEMIOLI.Application={},GEMIOLI.Application.prototype={constructor:GEMIOLI.Application},THREE.EventDispatcher.prototype.apply(GEMIOLI.Application),GEMIOLI.Application.init=function(e){if(e.reset&&GEMIOLI.Utils.resetLocalStorage(),Detector.webgl){adHandler=new AzerionHandler.adHandler,GEMIOLI.Application.DEBUG=e.debug||!1,GEMIOLI.Application.NOADS="noads"in e,GEMIOLI.Application.WIDTH=e.width||1536,GEMIOLI.Application.HEIGHT=e.height||2048,GEMIOLI.Application.innerWidth=window.innerWidth,GEMIOLI.Application.innerHeight=window.innerHeight;var t=new THREE.WebGLRenderer;t.autoClear=!1,t.setClearColor(e.color||135194,e.alpha||1),t.setSize(GEMIOLI.Application.innerWidth,GEMIOLI.Application.innerHeight),e.container.appendChild(t.domElement),GEMIOLI.Renderer=t;var n=!1;GEMIOLI.Application.crash=function(i){n||(n=!0,e.container===t.domElement.parentNode&&e.container.removeChild(t.domElement),Detector.addGetWebGLMessage({parent:e.container,message:i}))},GEMIOLI.Mapper=new GEMIOLI.Mapper,GEMIOLI.Application.graphicsScale=.5;var r="img/0.5/";if(GEMIOLI.Utils.isMobile()){var o=window.innerHeight*window.devicePixelRatio/GEMIOLI.Application.HEIGHT;o<=.25&&(GEMIOLI.Application.graphicsScale=.25,r="img/0.25/")}window.console&&window.console.log&&console.log("Window innerHeight: "+window.innerHeight+" Device Pixel Ratio: "+window.devicePixelRatio+" App Height: "+GEMIOLI.Application.HEIGHT+" aspect: "+o+" Image Prefix: "+r),GEMIOLI.Mapper.mapFunctions.push(function(e){if(SpilData.logoData&&e===SpilData.logoData.image)return null;var t=GEMIOLI.Utils.path(e).ext;return"png"!==t&&"jpg"!==t||-1!==e.indexOf(r)?null:r+e});var a="sound/desktop/";GEMIOLI.Utils.isMobile()&&(a="sound/mobile/"),window.console&&window.console.log&&console.log("Sound prefix: "+a),GEMIOLI.Mapper.mapFunctions.push(function(e){var t=GEMIOLI.Utils.path(e).ext;return"ogg"!==t&&"mp3"!==t||-1!==e.indexOf(a)?null:a+e}),GEMIOLI.ImageLoader=new GEMIOLI.ImageLoader,GEMIOLI.XHRLoader=new GEMIOLI.XHRLoader,GEMIOLI.SoundLoader=new GEMIOLI.SoundLoader,GEMIOLI.TextureLoader=new GEMIOLI.TextureLoader,THREE.Loader.Handlers.add(/\.jpg$/i,GEMIOLI.TextureLoader),THREE.Loader.Handlers.add(/\.png$/i,GEMIOLI.TextureLoader),GEMIOLI.ModelLoader=new GEMIOLI.ModelLoader,GEMIOLI.ModelBatchLoader=new GEMIOLI.ModelBatchLoader,GEMIOLI.AtlasLoader=new GEMIOLI.AtlasLoader,GEMIOLI.FontLoader=new GEMIOLI.FontLoader;var s={},l=[];GEMIOLI.Application.pushLayer=function(e){if(e){if(l.length>0){var t=l[l.length-1];for(activePointer in s)t.dispatchEvent&&t.dispatchEvent({type:"pointercancel",pointerId:s[activePointer]});s={}}l.push(e),e.resize&&e.resize(),e.dispatchEvent&&e.dispatchEvent({type:"added",local:!0})}},GEMIOLI.Application.popLayer=function(){var e=l.pop();for(activePointer in s)e.dispatchEvent&&e.dispatchEvent({type:"pointercancel",pointerId:s[activePointer]});s={},e&&e.dispatchEvent&&e.dispatchEvent({type:"removed",local:!0})},GEMIOLI.Application.removeLayer=function(e){if(l.length>0&&l[l.length-1]===e){for(activePointer in s)e.dispatchEvent&&e.dispatchEvent({type:"pointercancel",pointerId:s[activePointer]});s={}}for(i=0;i<l.length;++i)if(l[i]===e){l.splice(i,1);break}e&&e.dispatchEvent&&e.dispatchEvent({type:"removed",local:!0})},GEMIOLI.Application.clearLayers=function(){var e,t=[];for(e=0;e<l.length;++e)t.push(l[e]);for(e=0;e<t.length;++e)GEMIOLI.Application.popLayer()},GEMIOLI.Application.isLayerOnScreen=function(e){for(i=0;i<l.length;++i)if(e===l[i])return!0;return!1},GEMIOLI.Application.setHandCursor=function(t){e.container.style.cursor=t?"pointer":"auto"},GEMIOLI.Application.resize=function(e){if(GEMIOLI.Application.innerWidth!==window.innerWidth||GEMIOLI.Application.innerHeight!==window.innerHeight){console.log("Resize "+window.innerWidth+"x"+window.innerHeight),GEMIOLI.Application.innerWidth=window.innerWidth,GEMIOLI.Application.innerHeight=window.innerHeight,GEMIOLI.Renderer.setSize(GEMIOLI.Application.innerWidth,GEMIOLI.Application.innerHeight),GEMIOLI.Application.dispatchEvent({type:"resize"});var t,n=[];for(t=0;t<l.length;++t)n.push(l[t]);for(t=0;t<n.length;++t)n[t].resize&&n[t].resize()}},window.addEventListener("resize",GEMIOLI.Application.resize,!1),window.addEventListener("orientationchange",GEMIOLI.Application.resize,!1),t.domElement.addEventListener("pointerdown",function(e){if(l.length>0){s[e.pointerId]=e.pointerId;var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent({type:"pointerdown",pointerId:e.pointerId,x:e.clientX,y:e.clientY})}},!1),t.domElement.addEventListener("pointermove",function(e){if(l.length>0){var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent({type:"pointermove",pointerId:e.pointerId,down:void 0!==s[e.pointerId],x:e.clientX,y:e.clientY})}},!1),t.domElement.addEventListener("pointerup",function(e){if(l.length>0){delete s[e.pointerId];var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent({type:"pointerup",pointerId:e.pointerId,x:e.clientX,y:e.clientY})}},!1),t.domElement.addEventListener("pointercancel",function(e){if(l.length>0){delete s[e.pointerId];var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent({type:"pointercancel",pointerId:e.pointerId})}},!1),t.domElement.addEventListener("pointerout",function(e){if(l.length>0){delete s[e.pointerId];var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent({type:"pointercancel",pointerId:e.pointerId})}},!1),document.addEventListener("keydown",function(e){if(l.length>0){var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent(e)}},!1),document.addEventListener("keyup",function(e){if(l.length>0){var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent(e)}},!1),visibilityChangeFunc=function(e){"pagehide"!==e.type&&"blur"!==e.type&&"pageshow"!==e.type&&"focus"!==e.type?document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===e.type?GEMIOLI.Application.dispatchEvent({type:"blur"}):GEMIOLI.Application.dispatchEvent({type:"focus"}):"pagehide"===e.type||"blur"===e.type?GEMIOLI.Application.dispatchEvent({type:"blur"}):"pageshow"!==e.type&&"focus"!==e.type||GEMIOLI.Application.dispatchEvent({type:"focus"})};var c=null;(c=void 0!==document.webkitHidden?"webkitvisibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.hidden?"visibilitychange":null)&&document.addEventListener(c,visibilityChangeFunc,!1),window.onpagehide=visibilityChangeFunc,window.onpageshow=visibilityChangeFunc,window.onblur=visibilityChangeFunc,window.onfocus=visibilityChangeFunc,GEMIOLI.Application.addEventListener("blur",function(e){if(GEMIOLI.SoundLoader.mute(),l.length>0){var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent(e)}}),GEMIOLI.Application.addEventListener("focus",function(e){if(GEMIOLI.SoundLoader.unmute(),l.length>0){var t=l[l.length-1];t.dispatchEvent&&t.dispatchEvent(e)}});var h,u=new THREE.Clock(!0),d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};h=function(){GEMIOLI.Application.resize();var e=u.getDelta();e>1/30&&(e=1/30),GEMIOLI.Application.isLayerOnScreen(GEMIOLI.Application.rotate)&&(e=0);var t,n=u.elapsedTime,i=[];for(t=0;t<l.length;++t)i.push(l[t]);for(t=0;t<i.length;++t)i[t].update&&i[t].update(e,n);for(GEMIOLI.Application.dispatchEvent({type:"update",dt:e,time:n}),i=[],t=0;t<l.length;++t)i.push(l[t]);for(GEMIOLI.Renderer.clear(!1,!0,!1),t=0;t<i.length;++t)i[t].render&&i[t].render();GEMIOLI.Application.setHandCursor(GEMIOLI.Button.inHover>0),GEMIOLI.Button.inHover=0,d(h)},GEMIOLI.Application.pushLayer(new GEMIOLI.Preloader),h()}else Detector.addGetWebGLMessage({parent:e.container})},GEMIOLI.Layer=function(){GEMIOLI.DisplayObjectContainer.call(this),this.batcher=new GEMIOLI.Batcher,this.camera=new THREE.OrthographicCamera(0,GEMIOLI.Application.WIDTH,0,GEMIOLI.Application.HEIGHT,-1,1e3),this.width=GEMIOLI.Application.WIDTH,this.height=GEMIOLI.Application.HEIGHT},GEMIOLI.Layer.prototype=Object.create(GEMIOLI.DisplayObjectContainer.prototype),GEMIOLI.Layer.prototype.constructor=GEMIOLI.Layer,GEMIOLI.Layer.prototype.resize=function(){this.camera.right=GEMIOLI.Application.innerWidth,this.camera.bottom=GEMIOLI.Application.innerHeight,this.camera.updateProjectionMatrix();var e=Math.min(GEMIOLI.Application.innerWidth/GEMIOLI.Application.WIDTH,GEMIOLI.Application.innerHeight/GEMIOLI.Application.HEIGHT);this.width=GEMIOLI.Application.innerWidth/e,this.height=GEMIOLI.Application.innerHeight/e,this.scaleX=this.scaleY=e},GEMIOLI.Layer.prototype.update=function(e,t){},GEMIOLI.Layer.prototype.render=function(){this.batcher.batchIndex=0,this.batcher.camera=this.camera,this.batcher.modelViewMatrix.copyFrom(this.getMatrix()),this.batcher.color.copyFrom(this.tint),GEMIOLI.DisplayObjectContainer.prototype.render.call(this,this.batcher),this.batcher.render()},GEMIOLI.QuadMaterialVertexShader="\tuniform mat4 modelViewMatrix;\tuniform mat4 projectionMatrix;\tattribute vec2 position;\tattribute vec4 color;\tvarying vec4 vColor;\tvoid main() {\t\tvColor = color;\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 0.0, 1.0);\t}",GEMIOLI.QuadMaterialFragmentShader="\tvarying vec4 vColor;\tvoid main() {\t\tgl_FragColor = vColor;\t}",GEMIOLI.QuadMaterial=function(){var e="precision "+GEMIOLI.Renderer.getPrecision()+" float;\nprecision "+GEMIOLI.Renderer.getPrecision()+" int;\n";THREE.RawShaderMaterial.call(this,{uniforms:{},attributes:{},vertexShader:e+GEMIOLI.QuadMaterialVertexShader,fragmentShader:e+GEMIOLI.QuadMaterialFragmentShader,depthTest:!1,depthWrite:!1,transparent:!0})},GEMIOLI.QuadMaterial.prototype=Object.create(THREE.RawShaderMaterial.prototype),GEMIOLI.QuadMaterial.prototype.constructor=GEMIOLI.QuadMaterial,GEMIOLI.Quad=function(){GEMIOLI.DisplayObjectContainer.call(this),this.v1=new THREE.Vector2(0,0),this.v2=new THREE.Vector2(0,0),this.v3=new THREE.Vector2(0,0),this.v4=new THREE.Vector2(0,0),this.c1=new GEMIOLI.Color(1,1,1,1),this.c2=new GEMIOLI.Color(1,1,1,1),this.c3=new GEMIOLI.Color(1,1,1,1),this.c4=new GEMIOLI.Color(1,1,1,1)},GEMIOLI.Quad.fromRect=function(e,t,n,i){var r=new GEMIOLI.Quad;return r.setRectangle(e,t,n,i),r},GEMIOLI.Quad.fromRectColor=function(e,t,n,i,r,o,a,s){var l=new GEMIOLI.Quad;return l.setRectangle(e,t,n,i),l.setColor(r,o,a,s),l},GEMIOLI.Quad.immediateRenderCallback=function(e,t,n){this.__webglVertexBuffer||(this.__webglVertexBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.__webglVertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.positionArray,t.DYNAMIC_DRAW);var i=t.getVertexAttrib(e.attributes.position,t.VERTEX_ATTRIB_ARRAY_ENABLED);i||t.enableVertexAttribArray(e.attributes.position),t.vertexAttribPointer(e.attributes.position,2,t.FLOAT,!1,0,0),this.__webglColorBuffer||(this.__webglColorBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.__webglColorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.DYNAMIC_DRAW);var r=t.getVertexAttrib(e.attributes.color,t.VERTEX_ATTRIB_ARRAY_ENABLED);r||t.enableVertexAttribArray(e.attributes.color),t.vertexAttribPointer(e.attributes.color,4,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLES,0,this.count),this.count=0,i||t.disableVertexAttribArray(e.attributes.position),r||t.disableVertexAttribArray(e.attributes.color)},GEMIOLI.Quad.prototype=Object.create(GEMIOLI.DisplayObjectContainer.prototype),GEMIOLI.Quad.prototype.constructor=GEMIOLI.Quad,GEMIOLI.Quad.prototype.setRectangle=function(e,t,n,i){this.v1.set(e,t),this.v2.set(e+n,t),this.v3.set(e+n,t+i),this.v4.set(e,t+i)},GEMIOLI.Quad.prototype.setColor=function(e,t,n,i){this.c1.set(e,t,n,i),this.c2.set(e,t,n,i),this.c3.set(e,t,n,i),this.c4.set(e,t,n,i)},GEMIOLI.Quad.prototype.setColorHex=function(e){this.c1.setHex(e),this.c2.setHex(e),this.c3.setHex(e),this.c4.setHex(e)},GEMIOLI.Quad.prototype.isUnderPoint=function(){var e=new THREE.Vector2,t=function(e,t,n){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)},n=function(e,n,i,r){var o=t(e,n,i)<0,a=t(e,i,r)<0,s=t(e,r,n)<0;return o===a&&a===s};return function(t,i){return e.set(t,i),this.globalToLocal(e,e),n(e,this.v1,this.v3,this.v2)||n(e,this.v1,this.v4,this.v3)}}(),GEMIOLI.Quad.prototype.render=function(e){e.batchQuad(this),GEMIOLI.DisplayObjectContainer.prototype.render.call(this,e)},GEMIOLI.Batcher=function(){this.scene=new THREE.Scene,this.modelViewMatrix=new GEMIOLI.Matrix(1,0,0,1,0,0),this.matrixStack=[],this.matrixStackSize=0,this.color=new GEMIOLI.Color(1,1,1,1),this.colorStack=[],this.colorStackSize=0;var e=new THREE.ImmediateRenderObject;e.count=0,e.visible=!1,this.batches=[e],this.scene.add(e),this.batchIndex=0},GEMIOLI.Batcher.prototype={constructor:GEMIOLI.Batcher,pushMatrix:function(){this.matrixStack.length<this.matrixStackSize+1&&this.matrixStack.push(new GEMIOLI.Matrix(1,0,0,1,0,0)),this.matrixStack[this.matrixStackSize++].copyFrom(this.modelViewMatrix)},popMatrix:function(){this.modelViewMatrix.copyFrom(this.matrixStack[--this.matrixStackSize])},pushColor:function(){this.colorStack.length<this.colorStackSize+1&&this.colorStack.push(new GEMIOLI.Color(1,1,1,1)),this.colorStack[this.colorStackSize++].copyFrom(this.color)},popColor:function(){this.color.copyFrom(this.colorStack[--this.colorStackSize])},prependMatrix:function(e){this.modelViewMatrix.prepend(e)},prependColor:function(e){this.color.prepend(e)},flush:function(){if(this.batches[this.batchIndex].count>0&&++this.batchIndex===this.batches.length){var e=new THREE.ImmediateRenderObject;e.count=0,e.visible=!1,this.batches.push(e),this.scene.add(this.batches[this.batchIndex])}},render:function(){this.flush();for(var e=0;e<this.batchIndex;++e)this.batches[e].visible=!0;GEMIOLI.Renderer.render(this.scene,this.camera);for(e=0;e<this.batches.length;++e)this.batches[e].visible=!1}},GEMIOLI.Batcher.prototype.batchQuad=function(e){var t=this.batches[this.batchIndex];if(t.type!==GEMIOLI.Quad||t.blending!==e.blending){this.flush(),(t=this.batches[this.batchIndex]).type=GEMIOLI.Quad;var n=GEMIOLI.Quad.material;n||(n=new GEMIOLI.QuadMaterial,GEMIOLI.Quad.material=n),t.material=n,t.blending=t.material.blending=e.blending,t.positionArray||(t.positionArray=new Float32Array(12)),t.colorArray||(t.colorArray=new Float32Array(24)),t.immediateRenderCallback=GEMIOLI.Quad.immediateRenderCallback}var i=t.count,r=t.positionArray;2*(i+6)>r.length&&(t.positionArray=new Float32Array(2*r.length),t.positionArray.set(r,0),r=t.positionArray);var o=t.colorArray;4*(i+6)>o.length&&(t.colorArray=new Float32Array(2*o.length),t.colorArray.set(o,0),o=t.colorArray);var a=this.modelViewMatrix,s=this.color;i=2*t.count;var l=e.v1,c=e.v2,h=e.v3,u=e.v4;r[i+0]=r[i+6]=l.x*a.a+l.y*a.c+a.tx,r[i+1]=r[i+7]=l.x*a.b+l.y*a.d+a.ty,r[i+2]=r[i+10]=h.x*a.a+h.y*a.c+a.tx,r[i+3]=r[i+11]=h.x*a.b+h.y*a.d+a.ty,r[i+4]=c.x*a.a+c.y*a.c+a.tx,r[i+5]=c.x*a.b+c.y*a.d+a.ty,r[i+8]=u.x*a.a+u.y*a.c+a.tx,r[i+9]=u.x*a.b+u.y*a.d+a.ty,i=4*t.count;var d=e.c1,p=e.c2,f=e.c3,E=e.c4;o[i+0]=o[i+12]=d.r*s.r,o[i+1]=o[i+13]=d.g*s.g,o[i+2]=o[i+14]=d.b*s.b,o[i+3]=o[i+15]=d.a*s.a,o[i+4]=o[i+20]=f.r*s.r,o[i+5]=o[i+21]=f.g*s.g,o[i+6]=o[i+22]=f.b*s.b,o[i+7]=o[i+23]=f.a*s.a,o[i+8]=p.r*s.r,o[i+9]=p.g*s.g,o[i+10]=p.b*s.b,o[i+11]=p.a*s.a,o[i+16]=E.r*s.r,o[i+17]=E.g*s.g,o[i+18]=E.b*s.b,o[i+19]=E.a*s.a,t.count+=6},GEMIOLI.TextureQuadMaterialVertexShader="\tuniform mat4 modelViewMatrix;\tuniform mat4 projectionMatrix;\tattribute vec2 position;\tattribute vec4 color;\tattribute vec2 uv;\tvarying vec4 vColor;\tvarying vec2 vUv;\tvoid main() {\t\tvColor = color;\t\tvUv = uv;\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 0.0, 1.0);\t}",GEMIOLI.TextureQuadMaterialFragmentShader="\tvarying vec4 vColor;\tvarying vec2 vUv;\tuniform sampler2D map;\tvoid main() {\t\tgl_FragColor = vColor * texture2D(map, vUv);\t}",GEMIOLI.TextureQuadMaterial=function(e){var t="precision "+GEMIOLI.Renderer.getPrecision()+" float;\nprecision "+GEMIOLI.Renderer.getPrecision()+" int;\n";THREE.RawShaderMaterial.call(this,{uniforms:{map:{type:"t",value:e}},attributes:{},vertexShader:t+GEMIOLI.TextureQuadMaterialVertexShader,fragmentShader:t+GEMIOLI.TextureQuadMaterialFragmentShader,depthTest:!1,depthWrite:!1,transparent:!0})},GEMIOLI.TextureQuadMaterial.prototype=Object.create(THREE.RawShaderMaterial.prototype),GEMIOLI.TextureQuadMaterial.prototype.constructor=GEMIOLI.TextureQuadMaterial,GEMIOLI.TextureQuad=function(){GEMIOLI.Quad.call(this),this.uv1=new THREE.Vector2(0,1),this.uv2=new THREE.Vector2(1,1),this.uv3=new THREE.Vector2(1,0),this.uv4=new THREE.Vector2(0,0),this.texture=GEMIOLI.TextureLoader.DEFAULT},GEMIOLI.TextureQuad.fromRect=function(e,t,n,i,r){var o=new GEMIOLI.TextureQuad;return o.setRectangle(e,t,n,i),o.texture=r,o},GEMIOLI.TextureQuad.materials={},GEMIOLI.TextureQuad.immediateRenderCallback=function(e,t,n){this.__webglVertexBuffer||(this.__webglVertexBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.__webglVertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.positionArray,t.DYNAMIC_DRAW);var i=t.getVertexAttrib(e.attributes.position,t.VERTEX_ATTRIB_ARRAY_ENABLED);i||t.enableVertexAttribArray(e.attributes.position),t.vertexAttribPointer(e.attributes.position,2,t.FLOAT,!1,0,0),this.__webglUvBuffer||(this.__webglUvBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.__webglUvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.DYNAMIC_DRAW);var r=t.getVertexAttrib(e.attributes.uv,t.VERTEX_ATTRIB_ARRAY_ENABLED);r||t.enableVertexAttribArray(e.attributes.uv),t.vertexAttribPointer(e.attributes.uv,2,t.FLOAT,!1,0,0),this.__webglColorBuffer||(this.__webglColorBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.__webglColorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.DYNAMIC_DRAW);var o=t.getVertexAttrib(e.attributes.color,t.VERTEX_ATTRIB_ARRAY_ENABLED);o||t.enableVertexAttribArray(e.attributes.color),t.vertexAttribPointer(e.attributes.color,4,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLES,0,this.count),this.count=0,i||t.disableVertexAttribArray(e.attributes.position),r||t.disableVertexAttribArray(e.attributes.uv),o||t.disableVertexAttribArray(e.attributes.color)},GEMIOLI.TextureQuad.prototype=Object.create(GEMIOLI.Quad.prototype),GEMIOLI.TextureQuad.prototype.constructor=GEMIOLI.TextureQuad,GEMIOLI.TextureQuad.prototype.setUvRectangle=function(e,t,n,i){this.uv1.set(e,t),this.uv2.set(e+n,t),this.uv3.set(e+n,t+i),this.uv4.set(e,t+i)},GEMIOLI.TextureQuad.prototype.setUvBox=function(e,t,n,i){this.uv1.set(e,t),this.uv2.set(n,t),this.uv3.set(n,i),this.uv4.set(e,i)},GEMIOLI.TextureQuad.prototype.setTexture=function(e){},GEMIOLI.TextureQuad.prototype.render=function(e){e.batchTextureQuad(this),GEMIOLI.DisplayObjectContainer.prototype.render.call(this,e)},GEMIOLI.Batcher.prototype.batchTextureQuad=function(e){var t=this.batches[this.batchIndex];if(t.type!==GEMIOLI.TextureQuad||t.blending!==e.blending||t.texture!==e.texture){this.flush(),(t=this.batches[this.batchIndex]).type=GEMIOLI.TextureQuad,t.positionArray||(t.positionArray=new Float32Array(12)),t.uvArray||(t.uvArray=new Float32Array(12)),t.colorArray||(t.colorArray=new Float32Array(24));var n=GEMIOLI.TextureQuad.materials[e.texture.id];n||(n=new GEMIOLI.TextureQuadMaterial(e.texture),GEMIOLI.TextureQuad.materials[e.texture.id]=n),t.material=n,t.blending=t.material.blending=e.blending,t.texture=e.texture,t.immediateRenderCallback=GEMIOLI.TextureQuad.immediateRenderCallback}var i=t.count,r=t.positionArray;2*(i+6)>r.length&&(t.positionArray=new Float32Array(2*r.length),t.positionArray.set(r,0),r=t.positionArray);var o=t.uvArray;2*(i+6)>o.length&&(t.uvArray=new Float32Array(2*o.length),t.uvArray.set(o,0),o=t.uvArray);var a=t.colorArray;4*(i+6)>a.length&&(t.colorArray=new Float32Array(2*a.length),t.colorArray.set(a,0),a=t.colorArray);var s=this.modelViewMatrix,l=this.color;i=2*t.count;var c=e.v1,h=e.v2,u=e.v3,d=e.v4;r[i+0]=r[i+6]=c.x*s.a+c.y*s.c+s.tx,r[i+1]=r[i+7]=c.x*s.b+c.y*s.d+s.ty,r[i+2]=r[i+10]=u.x*s.a+u.y*s.c+s.tx,r[i+3]=r[i+11]=u.x*s.b+u.y*s.d+s.ty,r[i+4]=h.x*s.a+h.y*s.c+s.tx,r[i+5]=h.x*s.b+h.y*s.d+s.ty,r[i+8]=d.x*s.a+d.y*s.c+s.tx,r[i+9]=d.x*s.b+d.y*s.d+s.ty,i=2*t.count;var p=e.uv1,f=e.uv2,E=e.uv3,m=e.uv4;o[i+0]=o[i+6]=p.x,o[i+1]=o[i+7]=p.y,o[i+2]=o[i+10]=E.x,o[i+3]=o[i+11]=E.y,o[i+4]=f.x,o[i+5]=f.y,o[i+8]=m.x,o[i+9]=m.y,i=4*t.count;var g=e.c1,v=e.c2,y=e.c3,T=e.c4;a[i+0]=a[i+12]=g.r*l.r,a[i+1]=a[i+13]=g.g*l.g,a[i+2]=a[i+14]=g.b*l.b,a[i+3]=a[i+15]=g.a*l.a,a[i+4]=a[i+20]=y.r*l.r,a[i+5]=a[i+21]=y.g*l.g,a[i+6]=a[i+22]=y.b*l.b,a[i+7]=a[i+23]=y.a*l.a,a[i+8]=v.r*l.r,a[i+9]=v.g*l.g,a[i+10]=v.b*l.b,a[i+11]=v.a*l.a,a[i+16]=T.r*l.r,a[i+17]=T.g*l.g,a[i+18]=T.b*l.b,a[i+19]=T.a*l.a,t.count+=6},GEMIOLI.AtlasQuad=function(){GEMIOLI.TextureQuad.call(this),this.region=null;var e=this;this.onRegionLoad=function(t){var n=e.region;n?(e.texture=n.texture,e.setUvBox(n.u1,n.v1,n.u2,n.v2)):e.texture=GEMIOLI.TextureLoader.DEFAULT}},GEMIOLI.AtlasQuad.fromRect=function(e,t,n,i,r,o){var a=new GEMIOLI.AtlasQuad;return a.setRectangle(e,t,n,i),a.setRegion(GEMIOLI.AtlasLoader.loadRegion(r,o)),a},GEMIOLI.AtlasQuad.prototype=Object.create(GEMIOLI.TextureQuad.prototype),GEMIOLI.AtlasQuad.prototype.constructor=GEMIOLI.AtlasQuad,GEMIOLI.AtlasQuad.prototype.setRegion=function(e){this.region&&this.region.removeEventListener("load",this.onRegionLoad,!1),this.region=e,this.onRegionLoad(null),this.region&&this.region.addEventListener("load",this.onRegionLoad,!1)},GEMIOLI.Text=function(e,t,n,i,r,o){GEMIOLI.DisplayObjectContainer.call(this),this.size=e,this.textAlign=n||GEMIOLI.Text.LEFT_ALIGN,this.hAlign=i||GEMIOLI.Text.LEFT_ALIGN,this.vAlign=r||GEMIOLI.Text.TOP_ALIGN,this.color=o||new GEMIOLI.Color(1,1,1,1),this.offset=0,this.lineOffset=0,this.text="",this.textWidth=0,this.textHeight=0,this.font=t;var a=this;this._onFontLoad=function(e){a._font&&a._font.removeEventListener("load",a._onFontLoad,!1),a._font=null}},GEMIOLI.Text.fromUrl=function(e,t,n,i,r,o){return new GEMIOLI.Text(e,GEMIOLI.FontLoader.load(t),n,i,r,o)},GEMIOLI.Text.fromAtlas=function(e,t,n,i,r,o,a){return new GEMIOLI.Text(e,GEMIOLI.FontLoader.loadFromAtlas(t,n),i,r,o,a)},GEMIOLI.Text.LEFT_ALIGN=0,GEMIOLI.Text.CENTER_ALIGN=1,GEMIOLI.Text.RIGHT_ALIGN=2,GEMIOLI.Text.TOP_ALIGN=3,GEMIOLI.Text.BOTTOM_ALIGN=4,GEMIOLI.Text.prototype=Object.create(GEMIOLI.DisplayObjectContainer.prototype),GEMIOLI.Text.prototype.constructor=GEMIOLI.Text,GEMIOLI.Text.prototype.layout=function(){if((this.text!==this._text||this.font!==this._font||this.textAlign!==this._textAlign||this.hAlign!==this._hAlign||this.vAlign!==this._vAlign)&&(this._text=this.text,this._font&&this._font.removeEventListener("load",this._onFontLoad,!1),this._font=this.font,this._font&&this._font.addEventListener("load",this._onFontLoad,!1),this._textAlign=this.textAlign,this._hAlign=this.hAlign,this._vAlign=this.vAlign,this._lineWidths=[],this._cacheText="",this.textWidth=0,this.textHeight=0,this._font)){for(var e="",t=this.text,n=this._font,i=0,r=t.length;i<r;++i)(n.glyphs[t.charCodeAt(i)]||"\n"===t[i])&&(e+=t[i]);this._cacheText=e;var o=(t=e).length,a=this.size/n.size,s=0,l=0,c=0,h=0,u=0,d=0;for(n.base,i=0;i<o;++i)if("\n"!=t[i]){var p=n.glyphs[t.charCodeAt(i)];u<(c=s+p.x*a+p.w*a)&&(u=c),d<(h=l+p.y*a+p.h*a)&&(d=h),s+=(p.xa+this.offset)*a}else this._lineWidths.push(c),s=0,l+=(n.height+this.lineOffset)*a;this._lineWidths.push(c),this.textWidth=u,this.textHeight=d}},GEMIOLI.Text.prototype.render=function(e){if(this.layout(),this._font){var t=e.batches[e.batchIndex],n=this._font,r=this.size/n.size,o=0,a=0,s=this.textWidth,l=this.textHeight,c=this._lineWidths,h=0,u=this._cacheText,d=u.length;switch(this.vAlign){case GEMIOLI.Text.CENTER_ALIGN:a=-l/2;break;case GEMIOLI.Text.BOTTOM_ALIGN:a=-l;break;default:a=0}for(i=0;i<d;++i){var p=u[i];if("\n"===p||0===i){switch("\n"===p&&++h,this.textAlign){case GEMIOLI.Text.CENTER_ALIGN:o=(s-c[h])/2;break;case GEMIOLI.Text.RIGHT_ALIGN:o=s-c[h];break;default:o=0}switch(this.hAlign){case GEMIOLI.Text.CENTER_ALIGN:o-=s/2;break;case GEMIOLI.Text.RIGHT_ALIGN:o-=s}if("\n"===p){a+=(n.height+this.lineOffset)*r;continue}}var f=n.glyphs[u.charCodeAt(i)],E=n.pages[f.p];t.type===GEMIOLI.TextureQuad&&t.texture===E||(e.flush(),(t=e.batches[e.batchIndex]).type=GEMIOLI.TextureQuad,t.positionArray||(t.positionArray=new Float32Array(12)),t.uvArray||(t.uvArray=new Float32Array(12)),t.colorArray||(t.colorArray=new Float32Array(24)),t.material=new GEMIOLI.TextureQuadMaterial(E),t.texture=E,t.immediateRenderCallback=GEMIOLI.TextureQuad.immediateRenderCallback);var m=t.count,g=t.positionArray;2*(m+6)>g.length&&(t.positionArray=new Float32Array(2*g.length),t.positionArray.set(g,0),g=t.positionArray);var v=t.uvArray;2*(m+6)>v.length&&(t.uvArray=new Float32Array(2*v.length),t.uvArray.set(v,0),v=t.uvArray);var y=t.colorArray;4*(m+6)>y.length&&(t.colorArray=new Float32Array(2*y.length),t.colorArray.set(y,0),y=t.colorArray);var T=e.modelViewMatrix,_=e.color;m=2*t.count;var R=o+f.x*r,b=a+f.y*r,x=R+f.w*r,w=b,M=x,L=w+f.h*r,S=R,H=L;g[m+0]=g[m+6]=R*T.a+b*T.c+T.tx,g[m+1]=g[m+7]=R*T.b+b*T.d+T.ty,g[m+2]=g[m+10]=M*T.a+L*T.c+T.tx,g[m+3]=g[m+11]=M*T.b+L*T.d+T.ty,g[m+4]=x*T.a+w*T.c+T.tx,g[m+5]=x*T.b+w*T.d+T.ty,g[m+8]=S*T.a+H*T.c+T.tx,g[m+9]=S*T.b+H*T.d+T.ty,v[(m=2*t.count)+0]=v[m+6]=f.u1,v[m+1]=v[m+7]=f.v1,v[m+2]=v[m+10]=f.u2,v[m+3]=v[m+11]=f.v2,v[m+4]=f.u2,v[m+5]=f.v1,v[m+8]=f.u1,v[m+9]=f.v2,m=4*t.count;var I=this.color;y[m+0]=y[m+12]=I.r*_.r,y[m+1]=y[m+13]=I.g*_.g,y[m+2]=y[m+14]=I.b*_.b,y[m+3]=y[m+15]=I.a*_.a,y[m+4]=y[m+20]=I.r*_.r,y[m+5]=y[m+21]=I.g*_.g,y[m+6]=y[m+22]=I.b*_.b,y[m+7]=y[m+23]=I.a*_.a,y[m+8]=I.r*_.r,y[m+9]=I.g*_.g,y[m+10]=I.b*_.b,y[m+11]=I.a*_.a,y[m+16]=I.r*_.r,y[m+17]=I.g*_.g,y[m+18]=I.b*_.b,y[m+19]=I.a*_.a,t.count+=6,o+=(f.xa+this.offset)*r}GEMIOLI.DisplayObjectContainer.prototype.render.call(this,e)}},GEMIOLI.Button=function(e,t,n,i,r){GEMIOLI.DisplayObjectContainer.call(this),this.set(e,t,n,i),this.bpoint=new THREE.Vector2,this.pointerId=-1,this.keys=r||[],this.addEventListener("pointerdown",this.onPointerDown),this.addEventListener("pointerup",this.onPointerUp),this.addEventListener("pointermove",this.onPointerMove),this.addEventListener("pointercancel",this.onPointerCancel),this.addEventListener("keydown",this.onKeyDown),this.setState(GEMIOLI.Button.STATE_NORMAL)},GEMIOLI.Button.STATE_NORMAL=0,GEMIOLI.Button.STATE_HOVER=1,GEMIOLI.Button.STATE_PRESSED=2,GEMIOLI.Button.STATE_DISABLED=3,GEMIOLI.Button.inFocus=null,GEMIOLI.Button.inHover=0,GEMIOLI.Button.prototype=Object.create(GEMIOLI.DisplayObjectContainer.prototype),GEMIOLI.Button.prototype.constructor=GEMIOLI.Button,GEMIOLI.Button.prototype.isUnderPoint=function(e,t){var n=this.bpoint;return n.set(e,t),this.globalToLocal(n,n),this.bx1<=n.x&&n.x<=this.bx2&&this.by1<=n.y&&n.y<=this.by2},GEMIOLI.Button.prototype.setState=function(e){this.bstate!==e&&(this.bstate=e)},GEMIOLI.Button.prototype.render=function(){var e=new GEMIOLI.Matrix;return function(t){switch(this.bstate){case GEMIOLI.Button.STATE_HOVER:e.a=e.d=1.1,GEMIOLI.Button.inHover++;break;case GEMIOLI.Button.STATE_PRESSED:e.a=e.d=.9;break;default:e.a=e.d=1}t.pushMatrix(),t.prependMatrix(e),GEMIOLI.DisplayObjectContainer.prototype.render.call(this,t),t.popMatrix()}}(),GEMIOLI.Button.prototype.set=function(e,t,n,i){this.bx1=e,this.by1=t,this.bx2=e+n,this.by2=t+i},GEMIOLI.Button.prototype.onPointerDown=function(e){!GEMIOLI.Button.inFocus&&this.visible&&this.isUnderPoint(e.x,e.y)&&(this.pointerId=e.pointerId,GEMIOLI.Button.inFocus=this,e.cancelled=!0,this.bstate!==GEMIOLI.Button.STATE_DISABLED&&this.setState(GEMIOLI.Button.STATE_PRESSED))},GEMIOLI.Button.prototype.onPointerUp=function(e){GEMIOLI.Button.inFocus===this&&e.pointerId===this.pointerId&&(GEMIOLI.Button.inFocus=null,this.pointerId=-1,this.bstate!==GEMIOLI.Button.STATE_DISABLED&&this.setState(GEMIOLI.Button.STATE_NORMAL),this.isUnderPoint(e.x,e.y)&&this.dispatchEvent({type:"click"}))},GEMIOLI.Button.prototype.onPointerMove=function(e){if(this.bstate!==GEMIOLI.Button.STATE_DISABLED&&this.visible)if(GEMIOLI.Button.inFocus){if(GEMIOLI.Button.inFocus!==this||e.pointerId!==this.pointerId)return;this.setState(this.isUnderPoint(e.x,e.y)?GEMIOLI.Button.STATE_PRESSED:GEMIOLI.Button.STATE_NORMAL)}else e.down||this.setState(this.isUnderPoint(e.x,e.y)&&this.visible?GEMIOLI.Button.STATE_HOVER:GEMIOLI.Button.STATE_NORMAL)},GEMIOLI.Button.prototype.onPointerCancel=function(e){GEMIOLI.Button.inFocus===this&&e.pointerId===this.pointerId&&(GEMIOLI.Button.inFocus=null,this.pointerId=-1,this.bstate!==GEMIOLI.Button.STATE_DISABLED&&this.setState(GEMIOLI.Button.STATE_NORMAL))},GEMIOLI.Button.prototype.onKeyDown=function(e){if(!GEMIOLI.Button.inFocus&&this.visible)for(var t=e.keyCode,n=0;n<this.keys.length;++n)if(this.keys[n]===t){e.preventDefault(),e.cancelled=!0,this.dispatchEvent({type:"click"});break}},GEMIOLI.StaticButton=function(e,t,n,i,r){GEMIOLI.Button.call(this,e,t,n,i,r)},GEMIOLI.StaticButton.prototype=Object.create(GEMIOLI.Button.prototype),GEMIOLI.StaticButton.prototype.render=function(e){GEMIOLI.DisplayObjectContainer.prototype.render.call(this,e),this.bstate===GEMIOLI.Button.STATE_HOVER&&GEMIOLI.Button.inHover++},GEMIOLI.Cross=function(){GEMIOLI.Layer.call(this);this.fade=new GEMIOLI.Quad,this.fade.setColorHex(4278190080),this.addChild(this.fade)},GEMIOLI.Cross.prototype=Object.create(GEMIOLI.Layer.prototype),GEMIOLI.Cross.prototype.resize=function(){GEMIOLI.Layer.prototype.resize.call(this),this.fade.setRectangle(0,0,this.width,this.height)},GEMIOLI.Cross.prototype.show=function(e,t){GEMIOLI.Application.pushLayer(this),this.time=0,this.crossFunction=e,this.endFunction=t,this.runCross=!1},GEMIOLI.Cross.prototype.update=function(e,t){this.runCross&&(this.runCross=!1,GEMIOLI.Application.clearLayers(),this.crossFunction&&(this.crossFunction(),this.crossFunction=null),GEMIOLI.Application.pushLayer(this));var n=this.time;this.time+=e,n<.5&&this.time>=.5?(this.time=.5,this.runCross=!0):n<1&&this.time>=1&&(this.time=1,GEMIOLI.Application.popLayer(),this.endFunction&&(this.endFunction(),this.endFunction=null)),this.fade.tint.a=1-Math.abs(2*this.time-1)},GEMIOLI.Preloader=function(){var e=this;adHandler.init(),h5branding.gameanalytics.setup(GAME_KEY,SECRET_KEY,version),h5branding.google.setup(GOOGLE_ID,GOOGLE_APP_NAME,version),h5branding.google.sendScreenView("splash"),h5branding.SplashLoader.getInstance().setButtonCallback(function(){h5branding.SplashLoader.getInstance().destroy(),adHandler.showAd("splash",function(){GEMIOLI.Menu.show()}.bind(this))}),GEMIOLI.Layer.call(e),e.fade=new GEMIOLI.Quad,e.fade.setColorHex(4283943679),e.addChild(e.fade),e.center=new GEMIOLI.DisplayObjectContainer,e.addChild(e.center),e.back=GEMIOLI.AtlasQuad.fromRect(-269,-267,539,535,"atlases/preloader.atlas","back"),e.light=GEMIOLI.AtlasQuad.fromRect(-263,-240,526,480,"atlases/preloader.atlas","light"),e.almaz=GEMIOLI.AtlasQuad.fromRect(-118,-150,236,301,"atlases/preloader.atlas","almaz"),e.back.y=e.light.y=e.almaz.y=-200,e.progressBack=GEMIOLI.AtlasQuad.fromRect(-297,-53,594,107,"atlases/preloader.atlas","progress_bg"),e.progress=GEMIOLI.AtlasQuad.fromRect(-272,-29,545,58,"atlases/preloader.atlas","progress"),e.progress.setXFactor=function(e){var t=this;t.v2.set(545*e-272,-29),t.v3.set(545*e-272,29),t.uv2.set((t.region.u2-t.region.u1)*e+t.region.u1,t.region.v1),t.uv3.set((t.region.u2-t.region.u1)*e+t.region.u1,t.region.v2)},e.progressTop=GEMIOLI.AtlasQuad.fromRect(-277,-34,555,68,"atlases/preloader.atlas","progress_top"),e.progressValue=0,e.total=-1,e.progressBack.y=e.progress.y=e.progressTop.y=300,e.loading=GEMIOLI.AtlasQuad.fromRect(-185,-48,370,96,"atlases/preloader.atlas","loading"),e.caution=GEMIOLI.AtlasQuad.fromRect(-545,-109,1091,218,"atlases/preloader.atlas","caution"),e.caution.y=200,e.ready=new GEMIOLI.DisplayObjectContainer,e.ready.addChild(GEMIOLI.Utils.isMobile()?GEMIOLI.AtlasQuad.fromRect(-371,-48,742,96,"atlases/preloader.atlas","tap"):GEMIOLI.AtlasQuad.fromRect(-410,-47,821,95,"atlases/preloader.atlas","click")),e.ready.y=e.loading.y=160,e.ready.visible=!1,e.time=0,e.center.addEventListener("pointerdown",function(e){}),e.center.addEventListener("keydown",function(t){13!==t.keyCode&&32!==t.keyCode||(e.center.dispatchEvent({type:"pointerdown"}),t.preventDefault(),t.cancelled=!0)}),GEMIOLI.TextureLoader.load("atlases/preloader.png"),GEMIOLI.AtlasLoader.load("atlases/preloader.atlas",function(){GEMIOLI.TextureLoader.load("atlases/preloader.png",function(){e.center.addChild(e.back),e.center.addChild(e.light),e.center.addChild(e.almaz),e.center.addChild(e.progressBack),e.center.addChild(e.progress),e.center.addChild(e.progressTop),e.center.addChild(e.loading),e.center.addChild(e.ready),navigator.userAgent.toLowerCase().indexOf("samsung")>-1&&navigator.userAgent.indexOf("Android ")>-1&&e.addChild(e.caution),GEMIOLI.SoundLoader.webaudio?(GEMIOLI.SoundLoader.load("sounds.ogg","sounds.ogg"),GEMIOLI.SoundLoader.loadAtlas("sound/sounds.js","sounds.ogg",null,function(e){window.console&&window.console.log&&console.log("Can't load sound atlas",e)})):GEMIOLI.XHRLoader.load("sound/sounds.js",function(e){for(var t=JSON.parse(e.request.response),n=0,i=t.length;n<i;++n)GEMIOLI.SoundLoader.load(t[n].id,t[n].id+".ogg")},function(e){window.console&&window.console.log&&console.log("Can't load sound atlas",e)}),GEMIOLI.Cross=new GEMIOLI.Cross,GEMIOLI.Play=new GEMIOLI.Play,GEMIOLI.Menu=new GEMIOLI.Menu,GEMIOLI.Settings=new GEMIOLI.Settings,GEMIOLI.Pause=new GEMIOLI.Pause,GEMIOLI.Score=new GEMIOLI.Score,GEMIOLI.Shop=new GEMIOLI.Shop,e.total=GEMIOLI.Loader.getQueueLength()},function(){window.console&&window.console.log&&console.log("Can't load Preloader atlas texture",event)})},function(e){window.console&&window.console.log&&console.log("Can't load Preloader atlas",e)})},GEMIOLI.Preloader.prototype=Object.create(GEMIOLI.Layer.prototype),GEMIOLI.Preloader.prototype.resize=function(){var e=this;GEMIOLI.Layer.prototype.resize.call(e),e.fade.setRectangle(0,0,e.width,e.height),e.center.x=e.width/2,e.center.y=e.height/2,e.caution.x=e.width/2},GEMIOLI.Preloader.prototype.update=function(e,t){var n=this;if(-1!==n.total&&!0!==n.ready.visible){var i=GEMIOLI.Loader.getQueueLength();i>n.total&&(n.total=i),n.progressValue=Math.max(n.progressValue,1-i/n.total),n.progress.setXFactor(n.progressValue),h5branding.SplashLoader.getInstance().setLoadProgress(100*n.progressValue|0),0===i&&(n.loading.visible=!1,n.ready.visible=!0,n.progress.visible=!1,n.progressBack.visible=!1,n.progressTop.visible=!1),n.ready.visible&&(GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Cross.show(function(){GEMIOLI.Application.pushLayer(GEMIOLI.Play),GEMIOLI.Application.pushLayer(GEMIOLI.Menu)}),h5branding.SplashLoader.getInstance().setLoadProgress(100*n.progressValue|0))}},GEMIOLI.Logo=function(e,t,n,i){var r=this;GEMIOLI.StaticButton.call(r,e,t,n,i),r.quad=new GEMIOLI.LogoQuad(e,t,n,i),r.addChild(r.quad),r.addEventListener("click",function(e){GEMIOLI.SoundLoader.load("button").play(),SpilData.logoData&&SpilData.logoData.action&&SpilData.logoData.action.call(r)})},GEMIOLI.Logo.prototype=Object.create(GEMIOLI.StaticButton.prototype),GEMIOLI.LogoQuad=function(e,t,n,i){var r=this;GEMIOLI.TextureQuad.call(r),r.rectangle=new THREE.Vector4(e,t,n,i),r.setRectangle(r.rectangle.x,r.rectangle.y,r.rectangle.z,r.rectangle.w),r.visible=!1,r.createLogo()},GEMIOLI.LogoQuad.prototype=Object.create(GEMIOLI.TextureQuad.prototype),GEMIOLI.LogoQuad.prototype.createLogo=function(){var e=this,t=SponsorLogo.getLogo();if(t){e.visible=!0,e.texture=t;var n=t.image.width,i=t.image.height,r=Math.min(e.rectangle.z/n,e.rectangle.w/i);n*=r,i*=r,e.setRectangle(e.rectangle.x+e.rectangle.z/2-n/2,e.rectangle.y+e.rectangle.w/2-i/2,n,i)}},GEMIOLI.Play=function(){GEMIOLI.Layer.call(this);var e=this,t=new THREE.Object3D,n=new THREE.Scene;t.add(n);var i=new THREE.Scene;i.fog=new THREE.Fog(16777215,3e3,4e3),t.add(i);var r=new THREE.Scene;r.fog=new THREE.Fog(16777215,3e3,4e3),t.add(r);var o=new THREE.Scene;o.fog=i.fog,t.add(o);var a=new GEMIOLI.List;t.childs=a,t.add=function(e){e.sceneNode=a.add(e),e.ground?i.add(e):e.isShadow?r.add(e):e.sky?n.add(e):o.add(e)},t.remove=function(e){e.sceneNode&&(a.removeNode(e.sceneNode),e.sceneNode=null,e.ground?i.remove(e):e.isShadow?r.remove(e):e.sky?n.remove(e):o.remove(e))},e.scene3D=t;var s=new THREE.PerspectiveCamera(50,GEMIOLI.Application.innerWidth/GEMIOLI.Application.innerHeight,10,5e3),l=new THREE.Frustum;s.target=new THREE.Vector3,l.helpMatrix=new THREE.Matrix4,e.camera3D=s,e.frustum=l;var c=new GEMIOLI.List;e.toUpdate=c;var h=new GEMIOLI.List;e.toAdd=h;var u=new GEMIOLI.List;e.toRemove=u,e.player=null,e.bendMaterials=[],e.bendOffset=0,e.distance=0,e.playerSpeed=1e3,e.playerSpeedMode=0,e.bendX=e.bendY=0,GEMIOLI.Application.DEBUG&&(e.playerSpeedMode=1,e.debugLevel=-1,e.debugLevels=[]);var d,p=null,f=null,E=null,m=null,g=null,v=null,y=new THREE.BufferGeometry;y.addAttribute("index",new THREE.BufferAttribute(new Uint16Array([0,2,1,0,3,2]),1)),y.addAttribute("position",new THREE.BufferAttribute(new Float32Array([-.5,0,-.5,.5,0,-.5,.5,0,.5,-.5,0,.5]),3)),y.addAttribute("uv",new THREE.BufferAttribute(new Float32Array([0,1,1,1,1,0,0,0]),2));var T=new THREE.BufferGeometry;T.addAttribute("index",new THREE.BufferAttribute(new Uint16Array([0,1,2,0,2,3]),1)),T.addAttribute("position",new THREE.BufferAttribute(new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),3)),T.addAttribute("uv",new THREE.BufferAttribute(new Float32Array([0,0,1,0,1,1,0,1]),2));var _,R,b,x=new THREE.Vector3,w=function(e,t,n,i){var r=this;THREE.Mesh.call(this,e,t),r.ground=!0,r.type=n||1,r.box=i||e.boundingBox,r.wood=!1,r.boundingBox=new THREE.Box3,r.addEventListener("added",r.onAdded),r.addEventListener("removed",r.onRemoved)};(w.prototype=Object.create(THREE.Mesh.prototype)).onAdded=function(){var e=this;e.onPositionChange(),e.updateNode=c.add(e)},w.prototype.onRemoved=function(){c.removeNode(this.updateNode),this.updateNode=null},w.prototype.update=function(e){return _=this.boundingBox,R=_.min,b=_.max,g.x<=b.x&&g.x>=R.x&&g.z<=b.z&&g.z>=R.z&&(p.surface=this.type,p.wood=this.wood,!0)},w.prototype.onPositionChange=function(){var e=this;e.updateMatrixWorld(!0),e.boundingBox.copy(e.box),e.boundingBox.applyMatrix4(e.matrixWorld)};var M=function(e,t,n,i,r){var o=this;w.call(o,e,t,n),o.centerPoint=new THREE.Vector3,o.direction=new THREE.Vector3,o.left=i||!1,o.right=r||!1};(M.prototype=Object.create(w.prototype)).onAdded=function(){var e=this;e.playerRotated=!1,e.player=0,w.prototype.onAdded.call(e)},M.prototype.update=function(){var e,t,n,i;return function(r){e=(i=this).boundingBox,t=e.min,n=e.max,g.x<=n.x&&g.x>=t.x&&g.z<=n.z&&g.z>=t.z&&(p.surface=i.type,p.cross=i),!i.playerRotated&&x.copy(f).sub(i.centerPoint).dot(i.direction)>=0&&(i.left&&-1===i.player?(p.clearRotation.y+=Math.PI/2,p.clearPosition.copy(i.centerPoint),GEMIOLI.SoundLoader.load("turn").play()):i.right&&1===i.player&&(p.clearRotation.y-=Math.PI/2,p.clearPosition.copy(i.centerPoint),GEMIOLI.SoundLoader.load("turn").play()),i.playerRotated=!0)}}(),M.prototype.onPositionChange=function(){var e=this;w.prototype.onPositionChange.call(e),e.centerPoint.set(1016,0,-195,907).applyMatrix4(e.matrixWorld),e.direction.set(1,0,0).applyEuler(e.rotation)};var L=function(e){THREE.Mesh.call(this,T,e),this.sscale=1,this.srotation=0};(L.prototype=Object.create(THREE.Mesh.prototype)).update=function(){var e=this;e.material.uniforms.scale.value=e.sscale,e.material.uniforms.rotation.value=e.srotation};var S=["Level01.js","Level02.js","Level03.js","Level04.js","Level05.js","Level06.js","Level07.js","Level08.js","Level09.js","Level010.js","Level011.js","Level012.js","Level013.js","Level014.js","Level015.js","Level016.js","Level017.js","Level018.js","Level19.js","Level20.js","Level21.js","Level022.js","Level023.js"],H=["TileLLevel.js","TileRLevel.js","TileDoubleLevel.js"],I=function(e,t,n,i){var r=this;THREE.Object3D.call(r),r.addEventListener("added",r.onAdded),r.addEventListener("removed",r.onRemoved),r.objectsData=e,r.defaultBox=t,r.box=new THREE.Box3,r.instances=new GEMIOLI.List,r.nextLevel=null,r.nextLevelId=null,r.end=new THREE.Vector3,r.nextLevel1=r.nextLevel2=null,r.nextLevel1Id=r.nextLevel2Id=null,r.level1Offset=n,r.level2Offset=i,r.level1Offset&&(r.end1=new THREE.Vector3),r.level2Offset&&(r.end2=new THREE.Vector3)},A=!1,C=["models/Mnojitel.js","models/Schit.js","models/Magnit.js"];(I.prototype=Object.create(THREE.Object3D.prototype)).onAdded=function(){var t,n,i=this,r=i.objectsData;i.position;i.onPositionChange();for(var o=0,a=r.length;o<a;++o){if("models/Schit.js"===(n=r[o]).id){if(p.schitTime>0||p.magnetTime>0||p.multiplicatorTime>0||A)continue;A=!0,i.timeBonus=!0,t=e.objectFromPool(C[GEMIOLI.Utils.rand()%C.length])}else t=e.objectFromPool(n.id);t.position.copy(n.position),t.position.applyMatrix4(i.matrixWorld),t.rotation.copy(n.rotation),t.rotation.y+=i.rotation.y,t.scale.copy(n.scale),t.addEventListener("removed",i.onInstanceRemoved),t.level=i,t.levelNode=i.instances.add(t),h.add(t)}i.updateNode=c.add(i),e.tutorial&&("Nachalo.js"===i.objectType&&(i.nextLevelId="Level_Tut01.js"),"Level_Tut01.js"===i.objectType?i.nextLevelId="TileLLevel.js":"TileLLevel.js"===i.objectType?i.nextLevel1Id="Level_Tut02.js":"Level_Tut02.js"===i.objectType&&(i.nextLevelId="TileRLevel.js")),i.wasPlayer=!1,window.console&&window.console.log&&console.log("show",i.objectType,i.id)},I.prototype.onRemoved=function(){for(var e=this,t=e.instances.head;t;)u.add(t.data),t=t.next;c.removeNode(e.updateNode),e.updateNode=null,e.nextLevel&&!e.nextLevel.wasPlayer&&u.add(e.nextLevel),e.nextLevel1&&!e.nextLevel1.wasPlayer&&u.add(e.nextLevel1),e.nextLevel2&&!e.nextLevel2.wasPlayer&&u.add(e.nextLevel2),e.nextLevel=e.nextLevel1=e.nextLevel2=e.nextLevelId=e.nextLevel1Id=e.nextLevel2Id=null,e.timeBonus&&(e.timeBonus=!1,A=!1),window.console&&window.console.log&&console.log("hide",e.objectType,e.id)},I.prototype.update=function(){var t,n;return function(i){var r=this,o=r.box;t=o.min,n=o.max,g.x<=n.x&&g.x>=t.x&&g.z<=n.z&&g.z>=t.z&&(r.wasPlayer=!0),l.intersectsBox(r.box)?r.level1Offset||r.level2Offset?(r.level1Offset&&(r.nextLevel1||(r.nextLevel1=e.objectFromPool(r.nextLevel1Id||(r.nextLevel1Id=S[GEMIOLI.Utils.rand()%S.length])),r.nextLevel1.position.copy(r.end1),r.nextLevel1.rotation.copy(r.rotation),r.nextLevel1.rotation.y+=Math.PI/2,h.add(r.nextLevel1))),r.level2Offset&&(r.nextLevel2||(r.nextLevel2=e.objectFromPool(r.nextLevel2Id||(r.nextLevel2Id=S[GEMIOLI.Utils.rand()%S.length])),r.nextLevel2.position.copy(r.end2),r.nextLevel2.rotation.copy(r.rotation),r.nextLevel2.rotation.y-=Math.PI/2,h.add(r.nextLevel2)))):r.nextLevel||(void 0===e.debugLevel||-1===e.debugLevel?e.lineDistance<=0?(r.nextLevel=e.objectFromPool(H[GEMIOLI.Utils.rand()%H.length]),e.lineDistance=2e3+5e3*Math.random()):r.nextLevel=e.objectFromPool(r.nextLevelId||(r.nextLevelId=S[GEMIOLI.Utils.rand()%S.length])):r.nextLevel=e.objectFromPool(e.debugLevels[e.debugLevel]),r.nextLevel.position.copy(r.end),r.nextLevel.rotation.copy(r.rotation),h.add(r.nextLevel)):r.wasPlayer&&u.add(r)}}(),I.prototype.onPositionChange=function(){var e=this;e.updateMatrixWorld(!0),e.box.copy(e.defaultBox).applyMatrix4(e.matrixWorld),e.end.set(e.defaultBox.max.x,0,0).applyMatrix4(e.matrixWorld),e.level1Offset&&e.end1.copy(e.level1Offset).applyMatrix4(e.matrixWorld),e.level2Offset&&e.end2.copy(e.level2Offset).applyMatrix4(e.matrixWorld)},I.prototype.onInstanceRemoved=function(){var e=this;e.level.instances.removeNode(e.levelNode),e.levelNode=null,e.removeEventListener("removed",e.level.onInstanceRemoved),e.level=null};var O=function(e,t,n){var i=this;THREE.Mesh.call(i,e,t),i.defaultBox=n||i.geometry.boundingBox,i.boundingBox=new THREE.Box3,i.addEventListener("added",i.onAdded),i.addEventListener("removed",i.onRemoved),i.playerAnimation="wall",i.shadowId=null,i.shadowScale=null,i.shadowOpacity=1};O.prototype=Object.create(THREE.Mesh.prototype);var P=function(e,t,n){var i=this;THREE.SkinnedMesh.call(i,e,t,!1),i.animation=new GEMIOLI.Animation(i,e.animation),i.animation.play(0,1),i.defaultBox=n||i.geometry.boundingBox,i.boundingBox=new THREE.Box3,i.addEventListener("added",i.onAdded),i.addEventListener("removed",i.onRemoved),i.playerAnimation="wall",i.shadowId=null,i.shadowScale=null,i.shadowOffset=null,i.shadowOpacity=1};(P.prototype=Object.create(THREE.SkinnedMesh.prototype)).onAdded=O.prototype.onAdded=function(){var t=this;t.updateNode=c.add(t),t.shadowId&&(t.shadow=e.objectFromPool(t.shadowId),t.shadow.scale.copy(t.shadowScale),t.shadow.material.uniforms.opacity.value=t.shadowOpacity,t.shadow.position.copy(t.position),t.shadowOffset&&t.shadow.position.add(t.shadowOffset),t.shadow.position.y=0,t.shadow.rotation.y=t.rotation.y,h.add(t.shadow)),t.onPositionChange()},P.prototype.onRemoved=O.prototype.onRemoved=function(){var e=this;c.removeNode(e.updateNode),e.updateNode=null,e.shadow&&(u.add(e.shadow),e.shadow=null)},P.prototype.update=O.prototype.update=function(e){if(m.isIntersectionBox(this.boundingBox)){if(p.dead)return;if(p.schitTime>0)return void(p.schitTime<.05&&(p.schitTime+=e));this.onPlayer()}},P.prototype.onPositionChange=O.prototype.onPositionChange=function(){var e=this;e.updateMatrixWorld(!0),e.boundingBox.copy(e.defaultBox),e.boundingBox.applyMatrix4(e.matrixWorld)},P.prototype.onPlayer=O.prototype.onPlayer=function(){p.dead=!0,p.playId!==this.playerAnimation&&(p.play(this.playerAnimation,!1),GEMIOLI.SoundLoader.load(p.male?"wall_m":"wall_f").play()),p.quakeTime=1};var G={run:{start:1,end:13},jump:{start:14,end:42},slope:{start:43,end:65},menu:{start:66,end:106},watch:{start:107,end:151},catch:{start:152,end:172},wall:{start:173,end:207},fall:{start:208,end:235},magnet:{start:318,end:329}},D=1e5;e.playerTypes=[{id:"models/GGCowboy.js",cost:0,name:"Professor Jones"},{id:"models/GGGirl.js",cost:300,name:"Lara Bones"},{id:"models/GGMummy.js",cost:500,name:"Mummy"},{id:"models/GGAgent.js",cost:1e3,name:"Agent 99"},{id:"models/GGDisco.js",cost:2e3,name:"Disco Dancer"},{id:"models/GGCube.js",cost:5e3,name:"Cubeman"}],e.playerType=GEMIOLI.Utils.getInt("skin",0);var k=new THREE.ShaderMaterial({fragmentShader:GEMIOLI.BendShader.fragmentShader,vertexShader:GEMIOLI.BendShader.vertexShader,uniforms:THREE.UniformsUtils.clone(GEMIOLI.BendShader.uniforms),transparent:!0,skinning:!0});k.uniforms.diffuse.value=new THREE.Color(8173793),e.bendMaterials.push(k);var B=new THREE.ShaderMaterial({fragmentShader:GEMIOLI.BendShader.fragmentShader,vertexShader:GEMIOLI.BendShader.vertexShader,uniforms:THREE.UniformsUtils.clone(GEMIOLI.BendShader.uniforms),transparent:!0});B.map=GEMIOLI.TextureLoader.load("models/Planka.png"),B.map.wrapS=B.map.wrapT=THREE.RepeatWrapping,B.uniforms.map.value=B.map,e.bendMaterials.push(B);var N=function(t,n){var i=this;if(!t.bones){var r=d["models/GGCowboy.js"].model.geometry;t.bones=r.bones,t.animation=r.animation}THREE.SkinnedMesh.call(i,t,n,!1);var o=new GEMIOLI.Animation(i,t.animation);o.play(0,1);var a=new GEMIOLI.AnimationController(o,G);i.DAC=a,i.addEventListener("added",i.onAdded),i.addEventListener("removed",i.onRemoved),i.RHBone=o.getBone("RH04"),i.backBone=o.getBone("B01"),i.back2Bone=o.getBone("B02"),i.LHBone=o.getBone("LH04"),i.magnet=e.objectFromPool("models/GGMagnit.js"),i.magnet.rotation.set(Math.PI/2,0,0),i.LHBone.add(i.magnet),i.RLBone=o.getBone("RL03"),i.LLBone=o.getBone("LL03"),i.surface=i.oldSurface=0,i.contactPoint=new THREE.Vector3,i.defaultContactBox=new THREE.Box3(new THREE.Vector3(-30,-30,-30),new THREE.Vector3(30,30,30)),i.contactBox=new THREE.Box3,i.bonusPosition=new THREE.Vector3,i.clearPosition=new THREE.Vector3,i.clearRotation=new THREE.Euler,i.pointerStart=new THREE.Vector2,i.keys=[],i.goldEffect=e.objectFromPool("GoldEffect"),i.direction=new THREE.Vector3,i.schitMaterial=k,i.baseMaterial=i.material,i.male=!0};(N.prototype=Object.create(THREE.SkinnedMesh.prototype)).onAdded=function(){var t=this;for(var n in e.player=t,p=t,f=t.position,E=t.direction,m=t.contactBox,g=t.contactPoint,v=t.bonusPosition,e.addEventListener("pointerdown",t.onPointerDown,!1),e.addEventListener("pointermove",t.onPointerMove,!1),e.addEventListener("pointerup",t.onPointerUp,!1),e.addEventListener("pointercancel",t.onPointerCancel,!1),e.addEventListener("keydown",this.onKeyDown,!1),e.addEventListener("keyup",this.onKeyUp,!1),t.shadow=e.objectFromPool("Shadow"),t.shadow.material.uniforms.opacity.value=1,t.shadow.scale.set(80,80,80),h.add(t.shadow),h.add(t.goldEffect),t.jumpTime=t.slopeTime=t.quakeTime=t.leftTime=t.rightTime=0,t.schitTime=t.magnetTime=t.multiplicatorTime=0,t.magnet.visible=!1,t.cameraRotation=t.rotation.y=0,t.positionOffset=t.rotationOffset=0,t.goldTime=0,t.clearPosition.copy(t.position),t.clearRotation.copy(t.rotation),t.idleTime=0,t.dead=t.stick=!1,t.fallVelocity=0,t.surface=0,t.wood=!1,t.cross=null,t.pointerId=-1,t.pointerStart.set(0,0),t.swipe=0,t.keys)t.keys[n]=!1;t.play("run",!0)},N.prototype.onRemoved=function(){var t=this;e.player=null,p=null,f=null,E=null,m=null,g=null,v=null,t.shadow&&(u.add(t.shadow),t.shadow=null),u.add(t.goldEffect),e.removeEventListener("pointerdown",t.onPointerDown,!1),e.removeEventListener("pointermove",t.onPointerMove,!1),e.removeEventListener("pointerup",t.onPointerUp,!1),e.removeEventListener("pointercancel",t.onPointerCancel,!1),e.removeEventListener("keydown",this.onKeyDown,!1),e.removeEventListener("keyup",this.onKeyUp,!1),t.shieldSound&&(t.shieldSound.stop(),t.shieldSound=null)},N.prototype.play=function(e,t){var n=this;n.playTime=0,n.playId=e,n.playLoop=t,n.DAC.play(n.magnet.visible&&"run"===e?"magnet":e,t)},N.prototype.playUpdate=function(){var e=this,t=e.playTime;e.play(e.playId,e.playLoop),e.updateAC(t)},N.prototype.updateAC=function(e){this.DAC.update(e),this.playTime+=e},N.prototype.onPositionChange=function(){this.clearPosition.copy(this.position)};var j=new THREE.Vector3(-444,430,0),F=new THREE.Vector3(0,226,0),U=new THREE.Vector3(332,92,0),V=new THREE.Vector3(0,90,0);N.prototype.update=function(n){var i=this;if(i.schitTime>0){(i.schitTime-=.1*n)<=0&&(i.schitTime=0,i.shieldSound&&(i.shieldSound.stop(),i.shieldSound=null,GEMIOLI.SoundLoader.load("shieldActive_stop").play()));var r=Math.max((.3-i.schitTime)/.3,0),o=1-.7*Math.abs(Math.sin((10+20*r)*r))*(r>0?1:0);i.material=i.schitMaterial,i.material.uniforms.opacity.value=.7*o,B.uniforms.offsetRepeat.value.x=B.uniforms.offsetRepeat.value.y=.1*e.time,B.uniforms.opacity.value=o}else i.material=i.baseMaterial,B.uniforms.opacity.value=0;if(i.magnetTime>0&&(i.magnetTime-=.1*n)<=0&&(i.magnetTime=0,i.magnet.visible=!1,i.playUpdate()),i.multiplicatorTime>0){e.multiplicator.visible||(e.multiplicator.visible=!0),(i.multiplicatorTime-=.1*n)<=0&&(i.multiplicatorTime=0,e.multiplicator.visible=!1);var a=1-Math.max(i.multiplicatorTime-.95,0)/.05;r=TWEEN.Easing.Quadratic.In(a);e.multiplicator.scaleX=e.multiplicator.scaleY=1-.6*r+.05*Math.abs(Math.sin(10*e.time)),e.multiplicator.x=(160-e.multiplicator.sx)*r+e.multiplicator.sx,r=TWEEN.Easing.Quadratic.In(a),e.multiplicator.y=(270-e.multiplicator.sy)*r+e.multiplicator.sy,e.multiplicator.rotation=20-360*(1-a),e.multiplicator.tint.a=Math.min(i.multiplicatorTime/.05,1)}if(i.dead){if(i.shieldSound&&(i.shieldSound.stop(),i.shieldSound=null),"fall"===i.playId){c=650*n;i.direction.set(1,0,0).applyEuler(i.clearRotation),x.copy(i.direction).multiplyScalar(c),i.clearPosition.add(x),i.fallVelocity+=-7e3*n,i.clearPosition.y+=i.fallVelocity*n,f.copy(i.clearPosition),x.set(0,0,1).applyEuler(i.clearRotation).multiplyScalar(i.positionOffset),f.add(x),i.rotation.y=i.clearRotation.y+i.rotationOffset}}else{var c=e.playerSpeed*n;i.direction.set(1,0,0).applyEuler(i.clearRotation),x.copy(i.direction).multiplyScalar(c),i.clearPosition.add(x),f.copy(i.clearPosition);var u=e.distance;for(e.distance+=c,u<200&&e.distance>=200&&e.fadeMusic(0,1),e.tutorial||(e.lineDistance-=c);Math.abs(f.x)>D;){for(var d=t.childs.head,E=f.x>0?-D:D;d;)(y=d.data).position.x+=E,y.onPositionChange&&y.onPositionChange(),d=d.next;window.console&&window.console.log&&console.log("OFFSET X: "+E)}for(;Math.abs(f.z)>D;){var y;for(d=t.childs.head,E=f.z>0?-D:D;d;)(y=d.data).position.z+=E,y.onPositionChange&&y.onPositionChange(),d=d.next;window.console&&window.console.log&&console.log("OFFSET Z: "+E)}if(e.idle&&"catch"===i.playId&&!i.DAC.isPlaying()&&(e.idle=!1),e.idle)"catch"===i.playId||((i.idleTime-=n)<=0&&!i.DAC.isPlaying()&&(i.idleTime=5*Math.random()+2,i.play("watch",!1)),"watch"===i.playId&&i.DAC.isPlaying()||"menu"===i.playId&&i.DAC.isPlaying()||i.play("menu",!1));else if(1!==i.surface&&0===i.jumpTime)i.dead=!0,i.play("fall",!0),i.jumpTime=i.slopeTime=0,GEMIOLI.SoundLoader.load(i.male?"fall_m":"fall_f").play();else switch(i.swipe){case 0:0===i.jumpTime&&0===i.slopeTime&&"run"!==i.playId&&i.play("run",!0);break;case 1:0===i.jumpTime&&0===i.slopeTime&&e.distance>900&&(!e.tutorial||e.tutorialUpAllow)&&(i.jumpTime=1,e.tutorialUp=!0,i.play("jump",!1),GEMIOLI.SoundLoader.load(i.male?"jumpStart_m":"jumpStart_f").play());break;case 2:0===i.jumpTime&&0===i.slopeTime&&e.distance>900&&(!e.tutorial||e.tutorialDownAllow)&&(e.tutorialDown=!0,i.slopeTime=1,i.play("slope",!1),GEMIOLI.SoundLoader.load(i.male?"slope_m":"slope_f").play());break;case 3:!i.cross||i.cross.playerRotated||e.tutorial&&!e.tutorialCrossLeftAllow?0===i.leftTime&&0===i.rightTime&&e.distance>900&&(!e.tutorial||e.tutorialLeftAllow)&&(i.leftTime=1,e.tutorialLeft=!0,GEMIOLI.SoundLoader.load("turn").play()):(i.cross.player=-1,e.tutorialCrossLeft=!0);break;case 4:!i.cross||i.cross.playerRotated||e.tutorial&&!e.tutorialCrossRightAllow?0===i.leftTime&&0===i.rightTime&&e.distance>900&&(!e.tutorial||e.tutorialRightAllow)&&(i.rightTime=1,e.tutorialRight=!0,GEMIOLI.SoundLoader.load("turn").play()):(i.cross.player=1,e.tutorialCrossRight=!0)}var T=0;if(e.playerSpeed>1500&&(n*=e.playerSpeed/1500),i.jumpTime>0){r=30/29*n;i.jumpTime-=r,i.jumpTime<=0&&(i.jumpTime=0,1===i.surface&&(T=3,GEMIOLI.SoundLoader.load(i.wood?"jumpEnd_wood":"jumpEnd").play()))}else if(i.slopeTime>0){r=30/23*n;var _=Math.floor(10*i.slopeTime);i.slopeTime-=r,i.slopeTime<=0&&(i.slopeTime=0),1===i.surface&&_!==Math.floor(10*i.slopeTime)&&(T=1)}if(i.leftTime>0)if((i.leftTime-=1*n)<=0&&(i.leftTime=0),i.stick&&i.leftTime<.3&&(i.leftTime=.3),i.leftTime>.7){r=1-(i.leftTime-.7)/.3;i.positionOffset=-100*r,i.rotationOffset=.3*Math.sin(r*Math.PI)}else if(i.leftTime<.3){r=i.leftTime/.3;i.positionOffset=-100*r,i.rotationOffset=-.3*Math.sin(r*Math.PI)}else i.rotationOffset=0,i.positionOffset=-100;else if(i.rightTime>0)if((i.rightTime-=1*n)<=0&&(i.rightTime=0),i.stick&&i.rightTime<.3&&(i.rightTime=.3),i.rightTime>.7){r=1-(i.rightTime-.7)/.3;i.positionOffset=100*r,i.rotationOffset=-.3*Math.sin(r*Math.PI)}else if(i.rightTime<.3){r=i.rightTime/.3;i.positionOffset=100*r,i.rotationOffset=.3*Math.sin(r*Math.PI)}else i.rotationOffset=0,i.positionOffset=100;x.set(0,0,1).applyEuler(i.clearRotation).multiplyScalar(i.positionOffset),f.add(x),i.rotation.y=i.clearRotation.y+i.rotationOffset,e.idle||(i.schitTime>0&&!e.paused?i.shieldSound||(i.shieldSound=GEMIOLI.SoundLoader.load("shieldActive").play(0,!0)):i.shieldSound&&(i.shieldSound.stop(),i.shieldSound=null))}var R=i.shadow.material.uniforms.opacity.value;1===i.surface?(R+=7*n)>=1&&(R=1):(R-=7*n)<=0&&(R=0),i.shadow.material.uniforms.opacity.value=R;var b=Math.floor(i.DAC.time*i.DAC.fps);i.updateAC(n),i.updateMatrixWorld(!0);var w=Math.floor(i.DAC.time*i.DAC.fps);if(b!==w)switch(w){case 4:case 321:for(var M=0;M<2;++M){(L=e.objectFromPool("StepEffect")).position.setFromMatrixPosition(i.LLBone.matrixWorld),h.add(L)}e.distance>1020&&GEMIOLI.SoundLoader.load(i.wood?"runL_wood":"runL").play();break;case 10:case 327:for(M=0;M<2;++M){(L=e.objectFromPool("StepEffect")).position.setFromMatrixPosition(i.RLBone.matrixWorld),h.add(L)}e.distance>1020&&GEMIOLI.SoundLoader.load(i.wood?"runR_wood":"runR").play()}for(M=0;M<T;++M){var L;(L=e.objectFromPool("StepEffect")).position.copy(i.position),h.add(L)}g.copy(f),m.copy(i.defaultContactBox),v.setFromMatrixPosition(i.backBone.matrixWorld),m.translate(v),i.shadow.position.copy(v),i.shadow.position.y=0,i.magnet.visible&&v.setFromMatrixPosition(i.LHBone.matrixWorld),i.goldTime>0&&(i.goldTime-=5*n)<=0&&(i.goldTime=0),i.goldEffect.sscale=200*Math.sin(Math.PI*i.goldTime)+100,i.goldEffect.material.uniforms.opacity.value=.7*Math.sin(Math.PI*i.goldTime),i.goldEffect.position.copy(v),x.copy(i.direction).multiplyScalar(50),i.goldEffect.position.add(x);var S=1-Math.min(e.distance,1e3)/1e3;x.copy(U),x.z+=10*Math.sin(e.time)*(1-e.interfaceTime),x.y+=10*Math.sin(.5*e.time+10)*(1-e.interfaceTime),x.x+=5*Math.sin(e.time+4)*(1-e.interfaceTime),x.z+=100*Math.sin(S*Math.PI),x.x-=-100*Math.sin(S*Math.PI),i.cameraRotation!==i.clearRotation.y&&(i.cameraRotation>i.clearRotation.y?(i.cameraRotation-=5*n,i.cameraRotation<=i.clearRotation.y&&(i.cameraRotation=i.clearRotation.y)):(i.cameraRotation+=5*n,i.cameraRotation>=i.clearRotation.y&&(i.cameraRotation=i.clearRotation.y))),s.position.set(j.x*Math.cos(i.cameraRotation),j.y,-j.x*Math.sin(i.cameraRotation)),s.position.lerp(x,S),(i.quakeTime-=2*n)<0&&(i.quakeTime=0),x.set(0,i.quakeTime*(5*Math.sin(200*e.time)+7.5*Math.cos(100*e.time)),i.quakeTime*(7.5*Math.sin(150*e.time)-2.5*Math.cos(60*e.time))),s.position.x+=f.x,s.position.z+=f.z,s.position.add(x),s.target.copy(F),s.target.lerp(V,S),s.target.x+=f.x,s.target.z+=f.z,s.target.add(x),i.dead&&(s.target.y+=p.position.y),i.slopeTime>0&&(s.position.y-=350*Math.sin(i.slopeTime*Math.PI),s.target.y-=150*Math.sin(i.slopeTime*Math.PI)),s.lookAt(s.target),s.updateMatrixWorld(),s.matrixWorldInverse.getInverse(s.matrixWorld),l.helpMatrix.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),l.setFromMatrix(l.helpMatrix);for(var H=e.bendMaterials,I=5e-5*Math.sin(1e-4*(e.distance+e.bendOffset)),A=3e-5*Math.sin(2e-4*(e.distance+e.bendOffset))-5e-5,C=(M=0,H.length);M<C;++M)H[M].uniforms.bendX.value=I,H[M].uniforms.bendY.value=A;e.bendX=I,e.bendY=A,i.oldSurface=i.surface,i.surface=0,i.wood=!1,i.swipe=0,i.cross=null,i.stick=!1},N.prototype.onPointerDown=function(e){-1===p.pointerId&&(p.pointerId=e.pointerId,p.pointerStart.set(e.x,e.y),p.pointerTime=Date.now())},N.prototype.onPointerMove=function(e){p.pointerId,e.pointerId},N.prototype.onPointerUp=function(e){if(p.pointerId===e.pointerId){p.pointerId=-1;var t=Date.now(),n=e.x-p.pointerStart.x,i=e.y-p.pointerStart.y,r=Math.sqrt(n*n+i*i),o=r/(t-p.pointerTime)||0;r>10&&Math.abs(o)>.65&&(Math.abs(n)>=Math.abs(i)?p.swipe=n<0?3:4:p.swipe=i<0?1:2)}},N.prototype.onPointerCancel=function(e){p.pointerId===e.pointerId&&(p.pointerId=-1)},N.prototype.onKeyDown=function(e){if(!p.keys[e.keyCode])switch(p.keys[e.keyCode]=!0,e.keyCode){case 38:case 87:p.swipe=1;break;case 40:case 83:p.swipe=2;break;case 37:case 65:p.swipe=3;break;case 39:case 68:p.swipe=4}},N.prototype.onKeyUp=function(e){p.keys[e.keyCode]=!1};var z=function(e,t){var n=this;THREE.Mesh.call(n,e,t),n.addEventListener("added",n.onAdded),n.addEventListener("removed",n.onRemoved),n.time=180*Math.random(),n.effectEnabled=!0};(z.prototype=Object.create(THREE.Mesh.prototype)).onAdded=function(){var t=this;t.dead=!1,t.updateNode=c.add(t),t.defaultRotation=t.rotation.y,t.position.y<100&&(t.shadow=e.objectFromPool("Shadow"),t.shadow.scale.set(60,60,60),t.shadow.position.copy(t.position),t.shadow.position.y=0,h.add(t.shadow)),t.effectEnabled&&(t.effect=e.objectFromPool("BonusEffect"),t.effect.position.copy(t.position),x.copy(E).multiplyScalar(50),t.effect.position.add(x),t.effect.sscale=100,h.add(t.effect))},z.prototype.onRemoved=function(){var e=this;e.shadow&&(u.add(e.shadow),e.shadow=null),e.effect&&(u.add(e.effect),e.effect=null),c.removeNode(e.updateNode),e.updateNode=null},z.prototype.update=function(e){var t=this;if(!t.dead&&(t.time+=5*e,t.rotation.y=t.defaultRotation+Math.sin(t.time),t.effect&&(t.effect.sscale=30*Math.sin(t.time)+300,t.effect.position.copy(t.position),x.copy(E).multiplyScalar(50),t.effect.position.add(x)),t.position.distanceToSquared(v)<1e4)){if(u.add(t),t.dead||p.dead)return;t.dead=!0,t.onPlayer(),t.effect&&(t.effect.deadTime=1,t.effect=null)}},z.prototype.onPlayer=function(){},d={Shadow:function(){var t=function(){var t=new THREE.ShaderMaterial({fragmentShader:GEMIOLI.BendShader.fragmentShader,vertexShader:GEMIOLI.BendShader.vertexShader,uniforms:THREE.UniformsUtils.clone(GEMIOLI.BendShader.uniforms),transparent:!0,depthTest:!1,depthWrite:!1});t.map=GEMIOLI.TextureLoader.load("effects/shadow.png"),t.uniforms.map.value=t.map,e.bendMaterials.push(t),THREE.Mesh.call(this,y,t),this.isShadow=!0};return t.prototype=Object.create(THREE.Mesh.prototype),{instances:68,create:function(){return new t}}}(),ShadowSquare:function(){var t=function(){var t=new THREE.ShaderMaterial({fragmentShader:GEMIOLI.BendShader.fragmentShader,vertexShader:GEMIOLI.BendShader.vertexShader,uniforms:THREE.UniformsUtils.clone(GEMIOLI.BendShader.uniforms),transparent:!0,depthTest:!1,depthWrite:!1});t.map=GEMIOLI.TextureLoader.load("effects/shadow_square.png"),t.uniforms.map.value=t.map,e.bendMaterials.push(t),THREE.Mesh.call(this,y,t),this.isShadow=!0};return t.prototype=Object.create(THREE.Mesh.prototype),{instances:3,create:function(){return new t}}}(),StepEffect:function(){var t=function(){var t=new THREE.ShaderMaterial({fragmentShader:GEMIOLI.SpriteBendShader.fragmentShader,vertexShader:GEMIOLI.SpriteBendShader.vertexShader,uniforms:THREE.UniformsUtils.clone(GEMIOLI.SpriteBendShader.uniforms),transparent:!0,depthWrite:!1,depthText:!1});t.map=GEMIOLI.TextureLoader.load("effects/smoke.png"),t.uniforms.map.value=t.map,t.uniforms.diffuse.value=new THREE.Color(9472868),e.bendMaterials.push(t);var n=this;L.call(n,t),n.addEventListener("added",n.onAdded),n.addEventListener("removed",n.onRemoved),n.speed=new THREE.Vector3,n.defaultPosition=new THREE.Vector3};return(t.prototype=Object.create(L.prototype)).onAdded=function(){var e=this;e.updateNode=c.add(e),e.position.y=0,e.defaultPosition.copy(e.position).sub(p.position),e.time=1,e.srotation=Math.random(),e.rspeed=Math.random()-.5,e.speed.copy(E).multiplyScalar(-150)},t.prototype.onRemoved=function(){c.removeNode(this.updateNode),this.updateNode=null},t.prototype.update=function(e){var t=this;(t.time-=5*e)<=0&&(u.add(t),t.time=0),t.sscale=200*Math.sqrt(1-t.time),t.material.uniforms.opacity.value=.6*Math.sqrt(t.time),t.srotation+=t.rspeed*e,x.copy(t.speed).multiplyScalar(1-t.time),t.position.copy(p.position).add(t.defaultPosition).add(x),L.prototype.update.call(t,e)},{instances:7,create:function(){return new t}}}(),"models/GGCowboy.js":{skin:!0,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new N(this.model.geometry,this.model.material)}},"models/GGGirl.js":{skin:!0,shader:GEMIOLI.BendShader,transparent:!0,create:function(){var e=new N(this.model.geometry,this.model.material);return e.male=!1,e}},"models/GGCube.js":{skin:!0,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new N(this.model.geometry,this.model.material)}},"models/GGAgent.js":{skin:!0,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new N(this.model.geometry,this.model.material)}},"models/GGDisco.js":{skin:!0,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new N(this.model.geometry,this.model.material)}},"models/GGMummy.js":{skin:!0,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new N(this.model.geometry,this.model.material)}},BonusEffect:function(){var t=function(){var t=new THREE.ShaderMaterial({fragmentShader:GEMIOLI.SpriteBendShader.fragmentShader,vertexShader:GEMIOLI.SpriteBendShader.vertexShader,uniforms:THREE.UniformsUtils.clone(GEMIOLI.SpriteBendShader.uniforms),transparent:!0,depthWrite:!1,blending:THREE.AdditiveBlending});t.map=GEMIOLI.TextureLoader.load("effects/glow.png"),t.uniforms.map.value=t.map,t.uniforms.diffuse.value=new THREE.Color(16775020),e.bendMaterials.push(t);var n=this;L.call(n,t),n.addEventListener("added",n.onAdded),n.addEventListener("removed",n.onRemoved)};return(t.prototype=Object.create(L.prototype)).onAdded=function(){this.deadTime=0,this.material.uniforms.opacity.value=1,this.updateNode=c.add(this)},t.prototype.onRemoved=function(){c.removeNode(this.updateNode),this.updateNode=null},t.prototype.update=function(e){var t=this;t.deadTime>0&&((t.deadTime-=4*e)<=0&&(t.deadTime=0,u.add(t)),t.position.setFromMatrixPosition(p.back2Bone.matrixWorld),x.copy(E).multiplyScalar(-50),t.position.add(x),t.material.uniforms.opacity.value=Math.sin(t.deadTime*Math.PI/2),t.sscale=t.sscale+5e3*e,t.srotation=0),t.srotation+=2*e,L.prototype.update.call(t,e)},{instances:2,create:function(){return new t}}}(),"models/Schit.js":function(){var e=function(e,t){z.call(this,e,t)};return(e.prototype=Object.create(z.prototype)).onPlayer=function(){p.schitTime=1,GEMIOLI.SoundLoader.load("shield").play()},{shader:GEMIOLI.BendShader,create:function(){return new e(this.model.geometry,this.model.material)}}}(),"models/Mnojitel.js":function(){var t=function(e,t){z.call(this,e,t)};return(t.prototype=Object.create(z.prototype)).onPlayer=function(){p.multiplicatorTime=1,x.copy(e.from3DTo2D(this.position)),e.multiplicator.sx=x.x,e.multiplicator.sy=x.y,GEMIOLI.SoundLoader.load("multiplicator").play()},{shader:GEMIOLI.BendShader,create:function(){return new t(this.model.geometry,this.model.material)}}}(),"models/Magnit.js":function(){var e=function(e,t){z.call(this,e,t)};return(e.prototype=Object.create(z.prototype)).onPlayer=function(){p.magnetTime=1,p.magnet.visible=!0,p.playUpdate(),GEMIOLI.SoundLoader.load("magnet").play()},{shader:GEMIOLI.BendShader,create:function(){return new e(this.model.geometry,this.model.material)}}}(),"models/GGMagnit.js":{shader:GEMIOLI.BendShader,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/Tile.js":{instances:7,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new w(this.model.geometry,this.model.material,1)}},"models/TileBr.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new w(this.model.geometry,this.model.material,1)}},"models/TileBr02.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new w(this.model.geometry,this.model.material,1)}},"models/TileDouble.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new M(this.model.geometry,this.model.material,1,!0,!0)}},"models/TileR.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new M(this.model.geometry,this.model.material,1,!1,!0)}},"models/TileL.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new M(this.model.geometry,this.model.material,1,!0,!1)}},"models/TileDoubleMenu.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new w(this.model.geometry,this.model.material,1)}},"models/PiramidaMenu.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},AlmazEffect:function(){var t=function(){var t=new THREE.ShaderMaterial({fragmentShader:GEMIOLI.SpriteBendShader.fragmentShader,vertexShader:GEMIOLI.SpriteBendShader.vertexShader,uniforms:THREE.UniformsUtils.clone(GEMIOLI.SpriteBendShader.uniforms),transparent:!0,depthWrite:!1,depthTest:!1,blending:THREE.AdditiveBlending});t.map=GEMIOLI.TextureLoader.load("effects/star.png"),t.uniforms.map.value=t.map,e.bendMaterials.push(t);var n=this;L.call(n,t),n.addEventListener("added",n.onAdded),n.addEventListener("removed",n.onRemoved),n.speed=1,n.stime=0};return(t.prototype=Object.create(L.prototype)).onAdded=function(){this.updateNode=c.add(this)},t.prototype.onRemoved=function(){c.removeNode(this.updateNode),this.updateNode=null},t.prototype.update=function(e){var t=this;t.stime+=e,t.srotation=t.speed*t.stime,t.sscale=10*Math.sin(t.stime)+100,t.material.uniforms.opacity.value=.3*Math.sin(t.stime+.5)+.6,L.prototype.update.call(t,e)},{instances:2,create:function(){return new t}}}(),"models/AlmazMenu.js":function(){var t=function(e,t){var n=this;THREE.Mesh.call(n,e,t),n.addEventListener("added",n.onAdded),n.addEventListener("removed",n.onRemoved)};return(t.prototype=Object.create(THREE.Mesh.prototype)).onAdded=function(){var t=this;t.updateNode=c.add(t),t.startY=t.position.y,t.e1=e.objectFromPool("AlmazEffect"),t.e1.position.copy(t.position),h.add(t.e1),t.e2=e.objectFromPool("AlmazEffect"),t.e2.speed=-.8,t.e2.stime=2,t.e2.position.copy(t.position),h.add(t.e2)},t.prototype.onRemoved=function(){var e=this;c.removeNode(e.updateNode),e.updateNode=null,e.e1&&u.add(e.e1),e.e2&&u.add(e.e2)},t.prototype.update=function(e){var t=this;t.rotation.y+=e,t.position.y=t.startY+5*Math.sin(1.5*t.rotation.y),t.e1&&t.e1.position.copy(t.position),t.e2&&t.e2.position.copy(t.position),Math.floor(p.DAC.time*p.DAC.fps)>=163&&u.add(t)},{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new t(this.model.geometry,this.model.material)}}}(),"models/Piramida01.js":function(){var e=new THREE.Box3(new THREE.Vector3(-50,-300,0),new THREE.Vector3(100,100,500));return{instances:2,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new O(this.model.geometry,this.model.material,e)}}}(),"models/Piramida002.js":{instances:2,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/Arka01.js":{instances:8,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/Idols.js":{instances:8,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/Luch.js":function(){var t=new THREE.Box3(new THREE.Vector3(-50,60,-500),new THREE.Vector3(50,100,500)),n=function(e,n){P.call(this,e,n,t),this.AC=new GEMIOLI.AnimationController(this.animation,{idle:{start:0,end:3}}),this.luchSound=null};return(n.prototype=Object.create(P.prototype)).onAdded=function(){this.AC.play("idle",!0),P.prototype.onAdded.call(this)},n.prototype.onRemoved=function(){null!==this.luchSound&&(this.luchSound.stop(),this.luchSound=null),P.prototype.onRemoved.call(this)},n.prototype.update=function(t){var n=this;P.prototype.update.call(n,t),n.AC.update(t);var i=n.position.x-p.position.x,r=n.position.z-p.position.z,o=Math.sqrt(i*i+r*r),a=o>0?1-Math.min(1,o/1500):1-Math.min(1,-o/400);a>0?(n.luchSound||(n.luchSound=GEMIOLI.SoundLoader.load("ray").play(!1,!0)),n.luchSound.volume=e.paused?0:a):null!==n.luchSound&&(n.luchSound.stop(),n.luchSound=null)},n.prototype.onPlayer=function(){p.dead=!0,p.playId!==this.playerAnimation&&(p.play(this.playerAnimation,!1),GEMIOLI.SoundLoader.load(p.male?"charge_m":"charge_f").play()),p.quakeTime=1},{skin:!0,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new n(this.model.geometry,this.model.material)}}}(),GoldEffect:function(){var t=function(){var t=new THREE.ShaderMaterial({fragmentShader:GEMIOLI.SpriteBendShader.fragmentShader,vertexShader:GEMIOLI.SpriteBendShader.vertexShader,uniforms:THREE.UniformsUtils.clone(GEMIOLI.SpriteBendShader.uniforms),transparent:!0,depthWrite:!1,blending:THREE.AdditiveBlending});t.map=GEMIOLI.TextureLoader.load("effects/gold.png"),t.uniforms.map.value=t.map,e.bendMaterials.push(t);var n=this;L.call(n,t),n.addEventListener("added",n.onAdded),n.addEventListener("removed",n.onRemoved)};return(t.prototype=Object.create(L.prototype)).onAdded=function(){this.updateNode=c.add(this)},t.prototype.onRemoved=function(){c.removeNode(this.updateNode),this.updateNode=null},t.prototype.update=function(e){L.prototype.update.call(this,e)},{create:function(){return new t}}}(),"models/Gold.js":function(){var t=function(e,t){var n=this;THREE.Mesh.call(n,e,t),n.addEventListener("added",n.onAdded),n.addEventListener("removed",n.onRemoved),n.time=180*Math.random()};(t.prototype=Object.create(THREE.Mesh.prototype)).onAdded=function(){var t=this;t.dead=!1,t.magnet=!1,t.magnetSpeed=0,t.updateNode=c.add(t),t.position.y<100&&(t.shadow=e.objectFromPool("Shadow"),t.shadow.material.uniforms.opacity.value=1,t.shadow.scale.set(60,60,60),t.shadow.position.copy(t.position),t.shadow.position.y=0,h.add(t.shadow)),t.startRotation=t.rotation.y},t.prototype.onRemoved=function(){var e=this;e.shadow&&(u.add(e.shadow),e.shadow=null),c.removeNode(e.updateNode),e.updateNode=null},t.prototype.update=function(t){var n=this;if(!n.dead){n.time+=7*t,n.rotation.y=n.startRotation+.5*Math.sin(n.time),n.magnet&&(x.copy(v),x.sub(n.position),n.magnetSpeed+=.5*e.playerSpeed*t,x.multiplyScalar(Math.min(n.magnetSpeed,x.length())/x.length()),n.position.add(x),n.shadow&&(n.shadow.position.copy(n.position),n.shadow.position.y=0));var i=n.position.distanceToSquared(v);if(p.magnetTime>0&&i<4e5&&(n.magnet=!0),i<6e3){if(u.add(n),n.dead||p.dead)return;n.dead=!0,n.onPlayer()}}};var n=["bonus_1","bonus_2","bonus_3","bonus_4","bonus_5","bonus_6","bonus_7","bonus_8","bonus_9","bonus_10","bonus_11","bonus_12"],i=0;return t.prototype.onPlayer=function(){p.goldTime=1,p.goldEffect.srotation=Math.random()*Math.PI/2,e.addCoins(1),e.coinTimer=1,i=(i+1)%n.length,GEMIOLI.SoundLoader.load(n[i]).play().volume=.8},{instances:98,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new t(this.model.geometry,this.model.material)}}}(),"models/Kolovorot.js":function(){var t=new THREE.Box3(new THREE.Vector3(-150,-150,-200),new THREE.Vector3(150,150,200)),n=function(e,n){O.call(this,e,n,t),this.time=Math.random(),this.braceSound=null};return(n.prototype=Object.create(O.prototype)).onRemoved=function(){null!==this.braceSound&&(this.braceSound.stop(),this.braceSound=null),O.prototype.onRemoved.call(this)},n.prototype.update=function(t){var n=this;O.prototype.update.call(n,t),n.time+=3*t,Math.abs(n.rotation.x)<1?n.rotation.z=n.time:n.rotation.y=n.time;var i=n.position.x-p.position.x,r=n.position.z-p.position.z,o=Math.sqrt(i*i+r*r),a=o>0?1-Math.min(1,o/1500):1-Math.min(1,-o/400);a>0?(n.braceSound||(n.braceSound=GEMIOLI.SoundLoader.load("brace").play(!1,!0)),n.braceSound.volume=e.paused?0:a):null!==n.braceSound&&(n.braceSound.stop(),n.braceSound=null)},{instances:7,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new n(this.model.geometry,this.model.material)}}}(),"models/Brevno01.js":function(){var e=new THREE.Box3(new THREE.Vector3(-60,-60,-300),new THREE.Vector3(60,60,300)),t=new THREE.Vector3(100,100,600);return{instances:2,shader:GEMIOLI.BendShader,transparent:!0,create:function(){var n=new O(this.model.geometry,this.model.material,e);return n.shadowId="ShadowSquare",n.shadowScale=t,n}}}(),"models/Liana.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/Rock01.js":{instances:8,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/Tree01.js":{instances:8,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/SkalaL.js":{instances:8,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/SkalaR.js":{instances:8,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/Wall.js":function(){var e=new THREE.Box3(new THREE.Vector3(-170,-100,-450),new THREE.Vector3(0,400,450)),t=new THREE.Vector3(400,200,500);return{instances:2,shader:GEMIOLI.BendShader,transparent:!0,create:function(){var n=new O(this.model.geometry,this.model.material,e);return n.shadowId="ShadowSquare",n.shadowScale=t,n}}}(),"models/Zakr.js":{instances:4,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/Zakr001.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new THREE.Mesh(this.model.geometry,this.model.material)}},"models/MostBig.js":{shader:GEMIOLI.BendShader,transparent:!0,create:function(){var e=new w(this.model.geometry,this.model.material,1);return e.wood=!0,e}},"models/MostBigBreak.js":function(){var e=function(e,t){w.call(this,e,t,1),this.wood=!0};return(e.prototype=Object.create(w.prototype)).update=function(e){var t=this.boundingBox,n=t.min,i=t.max;Math.abs(g.x-(i.x+n.x)/2)<430&&Math.abs(g.z-(i.z+n.z)/2)<430?p.surface=p.schitTime>0?1:0:w.prototype.update.call(this,e)},{shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new e(this.model.geometry,this.model.material)}}}(),"models/MostGood.js":{instances:2,shader:GEMIOLI.BendShader,transparent:!0,create:function(){var e=new w(this.model.geometry,this.model.material,1);return e.wood=!0,e}},"models/TileCutL.js":function(){var e,t,n,i=function(e,t){w.call(this,e,t,1),this.fallBox=new THREE.Box3};(i.prototype=Object.create(w.prototype)).update=function(i){e=this.fallBox,t=e.min,n=e.max,g.x<=n.x&&g.x>=t.x&&g.z<=n.z&&g.z>=t.z?p.surface=p.schitTime>0?1:0:w.prototype.update.call(this,i)&&(p.stick=!0)};var r=new THREE.Box3(new THREE.Vector3(150,-200,-220),new THREE.Vector3(1050,200,0));return i.prototype.onPositionChange=function(){w.prototype.onPositionChange.call(this),this.fallBox.copy(r),this.fallBox.applyMatrix4(this.matrixWorld)},{instances:3,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new i(this.model.geometry,this.model.material)}}}(),"models/TileCutR.js":function(){var e,t,n,i=function(e,t){w.call(this,e,t,1),this.fallBox=new THREE.Box3};(i.prototype=Object.create(w.prototype)).update=function(i){e=this.fallBox,t=e.min,n=e.max,g.x<=n.x&&g.x>=t.x&&g.z<=n.z&&g.z>=t.z?p.surface=p.schitTime>0?1:0:w.prototype.update.call(this,i)&&(p.stick=!0)};var r=new THREE.Box3(new THREE.Vector3(150,-200,-400),new THREE.Vector3(1050,200,-180));return i.prototype.onPositionChange=function(){w.prototype.onPositionChange.call(this),this.fallBox.copy(r),this.fallBox.applyMatrix4(this.matrixWorld)},{instances:3,shader:GEMIOLI.BendShader,transparent:!0,create:function(){return new i(this.model.geometry,this.model.material)}}}(),"models/Planka01.js":function(){var e=function(e){w.call(this,e,B,1),this.ground=!1,this.renderOrder=1e6};return(e.prototype=Object.create(w.prototype)).update=function(e){w.prototype.update.call(this,e)&&0===p.schitTime&&(p.surface=0)},{instances:6,shader:GEMIOLI.BendShader,create:function(){return new e(this.model.geometry)}}}(),"models/Fon.js":function(){var t=function(e,t){var n=this;THREE.Mesh.call(n,e,t),t.map.minFilter=t.map.magFilter=THREE.LinearFilter,n.addEventListener("added",n.onAdded),n.addEventListener("removed",n.onRemoved),n.sky=!0,n.rotation.order="YZX"};return(t.prototype=Object.create(THREE.Mesh.prototype)).onAdded=function(){this.updateNode=c.add(this)},t.prototype.onRemoved=function(){c.removeNode(this.updateNode),this.updateNode=null},t.prototype.update=function(t){this.position.copy(s.position),this.rotation.y=-5e3*e.bendX*E.x},{notDepthTest:!0,notDepthWrite:!0,create:function(){return new t(this.model.geometry,this.model.material)}}}()},objectsPool={},e.objectFromPool=function(t){var n=objectsPool[t];return n?(objectsPool[t]=n.poolNext,n.poolNext=null):((n=d[t]&&d[t].create?d[t].create():new THREE.Object3D).objectType=t,n.addEventListener("removed",e.objectToPool),n.frustumCulled=!1),n},e.objectToPool=function(){var e=this;e.poolNext=objectsPool[e.objectType],objectsPool[e.objectType]=e};var W={};GEMIOLI.AtlasLoader.load("atlases/models.atlas",function(n){GEMIOLI.ModelBatchLoader.load("models/models.js",n,function(n){for(var i in n.models){var r=n.models[i];d[r.url]||(d[r.url]=THREE.Object3D);var o=d[r.url],a=r.material,s="models/"+(a.map?a.map.sourceFile:"empty")+(o.skin?"skin":"")+(o.notDepthWrite?"ndw":"")+(o.notDepthTest?"ndt":"")+(o.doubleSide?"ds":"")+(o.transparent?"t":"")+(o.shader?o.shader.id:"");if(!W[s]){var l=o.shader?new THREE.ShaderMaterial({fragmentShader:o.shader.fragmentShader,vertexShader:o.shader.vertexShader,uniforms:THREE.UniformsUtils.clone(o.shader.uniforms)}):new THREE.MeshBasicMaterial;o.shader&&(l.uniforms.map.value=a.map),l.fog=!0,l.map=a.map,W[s]=l,l.map&&!o.doubleSide||(l.side=THREE.DoubleSide),o.skin&&(l.skinning=!0),o.notDepthWrite&&(l.depthWrite=!1),o.notDepthTest&&(l.depthTest=!1),o.transparent&&(l.transparent=!0),o.shader===GEMIOLI.BendShader&&e.bendMaterials.push(l)}r.material=W[s],o.model=r,o.boundingSphere&&(r.geometry.boundingSphere=o.boundingSphere),r.geometry.computeBoundingBox()}GEMIOLI.XHRLoader.load("levels/levels.js",function(n){var i=JSON.parse(n.request.response);for(var r in GEMIOLI.XHRLoader.remove(n.url),i){for(var o,a,s=i[r],l=[],c=0,u=s.length;c<u;++c)o={id:"models/"+(o=s[c]).id+".js",name:o.n,position:new THREE.Vector3(o.x||0,o.y||0,o.z||0),rotation:new THREE.Euler(o.rx||0,o.ry||0,o.rz||0,"YZX"),scale:new THREE.Vector3(o.sx?o.sx:1,o.sy?o.sy:1,o.sz?o.sz:1)},l.push(o);for(c=0,u=l.length;c<u;++c)objectData=l[c],(a=e.objectFromPool(objectData.id))instanceof w&&1===a.type?(a.position.copy(objectData.position),a.rotation.copy(objectData.rotation),a.scale.copy(objectData.scale),h.add(a)):e.objectToPool.call(a);for(;h.head;)t.add(h.pop());var p=new THREE.Box3;p.setFromObject(t),e.clear();var f=null,E=null;"TileLLevel.js"!==r&&"TileDoubleLevel.js"!==r||(f=new THREE.Vector3(1016,0,-1010)),"TileRLevel.js"!==r&&"TileDoubleLevel.js"!==r||(E=new THREE.Vector3(1016,0,1010)),d[r]||(d[r]={create:function(){var e=l,t=p,n=f,i=E;return function(){return new I(e,t,n,i)}}()}),GEMIOLI.Application.DEBUG&&e.debugLevels.push(r)}for(var r in d){var m=d[r].instances||1,g=[];for(c=0;c<m;++c)g.push(e.objectFromPool(r));for(c=0;c<m;++c){var v=g.pop();GEMIOLI.Renderer.initObjectFunc(v),GEMIOLI.Renderer.updateObjectFunc(v),e.objectToPool.call(v)}}},function(e){window.console&&window.console.log&&console.log("Can't load levels",e)})},function(e){window.console&&window.console.log&&console.log("Can't load models",e)})},function(e){window.console&&window.console.log&&console.log("Can't load models atlas",e)}),e.addEventListener("added",function(){GEMIOLI.Renderer.setClearColor(4294967295,1),e.prepend()},!1),e.top=new GEMIOLI.DisplayObjectContainer,e.addChild(e.top),e.back=GEMIOLI.AtlasQuad.fromRect(-164,-139,329,278,"atlases/play.atlas","back"),e.back.x=180,e.back.y=150,e.top.addChild(e.back),e.distanceText=GEMIOLI.Text.fromAtlas(60,"fonts/play/text.fnt","atlases/play.atlas",GEMIOLI.Text.RIGHT_ALIGN,GEMIOLI.Text.RIGHT_ALIGN,GEMIOLI.Text.CENTER_ALIGN),e.distanceText.x=165,e.distanceText.y=-56,e.distanceText.offset=-16,e.back.addChild(e.distanceText),e.coinsText=GEMIOLI.Text.fromAtlas(60,"fonts/play/text.fnt","atlases/play.atlas",GEMIOLI.Text.RIGHT_ALIGN,GEMIOLI.Text.RIGHT_ALIGN,GEMIOLI.Text.CENTER_ALIGN),e.coinsText.x=165,e.coinsText.y=84,e.coinsText.offset=-16,e.back.addChild(e.coinsText),e.coin=GEMIOLI.AtlasQuad.fromRect(-35,-44,70,89,"atlases/play.atlas","coin"),e.coin.x=-95,e.coin.y=66,e.back.addChild(e.coin),e.pause=new GEMIOLI.Button(-95,-95,191,191,[27]),e.pause.addChild(GEMIOLI.AtlasQuad.fromRect(-95,-95,191,191,"atlases/play.atlas","pause")),e.pause.y=110,e.pause.addEventListener("click",function(t){GEMIOLI.SoundLoader.load("button").play(),e.onPause()},!1),e.top.addChild(e.pause),e.addEventListener("blur",function(t){e.paused||e.onPause()},!1),e.sound=new GEMIOLI.Button(-95,-95,191,191,[77]),e.sound.on=GEMIOLI.AtlasQuad.fromRect(-95,-95,191,191,"atlases/play.atlas","sound_on"),e.sound.off=GEMIOLI.AtlasQuad.fromRect(-95,-95,191,191,"atlases/play.atlas","sound_off"),e.sound.addChild(e.sound.on),e.sound.addChild(e.sound.off),e.sound.y=110,e.sound.on.visible=GEMIOLI.Utils.getBool("sound",!0),e.sound.off.visible=!e.sound.off.visible,e.sound.addEventListener("click",function(t){GEMIOLI.SoundLoader.load("button").play(),e.sound.on.visible=!e.sound.on.visible,e.sound.off.visible=!e.sound.off.visible,GEMIOLI.Utils.setBool("sound",e.sound.on.visible),GEMIOLI.Utils.getBool("sound",!0)?GEMIOLI.SoundLoader.unmute():GEMIOLI.SoundLoader.mute()},!1),e.sound.visible=GEMIOLI.SoundLoader.enabled,e.top.addChild(e.sound),e.multiplicator=GEMIOLI.AtlasQuad.fromRect(-159,-120,318,241,"atlases/play.atlas","x2"),e.top.addChild(e.multiplicator),e.logo=new GEMIOLI.Logo(-250,-100,500,200),e.logo.y=110,e.top.addChild(e.logo),e.tutorialInterface=new GEMIOLI.DisplayObjectContainer,e.addChild(e.tutorialInterface),e.tutorialArrow=GEMIOLI.AtlasQuad.fromRect(-476,-175,953,350,"atlases/play.atlas","arrow"),e.tutorialInterface.addChild(e.tutorialArrow),e.tutorialPointer=GEMIOLI.AtlasQuad.fromRect(-140,-42,362,479,"atlases/play.atlas","hand"),e.tutorialInterface.addChild(e.tutorialPointer),e.tutorialKeyboard=GEMIOLI.AtlasQuad.fromRect(-513,-342,1026,684,"atlases/play.atlas","keys"),e.tutorialInterface.addChild(e.tutorialKeyboard),e.tutorialKeyRight=GEMIOLI.AtlasQuad.fromRect(-160,-160,320,320,"atlases/play.atlas","key_active"),e.tutorialKeyRight.rotation=90,e.tutorialKeyRight.x=342,e.tutorialKeyRight.y=172,e.tutorialKeyboard.addChild(e.tutorialKeyRight),e.tutorialKeyLeft=GEMIOLI.AtlasQuad.fromRect(-160,-160,320,320,"atlases/play.atlas","key_active"),e.tutorialKeyLeft.rotation=-90,e.tutorialKeyLeft.x=-344,e.tutorialKeyLeft.y=172,e.tutorialKeyboard.addChild(e.tutorialKeyLeft),e.tutorialKeyUp=GEMIOLI.AtlasQuad.fromRect(-160,-160,320,320,"atlases/play.atlas","key_active"),e.tutorialKeyUp.rotation=0,e.tutorialKeyUp.x=0,e.tutorialKeyUp.y=-170,e.tutorialKeyboard.addChild(e.tutorialKeyUp),e.tutorialKeyDown=GEMIOLI.AtlasQuad.fromRect(-160,-160,320,320,"atlases/play.atlas","key_active"),e.tutorialKeyDown.rotation=180,e.tutorialKeyDown.x=0,e.tutorialKeyDown.y=172,e.tutorialKeyboard.addChild(e.tutorialKeyDown),e.tutorialKeyboard.scaleX=e.tutorialKeyboard.scaleY=.6,e.tutorialKeyboard.x=450,e.tutorialKeyboard.y=1200,e.tutorialArrow.visible=e.tutorialPointer.visible=GEMIOLI.Utils.isMobile(),e.tutorialKeyboard.visible=!GEMIOLI.Utils.isMobile(),e.music=null,e.musicVolume=1,e.musicFade=0,e.menu=null,e.menuVolume=1,e.menuFade=0,GEMIOLI.Application.addEventListener("update",function(t){var n=t.dt;null!==e.music&&e.music.volume!==e.musicVolume&&(e.music.volume>e.musicVolume?(e.music.volume-=n/e.musicFade)<=e.musicVolume&&(e.music.volume=e.musicVolume,0===e.music.volume&&(e.music.stop(),e.music=null)):(e.music.volume+=n/e.musicFade)>=e.musicVolume&&(e.music.volume=e.musicVolume)),null!==e.menu&&e.menu.volume!==e.menuVolume&&(e.menu.volume>e.menuVolume?(e.menu.volume-=n/e.menuFade)<=e.menuVolume&&(e.menu.volume=e.menuVolume,0===e.menu.volume&&(e.menu.stop(),e.menu=null)):(e.menu.volume+=n/e.menuFade)>=e.menuVolume&&(e.menu.volume=e.menuVolume))},!1),GEMIOLI.Application.DEBUG&&(e.levelText=GEMIOLI.Text.fromAtlas(70,"fonts/play/text.fnt","atlases/play.atlas",GEMIOLI.Text.LEFT_ALIGN,GEMIOLI.Text.LEFT_ALIGN,GEMIOLI.Text.BOTTOM_ALIGN),e.addChild(e.levelText),e.addEventListener("keydown",function(t){if(38===t.keyCode)e.playerSpeedMode=1;else if(40===t.keyCode)e.playerSpeedMode=2;else if(33===t.keyCode)++e.debugLevel>=e.debugLevels.length&&(e.debugLevel=e.debugLevels.length-1);else if(34===t.keyCode)--e.debugLevel<=-1&&(e.debugLevel=-1);else if(49===t.keyCode)GEMIOLI.Score.show();else if(50===t.keyCode)GEMIOLI.Score.show(!0);else if(51===t.keyCode)for(objectName in objectsPool){for(var n=0,i=objectsPool[objectName];i;)++n,i=i.poolNext;window.console&&window.console.log&&console.log(objectName,n)}}))},GEMIOLI.Play.prototype=Object.create(GEMIOLI.Layer.prototype),GEMIOLI.Play.prototype.render=function(){for(var e=this,t=e.scene3D.children,n=0,i=t.length;n<i;++n)GEMIOLI.Renderer.render(t[n],e.camera3D);GEMIOLI.Layer.prototype.render.call(e)},GEMIOLI.Play.prototype.show=function(){h5branding.google.sendScreenView("gameplay"),h5branding.gameanalytics.addDesignEvent("GameStart");var e=this;e.player.play("catch",!1),e.interfaceShowing=!0,e.sound.on.visible=GEMIOLI.Utils.getBool("sound",!0),e.sound.off.visible=!e.sound.on.visible,GEMIOLI.SoundLoader.load("start").play()},GEMIOLI.Play.prototype.hide=function(){that.interfaceShowing=!1},GEMIOLI.Play.prototype.resize=function(){var e=this;GEMIOLI.Layer.prototype.resize.call(e);var t=e.camera3D;t.aspect=GEMIOLI.Application.innerWidth/GEMIOLI.Application.innerHeight,t.zoom=1/Math.max(1,e.height/GEMIOLI.Application.HEIGHT),t.updateProjectionMatrix(),e.logo.x=e.width/2,e.pause.x=e.width-110,e.sound.x=e.width-320,e.tutorialInterface.x=e.width/2,e.tutorialInterface.y=e.height/2-400,GEMIOLI.Application.DEBUG&&(e.levelText.y=e.height)},GEMIOLI.Play.prototype.addCoins=function(e){this.player.multiplicatorTime>0&&(e*=2),this.coins+=e,GEMIOLI.Utils.setInt("coins",GEMIOLI.Utils.getInt("coins",0)+e),GEMIOLI.Utils.setInt("highscore",GEMIOLI.Utils.getInt("highscore",0)+e)},GEMIOLI.Play.prototype.fadeMusic=function(e,t){var n=this;null===n.music&&(n.music=GEMIOLI.SoundLoader.load("gameplay_loop").play(0,!0)),n.musicFade=void 0===e?0:e,n.musicVolume=void 0===t?1:t,0===n.musicFade&&(n.music.volume=n.musicVolume,0===n.music.volume&&(n.music.stop(),n.music=null))},GEMIOLI.Play.prototype.fadeMenu=function(e,t){var n=this;null===n.menu&&(n.menu=GEMIOLI.SoundLoader.load("menu").play(0,!0)),n.menuFade=void 0===e?0:e,n.menuVolume=void 0===t?1:t,0===n.menuFade&&(n.menu.volume=n.menuVolume,0===n.menu.volume&&(n.menu.stop(),n.menu=null))},GEMIOLI.Play.prototype.clear=function(){for(var e=this.scene3D;e.childs.head;)e.remove(e.childs.head.data);for(var t=this.toRemove;t.head;)e.remove(t.pop())},GEMIOLI.Play.prototype.prepend=function(){var e=this;e.scene3D;e.clear();var t=e.toAdd,n=e.objectFromPool("Nachalo.js");n.position.set(0,0,0),n.rotation.y=0,t.add(n);var i=e.objectFromPool("models/Fon.js");t.add(i);var r=e.objectFromPool(e.playerTypes[e.playerType].id);r.position.set(0,0,0),t.add(r),e.distance=0,e.lineDistance=5e3,e.bendOffset=1e5*Math.random(),e.deadTimer=1,e.coins=0,e.playerSpeed=e.speedTime=e.playerSpeedMode=0,e.idle=!0,e.interfaceShowing=!1,e.interfaceTime=0,e.paused=!1,e.coinTimer=e.time=0,e.multiplicator.visible=!1,e.bonusTimer=0,e.tutorial=GEMIOLI.Utils.getBool("tutorial",!0),e.tutorialUp=e.tutorialUpAllow=e.tutorialDown=e.tutorialDownAllow=e.tutorialLeft=e.tutorialLeftAllow=e.tutorialRight=e.tutorialRightAllow=e.tutorialCrossLeft=e.tutorialCrossLeftAllow=e.tutorialCrossRight=e.tutorialCrossRightAllow=!1,e.tutorialFade=1,e.tutorialTime=0,e.tutorialSound=null,e.update(0)},GEMIOLI.Play.prototype.update=function(){var e=1500,t=15e4;return function(n,i){var r=this;r.paused&&(n=0);var o=n;switch(n*=r.tutorialFade,r.time+=n,r.player&&r.player.update(n),r.idle||(r.speedTime+=n),r.playerSpeedMode){case 1:r.playerSpeed=2e3;break;case 2:r.playerSpeed=e;break;default:r.speedTime<2?r.playerSpeed=1200*r.speedTime/2+(r.idle?0:300):r.distance<t?r.playerSpeed=500*(r.distance-1500)/148500+e:r.playerSpeed=.002*(r.distance-t)+2e3}for(var a=r.toUpdate.head;a;)a.data.update(n),a=a.next;for(var s=r.scene3D,l=r.toAdd;l.head;)s.add(l.pop());for(var c=r.toRemove;c.head;)s.remove(c.pop());r.player&&r.player.dead&&r.deadTimer>0&&(r.deadTimer-=n)<=0&&(r.fadeMusic(.25,.5),GEMIOLI.Score.show()),r.interfaceShowing?(r.interfaceTime+=2*n)>1&&(r.interfaceTime=1):r.interfaceTime>=0&&(r.interfaceTime-=4*n)<=0&&(r.interfaceTime=0),r.top.y=-300*(1-(r.interfaceShowing?TWEEN.Easing.Back.Out(r.interfaceTime):r.interfaceTime)),r.distanceText.text=Math.floor(r.distance/(GEMIOLI.Application.DEBUG?1:200)).toString(),r.distanceText.scaleX=r.distanceText.scaleY=4/Math.max(4,r.distanceText.text.length),r.coinsText.text=r.coins.toString(),r.coinsText.scaleX=r.coinsText.scaleY=4/Math.max(4,r.coinsText.text.length),r.levelText&&(void 0!==r.debugLevel&&-1!==r.debugLevel?r.levelText.text="Level: "+r.debugLevels[r.debugLevel]:r.levelText.text=""),r.coinTimer>0&&((r.coinTimer-=5*n)<=0&&(r.coinTimer=0),r.coin.scaleX=r.coin.scaleY=1+.2*Math.sin(r.coinTimer*Math.PI)),r.tutorial?(r.tutorialTime+=.7*o,r.distance>4e3&&!r.tutorialUp?(r.tutorialFade=1-(r.distance-4e3)/200,r.tutorialUpAllow=!0,r.tutorialArrow.rotation=-90,r.tutorialPointer.x=0,r.tutorialPointer.y=-700*TWEEN.Easing.Quintic.In(Math.min(1,1.3*(r.tutorialTime-Math.floor(r.tutorialTime))))+350,r.tutorialKeyUp.visible=!0,r.tutorialKeyDown.visible=r.tutorialKeyLeft.visible=r.tutorialKeyRight.visible=!1,r.tutorialKeyUp.tint.a=Math.abs(Math.sin(8*r.tutorialTime))):r.distance>8500&&!r.tutorialDown?(r.tutorialFade=1-(r.distance-8500)/200,r.tutorialDownAllow=!0,r.tutorialArrow.rotation=90,r.tutorialPointer.x=0,r.tutorialPointer.y=700*TWEEN.Easing.Quintic.In(Math.min(1,1.3*(r.tutorialTime-Math.floor(r.tutorialTime))))-350,r.tutorialKeyDown.visible=!0,r.tutorialKeyUp.visible=r.tutorialKeyLeft.visible=r.tutorialKeyRight.visible=!1,r.tutorialKeyDown.tint.a=Math.abs(Math.sin(8*r.tutorialTime))):r.distance>12e3&&!r.tutorialCrossLeft?(r.tutorialFade=1-(r.distance-12e3)/200,r.tutorialCrossLeftAllow=!0,r.tutorialArrow.rotation=180,r.tutorialPointer.x=-700*TWEEN.Easing.Quintic.In(Math.min(1,1.3*(r.tutorialTime-Math.floor(r.tutorialTime))))+350,r.tutorialPointer.y=0,r.tutorialKeyLeft.visible=!0,r.tutorialKeyDown.visible=r.tutorialKeyUp.visible=r.tutorialKeyRight.visible=!1,r.tutorialKeyLeft.tint.a=Math.abs(Math.sin(8*r.tutorialTime))):r.distance>16500&&!r.tutorialRight?(r.tutorialFade=1-(r.distance-16500)/200,r.tutorialRightAllow=!0,r.tutorialArrow.rotation=0,r.tutorialPointer.x=700*TWEEN.Easing.Quintic.In(Math.min(1,1.3*(r.tutorialTime-Math.floor(r.tutorialTime))))-350,r.tutorialPointer.y=0,r.tutorialKeyRight.visible=!0,r.tutorialKeyDown.visible=r.tutorialKeyLeft.visible=r.tutorialKeyUp.visible=!1,r.tutorialKeyRight.tint.a=Math.abs(Math.sin(8*r.tutorialTime))):r.distance>19500&&!r.tutorialLeft?(r.tutorialFade=1-(r.distance-19500)/200,r.tutorialLeftAllow=!0,r.tutorialArrow.rotation=180,r.tutorialPointer.x=-700*TWEEN.Easing.Quintic.In(Math.min(1,1.3*(r.tutorialTime-Math.floor(r.tutorialTime))))+350,r.tutorialPointer.y=0,r.tutorialKeyLeft.visible=!0,r.tutorialKeyDown.visible=r.tutorialKeyUp.visible=r.tutorialKeyRight.visible=!1,r.tutorialKeyLeft.tint.a=Math.abs(Math.sin(8*r.tutorialTime))):r.distance>24e3&&!r.tutorialCrossRight?(r.tutorialFade=1-(r.distance-24e3)/200,r.tutorialCrossRightAllow=!0,r.tutorialArrow.rotation=0,r.tutorialPointer.x=700*TWEEN.Easing.Quintic.In(Math.min(1,1.3*(r.tutorialTime-Math.floor(r.tutorialTime))))-350,r.tutorialPointer.y=0,r.tutorialKeyRight.visible=!0,r.tutorialKeyDown.visible=r.tutorialKeyLeft.visible=r.tutorialKeyUp.visible=!1,r.tutorialKeyRight.tint.a=Math.abs(Math.sin(8*r.tutorialTime))):((r.tutorialFade+=5*o)>=1&&(r.tutorialFade=1,r.tutorialTime=0,r.distance>=25e3&&(r.tutorial=!1,GEMIOLI.Utils.setBool("tutorial",!1))),r.tutorial&&(r.tutorialUpAllow=r.tutorialDownAllow=r.tutorialLeftAllow=r.tutorialRightAllow=r.tutorialCrossLeftAllow=r.tutorialCrossRightAllow=!1),r.tutorialSound&&(r.tutorialSound.volume=1-r.tutorialFade)),r.tutorialInterface.tint.a=1-r.tutorialFade,r.tutorialInterface.visible=!0,r.tutorialFade<1?null===r.tutorialSound&&(r.tutorialSound=GEMIOLI.SoundLoader.load("tutorial").play(),r.tutorialSound.volume=1,r.fadeMusic(.25,.5)):r.tutorialSound&&(r.tutorialSound=null,r.fadeMusic(.25,1))):r.tutorialInterface.visible=!1}}(),GEMIOLI.Play.prototype.onPause=function(){GEMIOLI.Pause.show(),GEMIOLI.Pause.addEventListener("removed",GEMIOLI.Play.onPauseRemoved,!1)},GEMIOLI.Play.prototype.onPauseRemoved=function(){GEMIOLI.Pause.removeEventListener("removed",GEMIOLI.Play.onPauseRemoved,!1),GEMIOLI.Play.paused=!1},GEMIOLI.Play.prototype.from3DTo2D=function(){var e=new THREE.Vector3;return function(t){var n=this;return e.copy(t),e.project(n.camera3D),e.set(.5*(e.x+1)*n.width,(1-.5*(e.y+1))*n.height,0),e}}(),GEMIOLI.List=function(){this.head=null,this.tail=null,this.pool=null},GEMIOLI.List.prototype={constructor:GEMIOLI.List,nodeFromPool:function(e){if(this.pool){var t=this.pool;return this.pool=t.next,t.previous=t.next=null,t.data=e,t}return{data:e,previous:null,next:null}},nodeToPool:function(e){e.data=null,e.previous=null,e.next=this.pool,this.pool=e},add:function(e){var t=this,n=t.nodeFromPool(e);return t.tail?(t.tail.next=n,n.previous=t.tail,t.tail=n):t.head=t.tail=n,n},pop:function(){var e=this;if(e.tail){var t=e.tail.data;return e.removeNode(e.tail),t}return null},removeNode:function(e){var t=this;t.head===e&&(t.head=t.head.next),t.tail===e&&(t.tail=t.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous),t.nodeToPool(e)}},GEMIOLI.BendShader={id:"Bend",uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{bendX:{type:"f",value:1e-4},bendY:{type:"f",value:0}}]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"uniform float bendX;","uniform float bendY;","void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_SKINNING","\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = vec4(0.0);","\tworldPosition += boneMatX * skinVertex * skinWeight.x;","\tworldPosition += boneMatY * skinVertex * skinWeight.y;","\tworldPosition  = bindMatrixInverse * worldPosition;","\tworldPosition  = modelMatrix * vec4(worldPosition.xyz, 1.0);","#else","\tvec4 worldPosition = modelMatrix * vec4(position, 1.0);","#endif","\tvec2 offset = vec2(worldPosition.x - cameraPosition.x, worldPosition.z - cameraPosition.z);","\tfloat bendOffset = offset.x * offset.x + offset.y * offset.y;","\tworldPosition.y += bendOffset * bendY;","\tworldPosition.z += bendOffset * bendX;","\tvec4 mvPosition = viewMatrix * vec4(worldPosition.xyz, 1.0);","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,"\toutgoingLight = diffuseColor.rgb;","\t#ifdef USE_FOG","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\t#ifdef FOG_EXP2","\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );","\t\tfogFactor = whiteCompliment( fogFactor );","\t#else","\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );","\t#endif","\tgl_FragColor = vec4( outgoingLight, diffuseColor.a * (1.0 - fogFactor));","\t#else","\tgl_FragColor = vec4( outgoingLight, diffuseColor.a);","\t#endif","}"].join("\n")},GEMIOLI.SpriteBendShader={id:"SpriteBend",uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{bendX:{type:"f",value:1e-4},bendY:{type:"f",value:0},scale:{type:"f",value:1},rotation:{type:"f",value:0}}]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,"uniform float bendX;","uniform float bendY;","uniform float scale;","uniform float rotation;","void main() {",THREE.ShaderChunk.map_vertex,"\tvec2 alignedPosition = position.xy * vec2(scale, scale);","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 worldPosition;","\tworldPosition = modelMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tvec2 offset = vec2(worldPosition.x - cameraPosition.x, worldPosition.z - cameraPosition.z);","\tfloat bendOffset = offset.x * offset.x + offset.y * offset.y;","\tworldPosition.y += bendOffset * bendY;","\tworldPosition.z += bendOffset * bendX;","\tvec4 mvPosition = viewMatrix * vec4(worldPosition.xyz, 1.0);","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},THREE.SphereBufferGeometry=function(e,t,n,i,r,o,a){THREE.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;for(var s=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),l=(t+1)*(n+1),c=new THREE.BufferAttribute(new Float32Array(3*l),3),h=new THREE.BufferAttribute(new Float32Array(2*l),2),u=0,d=[],p=(new THREE.Vector3,0);p<=n;p++){for(var f=[],E=p/n,m=0;m<=t;m++){var g=m/t,v=-e*Math.cos(i+g*r)*Math.sin(o+E*a),y=e*Math.cos(o+E*a),T=e*Math.sin(i+g*r)*Math.sin(o+E*a);c.setXYZ(u,v,y,T),h.setXY(u,g,E),f.push(u),u++}d.push(f)}var _=[];for(p=0;p<n;p++)for(m=0;m<t;m++){var R=d[p][m+1],b=d[p][m],x=d[p+1][m],w=d[p+1][m+1];(0!==p||o>0)&&_.push(R,b,w),(p!==n-1||s<Math.PI)&&_.push(b,x,w)}this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(_),1)),this.addAttribute("position",c),this.addAttribute("uv",h),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry,THREE.SphereBufferGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.SphereBufferGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},GEMIOLI.Menu=function(){GEMIOLI.Layer.call(this);var e=this;e.bottom=new GEMIOLI.DisplayObjectContainer,e.addChild(e.bottom),e.play=new GEMIOLI.Button(-204,-198,408,397,[13,32,27]),e.play.addChild(GEMIOLI.AtlasQuad.fromRect(-204,-198,408,397,"atlases/menu.atlas","play")),e.play.y=-190,e.play.addEventListener("click",function(t){e.showing&&!GEMIOLI.Button.inFocus&&(e.hide(),GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Play.show())}),e.bottom.addChild(e.play),e.addEventListener("pointerdown",function(t){e.showing&&!GEMIOLI.Button.inFocus&&e.play.dispatchEvent({type:"click"})}),h5branding.Branding.outGoingLinksAllowed()&&(e.more=new GEMIOLI.Button(-178,-167,356,335,[77]),e.more.addChild(GEMIOLI.AtlasQuad.fromRect(-178,-167,356,335,"atlases/menu.atlas","more")),e.more.x=-600,e.more.y=-190,e.more.addEventListener("click",function(t){e.showing&&!GEMIOLI.Button.inFocus&&(GEMIOLI.SoundLoader.load("button").play(),h5branding.Branding.openCampaignLink(GOOGLE_APP_NAME,h5branding.UtmTargets.more_games))})),e.bottom.addChild(e.more),e.shop=new GEMIOLI.Button(-178,-167,356,335,[66]),e.shop.addChild(GEMIOLI.AtlasQuad.fromRect(-178,-167,356,335,"atlases/menu.atlas","shop")),e.shop.x=600,e.shop.y=-190,e.shop.addEventListener("click",function(t){e.showing&&!GEMIOLI.Button.inFocus&&(GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Shop.show())}),e.bottom.addChild(e.shop),e.title1=GEMIOLI.AtlasQuad.fromRect(-447,-158,895,317,"atlases/menu.atlas","title1"),e.addChild(e.title1),e.title2=GEMIOLI.AtlasQuad.fromRect(-405,-114,810,228,"atlases/menu.atlas","title2"),e.addChild(e.title2),e.top=new GEMIOLI.DisplayObjectContainer,e.addChild(e.top),e.settings=new GEMIOLI.Button(-135,-135,271,271,[83]),e.settings.addChild(GEMIOLI.AtlasQuad.fromRect(-135,-135,271,271,"atlases/menu.atlas","settings")),e.settings.x=600,e.settings.y=150,e.settings.addEventListener("click",function(t){e.showing&&!GEMIOLI.Button.inFocus&&(GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Settings.show())}),e.top.addChild(e.settings),e.logo=new GEMIOLI.Logo(-200,-125,400,250),e.logo.x=-600,e.logo.y=150,e.top.addChild(e.logo)},GEMIOLI.Menu.prototype=Object.create(GEMIOLI.Layer.prototype),GEMIOLI.Menu.prototype.show=function(){h5branding.SplashLoader.getInstance()&&h5branding.SplashLoader.getInstance().destroy(),h5branding.google.sendScreenView("menu");this.time=0,this.showing=!0,GEMIOLI.Play.fadeMenu(0,1)},GEMIOLI.Menu.prototype.hide=function(){this.showing=!1,GEMIOLI.Play.fadeMenu(.7,0)},GEMIOLI.Menu.prototype.update=function(e,t){var n=this;if(n.showing)(n.time+=2*e)>1&&(n.time=1);else if(n.time>=0&&(n.time-=4*e)<=0)return void GEMIOLI.Application.popLayer();n.top.x=n.bottom.x=n.width/2,n.bottom.y=500*(1-(n.showing?TWEEN.Easing.Back.Out(n.time):n.time))+n.height,n.title1.y=n.title2.y=n.top.y=-700*(1-(n.showing?TWEEN.Easing.Back.Out(n.time):n.time)),n.title1.x=n.width/2-0-(1-(n.showing?TWEEN.Easing.Elastic.Out(n.time):n.time))*(n.width/2-50+320),n.title2.x=n.width/2+40+(1-(n.showing?TWEEN.Easing.Elastic.Out(n.time):n.time))*(n.width/2+320),n.title1.y=250,n.title2.y=450;var i=1+.02*Math.abs(Math.sin(8*t));n.play.scaleX=n.play.scaleY=i},GEMIOLI.Settings=function(){GEMIOLI.Layer.call(this);var e=this;e.fade=GEMIOLI.AtlasQuad.fromRect(0,0,0,0,"atlases/settings.atlas","fade"),e.addChild(this.fade),e.opacity=0,e.center=new GEMIOLI.DisplayObjectContainer,e.addChild(e.center),e.fade.addEventListener("pointerdown",function(t){e.showing&&!GEMIOLI.Button.inFocus&&e.hide()}),e.back=GEMIOLI.AtlasQuad.fromRect(-585,-562,1171,1125,"atlases/settings.atlas","back"),e.back.addEventListener("pointerdown",function(t){e.back.isUnderPoint(t.x,t.y)&&(t.cancelled=!0)}),e.center.addChild(e.back);var t=GEMIOLI.AtlasQuad.fromRect(-317,-215,635,431,"atlases/settings.atlas","logo");t.x=-200,t.y=-100,e.center.addChild(t),(t=GEMIOLI.AtlasQuad.fromRect(-165,-165,331,331,"atlases/settings.atlas","logo2")).x=330,t.y=-100,e.center.addChild(t),e.sound=new GEMIOLI.Button(-139,-138,278,277,[77,83]),e.sound.on=GEMIOLI.AtlasQuad.fromRect(-139,-138,278,277,"atlases/settings.atlas","sound_on"),e.sound.off=GEMIOLI.AtlasQuad.fromRect(-139,-138,278,277,"atlases/settings.atlas","sound_off"),e.sound.addChild(e.sound.on),e.sound.addChild(e.sound.off),e.sound.x=-250,e.sound.y=300,e.sound.on.visible=GEMIOLI.Utils.getBool("sound",!0),e.sound.off.visible=!e.sound.off.visible,e.sound.addEventListener("click",function(t){e.showing&&(GEMIOLI.SoundLoader.load("button").play(),e.sound.on.visible=!e.sound.on.visible,e.sound.off.visible=!e.sound.off.visible,GEMIOLI.Utils.setBool("sound",e.sound.on.visible),GEMIOLI.Utils.getBool("sound",!0)?GEMIOLI.SoundLoader.unmute():GEMIOLI.SoundLoader.mute())},!1),e.sound.visible=GEMIOLI.SoundLoader.enabled,e.center.addChild(e.sound),e.addEventListener("added",function(t){e.sound.on.visible=GEMIOLI.Utils.getBool("sound",!0),e.sound.off.visible=!e.sound.on.visible},!1),e.close=new GEMIOLI.Button(-139,-138,278,277,[32,13,27]),e.close.x=250,e.close.y=300,e.close.addChild(GEMIOLI.AtlasQuad.fromRect(-139,-138,278,277,"atlases/settings.atlas","close")),e.center.addChild(this.close),e.close.addEventListener("click",function(t){e.showing&&adHandler.showAd("settings",function(){GEMIOLI.SoundLoader.load("button").play(),e.hide()}.bind(this))})},GEMIOLI.Settings.prototype=Object.create(GEMIOLI.Layer.prototype),GEMIOLI.Settings.prototype.resize=function(){var e=this;GEMIOLI.Layer.prototype.resize.call(e),e.fade.setRectangle(0,0,e.width,e.height),e.center.x=e.width/2,e.center.y=e.height/2},GEMIOLI.Settings.prototype.show=function(){var e=this;h5branding.google.sendScreenView("settings"),GEMIOLI.Application.pushLayer(GEMIOLI.Settings),e.opacity=0,e.showing=!0,e.update(0,0),GEMIOLI.SoundLoader.load("open_swish").play()},GEMIOLI.Settings.prototype.hide=function(){adHandler.showAd("settings",function(){this.showing=!1,GEMIOLI.SoundLoader.load("close_swish").play()}.bind(this))},GEMIOLI.Settings.prototype.update=function(e,t){var n=this;if(e*=4,n.showing)(n.opacity+=e)>1&&(n.opacity=1);else if(n.opacity>=0&&(n.opacity-=e)<=0)return void GEMIOLI.Application.popLayer();n.fade.tint.a=n.opacity,n.center.x=n.width/2,n.center.y=n.height/2+(n.showing?-n.height/2*TWEEN.Easing.Back.In(1-n.opacity):n.height/2*TWEEN.Easing.Back.In(1-n.opacity))},GEMIOLI.Pause=function(){GEMIOLI.Layer.call(this);var e=this;e.fade=GEMIOLI.AtlasQuad.fromRect(0,0,0,0,"atlases/pause.atlas","fade"),e.addChild(e.fade),e.opacity=0,e.center=new GEMIOLI.DisplayObjectContainer,e.addChild(e.center),e.fade.addEventListener("pointerdown",function(t){e.showing&&!GEMIOLI.Button.inFocus&&e.hide()}),e.back=GEMIOLI.AtlasQuad.fromRect(-585,-549,1171,1099,"atlases/pause.atlas","back"),e.center.addChild(e.back),e.close=new GEMIOLI.Button(-165,-159,330,318,[32,13,27]),e.close.y=150,e.close.addChild(GEMIOLI.AtlasQuad.fromRect(-165,-159,330,318,"atlases/pause.atlas","close")),e.center.addChild(e.close),e.close.addEventListener("click",function(t){e.showing&&(GEMIOLI.SoundLoader.load("button").play(),e.hide())}),e.restart=new GEMIOLI.Button(-138,-138,277,277,[82]),e.restart.x=350,e.restart.y=250,e.restart.addChild(GEMIOLI.AtlasQuad.fromRect(-138,-138,277,277,"atlases/pause.atlas","restart")),e.center.addChild(e.restart),e.restart.addEventListener("click",function(t){e.showing&&adHandler.showAd("restart",function(){GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Cross.show(function(){GEMIOLI.Application.pushLayer(GEMIOLI.Play),GEMIOLI.Play.show(),GEMIOLI.Play.fadeMusic(.25,1)})}.bind(this))}),e.menu=new GEMIOLI.Button(-139,-138,278,277,[77]),e.menu.x=-350,e.menu.y=250,e.menu.addChild(GEMIOLI.AtlasQuad.fromRect(-139,-138,278,277,"atlases/pause.atlas","menu")),e.center.addChild(e.menu),e.menu.addEventListener("click",function(t){e.showing&&adHandler.showAd("menu",function(){GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Play.fadeMusic(.25,0),GEMIOLI.Cross.show(function(){GEMIOLI.Application.pushLayer(GEMIOLI.Play),GEMIOLI.Application.pushLayer(GEMIOLI.Menu),GEMIOLI.Menu.show()})}.bind(this))}),e.logo=new GEMIOLI.Logo(-225,-90,450,180),e.logo.y=410,e.center.addChild(e.logo)},GEMIOLI.Pause.prototype=Object.create(GEMIOLI.Layer.prototype),GEMIOLI.Pause.prototype.resize=function(){var e=this;GEMIOLI.Layer.prototype.resize.call(e),e.fade.setRectangle(0,0,e.width,e.height),e.center.x=e.width/2,e.center.y=e.height/2},GEMIOLI.Pause.prototype.show=function(){h5branding.google.sendScreenView("pause_menu");var e=this;GEMIOLI.Application.pushLayer(GEMIOLI.Pause),GEMIOLI.Play.paused=!0,e.opacity=0,e.showing=!0,e.update(0,0),GEMIOLI.Play.fadeMusic(.25,.5),GEMIOLI.SoundLoader.load("open_swish").play()},GEMIOLI.Pause.prototype.hide=function(){this.showing=!1,GEMIOLI.Play.tutorialSound||GEMIOLI.Play.fadeMusic(.25,1),GEMIOLI.SoundLoader.load("close_swish").play()},GEMIOLI.Pause.prototype.update=function(e,t){var n=this;if(e*=4,n.showing)(n.opacity+=e)>1&&(n.opacity=1);else if(n.opacity>=0&&(n.opacity-=e)<=0)return void GEMIOLI.Application.popLayer();n.fade.tint.a=n.opacity,n.center.x=n.width/2,n.center.y=n.height/2+(n.showing?-n.height/2*TWEEN.Easing.Back.In(1-n.opacity):n.height/2*TWEEN.Easing.Back.In(1-n.opacity))},GEMIOLI.Score=function(){GEMIOLI.Layer.call(this);var e=this;e.fade=GEMIOLI.AtlasQuad.fromRect(0,0,0,0,"atlases/score.atlas","fade"),e.addChild(e.fade),e.opacity=0,e.center=new GEMIOLI.DisplayObjectContainer,e.addChild(e.center),e.back=GEMIOLI.AtlasQuad.fromRect(-575,-629,1171,1259,"atlases/score.atlas","back"),e.center.addChild(e.back),e.restart=new GEMIOLI.Button(-138,-138,277,277,[32,13,27]),e.restart.x=350,e.restart.y=370,e.restart.addChild(GEMIOLI.AtlasQuad.fromRect(-138,-138,277,277,"atlases/score.atlas","restart")),e.center.addChild(e.restart),e.restart.addEventListener("click",function(t){e.showing&&adHandler.showAd("restart",function(){GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Cross.show(function(){e.hide(),GEMIOLI.Application.pushLayer(GEMIOLI.Play),GEMIOLI.Play.show(),GEMIOLI.Play.fadeMusic(.25,1)})}.bind(this))}),e.shop=new GEMIOLI.Button(-138,-138,277,277,[66,83]),e.shop.y=370,e.shop.addChild(GEMIOLI.AtlasQuad.fromRect(-138,-138,277,277,"atlases/score.atlas","shop")),e.center.addChild(e.shop),e.shop.addEventListener("click",function(t){e.showing&&(GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Shop.show(e.shopAttract),e.shopAttract=0)}),e.menu=new GEMIOLI.Button(-138,-138,277,277,[77]),e.menu.x=-350,e.menu.y=370,e.menu.addChild(GEMIOLI.AtlasQuad.fromRect(-138,-138,277,277,"atlases/score.atlas","menu")),e.center.addChild(e.menu),e.menu.addEventListener("click",function(t){e.showing&&adHandler.showAd("menu",function(){GEMIOLI.SoundLoader.load("button").play(),GEMIOLI.Play.fadeMusic(.25,0),GEMIOLI.Cross.show(function(){e.hide(),GEMIOLI.Application.pushLayer(GEMIOLI.Play),GEMIOLI.Application.pushLayer(GEMIOLI.Menu),GEMIOLI.Menu.show()})}.bind(this))}),e.scoreText=GEMIOLI.Text.fromAtlas(135,"fonts/score/score.fnt","atlases/score.atlas",GEMIOLI.Text.CENTER_ALIGN,GEMIOLI.Text.CENTER_ALIGN,GEMIOLI.Text.CENTER_ALIGN),e.scoreText.y=-250,e.scoreText.offset=-10,e.center.addChild(e.scoreText),e.distanceText=GEMIOLI.Text.fromAtlas(100,"fonts/score/text.fnt","atlases/score.atlas",GEMIOLI.Text.LEFT_ALIGN,GEMIOLI.Text.LEFT_ALIGN,GEMIOLI.Text.CENTER_ALIGN),e.distanceText.x=50,e.distanceText.y=-40,e.distanceText.offset=-15,e.center.addChild(e.distanceText),e.coinsText=GEMIOLI.Text.fromAtlas(100,"fonts/score/text.fnt","atlases/score.atlas",GEMIOLI.Text.LEFT_ALIGN,GEMIOLI.Text.LEFT_ALIGN,GEMIOLI.Text.CENTER_ALIGN),e.coinsText.x=50,e.coinsText.y=95,e.coinsText.offset=-15,e.center.addChild(e.coinsText),e.medal=GEMIOLI.AtlasQuad.fromRect(-186,-186,372,372,"atlases/score.atlas","medal"),e.medal.x=420,e.medal.y=-540,e.center.addChild(e.medal),e.logo=new GEMIOLI.Logo(-175,-90,350,180),e.logo.x=-350,e.logo.y=-450,e.center.addChild(e.logo)},GEMIOLI.Score.prototype=Object.create(GEMIOLI.Layer.prototype),GEMIOLI.Score.prototype.resize=function(){var e=this;GEMIOLI.Layer.prototype.resize.call(e),e.fade.setRectangle(0,0,e.width,e.height),e.center.x=e.width/2,e.center.y=e.height/2},GEMIOLI.Score.prototype.show=function(e){h5branding.google.sendScreenView("gameover");var t=this;GEMIOLI.Application.pushLayer(GEMIOLI.Score),GEMIOLI.Play.paused=!0,t.opacity=0,t.showing=!0;var n=Math.floor(GEMIOLI.Play.distance/200);t.score=100*n+80*GEMIOLI.Play.coins,t.panelSound=t.countSound=!0,t.distanceText.text=n.toString()+"m",t.distanceText.scaleX=t.distanceText.scaleY=6/Math.max(6,t.distanceText.text.length),t.coinsText.text=GEMIOLI.Play.coins.toString(),t.coinsText.scaleX=t.coinsText.scaleY=6/Math.max(6,t.coinsText.text.length);var i=GEMIOLI.Utils.getInt("score",0);e&&(t.score=i+1),t.score>i?(GEMIOLI.Utils.setInt("score",t.score),t.medal.visible=!0,t.medalSound=!0,t.panelSound=!1):(t.medal.visible=!1,t.medalSound=!1),0===t.score&&(t.countSound=!1),t.time=1,t.shopAttract=0;for(var r=0;r<GEMIOLI.Play.playerTypes.length;++r)GEMIOLI.Utils.getBool("skin"+r.toString(),!1)||0===r||GEMIOLI.Play.playerTypes[r].cost<=GEMIOLI.Utils.getInt("coins",0)&&(t.shopAttract=r);h5branding.gameanalytics.addDesignEvent("GameEnd",GEMIOLI.Utils.getInt("highscore",0).toString()),t.adsShown=!1,t.update(0,0),GEMIOLI.SoundLoader.load("open_swish").play()},GEMIOLI.Score.prototype.hide=function(){this.showing=!1},GEMIOLI.Score.prototype.update=function(e,t){var n=this;if(n.time-=e,n.time<0&&(n.time=0),e*=4,n.showing)(n.opacity+=e)>1&&(n.opacity=1,n.adsShown||(n.adsShown=!0));else if(n.opacity>=0&&(n.opacity-=e)<=0)return void GEMIOLI.Application.popLayer();n.fade.tint.a=n.opacity,n.center.x=n.width/2,n.center.y=n.height/2+(n.showing?-n.height/2*TWEEN.Easing.Back.In(1-n.opacity):n.height/2*TWEEN.Easing.Back.In(1-n.opacity));var i=Math.max(n.time-.4,0)/.6;i<.7&&n.countSound&&(GEMIOLI.SoundLoader.load("count").play(),n.countSound=!1);var r=Math.floor(n.score*(1-i)).toString();n.scoreText.text="";for(var o=0;o<r.length;++o)(r.length-o)%3==0&&0!==o&&(n.scoreText.text+=","),n.scoreText.text+=r[o];var a=1+.1*Math.abs(Math.sin(10*i));n.scoreText.scaleX=n.scoreText.scaleY=a,i=Math.max(Math.min(n.time,.5)-.3,0)/.2,n.medal.y=-540-n.height/2*TWEEN.Easing.Back.In(i),n.medal.scaleX=n.medal.scaleY=1+.2*TWEEN.Easing.Back.Out(i),n.medal.visible&&n.medalSound&&i<=.5&&(n.medalSound=!1,GEMIOLI.SoundLoader.load("medal").play()),i=Math.max(Math.min(n.time,.4)-.2,0)/.2,n.center.scaleX=n.center.scaleY=1+.1*Math.sin(i*Math.PI),i<=.3&&n.panelSound&&(GEMIOLI.SoundLoader.load("runR_wood").play(),n.panelSound=!1),n.shop.scaleX=n.shop.scaleY=1+(0!==n.shopAttract?.1*Math.abs(Math.sin(10*t)):0)},GEMIOLI.Shop=function(){GEMIOLI.Layer.call(this);var e=this;e.fade=GEMIOLI.AtlasQuad.fromRect(0,0,0,0,"atlases/shop.atlas","fade"),e.addChild(this.fade),e.opacity=0,e.center=new GEMIOLI.DisplayObjectContainer,e.addChild(e.center),e.fade.addEventListener("pointerdown",function(t){e.showing&&!GEMIOLI.Button.inFocus&&e.hide()}),e.back=GEMIOLI.AtlasQuad.fromRect(-585,-773,1171,1546,"atlases/shop.atlas","back"),e.back.addEventListener("pointerdown",function(t){e.back.isUnderPoint(t.x,t.y)&&(t.cancelled=!0)}),e.center.addChild(e.back),e.close=new GEMIOLI.Button(-139,-138,278,277,[32,13,27]),e.close.x=330,e.close.y=530,e.close.addChild(GEMIOLI.AtlasQuad.fromRect(-139,-138,278,277,"atlases/shop.atlas","close")),e.center.addChild(e.close),e.close.addEventListener("click",function(t){e.showing&&adHandler.showAd("shop",function(){GEMIOLI.SoundLoader.load("button").play(),e.hide()}.bind(this))}),e.buy=new GEMIOLI.Button(-296,-137,593,274,[]),e.buy.x=-170,e.buy.y=530,e.center.addChild(e.buy),e.buyActive=GEMIOLI.AtlasQuad.fromRect(-296,-137,593,274,"atlases/shop.atlas","active"),e.buy.addChild(e.buyActive),e.buySelected=GEMIOLI.AtlasQuad.fromRect(-296,-137,593,274,"atlases/shop.atlas","selected"),e.buy.addChild(e.buySelected),e.buySelect=GEMIOLI.AtlasQuad.fromRect(-296,-137,593,274,"atlases/shop.atlas","select"),e.buy.addChild(e.buySelect),e.buyLabel=new GEMIOLI.DisplayObjectContainer,e.buy.addChild(e.buyLabel),e.buyText=GEMIOLI.Text.fromAtlas(75,"fonts/shop/cost.fnt","atlases/shop.atlas",GEMIOLI.Text.LEFT_ALIGN,GEMIOLI.Text.LEFT_ALIGN,GEMIOLI.Text.CENTER_ALIGN),e.buyText.y=10,e.buyText.text="99999",e.buyText.offset=-15,e.buyLabel.addChild(e.buyText),e.buyCoin=GEMIOLI.AtlasQuad.fromRect(0,-75,118,151,"atlases/shop.atlas","coin"),e.buyLabel.addChild(e.buyCoin),e.buy.addEventListener("click",function(t){if(e.showing&&this.bstate!==GEMIOLI.Button.STATE_DISABLED){var n;if(GEMIOLI.Utils.getBool("skin"+e.currentType.toString(),!1)||0===e.currentType){if(GEMIOLI.Play.playerType=e.currentType,GEMIOLI.Utils.setInt("skin",GEMIOLI.Play.playerType),GEMIOLI.SoundLoader.load("button").play(),!GEMIOLI.Score.showing)GEMIOLI.Play.scene3D.remove(GEMIOLI.Play.player),(n=GEMIOLI.Play.objectFromPool(GEMIOLI.Play.playerTypes[GEMIOLI.Play.playerType].id)).position.set(0,0,0),GEMIOLI.Play.scene3D.add(n)}else if(GEMIOLI.Utils.setInt("coins",GEMIOLI.Utils.getInt("coins",0)-e.playerTypes[e.currentType].cost),GEMIOLI.Utils.setBool("skin"+e.currentType.toString(),!0),GEMIOLI.Play.playerType=e.currentType,GEMIOLI.Utils.setInt("skin",GEMIOLI.Play.playerType),GEMIOLI.SoundLoader.load("buy").play(),!GEMIOLI.Score.showing)GEMIOLI.Play.scene3D.remove(GEMIOLI.Play.player),(n=GEMIOLI.Play.objectFromPool(GEMIOLI.Play.playerTypes[GEMIOLI.Play.playerType].id)).position.set(0,0,0),GEMIOLI.Play.scene3D.add(n);e.updateData(),GEMIOLI.Score.showing||e.hide()}else e.showing&&this.bstate===GEMIOLI.Button.STATE_DISABLED&&GEMIOLI.SoundLoader.load("button").play()}),e.nameText=GEMIOLI.Text.fromAtlas(75,"fonts/shop/name.fnt","atlases/shop.atlas",GEMIOLI.Text.CENTER_ALIGN,GEMIOLI.Text.CENTER_ALIGN,GEMIOLI.Text.CENTER_ALIGN),e.nameText.x=0,e.nameText.y=290,e.nameText.offset=-15,e.nameText.text="Professor Jones",e.center.addChild(e.nameText),e.next=new GEMIOLI.Button(-80,-129,160,258,[39]),e.next.x=410,e.next.y=-100,e.next.addChild(GEMIOLI.AtlasQuad.fromRect(-80,-129,160,258,"atlases/shop.atlas","next")),e.center.addChild(e.next),e.next.addEventListener("click",function(t){e.showing&&(GEMIOLI.SoundLoader.load("button").play(),++e.currentType>=e.playerTypes.length&&(e.currentType=0),e.updateData())}),e.previous=new GEMIOLI.Button(-80,-129,160,258,[37]),e.previous.x=-410,e.previous.y=-100,e.previous.addChild(GEMIOLI.AtlasQuad.fromRect(-80,-129,160,258,"atlases/shop.atlas","previous")),e.center.addChild(e.previous),e.previous.addEventListener("click",function(t){e.showing&&(GEMIOLI.SoundLoader.load("button").play(),--e.currentType<0&&(e.currentType=e.playerTypes.length-1),e.updateData())}),e.coinsText=GEMIOLI.Text.fromAtlas(60,"fonts/shop/count.fnt","atlases/shop.atlas",GEMIOLI.Text.CENTER_ALIGN,GEMIOLI.Text.CENTER_ALIGN,GEMIOLI.Text.CENTER_ALIGN),e.coinsText.x=380,e.coinsText.y=-654,e.coinsText.offset=-15,e.coinsText.text="9999",e.center.addChild(e.coinsText),e.scene3D=new THREE.Object3D,e.camera3D=new THREE.PerspectiveCamera(50,GEMIOLI.Application.innerWidth/GEMIOLI.Application.innerHeight,10,5e3),e.camera3D.position.set(332,34,0),e.camera3D.lookAt(new THREE.Vector3(0,12,0)),e.playerTypes=[],GEMIOLI.AtlasLoader.load("atlases/models.atlas",function(t){GEMIOLI.ModelBatchLoader.load("models/models.js",t,function(t){for(var n in t.models){for(var i=null,r=GEMIOLI.Play.playerTypes,o=0,a=r.length;o<a&&n!==r[o].id;++o);o!==a&&(t.models[n].geometry.bones||(t.models[n].geometry.bones=t.models["models/GGCowboy.js"].geometry.bones,t.models[n].geometry.animation=t.models["models/GGCowboy.js"].geometry.animation),(i=new THREE.SkinnedMesh(t.models[n].geometry,new THREE.MeshBasicMaterial({skinning:!0,map:t.models[n].material.map}),!1)).tempAnimation=new GEMIOLI.Animation(i,t.models[n].geometry.animation),i.tempAnimation.play(0,1),i.tempAnimationController=new GEMIOLI.AnimationController(i.tempAnimation,{idle:{start:236,end:275},hi:{start:277,end:317}}),i.cost=r[o].cost,i.name=r[o].name,i.position.x=100,i.scale.set(.45,.45,.45),i.tempAnimationController.play("idle",!1),i.tempAnimationController.update(0),i.idleTime=5*Math.random()+2,e.playerTypes[o]=i)}},function(e){console.log("Shop can't load models",e)})},function(e){console.log("Shop can't load models atlas",e)})},GEMIOLI.Shop.prototype=Object.create(GEMIOLI.Layer.prototype),GEMIOLI.Shop.prototype.resize=function(){var e=this;GEMIOLI.Layer.prototype.resize.call(e),GEMIOLI.Layer.prototype.resize.call(e);var t=e.camera3D;t.aspect=GEMIOLI.Application.innerWidth/GEMIOLI.Application.innerHeight,t.zoom=1/Math.max(1,e.height/GEMIOLI.Application.HEIGHT),t.updateProjectionMatrix(),e.fade.setRectangle(0,0,e.width,e.height),e.center.x=e.width/2,e.center.y=e.height/2},GEMIOLI.Shop.prototype.show=function(e){h5branding.google.sendScreenView("shop");var t=this;GEMIOLI.Application.pushLayer(GEMIOLI.Shop),t.opacity=0,t.showing=!0,t.currentType=e||GEMIOLI.Play.playerType,t.updateData(),t.update(0,0),GEMIOLI.SoundLoader.load("open_swish").play()},GEMIOLI.Shop.prototype.hide=function(){this.showing=!1,GEMIOLI.SoundLoader.load("close_swish").play()},GEMIOLI.Shop.prototype.update=function(e,t){var n=this;if(e*=4,n.showing)(n.opacity+=e)>1&&(n.opacity=1);else if(n.opacity>=0&&(n.opacity-=e)<=0)return void GEMIOLI.Application.popLayer();n.fade.tint.a=n.opacity,n.center.x=n.width/2,n.center.y=n.height/2+(n.showing?-n.height/2*TWEEN.Easing.Back.In(1-n.opacity):n.height/2*TWEEN.Easing.Back.In(1-n.opacity));for(var i=0;i<n.playerTypes.length;++i){var r=n.playerTypes[i];r.visible&&((r.idleTime-=e/4)<=0&&!r.tempAnimationController.isPlaying()&&(r.idleTime=5*Math.random()+10,r.tempAnimationController.play("hi",!1)),"hi"===r.tempAnimationController.animationId&&r.tempAnimationController.isPlaying()||"idle"===r.tempAnimationController.animationId&&r.tempAnimationController.isPlaying()||r.tempAnimationController.play("idle",!1),r.tempAnimationController.update(e/4),r.updateMatrixWorld(!0))}n.viewportOffset=(n.center.y-n.height/2)*n.scaleY},GEMIOLI.Shop.prototype.updateData=function(){var e=this,t=GEMIOLI.Utils.getInt("coins",0);e.coinsText.text=t.toString(),e.coinsText.scaleX=e.coinsText.scaleY=4/Math.max(4,e.coinsText.text.length);for(var n=0;n<e.playerTypes.length;++n){var i=e.playerTypes[n];i.visible=e.currentType===n,i.visible?(i.tempAnimationController.play("idle",!1),i.idleTime=Math.random()+2,e.scene3D.add(i),GEMIOLI.Utils.getBool("skin"+n.toString(),!1)||0===e.currentType?n===GEMIOLI.Play.playerType?(e.buyActive.visible=e.buySelect.visible=e.buyLabel.visible=!1,e.buySelected.visible=!0,e.buy.setState(GEMIOLI.Button.STATE_DISABLED)):(e.buyActive.visible=e.buySelected.visible=e.buyLabel.visible=!1,e.buySelect.visible=!0,e.buy.setState(GEMIOLI.Button.STATE_NORMAL)):(e.buySelect.visible=e.buySelected.visible=!1,e.buyLabel.visible=!0,e.buyText.text=i.cost.toString(),e.buyText.layout(),e.buyLabel.x=-(e.buyText.textWidth+118)/2,e.buyCoin.x=e.buyText.textWidth,e.buyActive.visible=!0,i.cost>t?(e.buyText.tint.set(1,0,0,1),e.buy.setState(GEMIOLI.Button.STATE_DISABLED)):(e.buyText.tint.set(223/255,254/255,249/255,1),e.buy.setState(GEMIOLI.Button.STATE_NORMAL))),e.nameText.text=i.name,e.nameText.scaleX=e.nameText.scaleY=12/Math.max(12,e.nameText.text.length)):i.parent&&e.scene3D.remove(i)}},GEMIOLI.Shop.prototype.render=function(){var e=this;GEMIOLI.Layer.prototype.render.call(e),GEMIOLI.Renderer.setViewport(0,-e.viewportOffset,GEMIOLI.Application.innerWidth,GEMIOLI.Application.innerHeight),GEMIOLI.Renderer.render(e.scene3D,e.camera3D),GEMIOLI.Renderer.setViewport(0,0,GEMIOLI.Application.innerWidth,GEMIOLI.Application.innerHeight)};